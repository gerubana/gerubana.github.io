!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).HWLLSPlayer=t()}(this,(function(){function e(e,t){return t.forEach((function(t){Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(e)}function t(e,t,r,i,n){var s={};return Object.keys(i).forEach((function(e){s[e]=i[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce((function(r,i){return i(e,t,r)||r}),s),n&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(n):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})})),t}function s(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var a=function(e){return e&&e.Math==Math&&e},o=a("object"==typeof globalThis&&globalThis)||a("object"==typeof window&&window)||a("object"==typeof self&&self)||a("object"==typeof r&&r)||function(){return this}()||Function("return this")(),l={},c=function(e){try{return!!e()}catch(t){return!0}},d=!c((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),u=!c((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),h=u,f=Function.prototype.call,p=h?f.bind(f):function(){return f.apply(f,arguments)},m={},g={}.propertyIsEnumerable,y=Object.getOwnPropertyDescriptor,_=y&&!g.call({1:2},1);m.f=_?function(e){var t=y(this,e);return!!t&&t.enumerable}:g;var v,E,S=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},T=u,b=Function.prototype,R=b.bind,w=b.call,A=T&&R.bind(w,w),L=T?function(e){return e&&A(e)}:function(e){return e&&function(){return w.apply(e,arguments)}},C=L,I=C({}.toString),k=C("".slice),D=function(e){return k(I(e),8,-1)},P=c,O=D,x=Object,M=L("".split),N=P((function(){return!x("z").propertyIsEnumerable(0)}))?function(e){return"String"==O(e)?M(e,""):x(e)}:x,F=TypeError,U=function(e){if(null==e)throw F("Can't call method on "+e);return e},B=N,H=U,j=function(e){return B(H(e))},V=function(e){return"function"==typeof e},G=V,z=function(e){return"object"==typeof e?null!==e:G(e)},K=o,W=V,$=function(e,t){return arguments.length<2?(r=K[e],W(r)?r:void 0):K[e]&&K[e][t];var r},Y=L({}.isPrototypeOf),q=$("navigator","userAgent")||"",Z=o,X=q,J=Z.process,Q=Z.Deno,ee=J&&J.versions||Q&&Q.version,te=ee&&ee.v8;te&&(E=(v=te.split("."))[0]>0&&v[0]<4?1:+(v[0]+v[1])),!E&&X&&(!(v=X.match(/Edge\/(\d+)/))||v[1]>=74)&&(v=X.match(/Chrome\/(\d+)/))&&(E=+v[1]);var re=E,ie=re,ne=c,se=!!Object.getOwnPropertySymbols&&!ne((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ie&&ie<41})),ae=se&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,oe=$,le=V,ce=Y,de=Object,ue=ae?function(e){return"symbol"==typeof e}:function(e){var t=oe("Symbol");return le(t)&&ce(t.prototype,de(e))},he=String,fe=function(e){try{return he(e)}catch(t){return"Object"}},pe=V,me=fe,ge=TypeError,ye=function(e){if(pe(e))return e;throw ge(me(e)+" is not a function")},_e=ye,ve=function(e,t){var r=e[t];return null==r?void 0:_e(r)},Ee=p,Se=V,Te=z,be=TypeError,Re={exports:{}},we=o,Ae=Object.defineProperty,Le=function(e,t){try{Ae(we,e,{value:t,configurable:!0,writable:!0})}catch(r){we[e]=t}return t},Ce=Le,Ie="__core-js_shared__",ke=o[Ie]||Ce(Ie,{}),De=ke;(Re.exports=function(e,t){return De[e]||(De[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.23.3",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.23.3/LICENSE",source:"https://github.com/zloirock/core-js"});var Pe=U,Oe=Object,xe=function(e){return Oe(Pe(e))},Me=xe,Ne=L({}.hasOwnProperty),Fe=Object.hasOwn||function(e,t){return Ne(Me(e),t)},Ue=L,Be=0,He=Math.random(),je=Ue(1..toString),Ve=function(e){return"Symbol("+(void 0===e?"":e)+")_"+je(++Be+He,36)},Ge=o,ze=Re.exports,Ke=Fe,We=Ve,$e=se,Ye=ae,qe=ze("wks"),Ze=Ge.Symbol,Xe=Ze&&Ze.for,Je=Ye?Ze:Ze&&Ze.withoutSetter||We,Qe=function(e){if(!Ke(qe,e)||!$e&&"string"!=typeof qe[e]){var t="Symbol."+e;$e&&Ke(Ze,e)?qe[e]=Ze[e]:qe[e]=Ye&&Xe?Xe(t):Je(t)}return qe[e]},et=p,tt=z,rt=ue,it=ve,nt=function(e,t){var r,i;if("string"===t&&Se(r=e.toString)&&!Te(i=Ee(r,e)))return i;if(Se(r=e.valueOf)&&!Te(i=Ee(r,e)))return i;if("string"!==t&&Se(r=e.toString)&&!Te(i=Ee(r,e)))return i;throw be("Can't convert object to primitive value")},st=TypeError,at=Qe("toPrimitive"),ot=function(e,t){if(!tt(e)||rt(e))return e;var r,i=it(e,at);if(i){if(void 0===t&&(t="default"),r=et(i,e,t),!tt(r)||rt(r))return r;throw st("Can't convert object to primitive value")}return void 0===t&&(t="number"),nt(e,t)},lt=ot,ct=ue,dt=function(e){var t=lt(e,"string");return ct(t)?t:t+""},ut=z,ht=o.document,ft=ut(ht)&&ut(ht.createElement),pt=function(e){return ft?ht.createElement(e):{}},mt=pt,gt=!d&&!c((function(){return 7!=Object.defineProperty(mt("div"),"a",{get:function(){return 7}}).a})),yt=d,_t=p,vt=m,Et=S,St=j,Tt=dt,bt=Fe,Rt=gt,wt=Object.getOwnPropertyDescriptor;l.f=yt?wt:function(e,t){if(e=St(e),t=Tt(t),Rt)try{return wt(e,t)}catch(r){}if(bt(e,t))return Et(!_t(vt.f,e,t),e[t])};var At={},Lt=d&&c((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Ct=z,It=String,kt=TypeError,Dt=function(e){if(Ct(e))return e;throw kt(It(e)+" is not an object")},Pt=d,Ot=gt,xt=Lt,Mt=Dt,Nt=dt,Ft=TypeError,Ut=Object.defineProperty,Bt=Object.getOwnPropertyDescriptor,Ht="enumerable",jt="configurable",Vt="writable";At.f=Pt?xt?function(e,t,r){if(Mt(e),t=Nt(t),Mt(r),"function"==typeof e&&"prototype"===t&&"value"in r&&Vt in r&&!r[Vt]){var i=Bt(e,t);i&&i[Vt]&&(e[t]=r.value,r={configurable:jt in r?r[jt]:i[jt],enumerable:Ht in r?r[Ht]:i[Ht],writable:!1})}return Ut(e,t,r)}:Ut:function(e,t,r){if(Mt(e),t=Nt(t),Mt(r),Ot)try{return Ut(e,t,r)}catch(i){}if("get"in r||"set"in r)throw Ft("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var Gt=At,zt=S,Kt=d?function(e,t,r){return Gt.f(e,t,zt(1,r))}:function(e,t,r){return e[t]=r,e},Wt={exports:{}},$t=d,Yt=Fe,qt=Function.prototype,Zt=$t&&Object.getOwnPropertyDescriptor,Xt=Yt(qt,"name"),Jt={EXISTS:Xt,PROPER:Xt&&"something"===function(){}.name,CONFIGURABLE:Xt&&(!$t||$t&&Zt(qt,"name").configurable)},Qt=V,er=ke,tr=L(Function.toString);Qt(er.inspectSource)||(er.inspectSource=function(e){return tr(e)});var rr,ir,nr,sr=er.inspectSource,ar=V,or=sr,lr=o.WeakMap,cr=ar(lr)&&/native code/.test(or(lr)),dr=Re.exports,ur=Ve,hr=dr("keys"),fr=function(e){return hr[e]||(hr[e]=ur(e))},pr={},mr=cr,gr=o,yr=L,_r=z,vr=Kt,Er=Fe,Sr=ke,Tr=fr,br=pr,Rr="Object already initialized",wr=gr.TypeError,Ar=gr.WeakMap;if(mr||Sr.state){var Lr=Sr.state||(Sr.state=new Ar),Cr=yr(Lr.get),Ir=yr(Lr.has),kr=yr(Lr.set);rr=function(e,t){if(Ir(Lr,e))throw new wr(Rr);return t.facade=e,kr(Lr,e,t),t},ir=function(e){return Cr(Lr,e)||{}},nr=function(e){return Ir(Lr,e)}}else{var Dr=Tr("state");br[Dr]=!0,rr=function(e,t){if(Er(e,Dr))throw new wr(Rr);return t.facade=e,vr(e,Dr,t),t},ir=function(e){return Er(e,Dr)?e[Dr]:{}},nr=function(e){return Er(e,Dr)}}var Pr={set:rr,get:ir,has:nr,enforce:function(e){return nr(e)?ir(e):rr(e,{})},getterFor:function(e){return function(t){var r;if(!_r(t)||(r=ir(t)).type!==e)throw wr("Incompatible receiver, "+e+" required");return r}}},Or=c,xr=V,Mr=Fe,Nr=d,Fr=Jt.CONFIGURABLE,Ur=sr,Br=Pr.enforce,Hr=Pr.get,jr=Object.defineProperty,Vr=Nr&&!Or((function(){return 8!==jr((function(){}),"length",{value:8}).length})),Gr=String(String).split("String"),zr=Wt.exports=function(e,t,r){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!Mr(e,"name")||Fr&&e.name!==t)&&(Nr?jr(e,"name",{value:t,configurable:!0}):e.name=t),Vr&&r&&Mr(r,"arity")&&e.length!==r.arity&&jr(e,"length",{value:r.arity});try{r&&Mr(r,"constructor")&&r.constructor?Nr&&jr(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(n){}var i=Br(e);return Mr(i,"source")||(i.source=Gr.join("string"==typeof t?t:"")),e};Function.prototype.toString=zr((function(){return xr(this)&&Hr(this).source||Ur(this)}),"toString");var Kr=V,Wr=At,$r=Wt.exports,Yr=Le,qr=function(e,t,r,i){i||(i={});var n=i.enumerable,s=void 0!==i.name?i.name:t;if(Kr(r)&&$r(r,s,i),i.global)n?e[t]=r:Yr(t,r);else{try{i.unsafe?e[t]&&(n=!0):delete e[t]}catch(a){}n?e[t]=r:Wr.f(e,t,{value:r,enumerable:!1,configurable:!i.nonConfigurable,writable:!i.nonWritable})}return e},Zr={},Xr=Math.ceil,Jr=Math.floor,Qr=Math.trunc||function(e){var t=+e;return(t>0?Jr:Xr)(t)},ei=function(e){var t=+e;return t!=t||0===t?0:Qr(t)},ti=ei,ri=Math.max,ii=Math.min,ni=function(e,t){var r=ti(e);return r<0?ri(r+t,0):ii(r,t)},si=ei,ai=Math.min,oi=function(e){return e>0?ai(si(e),9007199254740991):0},li=oi,ci=function(e){return li(e.length)},di=j,ui=ni,hi=ci,fi=function(e){return function(t,r,i){var n,s=di(t),a=hi(s),o=ui(i,a);if(e&&r!=r){for(;a>o;)if((n=s[o++])!=n)return!0}else for(;a>o;o++)if((e||o in s)&&s[o]===r)return e||o||0;return!e&&-1}},pi={includes:fi(!0),indexOf:fi(!1)},mi=Fe,gi=j,yi=pi.indexOf,_i=pr,vi=L([].push),Ei=function(e,t){var r,i=gi(e),n=0,s=[];for(r in i)!mi(_i,r)&&mi(i,r)&&vi(s,r);for(;t.length>n;)mi(i,r=t[n++])&&(~yi(s,r)||vi(s,r));return s},Si=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ti=Ei,bi=Si.concat("length","prototype");Zr.f=Object.getOwnPropertyNames||function(e){return Ti(e,bi)};var Ri={};Ri.f=Object.getOwnPropertySymbols;var wi=$,Ai=Zr,Li=Ri,Ci=Dt,Ii=L([].concat),ki=wi("Reflect","ownKeys")||function(e){var t=Ai.f(Ci(e)),r=Li.f;return r?Ii(t,r(e)):t},Di=Fe,Pi=ki,Oi=l,xi=At,Mi=function(e,t,r){for(var i=Pi(t),n=xi.f,s=Oi.f,a=0;a<i.length;a++){var o=i[a];Di(e,o)||r&&Di(r,o)||n(e,o,s(t,o))}},Ni=c,Fi=V,Ui=/#|\.prototype\./,Bi=function(e,t){var r=ji[Hi(e)];return r==Gi||r!=Vi&&(Fi(t)?Ni(t):!!t)},Hi=Bi.normalize=function(e){return String(e).replace(Ui,".").toLowerCase()},ji=Bi.data={},Vi=Bi.NATIVE="N",Gi=Bi.POLYFILL="P",zi=Bi,Ki=o,Wi=l.f,$i=Kt,Yi=qr,qi=Le,Zi=Mi,Xi=zi,Ji=function(e,t){var r,i,n,s,a,o=e.target,l=e.global,c=e.stat;if(r=l?Ki:c?Ki[o]||qi(o,{}):(Ki[o]||{}).prototype)for(i in t){if(s=t[i],n=e.dontCallGetSet?(a=Wi(r,i))&&a.value:r[i],!Xi(l?i:o+(c?".":"#")+i,e.forced)&&void 0!==n){if(typeof s==typeof n)continue;Zi(s,n)}(e.sham||n&&n.sham)&&$i(s,"sham",!0),Yi(r,i,s,e)}},Qi="process"==D(o.process),en=V,tn=String,rn=TypeError,nn=L,sn=Dt,an=function(e){if("object"==typeof e||en(e))return e;throw rn("Can't set "+tn(e)+" as a prototype")},on=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=nn(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(i){}return function(r,i){return sn(r),an(i),t?e(r,i):r.__proto__=i,r}}():void 0),ln=At.f,cn=Fe,dn=Qe("toStringTag"),un=function(e,t,r){e&&!r&&(e=e.prototype),e&&!cn(e,dn)&&ln(e,dn,{configurable:!0,value:t})},hn=$,fn=At,pn=d,mn=Qe("species"),gn=function(e){var t=hn(e),r=fn.f;pn&&t&&!t[mn]&&r(t,mn,{configurable:!0,get:function(){return this}})},yn=Y,_n=TypeError,vn=function(e,t){if(yn(t,e))return e;throw _n("Incorrect invocation")},En={};En[Qe("toStringTag")]="z";var Sn="[object z]"===String(En),Tn=V,bn=D,Rn=Qe("toStringTag"),wn=Object,An="Arguments"==bn(function(){return arguments}()),Ln=Sn?bn:function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(r){}}(t=wn(e),Rn))?r:An?bn(t):"Object"==(i=bn(t))&&Tn(t.callee)?"Arguments":i},Cn=L,In=c,kn=V,Dn=Ln,Pn=sr,On=function(){},xn=[],Mn=$("Reflect","construct"),Nn=/^\s*(?:class|function)\b/,Fn=Cn(Nn.exec),Un=!Nn.exec(On),Bn=function(e){if(!kn(e))return!1;try{return Mn(On,xn,e),!0}catch(t){return!1}},Hn=function(e){if(!kn(e))return!1;switch(Dn(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Un||!!Fn(Nn,Pn(e))}catch(t){return!0}};Hn.sham=!0;var jn,Vn,Gn,zn,Kn=!Mn||In((function(){var e;return Bn(Bn.call)||!Bn(Object)||!Bn((function(){e=!0}))||e}))?Hn:Bn,Wn=Kn,$n=fe,Yn=TypeError,qn=function(e){if(Wn(e))return e;throw Yn($n(e)+" is not a constructor")},Zn=Dt,Xn=qn,Jn=Qe("species"),Qn=function(e,t){var r,i=Zn(e).constructor;return void 0===i||null==(r=Zn(i)[Jn])?t:Xn(r)},es=u,ts=Function.prototype,rs=ts.apply,is=ts.call,ns="object"==typeof Reflect&&Reflect.apply||(es?is.bind(rs):function(){return is.apply(rs,arguments)}),ss=ye,as=u,os=L(L.bind),ls=function(e,t){return ss(e),void 0===t?e:as?os(e,t):function(){return e.apply(t,arguments)}},cs=$("document","documentElement"),ds=L([].slice),us=TypeError,hs=/(?:ipad|iphone|ipod).*applewebkit/i.test(q),fs=o,ps=ns,ms=ls,gs=V,ys=Fe,_s=c,vs=cs,Es=ds,Ss=pt,Ts=function(e,t){if(e<t)throw us("Not enough arguments");return e},bs=hs,Rs=Qi,ws=fs.setImmediate,As=fs.clearImmediate,Ls=fs.process,Cs=fs.Dispatch,Is=fs.Function,ks=fs.MessageChannel,Ds=fs.String,Ps=0,Os={},xs="onreadystatechange";try{jn=fs.location}catch(IU){}var Ms=function(e){if(ys(Os,e)){var t=Os[e];delete Os[e],t()}},Ns=function(e){return function(){Ms(e)}},Fs=function(e){Ms(e.data)},Us=function(e){fs.postMessage(Ds(e),jn.protocol+"//"+jn.host)};ws&&As||(ws=function(e){Ts(arguments.length,1);var t=gs(e)?e:Is(e),r=Es(arguments,1);return Os[++Ps]=function(){ps(t,void 0,r)},Vn(Ps),Ps},As=function(e){delete Os[e]},Rs?Vn=function(e){Ls.nextTick(Ns(e))}:Cs&&Cs.now?Vn=function(e){Cs.now(Ns(e))}:ks&&!bs?(zn=(Gn=new ks).port2,Gn.port1.onmessage=Fs,Vn=ms(zn.postMessage,zn)):fs.addEventListener&&gs(fs.postMessage)&&!fs.importScripts&&jn&&"file:"!==jn.protocol&&!_s(Us)?(Vn=Us,fs.addEventListener("message",Fs,!1)):Vn=xs in Ss("script")?function(e){vs.appendChild(Ss("script"))[xs]=function(){vs.removeChild(this),Ms(e)}}:function(e){setTimeout(Ns(e),0)});var Bs,Hs,js,Vs,Gs,zs,Ks,Ws,$s={set:ws,clear:As},Ys=o,qs=/ipad|iphone|ipod/i.test(q)&&void 0!==Ys.Pebble,Zs=/web0s(?!.*chrome)/i.test(q),Xs=o,Js=ls,Qs=l.f,ea=$s.set,ta=hs,ra=qs,ia=Zs,na=Qi,sa=Xs.MutationObserver||Xs.WebKitMutationObserver,aa=Xs.document,oa=Xs.process,la=Xs.Promise,ca=Qs(Xs,"queueMicrotask"),da=ca&&ca.value;da||(Bs=function(){var e,t;for(na&&(e=oa.domain)&&e.exit();Hs;){t=Hs.fn,Hs=Hs.next;try{t()}catch(IU){throw Hs?Vs():js=void 0,IU}}js=void 0,e&&e.enter()},ta||na||ia||!sa||!aa?!ra&&la&&la.resolve?((Ks=la.resolve(void 0)).constructor=la,Ws=Js(Ks.then,Ks),Vs=function(){Ws(Bs)}):na?Vs=function(){oa.nextTick(Bs)}:(ea=Js(ea,Xs),Vs=function(){ea(Bs)}):(Gs=!0,zs=aa.createTextNode(""),new sa(Bs).observe(zs,{characterData:!0}),Vs=function(){zs.data=Gs=!Gs}));var ua=da||function(e){var t={fn:e,next:void 0};js&&(js.next=t),Hs||(Hs=t,Vs()),js=t},ha=o,fa=function(e){try{return{error:!1,value:e()}}catch(IU){return{error:!0,value:IU}}},pa=function(){this.head=null,this.tail=null};pa.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var ma=pa,ga=o.Promise,ya="object"==typeof window&&"object"!=typeof Deno,_a=o,va=ga,Ea=V,Sa=zi,Ta=sr,ba=Qe,Ra=ya,wa=re;va&&va.prototype;var Aa=ba("species"),La=!1,Ca=Ea(_a.PromiseRejectionEvent),Ia=Sa("Promise",(function(){var e=Ta(va),t=e!==String(va);if(!t&&66===wa)return!0;if(wa>=51&&/native code/.test(e))return!1;var r=new va((function(e){e(1)})),i=function(e){e((function(){}),(function(){}))};return(r.constructor={})[Aa]=i,!(La=r.then((function(){}))instanceof i)||!t&&Ra&&!Ca})),ka={CONSTRUCTOR:Ia,REJECTION_EVENT:Ca,SUBCLASSING:La},Da={},Pa=ye,Oa=function(e){var t,r;this.promise=new e((function(e,i){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=i})),this.resolve=Pa(t),this.reject=Pa(r)};Da.f=function(e){return new Oa(e)};var xa,Ma,Na,Fa=Ji,Ua=Qi,Ba=o,Ha=p,ja=qr,Va=on,Ga=un,za=gn,Ka=ye,Wa=V,$a=z,Ya=vn,qa=Qn,Za=$s.set,Xa=ua,Ja=function(e,t){var r=ha.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))},Qa=fa,eo=ma,to=Pr,ro=ga,io=Da,no="Promise",so=ka.CONSTRUCTOR,ao=ka.REJECTION_EVENT,oo=ka.SUBCLASSING,lo=to.getterFor(no),co=to.set,uo=ro&&ro.prototype,ho=ro,fo=uo,po=Ba.TypeError,mo=Ba.document,go=Ba.process,yo=io.f,_o=yo,vo=!!(mo&&mo.createEvent&&Ba.dispatchEvent),Eo="unhandledrejection",So=function(e){var t;return!(!$a(e)||!Wa(t=e.then))&&t},To=function(e,t){var r,i,n,s=t.value,a=1==t.state,o=a?e.ok:e.fail,l=e.resolve,c=e.reject,d=e.domain;try{o?(a||(2===t.rejection&&Lo(t),t.rejection=1),!0===o?r=s:(d&&d.enter(),r=o(s),d&&(d.exit(),n=!0)),r===e.promise?c(po("Promise-chain cycle")):(i=So(r))?Ha(i,r,l,c):l(r)):c(s)}catch(IU){d&&!n&&d.exit(),c(IU)}},bo=function(e,t){e.notified||(e.notified=!0,Xa((function(){for(var r,i=e.reactions;r=i.get();)To(r,e);e.notified=!1,t&&!e.rejection&&wo(e)})))},Ro=function(e,t,r){var i,n;vo?((i=mo.createEvent("Event")).promise=t,i.reason=r,i.initEvent(e,!1,!0),Ba.dispatchEvent(i)):i={promise:t,reason:r},!ao&&(n=Ba["on"+e])?n(i):e===Eo&&Ja("Unhandled promise rejection",r)},wo=function(e){Ha(Za,Ba,(function(){var t,r=e.facade,i=e.value;if(Ao(e)&&(t=Qa((function(){Ua?go.emit("unhandledRejection",i,r):Ro(Eo,r,i)})),e.rejection=Ua||Ao(e)?2:1,t.error))throw t.value}))},Ao=function(e){return 1!==e.rejection&&!e.parent},Lo=function(e){Ha(Za,Ba,(function(){var t=e.facade;Ua?go.emit("rejectionHandled",t):Ro("rejectionhandled",t,e.value)}))},Co=function(e,t,r){return function(i){e(t,i,r)}},Io=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,bo(e,!0))},ko=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw po("Promise can't be resolved itself");var i=So(t);i?Xa((function(){var r={done:!1};try{Ha(i,t,Co(ko,r,e),Co(Io,r,e))}catch(IU){Io(r,IU,e)}})):(e.value=t,e.state=1,bo(e,!1))}catch(IU){Io({done:!1},IU,e)}}};if(so&&(fo=(ho=function(e){Ya(this,fo),Ka(e),Ha(xa,this);var t=lo(this);try{e(Co(ko,t),Co(Io,t))}catch(IU){Io(t,IU)}}).prototype,(xa=function(e){co(this,{type:no,done:!1,notified:!1,parent:!1,reactions:new eo,rejection:!1,state:0,value:void 0})}).prototype=ja(fo,"then",(function(e,t){var r=lo(this),i=yo(qa(this,ho));return r.parent=!0,i.ok=!Wa(e)||e,i.fail=Wa(t)&&t,i.domain=Ua?go.domain:void 0,0==r.state?r.reactions.add(i):Xa((function(){To(i,r)})),i.promise})),Ma=function(){var e=new xa,t=lo(e);this.promise=e,this.resolve=Co(ko,t),this.reject=Co(Io,t)},io.f=yo=function(e){return e===ho||undefined===e?new Ma(e):_o(e)},Wa(ro)&&uo!==Object.prototype)){Na=uo.then,oo||ja(uo,"then",(function(e,t){var r=this;return new ho((function(e,t){Ha(Na,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete uo.constructor}catch(IU){}Va&&Va(uo,fo)}Fa({global:!0,constructor:!0,wrap:!0,forced:so},{Promise:ho}),Ga(ho,no,!1),za(no);var Do={},Po=Do,Oo=Qe("iterator"),xo=Array.prototype,Mo=function(e){return void 0!==e&&(Po.Array===e||xo[Oo]===e)},No=Ln,Fo=ve,Uo=Do,Bo=Qe("iterator"),Ho=function(e){if(null!=e)return Fo(e,Bo)||Fo(e,"@@iterator")||Uo[No(e)]},jo=p,Vo=ye,Go=Dt,zo=fe,Ko=Ho,Wo=TypeError,$o=function(e,t){var r=arguments.length<2?Ko(e):t;if(Vo(r))return Go(jo(r,e));throw Wo(zo(e)+" is not iterable")},Yo=p,qo=Dt,Zo=ve,Xo=ls,Jo=p,Qo=Dt,el=fe,tl=Mo,rl=ci,il=Y,nl=$o,sl=Ho,al=function(e,t,r){var i,n;qo(e);try{if(!(i=Zo(e,"return"))){if("throw"===t)throw r;return r}i=Yo(i,e)}catch(IU){n=!0,i=IU}if("throw"===t)throw r;if(n)throw i;return qo(i),r},ol=TypeError,ll=function(e,t){this.stopped=e,this.result=t},cl=ll.prototype,dl=function(e,t,r){var i,n,s,a,o,l,c,d=r&&r.that,u=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_ITERATOR),f=!(!r||!r.INTERRUPTED),p=Xo(t,d),m=function(e){return i&&al(i,"normal",e),new ll(!0,e)},g=function(e){return u?(Qo(e),f?p(e[0],e[1],m):p(e[0],e[1])):f?p(e,m):p(e)};if(h)i=e;else{if(!(n=sl(e)))throw ol(el(e)+" is not iterable");if(tl(n)){for(s=0,a=rl(e);a>s;s++)if((o=g(e[s]))&&il(cl,o))return o;return new ll(!1)}i=nl(e,n)}for(l=i.next;!(c=Jo(l,i)).done;){try{o=g(c.value)}catch(IU){al(i,"throw",IU)}if("object"==typeof o&&o&&il(cl,o))return o}return new ll(!1)},ul=Qe("iterator"),hl=!1;try{var fl=0,pl={next:function(){return{done:!!fl++}},return:function(){hl=!0}};pl[ul]=function(){return this},Array.from(pl,(function(){throw 2}))}catch(IU){}var ml=function(e,t){if(!t&&!hl)return!1;var r=!1;try{var i={};i[ul]=function(){return{next:function(){return{done:r=!0}}}},e(i)}catch(IU){}return r},gl=ga,yl=ka.CONSTRUCTOR||!ml((function(e){gl.all(e).then(void 0,(function(){}))})),_l=p,vl=ye,El=Da,Sl=fa,Tl=dl;Ji({target:"Promise",stat:!0,forced:yl},{all:function(e){var t=this,r=El.f(t),i=r.resolve,n=r.reject,s=Sl((function(){var r=vl(t.resolve),s=[],a=0,o=1;Tl(e,(function(e){var l=a++,c=!1;o++,_l(r,t,e).then((function(e){c||(c=!0,s[l]=e,--o||i(s))}),n)})),--o||i(s)}));return s.error&&n(s.value),r.promise}});var bl=Ji,Rl=ka.CONSTRUCTOR,wl=ga,Al=$,Ll=V,Cl=qr,Il=wl&&wl.prototype;if(bl({target:"Promise",proto:!0,forced:Rl,real:!0},{catch:function(e){return this.then(void 0,e)}}),Ll(wl)){var kl=Al("Promise").prototype.catch;Il.catch!==kl&&Cl(Il,"catch",kl,{unsafe:!0})}var Dl=p,Pl=ye,Ol=Da,xl=fa,Ml=dl;Ji({target:"Promise",stat:!0,forced:yl},{race:function(e){var t=this,r=Ol.f(t),i=r.reject,n=xl((function(){var n=Pl(t.resolve);Ml(e,(function(e){Dl(n,t,e).then(r.resolve,i)}))}));return n.error&&i(n.value),r.promise}});var Nl=p,Fl=Da;Ji({target:"Promise",stat:!0,forced:ka.CONSTRUCTOR},{reject:function(e){var t=Fl.f(this);return Nl(t.reject,void 0,e),t.promise}});var Ul=Dt,Bl=z,Hl=Da,jl=function(e,t){if(Ul(e),Bl(t)&&t.constructor===e)return t;var r=Hl.f(e);return(0,r.resolve)(t),r.promise},Vl=Ji,Gl=ka.CONSTRUCTOR,zl=jl;function Kl(e){return Kl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kl(e)}function Wl(e){var t=function(e,t){if("object"!=Kl(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=Kl(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Kl(t)?t:t+""}function $l(e,t,r){return(t=Wl(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}$("Promise"),Vl({target:"Promise",stat:!0,forced:Gl},{resolve:function(e){return zl(this,e)}});var Yl=Ln,ql=String,Zl=function(e){if("Symbol"===Yl(e))throw TypeError("Cannot convert a Symbol value to a string");return ql(e)},Xl=Dt,Jl=function(){var e=Xl(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Ql=c,ec=o.RegExp,tc=Ql((function(){var e=ec("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),rc=tc||Ql((function(){return!ec("a","y").sticky})),ic={BROKEN_CARET:tc||Ql((function(){var e=ec("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),MISSED_STICKY:rc,UNSUPPORTED_Y:tc},nc={},sc=Ei,ac=Si,oc=Object.keys||function(e){return sc(e,ac)},lc=d,cc=Lt,dc=At,uc=Dt,hc=j,fc=oc;nc.f=lc&&!cc?Object.defineProperties:function(e,t){uc(e);for(var r,i=hc(t),n=fc(t),s=n.length,a=0;s>a;)dc.f(e,r=n[a++],i[r]);return e};var pc,mc=Dt,gc=nc,yc=Si,_c=pr,vc=cs,Ec=pt,Sc="prototype",Tc="script",bc=fr("IE_PROTO"),Rc=function(){},wc=function(e){return"<"+Tc+">"+e+"</"+Tc+">"},Ac=function(e){e.write(wc("")),e.close();var t=e.parentWindow.Object;return e=null,t},Lc=function(){try{pc=new ActiveXObject("htmlfile")}catch(IU){}var e,t,r;Lc="undefined"!=typeof document?document.domain&&pc?Ac(pc):(t=Ec("iframe"),r="java"+Tc+":",t.style.display="none",vc.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(wc("document.F=Object")),e.close(),e.F):Ac(pc);for(var i=yc.length;i--;)delete Lc[Sc][yc[i]];return Lc()};_c[bc]=!0;var Cc=Object.create||function(e,t){var r;return null!==e?(Rc[Sc]=mc(e),r=new Rc,Rc[Sc]=null,r[bc]=e):r=Lc(),void 0===t?r:gc.f(r,t)},Ic=c,kc=o.RegExp,Dc=Ic((function(){var e=kc(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),Pc=c,Oc=o.RegExp,xc=Pc((function(){var e=Oc("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),Mc=p,Nc=L,Fc=Zl,Uc=Jl,Bc=ic,Hc=Re.exports,jc=Cc,Vc=Pr.get,Gc=Dc,zc=xc,Kc=Hc("native-string-replace",String.prototype.replace),Wc=RegExp.prototype.exec,$c=Wc,Yc=Nc("".charAt),qc=Nc("".indexOf),Zc=Nc("".replace),Xc=Nc("".slice),Jc=function(){var e=/a/,t=/b*/g;return Mc(Wc,e,"a"),Mc(Wc,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),Qc=Bc.BROKEN_CARET,ed=void 0!==/()??/.exec("")[1];(Jc||ed||Qc||Gc||zc)&&($c=function(e){var t,r,i,n,s,a,o,l=this,c=Vc(l),d=Fc(e),u=c.raw;if(u)return u.lastIndex=l.lastIndex,t=Mc($c,u,d),l.lastIndex=u.lastIndex,t;var h=c.groups,f=Qc&&l.sticky,p=Mc(Uc,l),m=l.source,g=0,y=d;if(f&&(p=Zc(p,"y",""),-1===qc(p,"g")&&(p+="g"),y=Xc(d,l.lastIndex),l.lastIndex>0&&(!l.multiline||l.multiline&&"\n"!==Yc(d,l.lastIndex-1))&&(m="(?: "+m+")",y=" "+y,g++),r=new RegExp("^(?:"+m+")",p)),ed&&(r=new RegExp("^"+m+"$(?!\\s)",p)),Jc&&(i=l.lastIndex),n=Mc(Wc,f?r:l,y),f?n?(n.input=Xc(n.input,g),n[0]=Xc(n[0],g),n.index=l.lastIndex,l.lastIndex+=n[0].length):l.lastIndex=0:Jc&&n&&(l.lastIndex=l.global?n.index+n[0].length:i),ed&&n&&n.length>1&&Mc(Kc,n[0],r,(function(){for(s=1;s<arguments.length-2;s++)void 0===arguments[s]&&(n[s]=void 0)})),n&&h)for(n.groups=a=jc(null),s=0;s<h.length;s++)a[(o=h[s])[0]]=n[o[1]];return n});var td=$c;Ji({target:"RegExp",proto:!0,forced:/./.exec!==td},{exec:td});var rd=L,id=qr,nd=td,sd=c,ad=Qe,od=Kt,ld=ad("species"),cd=RegExp.prototype,dd=L,ud=ei,hd=Zl,fd=U,pd=dd("".charAt),md=dd("".charCodeAt),gd=dd("".slice),yd=function(e){return function(t,r){var i,n,s=hd(fd(t)),a=ud(r),o=s.length;return a<0||a>=o?e?"":void 0:(i=md(s,a))<55296||i>56319||a+1===o||(n=md(s,a+1))<56320||n>57343?e?pd(s,a):i:e?gd(s,a,a+2):n-56320+(i-55296<<10)+65536}},_d={codeAt:yd(!1),charAt:yd(!0)}.charAt,vd=L,Ed=xe,Sd=Math.floor,Td=vd("".charAt),bd=vd("".replace),Rd=vd("".slice),wd=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Ad=/\$([$&'`]|\d{1,2})/g,Ld=p,Cd=Dt,Id=V,kd=D,Dd=td,Pd=TypeError,Od=ns,xd=p,Md=L,Nd=function(e,t,r,i){var n=ad(e),s=!sd((function(){var t={};return t[n]=function(){return 7},7!=""[e](t)})),a=s&&!sd((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[ld]=function(){return r},r.flags="",r[n]=/./[n]),r.exec=function(){return t=!0,null},r[n](""),!t}));if(!s||!a||r){var o=rd(/./[n]),l=t(n,""[e],(function(e,t,r,i,n){var a=rd(e),l=t.exec;return l===nd||l===cd.exec?s&&!n?{done:!0,value:o(t,r,i)}:{done:!0,value:a(r,t,i)}:{done:!1}}));id(String.prototype,e,l[0]),id(cd,n,l[1])}i&&od(cd[n],"sham",!0)},Fd=c,Ud=Dt,Bd=V,Hd=ei,jd=oi,Vd=Zl,Gd=U,zd=function(e,t,r){return t+(r?_d(e,t).length:1)},Kd=ve,Wd=function(e,t,r,i,n,s){var a=r+e.length,o=i.length,l=Ad;return void 0!==n&&(n=Ed(n),l=wd),bd(s,l,(function(s,l){var c;switch(Td(l,0)){case"$":return"$";case"&":return e;case"`":return Rd(t,0,r);case"'":return Rd(t,a);case"<":c=n[Rd(l,1,-1)];break;default:var d=+l;if(0===d)return s;if(d>o){var u=Sd(d/10);return 0===u?s:u<=o?void 0===i[u-1]?Td(l,1):i[u-1]+Td(l,1):s}c=i[d-1]}return void 0===c?"":c}))},$d=function(e,t){var r=e.exec;if(Id(r)){var i=Ld(r,e,t);return null!==i&&Cd(i),i}if("RegExp"===kd(e))return Ld(Dd,e,t);throw Pd("RegExp#exec called on incompatible receiver")},Yd=Qe("replace"),qd=Math.max,Zd=Math.min,Xd=Md([].concat),Jd=Md([].push),Qd=Md("".indexOf),eu=Md("".slice),tu="$0"==="a".replace(/./,"$0"),ru=!!/./[Yd]&&""===/./[Yd]("a","$0");Nd("replace",(function(e,t,r){var i=ru?"$":"$0";return[function(e,r){var i=Gd(this),n=null==e?void 0:Kd(e,Yd);return n?xd(n,e,i,r):xd(t,Vd(i),e,r)},function(e,n){var s=Ud(this),a=Vd(e);if("string"==typeof n&&-1===Qd(n,i)&&-1===Qd(n,"$<")){var o=r(t,s,a,n);if(o.done)return o.value}var l=Bd(n);l||(n=Vd(n));var c=s.global;if(c){var d=s.unicode;s.lastIndex=0}for(var u=[];;){var h=$d(s,a);if(null===h)break;if(Jd(u,h),!c)break;""===Vd(h[0])&&(s.lastIndex=zd(a,jd(s.lastIndex),d))}for(var f,p="",m=0,g=0;g<u.length;g++){for(var y=Vd((h=u[g])[0]),_=qd(Zd(Hd(h.index),a.length),0),v=[],E=1;E<h.length;E++)Jd(v,void 0===(f=h[E])?f:String(f));var S=h.groups;if(l){var T=Xd([y],v,_,a);void 0!==S&&Jd(T,S);var b=Vd(Od(n,void 0,T))}else b=Wd(y,a,_,v,S,n);_>=m&&(p+=eu(a,m,_)+b,m=_+y.length)}return p+eu(a,m)}]}),!!Fd((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!tu||ru);var iu="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},nu=[],su=[],au="undefined"!=typeof Uint8Array?Uint8Array:Array,ou=!1;function lu(){ou=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0;t<64;++t)nu[t]=e[t],su[e.charCodeAt(t)]=t;su["-".charCodeAt(0)]=62,su["_".charCodeAt(0)]=63}function cu(e,t,r){for(var i,n,s=[],a=t;a<r;a+=3)i=(e[a]<<16)+(e[a+1]<<8)+e[a+2],s.push(nu[(n=i)>>18&63]+nu[n>>12&63]+nu[n>>6&63]+nu[63&n]);return s.join("")}function du(e){var t;ou||lu();for(var r=e.length,i=r%3,n="",s=[],a=16383,o=0,l=r-i;o<l;o+=a)s.push(cu(e,o,o+a>l?l:o+a));return 1===i?(t=e[r-1],n+=nu[t>>2],n+=nu[t<<4&63],n+="=="):2===i&&(t=(e[r-2]<<8)+e[r-1],n+=nu[t>>10],n+=nu[t>>4&63],n+=nu[t<<2&63],n+="="),s.push(n),s.join("")}function uu(e,t,r,i,n){var s,a,o=8*n-i-1,l=(1<<o)-1,c=l>>1,d=-7,u=r?n-1:0,h=r?-1:1,f=e[t+u];for(u+=h,s=f&(1<<-d)-1,f>>=-d,d+=o;d>0;s=256*s+e[t+u],u+=h,d-=8);for(a=s&(1<<-d)-1,s>>=-d,d+=i;d>0;a=256*a+e[t+u],u+=h,d-=8);if(0===s)s=1-c;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,i),s-=c}return(f?-1:1)*a*Math.pow(2,s-i)}function hu(e,t,r,i,n,s){var a,o,l,c=8*s-n-1,d=(1<<c)-1,u=d>>1,h=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:s-1,p=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=d):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+u>=1?h/l:h*Math.pow(2,1-u))*l>=2&&(a++,l/=2),a+u>=d?(o=0,a=d):a+u>=1?(o=(t*l-1)*Math.pow(2,n),a+=u):(o=t*Math.pow(2,u-1)*Math.pow(2,n),a=0));n>=8;e[r+f]=255&o,f+=p,o/=256,n-=8);for(a=a<<n|o,c+=n;c>0;e[r+f]=255&a,f+=p,a/=256,c-=8);e[r+f-p]|=128*m}var fu={}.toString,pu=Array.isArray||function(e){return"[object Array]"==fu.call(e)};_u.TYPED_ARRAY_SUPPORT=void 0===iu.TYPED_ARRAY_SUPPORT||iu.TYPED_ARRAY_SUPPORT;var mu=gu();function gu(){return _u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function yu(e,t){if(gu()<t)throw new RangeError("Invalid typed array length");return _u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=_u.prototype:(null===e&&(e=new _u(t)),e.length=t),e}function _u(e,t,r){if(!(_u.TYPED_ARRAY_SUPPORT||this instanceof _u))return new _u(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return Su(this,e)}return vu(this,e,t,r)}function vu(e,t,r,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,i){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(i||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,r):new Uint8Array(t,r,i);_u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=_u.prototype:e=Tu(e,t);return e}(e,t,r,i):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!_u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var i=0|wu(t,r);e=yu(e,i);var n=e.write(t,r);n!==i&&(e=e.slice(0,n));return e}(e,t,r):function(e,t){if(Ru(t)){var r=0|bu(t.length);return 0===(e=yu(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?yu(e,0):Tu(e,t);if("Buffer"===t.type&&pu(t.data))return Tu(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function Eu(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function Su(e,t){if(Eu(t),e=yu(e,t<0?0:0|bu(t)),!_u.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function Tu(e,t){var r=t.length<0?0:0|bu(t.length);e=yu(e,r);for(var i=0;i<r;i+=1)e[i]=255&t[i];return e}function bu(e){if(e>=gu())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+gu().toString(16)+" bytes");return 0|e}function Ru(e){return!(null==e||!e._isBuffer)}function wu(e,t){if(Ru(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return Ju(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Qu(e).length;default:if(i)return Ju(e).length;t=(""+t).toLowerCase(),i=!0}}function Au(e,t,r){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return ju(this,t,r);case"utf8":case"utf-8":return Fu(this,t,r);case"ascii":return Bu(this,t,r);case"latin1":case"binary":return Hu(this,t,r);case"base64":return Nu(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Vu(this,t,r);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function Lu(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function Cu(e,t,r,i,n){if(0===e.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=n?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(n)return-1;r=e.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof t&&(t=_u.from(t,i)),Ru(t))return 0===t.length?-1:Iu(e,t,r,i,n);if("number"==typeof t)return t&=255,_u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):Iu(e,[t],r,i,n);throw new TypeError("val must be string, number or Buffer")}function Iu(e,t,r,i,n){var s,a=1,o=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a=2,o/=2,l/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(n){var d=-1;for(s=r;s<o;s++)if(c(e,s)===c(t,-1===d?0:s-d)){if(-1===d&&(d=s),s-d+1===l)return d*a}else-1!==d&&(s-=s-d),d=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){for(var u=!0,h=0;h<l;h++)if(c(e,s+h)!==c(t,h)){u=!1;break}if(u)return s}return-1}function ku(e,t,r,i){r=Number(r)||0;var n=e.length-r;i?(i=Number(i))>n&&(i=n):i=n;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");i>s/2&&(i=s/2);for(var a=0;a<i;++a){var o=parseInt(t.substr(2*a,2),16);if(isNaN(o))return a;e[r+a]=o}return a}function Du(e,t,r,i){return eh(Ju(t,e.length-r),e,r,i)}function Pu(e,t,r,i){return eh(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,i)}function Ou(e,t,r,i){return Pu(e,t,r,i)}function xu(e,t,r,i){return eh(Qu(t),e,r,i)}function Mu(e,t,r,i){return eh(function(e,t){for(var r,i,n,s=[],a=0;a<e.length&&!((t-=2)<0);++a)i=(r=e.charCodeAt(a))>>8,n=r%256,s.push(n),s.push(i);return s}(t,e.length-r),e,r,i)}function Nu(e,t,r){return 0===t&&r===e.length?du(e):du(e.slice(t,r))}function Fu(e,t,r){r=Math.min(e.length,r);for(var i=[],n=t;n<r;){var s,a,o,l,c=e[n],d=null,u=c>239?4:c>223?3:c>191?2:1;if(n+u<=r)switch(u){case 1:c<128&&(d=c);break;case 2:128==(192&(s=e[n+1]))&&(l=(31&c)<<6|63&s)>127&&(d=l);break;case 3:s=e[n+1],a=e[n+2],128==(192&s)&&128==(192&a)&&(l=(15&c)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(d=l);break;case 4:s=e[n+1],a=e[n+2],o=e[n+3],128==(192&s)&&128==(192&a)&&128==(192&o)&&(l=(15&c)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(d=l)}null===d?(d=65533,u=1):d>65535&&(d-=65536,i.push(d>>>10&1023|55296),d=56320|1023&d),i.push(d),n+=u}return function(e){var t=e.length;if(t<=Uu)return String.fromCharCode.apply(String,e);var r="",i=0;for(;i<t;)r+=String.fromCharCode.apply(String,e.slice(i,i+=Uu));return r}(i)}_u.poolSize=8192,_u._augment=function(e){return e.__proto__=_u.prototype,e},_u.from=function(e,t,r){return vu(null,e,t,r)},_u.TYPED_ARRAY_SUPPORT&&(_u.prototype.__proto__=Uint8Array.prototype,_u.__proto__=Uint8Array),_u.alloc=function(e,t,r){return function(e,t,r,i){return Eu(t),t<=0?yu(e,t):void 0!==r?"string"==typeof i?yu(e,t).fill(r,i):yu(e,t).fill(r):yu(e,t)}(null,e,t,r)},_u.allocUnsafe=function(e){return Su(null,e)},_u.allocUnsafeSlow=function(e){return Su(null,e)},_u.isBuffer=th,_u.compare=function(e,t){if(!Ru(e)||!Ru(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,i=t.length,n=0,s=Math.min(r,i);n<s;++n)if(e[n]!==t[n]){r=e[n],i=t[n];break}return r<i?-1:i<r?1:0},_u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},_u.concat=function(e,t){if(!pu(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return _u.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var i=_u.allocUnsafe(t),n=0;for(r=0;r<e.length;++r){var s=e[r];if(!Ru(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,n),n+=s.length}return i},_u.byteLength=wu,_u.prototype._isBuffer=!0,_u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Lu(this,t,t+1);return this},_u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Lu(this,t,t+3),Lu(this,t+1,t+2);return this},_u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Lu(this,t,t+7),Lu(this,t+1,t+6),Lu(this,t+2,t+5),Lu(this,t+3,t+4);return this},_u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?Fu(this,0,e):Au.apply(this,arguments)},_u.prototype.equals=function(e){if(!Ru(e))throw new TypeError("Argument must be a Buffer");return this===e||0===_u.compare(this,e)},_u.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},_u.prototype.compare=function(e,t,r,i,n){if(!Ru(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),t<0||r>e.length||i<0||n>this.length)throw new RangeError("out of range index");if(i>=n&&t>=r)return 0;if(i>=n)return-1;if(t>=r)return 1;if(this===e)return 0;for(var s=(n>>>=0)-(i>>>=0),a=(r>>>=0)-(t>>>=0),o=Math.min(s,a),l=this.slice(i,n),c=e.slice(t,r),d=0;d<o;++d)if(l[d]!==c[d]){s=l[d],a=c[d];break}return s<a?-1:a<s?1:0},_u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},_u.prototype.indexOf=function(e,t,r){return Cu(this,e,t,r,!0)},_u.prototype.lastIndexOf=function(e,t,r){return Cu(this,e,t,r,!1)},_u.prototype.write=function(e,t,r,i){if(void 0===t)i="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)i=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}var n=this.length-t;if((void 0===r||r>n)&&(r=n),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return ku(this,e,t,r);case"utf8":case"utf-8":return Du(this,e,t,r);case"ascii":return Pu(this,e,t,r);case"latin1":case"binary":return Ou(this,e,t,r);case"base64":return xu(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Mu(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},_u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Uu=4096;function Bu(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(127&e[n]);return i}function Hu(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(e[n]);return i}function ju(e,t,r){var i=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>i)&&(r=i);for(var n="",s=t;s<r;++s)n+=Xu(e[s]);return n}function Vu(e,t,r){for(var i=e.slice(t,r),n="",s=0;s<i.length;s+=2)n+=String.fromCharCode(i[s]+256*i[s+1]);return n}function Gu(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function zu(e,t,r,i,n,s){if(!Ru(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<s)throw new RangeError('"value" argument is out of bounds');if(r+i>e.length)throw new RangeError("Index out of range")}function Ku(e,t,r,i){t<0&&(t=65535+t+1);for(var n=0,s=Math.min(e.length-r,2);n<s;++n)e[r+n]=(t&255<<8*(i?n:1-n))>>>8*(i?n:1-n)}function Wu(e,t,r,i){t<0&&(t=4294967295+t+1);for(var n=0,s=Math.min(e.length-r,4);n<s;++n)e[r+n]=t>>>8*(i?n:3-n)&255}function $u(e,t,r,i,n,s){if(r+i>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function Yu(e,t,r,i,n){return n||$u(e,0,r,4),hu(e,t,r,i,23,4),r+4}function qu(e,t,r,i,n){return n||$u(e,0,r,8),hu(e,t,r,i,52,8),r+8}_u.prototype.slice=function(e,t){var r,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),_u.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=_u.prototype;else{var n=t-e;r=new _u(n,void 0);for(var s=0;s<n;++s)r[s]=this[s+e]}return r},_u.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||Gu(e,t,this.length);for(var i=this[e],n=1,s=0;++s<t&&(n*=256);)i+=this[e+s]*n;return i},_u.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||Gu(e,t,this.length);for(var i=this[e+--t],n=1;t>0&&(n*=256);)i+=this[e+--t]*n;return i},_u.prototype.readUInt8=function(e,t){return t||Gu(e,1,this.length),this[e]},_u.prototype.readUInt16LE=function(e,t){return t||Gu(e,2,this.length),this[e]|this[e+1]<<8},_u.prototype.readUInt16BE=function(e,t){return t||Gu(e,2,this.length),this[e]<<8|this[e+1]},_u.prototype.readUInt32LE=function(e,t){return t||Gu(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},_u.prototype.readUInt32BE=function(e,t){return t||Gu(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},_u.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||Gu(e,t,this.length);for(var i=this[e],n=1,s=0;++s<t&&(n*=256);)i+=this[e+s]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*t)),i},_u.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||Gu(e,t,this.length);for(var i=t,n=1,s=this[e+--i];i>0&&(n*=256);)s+=this[e+--i]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*t)),s},_u.prototype.readInt8=function(e,t){return t||Gu(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},_u.prototype.readInt16LE=function(e,t){t||Gu(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},_u.prototype.readInt16BE=function(e,t){t||Gu(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},_u.prototype.readInt32LE=function(e,t){return t||Gu(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},_u.prototype.readInt32BE=function(e,t){return t||Gu(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},_u.prototype.readFloatLE=function(e,t){return t||Gu(e,4,this.length),uu(this,e,!0,23,4)},_u.prototype.readFloatBE=function(e,t){return t||Gu(e,4,this.length),uu(this,e,!1,23,4)},_u.prototype.readDoubleLE=function(e,t){return t||Gu(e,8,this.length),uu(this,e,!0,52,8)},_u.prototype.readDoubleBE=function(e,t){return t||Gu(e,8,this.length),uu(this,e,!1,52,8)},_u.prototype.writeUIntLE=function(e,t,r,i){(e=+e,t|=0,r|=0,i)||zu(this,e,t,r,Math.pow(2,8*r)-1,0);var n=1,s=0;for(this[t]=255&e;++s<r&&(n*=256);)this[t+s]=e/n&255;return t+r},_u.prototype.writeUIntBE=function(e,t,r,i){(e=+e,t|=0,r|=0,i)||zu(this,e,t,r,Math.pow(2,8*r)-1,0);var n=r-1,s=1;for(this[t+n]=255&e;--n>=0&&(s*=256);)this[t+n]=e/s&255;return t+r},_u.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||zu(this,e,t,1,255,0),_u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},_u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||zu(this,e,t,2,65535,0),_u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Ku(this,e,t,!0),t+2},_u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||zu(this,e,t,2,65535,0),_u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Ku(this,e,t,!1),t+2},_u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||zu(this,e,t,4,4294967295,0),_u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Wu(this,e,t,!0),t+4},_u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||zu(this,e,t,4,4294967295,0),_u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Wu(this,e,t,!1),t+4},_u.prototype.writeIntLE=function(e,t,r,i){if(e=+e,t|=0,!i){var n=Math.pow(2,8*r-1);zu(this,e,t,r,n-1,-n)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},_u.prototype.writeIntBE=function(e,t,r,i){if(e=+e,t|=0,!i){var n=Math.pow(2,8*r-1);zu(this,e,t,r,n-1,-n)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},_u.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||zu(this,e,t,1,127,-128),_u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},_u.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||zu(this,e,t,2,32767,-32768),_u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Ku(this,e,t,!0),t+2},_u.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||zu(this,e,t,2,32767,-32768),_u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Ku(this,e,t,!1),t+2},_u.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||zu(this,e,t,4,2147483647,-2147483648),_u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Wu(this,e,t,!0),t+4},_u.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||zu(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),_u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Wu(this,e,t,!1),t+4},_u.prototype.writeFloatLE=function(e,t,r){return Yu(this,e,t,!0,r)},_u.prototype.writeFloatBE=function(e,t,r){return Yu(this,e,t,!1,r)},_u.prototype.writeDoubleLE=function(e,t,r){return qu(this,e,t,!0,r)},_u.prototype.writeDoubleBE=function(e,t,r){return qu(this,e,t,!1,r)},_u.prototype.copy=function(e,t,r,i){if(r||(r=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-r&&(i=e.length-t+r);var n,s=i-r;if(this===e&&r<t&&t<i)for(n=s-1;n>=0;--n)e[n+t]=this[n+r];else if(s<1e3||!_u.TYPED_ARRAY_SUPPORT)for(n=0;n<s;++n)e[n+t]=this[n+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+s),t);return s},_u.prototype.fill=function(e,t,r,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),1===e.length){var n=e.charCodeAt(0);n<256&&(e=n)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!_u.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var s;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{var a=Ru(e)?e:Ju(new _u(e,i).toString()),o=a.length;for(s=0;s<r-t;++s)this[s+t]=a[s%o]}return this};var Zu=/[^+\/0-9A-Za-z-_]/g;function Xu(e){return e<16?"0"+e.toString(16):e.toString(16)}function Ju(e,t){var r;t=t||1/0;for(var i=e.length,n=null,s=[],a=0;a<i;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!n){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(a+1===i){(t-=3)>-1&&s.push(239,191,189);continue}n=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(t-=3)>-1&&s.push(239,191,189);if(n=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function Qu(e){return function(e){var t,r,i,n,s,a;ou||lu();var o=e.length;if(o%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s="="===e[o-2]?2:"="===e[o-1]?1:0,a=new au(3*o/4-s),i=s>0?o-4:o;var l=0;for(t=0,r=0;t<i;t+=4,r+=3)n=su[e.charCodeAt(t)]<<18|su[e.charCodeAt(t+1)]<<12|su[e.charCodeAt(t+2)]<<6|su[e.charCodeAt(t+3)],a[l++]=n>>16&255,a[l++]=n>>8&255,a[l++]=255&n;return 2===s?(n=su[e.charCodeAt(t)]<<2|su[e.charCodeAt(t+1)]>>4,a[l++]=255&n):1===s&&(n=su[e.charCodeAt(t)]<<10|su[e.charCodeAt(t+1)]<<4|su[e.charCodeAt(t+2)]>>2,a[l++]=n>>8&255,a[l++]=255&n),a}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(Zu,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function eh(e,t,r,i){for(var n=0;n<i&&!(n+r>=t.length||n>=e.length);++n)t[n+r]=e[n];return n}function th(e){return null!=e&&(!!e._isBuffer||rh(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&rh(e.slice(0,0))}(e))}function rh(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var ih=Object.freeze({__proto__:null,INSPECT_MAX_BYTES:50,kMaxLength:mu,Buffer:_u,SlowBuffer:function(e){return+e!=e&&(e=0),_u.alloc(+e)},isBuffer:th});function nh(){throw new Error("setTimeout has not been defined")}function sh(){throw new Error("clearTimeout has not been defined")}var ah=nh,oh=sh;function lh(e){if(ah===setTimeout)return setTimeout(e,0);if((ah===nh||!ah)&&setTimeout)return ah=setTimeout,setTimeout(e,0);try{return ah(e,0)}catch(t){try{return ah.call(null,e,0)}catch(t){return ah.call(this,e,0)}}}"function"==typeof iu.setTimeout&&(ah=setTimeout),"function"==typeof iu.clearTimeout&&(oh=clearTimeout);var ch,dh=[],uh=!1,hh=-1;function fh(){uh&&ch&&(uh=!1,ch.length?dh=ch.concat(dh):hh=-1,dh.length&&ph())}function ph(){if(!uh){var e=lh(fh);uh=!0;for(var t=dh.length;t;){for(ch=dh,dh=[];++hh<t;)ch&&ch[hh].run();hh=-1,t=dh.length}ch=null,uh=!1,function(e){if(oh===clearTimeout)return clearTimeout(e);if((oh===sh||!oh)&&clearTimeout)return oh=clearTimeout,clearTimeout(e);try{return oh(e)}catch(t){try{return oh.call(null,e)}catch(t){return oh.call(this,e)}}}(e)}}function mh(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];dh.push(new gh(e,t)),1!==dh.length||uh||lh(ph)}function gh(e,t){this.fun=e,this.array=t}gh.prototype.run=function(){this.fun.apply(null,this.array)};function yh(){}var _h=yh,vh=yh,Eh=yh,Sh=yh,Th=yh,bh=yh,Rh=yh;var wh=iu.performance||{},Ah=wh.now||wh.mozNow||wh.msNow||wh.oNow||wh.webkitNow||function(){return(new Date).getTime()};var Lh=new Date;var Ch={nextTick:mh,title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:_h,addListener:vh,once:Eh,off:Sh,removeListener:Th,removeAllListeners:bh,emit:Rh,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*Ah.call(wh),r=Math.floor(t),i=Math.floor(t%1*1e9);return e&&(r-=e[0],(i-=e[1])<0&&(r--,i+=1e9)),[r,i]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-Lh)/1e3}},Ih={exports:{}};!function(e,t){e.exports=function e(t,r,i){function n(o,l){if(!r[o]){if(!t[o]){if(!l&&s)return s(o);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=r[o]={exports:{}};t[o][0].call(d.exports,(function(e){return n(t[o][1][e]||e)}),d,d.exports,e,t,r,i)}return r[o].exports}for(var a=s,o=0;o<i.length;o++)n(i[o]);return n}({1:[function(e,t,r){var i=e("./utils"),n=e("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,n,a,o,l,c,d=[],u=0,h=e.length,f=h,p="string"!==i.getTypeOf(e);u<e.length;)f=h-u,n=p?(t=e[u++],r=u<h?e[u++]:0,u<h?e[u++]:0):(t=e.charCodeAt(u++),r=u<h?e.charCodeAt(u++):0,u<h?e.charCodeAt(u++):0),a=t>>2,o=(3&t)<<4|r>>4,l=1<f?(15&r)<<2|n>>6:64,c=2<f?63&n:64,d.push(s.charAt(a)+s.charAt(o)+s.charAt(l)+s.charAt(c));return d.join("")},r.decode=function(e){var t,r,i,a,o,l,c=0,d=0,u="data:";if(e.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");var h,f=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===s.charAt(64)&&f--,e.charAt(e.length-2)===s.charAt(64)&&f--,f%1!=0)throw new Error("Invalid base64 input, bad content length.");for(h=n.uint8array?new Uint8Array(0|f):new Array(0|f);c<e.length;)t=s.indexOf(e.charAt(c++))<<2|(a=s.indexOf(e.charAt(c++)))>>4,r=(15&a)<<4|(o=s.indexOf(e.charAt(c++)))>>2,i=(3&o)<<6|(l=s.indexOf(e.charAt(c++))),h[d++]=t,64!==o&&(h[d++]=r),64!==l&&(h[d++]=i);return h}},{"./support":30,"./utils":32}],2:[function(e,t,r){var i=e("./external"),n=e("./stream/DataWorker"),s=e("./stream/Crc32Probe"),a=e("./stream/DataLengthProbe");function o(e,t,r,i,n){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=i,this.compressedContent=n}o.prototype={getContentWorker:function(){var e=new n(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new n(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(e,t,r){return e.pipe(new s).pipe(new a("uncompressedSize")).pipe(t.compressWorker(r)).pipe(new a("compressedSize")).withStreamInfo("compression",t)},t.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,r){var i=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(e){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,r){var i=e("./utils"),n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==i.getTypeOf(e)?function(e,t,r,i){var s=n,a=i+r;e^=-1;for(var o=i;o<a;o++)e=e>>>8^s[255&(e^t[o])];return~e}(0|t,e,e.length,0):function(e,t,r,i){var s=n,a=i+r;e^=-1;for(var o=i;o<a;o++)e=e>>>8^s[255&(e^t.charCodeAt(o))];return~e}(0|t,e,e.length,0):0}},{"./utils":32}],5:[function(e,t,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,t,r){var i=null;i="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:i}},{lie:37}],7:[function(e,t,r){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,n=e("pako"),s=e("./utils"),a=e("./stream/GenericWorker"),o=i?"uint8array":"array";function l(e,t){a.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}r.magic="\b\0",s.inherits(l,a),l.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(o,e.data),!1)},l.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new n[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},r.compressWorker=function(e){return new l("Deflate",e)},r.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,r){function i(e,t){var r,i="";for(r=0;r<t;r++)i+=String.fromCharCode(255&e),e>>>=8;return i}function n(e,t,r,n,a,d){var u,h,f=e.file,p=e.compression,m=d!==o.utf8encode,g=s.transformTo("string",d(f.name)),y=s.transformTo("string",o.utf8encode(f.name)),_=f.comment,v=s.transformTo("string",d(_)),E=s.transformTo("string",o.utf8encode(_)),S=y.length!==f.name.length,T=E.length!==_.length,b="",R="",w="",A=f.dir,L=f.date,C={crc32:0,compressedSize:0,uncompressedSize:0};t&&!r||(C.crc32=e.crc32,C.compressedSize=e.compressedSize,C.uncompressedSize=e.uncompressedSize);var I=0;t&&(I|=8),m||!S&&!T||(I|=2048);var k=0,D=0;A&&(k|=16),"UNIX"===a?(D=798,k|=function(e,t){var r=e;return e||(r=t?16893:33204),(65535&r)<<16}(f.unixPermissions,A)):(D=20,k|=function(e){return 63&(e||0)}(f.dosPermissions)),u=L.getUTCHours(),u<<=6,u|=L.getUTCMinutes(),u<<=5,u|=L.getUTCSeconds()/2,h=L.getUTCFullYear()-1980,h<<=4,h|=L.getUTCMonth()+1,h<<=5,h|=L.getUTCDate(),S&&(R=i(1,1)+i(l(g),4)+y,b+="up"+i(R.length,2)+R),T&&(w=i(1,1)+i(l(v),4)+E,b+="uc"+i(w.length,2)+w);var P="";return P+="\n\0",P+=i(I,2),P+=p.magic,P+=i(u,2),P+=i(h,2),P+=i(C.crc32,4),P+=i(C.compressedSize,4),P+=i(C.uncompressedSize,4),P+=i(g.length,2),P+=i(b.length,2),{fileRecord:c.LOCAL_FILE_HEADER+P+g+b,dirRecord:c.CENTRAL_FILE_HEADER+i(D,2)+P+i(v.length,2)+"\0\0\0\0"+i(k,4)+i(n,4)+g+b+v}}var s=e("../utils"),a=e("../stream/GenericWorker"),o=e("../utf8"),l=e("../crc32"),c=e("../signature");function d(e,t,r,i){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=i,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(d,a),d.prototype.push=function(e){var t=e.meta.percent||0,r=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,a.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:r?(t+100*(r-i-1))/r:100}}))},d.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var r=n(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,r=n(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),t)this.push({data:function(e){return c.DATA_DESCRIPTOR+i(e.crc32,4)+i(e.compressedSize,4)+i(e.uncompressedSize,4)}(e),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var r=this.bytesWritten-e,n=function(e,t,r,n,a){var o=s.transformTo("string",a(n));return c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(e,2)+i(e,2)+i(t,4)+i(r,4)+i(o.length,2)+o}(this.dirRecords.length,r,e,this.zipComment,this.encodeFileName);this.push({data:n,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},d.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(e){var t=this._sources;if(!a.prototype.error.call(this,e))return!1;for(var r=0;r<t.length;r++)try{t[r].error(e)}catch(e){}return!0},d.prototype.lock=function(){a.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,r){var i=e("../compressions"),n=e("./ZipFileWorker");r.generateWorker=function(e,t,r){var s=new n(t.streamFiles,r,t.platform,t.encodeFileName),a=0;try{e.forEach((function(e,r){a++;var n=function(e,t){var r=e||t,n=i[r];if(!n)throw new Error(r+" is not a valid compression method !");return n}(r.options.compression,t.compression),o=r.options.compressionOptions||t.compressionOptions||{},l=r.dir,c=r.date;r._compressWorker(n,o).withStreamInfo("file",{name:e,dir:l,date:c,comment:r.comment||"",unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions}).pipe(s)})),s.entriesCount=a}catch(e){s.error(e)}return s}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,r){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new i;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}(i.prototype=e("./object")).loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.10.0",i.loadAsync=function(e,t){return(new i).loadAsync(e,t)},i.external=e("./external"),t.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,r){var i=e("./utils"),n=e("./external"),s=e("./utf8"),a=e("./zipEntries"),o=e("./stream/Crc32Probe"),l=e("./nodejsUtils");function c(e){return new n.Promise((function(t,r){var i=e.decompressed.getContentWorker().pipe(new o);i.on("error",(function(e){r(e)})).on("end",(function(){i.streamInfo.crc32!==e.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}t.exports=function(e,t){var r=this;return t=i.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),l.isNode&&l.isStream(e)?n.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var r=new a(t);return r.load(e),r})).then((function(e){var r=[n.Promise.resolve(e)],i=e.files;if(t.checkCRC32)for(var s=0;s<i.length;s++)r.push(c(i[s]));return n.Promise.all(r)})).then((function(e){for(var n=e.shift(),s=n.files,a=0;a<s.length;a++){var o=s[a],l=o.fileNameStr,c=i.resolve(o.fileNameStr);r.file(c,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir,comment:o.fileCommentStr.length?o.fileCommentStr:null,unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions,createFolders:t.createFolders}),o.dir||(r.file(c).unsafeOriginalName=l)}return n.zipComment.length&&(r.comment=n.zipComment),r}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,r){var i=e("../utils"),n=e("../stream/GenericWorker");function s(e,t){n.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}i.inherits(s,n),s.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},s.prototype.pause=function(){return!!n.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,r){var i=e("readable-stream").Readable;function n(e,t,r){i.call(this,t),this._helper=e;var n=this;e.on("data",(function(e,t){n.push(e)||n._helper.pause(),r&&r(t)})).on("error",(function(e){n.emit("error",e)})).on("end",(function(){n.push(null)}))}e("../utils").inherits(n,i),n.prototype._read=function(){this._helper.resume()},t.exports=n},{"../utils":32,"readable-stream":16}],14:[function(e,t,r){t.exports={isNode:void 0!==_u,newBufferFrom:function(e,t){if(_u.from&&_u.from!==Uint8Array.from)return _u.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new _u(e,t)},allocBuffer:function(e){if(_u.alloc)return _u.alloc(e);var t=new _u(e);return t.fill(0),t},isBuffer:function(e){return th(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,r){function i(e,t,r){var i,n=s.getTypeOf(t),o=s.extend(r||{},l);o.date=o.date||new Date,null!==o.compression&&(o.compression=o.compression.toUpperCase()),"string"==typeof o.unixPermissions&&(o.unixPermissions=parseInt(o.unixPermissions,8)),o.unixPermissions&&16384&o.unixPermissions&&(o.dir=!0),o.dosPermissions&&16&o.dosPermissions&&(o.dir=!0),o.dir&&(e=m(e)),o.createFolders&&(i=p(e))&&g.call(this,i,!0);var u="string"===n&&!1===o.binary&&!1===o.base64;r&&void 0!==r.binary||(o.binary=!u),(t instanceof c&&0===t.uncompressedSize||o.dir||!t||0===t.length)&&(o.base64=!1,o.binary=!0,t="",o.compression="STORE",n="string");var y=null;y=t instanceof c||t instanceof a?t:h.isNode&&h.isStream(t)?new f(e,t):s.prepareContent(e,t,o.binary,o.optimizedBinaryString,o.base64);var _=new d(e,y,o);this.files[e]=_}var n=e("./utf8"),s=e("./utils"),a=e("./stream/GenericWorker"),o=e("./stream/StreamHelper"),l=e("./defaults"),c=e("./compressedObject"),d=e("./zipObject"),u=e("./generate"),h=e("./nodejsUtils"),f=e("./nodejs/NodejsStreamInputAdapter"),p=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return 0<t?e.substring(0,t):""},m=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},g=function(e,t){return t=void 0!==t?t:l.createFolders,e=m(e),this.files[e]||i.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function y(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var _={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,r,i;for(t in this.files)i=this.files[t],(r=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(r,i)},filter:function(e){var t=[];return this.forEach((function(r,i){e(r,i)&&t.push(i)})),t},file:function(e,t,r){if(1!==arguments.length)return e=this.root+e,i.call(this,e,t,r),this;if(y(e)){var n=e;return this.filter((function(e,t){return!t.dir&&n.test(e)}))}var s=this.files[this.root+e];return s&&!s.dir?s:null},folder:function(e){if(!e)return this;if(y(e))return this.filter((function(t,r){return r.dir&&e.test(t)}));var t=this.root+e,r=g.call(this,t),i=this.clone();return i.root=r.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter((function(t,r){return r.name.slice(0,e.length)===e})),i=0;i<r.length;i++)delete this.files[r[i].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,r={};try{if((r=s.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");s.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var i=r.comment||this.comment||"";t=u.generateWorker(this,r,i)}catch(e){(t=new a("error")).error(e)}return new o(t,r.type||"string",r.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=_},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,r){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,r){var i=e("./DataReader");function n(e){i.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(n,i),n.prototype.byteAt=function(e){return this.data[this.zero+e]},n.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),i=e.charCodeAt(2),n=e.charCodeAt(3),s=this.length-4;0<=s;--s)if(this.data[s]===t&&this.data[s+1]===r&&this.data[s+2]===i&&this.data[s+3]===n)return s-this.zero;return-1},n.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1),i=e.charCodeAt(2),n=e.charCodeAt(3),s=this.readData(4);return t===s[0]&&r===s[1]&&i===s[2]&&n===s[3]},n.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./DataReader":18}],18:[function(e,t,r){var i=e("../utils");function n(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}n.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return i.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=n},{"../utils":32}],19:[function(e,t,r){var i=e("./Uint8ArrayReader");function n(e){i.call(this,e)}e("../utils").inherits(n,i),n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,r){var i=e("./DataReader");function n(e){i.call(this,e)}e("../utils").inherits(n,i),n.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},n.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},n.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./DataReader":18}],21:[function(e,t,r){var i=e("./ArrayReader");function n(e){i.call(this,e)}e("../utils").inherits(n,i),n.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,r){var i=e("../utils"),n=e("../support"),s=e("./ArrayReader"),a=e("./StringReader"),o=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=i.getTypeOf(e);return i.checkSupport(t),"string"!==t||n.uint8array?"nodebuffer"===t?new o(e):n.uint8array?new l(i.transformTo("uint8array",e)):new s(i.transformTo("array",e)):new a(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,r){var i=e("./GenericWorker"),n=e("../utils");function s(e){i.call(this,"ConvertWorker to "+e),this.destType=e}n.inherits(s,i),s.prototype.processChunk=function(e){this.push({data:n.transformTo(this.destType,e.data),meta:e.meta})},t.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,r){var i=e("./GenericWorker"),n=e("../crc32");function s(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(s,i),s.prototype.processChunk=function(e){this.streamInfo.crc32=n(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,r){var i=e("../utils"),n=e("./GenericWorker");function s(e){n.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}i.inherits(s,n),s.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}n.prototype.processChunk.call(this,e)},t.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,r){var i=e("../utils"),n=e("./GenericWorker");function s(e){n.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=i.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}i.inherits(s,n),s.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,r){function i(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=i},{}],29:[function(e,t,r){var i=e("../utils"),n=e("./ConvertWorker"),s=e("./GenericWorker"),a=e("../base64"),o=e("../support"),l=e("../external"),c=null;if(o.nodestream)try{c=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function d(e,t){return new l.Promise((function(r,n){var s=[],o=e._internalType,l=e._outputType,c=e._mimeType;e.on("data",(function(e,r){s.push(e),t&&t(r)})).on("error",(function(e){s=[],n(e)})).on("end",(function(){try{var e=function(e,t,r){switch(e){case"blob":return i.newBlob(i.transformTo("arraybuffer",t),r);case"base64":return a.encode(t);default:return i.transformTo(e,t)}}(l,function(e,t){var r,i=0,n=null,s=0;for(r=0;r<t.length;r++)s+=t[r].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(n=new Uint8Array(s),r=0;r<t.length;r++)n.set(t[r],i),i+=t[r].length;return n;case"nodebuffer":return _u.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(o,s),c);r(e)}catch(e){n(e)}s=[]})).resume()}))}function u(e,t,r){var a=t;switch(t){case"blob":case"arraybuffer":a="uint8array";break;case"base64":a="string"}try{this._internalType=a,this._outputType=t,this._mimeType=r,i.checkSupport(a),this._worker=e.pipe(new n(a)),e.lock()}catch(e){this._worker=new s("error"),this._worker.error(e)}}u.prototype={accumulate:function(e){return d(this,e)},on:function(e,t){var r=this;return"data"===e?this._worker.on(e,(function(e){t.call(r,e.data,e.meta)})):this._worker.on(e,(function(){i.delay(t,arguments,r)})),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer=void 0!==_u,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{var i=new ArrayBuffer(0);try{r.blob=0===new Blob([i],{type:"application/zip"}).size}catch(e){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(i),r.blob=0===n.getBlob("application/zip").size}catch(e){r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch(e){r.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,r){for(var i=e("./utils"),n=e("./support"),s=e("./nodejsUtils"),a=e("./stream/GenericWorker"),o=new Array(256),l=0;l<256;l++)o[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function c(){a.call(this,"utf-8 decode"),this.leftOver=null}function d(){a.call(this,"utf-8 encode")}o[254]=o[254]=1,r.utf8encode=function(e){return n.nodebuffer?s.newBufferFrom(e,"utf-8"):function(e){var t,r,i,s,a,o=e.length,l=0;for(s=0;s<o;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(i=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(i-56320),s++),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=n.uint8array?new Uint8Array(l):new Array(l),s=a=0;a<l;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(i=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(i-56320),s++),r<128?t[a++]=r:(r<2048?t[a++]=192|r>>>6:(r<65536?t[a++]=224|r>>>12:(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63),t[a++]=128|r>>>6&63),t[a++]=128|63&r);return t}(e)},r.utf8decode=function(e){return n.nodebuffer?i.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,r,n,s,a=e.length,l=new Array(2*a);for(t=r=0;t<a;)if((n=e[t++])<128)l[r++]=n;else if(4<(s=o[n]))l[r++]=65533,t+=s-1;else{for(n&=2===s?31:3===s?15:7;1<s&&t<a;)n=n<<6|63&e[t++],s--;1<s?l[r++]=65533:n<65536?l[r++]=n:(n-=65536,l[r++]=55296|n>>10&1023,l[r++]=56320|1023&n)}return l.length!==r&&(l.subarray?l=l.subarray(0,r):l.length=r),i.applyFromCharCode(l)}(e=i.transformTo(n.uint8array?"uint8array":"array",e))},i.inherits(c,a),c.prototype.processChunk=function(e){var t=i.transformTo(n.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(n.uint8array){var s=t;(t=new Uint8Array(s.length+this.leftOver.length)).set(this.leftOver,0),t.set(s,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var a=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0||0===r?t:r+o[e[r]]>t?r:t}(t),l=t;a!==t.length&&(n.uint8array?(l=t.subarray(0,a),this.leftOver=t.subarray(a,t.length)):(l=t.slice(0,a),this.leftOver=t.slice(a,t.length))),this.push({data:r.utf8decode(l),meta:e.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=c,i.inherits(d,a),d.prototype.processChunk=function(e){this.push({data:r.utf8encode(e.data),meta:e.meta})},r.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,r){var i=e("./support"),n=e("./base64"),s=e("./nodejsUtils"),a=e("./external");function o(e){return e}function l(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}e("setimmediate"),r.newBlob=function(t,i){r.checkSupport("blob");try{return new Blob([t],{type:i})}catch(e){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(t),n.getBlob(i)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(e,t,r){var i=[],n=0,s=e.length;if(s<=r)return String.fromCharCode.apply(null,e);for(;n<s;)"array"===t||"nodebuffer"===t?i.push(String.fromCharCode.apply(null,e.slice(n,Math.min(n+r,s)))):i.push(String.fromCharCode.apply(null,e.subarray(n,Math.min(n+r,s)))),n+=r;return i.join("")},stringifyByChar:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,s.allocBuffer(1)).length}catch(e){return!1}}()}};function d(e){var t=65536,i=r.getTypeOf(e),n=!0;if("uint8array"===i?n=c.applyCanBeUsed.uint8array:"nodebuffer"===i&&(n=c.applyCanBeUsed.nodebuffer),n)for(;1<t;)try{return c.stringifyByChunk(e,i,t)}catch(e){t=Math.floor(t/2)}return c.stringifyByChar(e)}function u(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}r.applyFromCharCode=d;var h={};h.string={string:o,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return h.string.uint8array(e).buffer},uint8array:function(e){return l(e,new Uint8Array(e.length))},nodebuffer:function(e){return l(e,s.allocBuffer(e.length))}},h.array={string:d,array:o,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(e)}},h.arraybuffer={string:function(e){return d(new Uint8Array(e))},array:function(e){return u(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:o,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(new Uint8Array(e))}},h.uint8array={string:d,array:function(e){return u(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:o,nodebuffer:function(e){return s.newBufferFrom(e)}},h.nodebuffer={string:d,array:function(e){return u(e,new Array(e.length))},arraybuffer:function(e){return h.nodebuffer.uint8array(e).buffer},uint8array:function(e){return u(e,new Uint8Array(e.length))},nodebuffer:o},r.transformTo=function(e,t){if(t=t||"",!e)return t;r.checkSupport(e);var i=r.getTypeOf(t);return h[i][e](t)},r.resolve=function(e){for(var t=e.split("/"),r=[],i=0;i<t.length;i++){var n=t[i];"."===n||""===n&&0!==i&&i!==t.length-1||(".."===n?r.pop():r.push(n))}return r.join("/")},r.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":i.nodebuffer&&s.isBuffer(e)?"nodebuffer":i.uint8array&&e instanceof Uint8Array?"uint8array":i.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(e){if(!i[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(e){var t,r,i="";for(r=0;r<(e||"").length;r++)i+="\\x"+((t=e.charCodeAt(r))<16?"0":"")+t.toString(16).toUpperCase();return i},r.delay=function(e,t,r){setImmediate((function(){e.apply(r||null,t||[])}))},r.inherits=function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r},r.extend=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},r.prepareContent=function(e,t,s,o,c){return a.Promise.resolve(t).then((function(e){return i.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new a.Promise((function(t,r){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.onerror=function(e){r(e.target.error)},i.readAsArrayBuffer(e)})):e})).then((function(t){var d=r.getTypeOf(t);return d?("arraybuffer"===d?t=r.transformTo("uint8array",t):"string"===d&&(c?t=n.decode(t):s&&!0!==o&&(t=function(e){return l(e,i.uint8array?new Uint8Array(e.length):new Array(e.length))}(t))),t):a.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,t,r){var i=e("./reader/readerFor"),n=e("./utils"),s=e("./signature"),a=e("./zipEntry"),o=(e("./utf8"),e("./support"));function l(e){this.files=[],this.loadOptions=e}l.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+n.pretty(t)+", expected "+n.pretty(e)+")")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var i=this.reader.readString(4)===t;return this.reader.setIndex(r),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=o.uint8array?"uint8array":"array",r=n.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,i=this.zip64EndOfCentralSize-44;0<i;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(e=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===n.MAX_VALUE_16BITS||this.diskWithCentralDirStart===n.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===n.MAX_VALUE_16BITS||this.centralDirRecords===n.MAX_VALUE_16BITS||this.centralDirSize===n.MAX_VALUE_32BITS||this.centralDirOffset===n.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var i=t-r;if(0<i)this.isSignature(t,s.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(e){this.reader=i(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t,r){var i=e("./reader/readerFor"),n=e("./utils"),s=e("./compressedObject"),a=e("./crc32"),o=e("./utf8"),l=e("./compressions"),c=e("./support");function d(e,t){this.options=e,this.loadOptions=t}d.prototype={isEncrypted:function(){return!(1&~this.bitFlag)},useUTF8:function(){return!(2048&~this.bitFlag)},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+n.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=i(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,r,i,n=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<n;)t=e.readInt(2),r=e.readInt(2),i=e.readData(r),this.extraFields[t]={id:t,length:r,value:i};e.setIndex(n)},handleUTF8:function(){var e=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var r=n.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var i=this.findExtraFieldUnicodeComment();if(null!==i)this.fileCommentStr=i;else{var s=n.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(s)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=i(e.value);return 1!==t.readInt(1)||a(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=i(e.value);return 1!==t.readInt(1)||a(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null}},t.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,r){function i(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}}var n=e("./stream/StreamHelper"),s=e("./stream/DataWorker"),a=e("./utf8"),o=e("./compressedObject"),l=e("./stream/GenericWorker");i.prototype={internalStream:function(e){var t=null,r="string";try{if(!e)throw new Error("No output type specified.");var i="string"===(r=e.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string"),t=this._decompressWorker();var s=!this._dataBinary;s&&!i&&(t=t.pipe(new a.Utf8EncodeWorker)),!s&&i&&(t=t.pipe(new a.Utf8DecodeWorker))}catch(e){(t=new l("error")).error(e)}return new n(t,r,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof o&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new a.Utf8EncodeWorker)),o.createWorkerFrom(r,e,t)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof l?this._data:new s(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<c.length;u++)i.prototype[c[u]]=d;t.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,i){(function(e){var r,i,n=e.MutationObserver||e.WebKitMutationObserver;if(n){var s=0,a=new n(d),o=e.document.createTextNode("");a.observe(o,{characterData:!0}),r=function(){o.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)};else{var l=new e.MessageChannel;l.port1.onmessage=d,r=function(){l.port2.postMessage(0)}}var c=[];function d(){var e,t;i=!0;for(var r=c.length;r;){for(t=c,c=[],e=-1;++e<r;)t[e]();r=c.length}i=!1}t.exports=function(e){1!==c.push(e)||i||r()}}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,r){var i=e("immediate");function n(){}var s={},a=["REJECTED"],o=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==n&&f(this,e)}function d(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function u(e,t,r){i((function(){var i;try{i=t(r)}catch(i){return s.reject(e,i)}i===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,i)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var r=!1;function i(t){r||(r=!0,s.reject(e,t))}function n(t){r||(r=!0,s.resolve(e,t))}var a=p((function(){t(n,i)}));"error"===a.status&&i(a.value)}function p(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}(t.exports=c).prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then((function(r){return t.resolve(e()).then((function(){return r}))}),(function(r){return t.resolve(e()).then((function(){throw r}))}))},c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===o||"function"!=typeof t&&this.state===a)return this;var r=new this.constructor(n);return this.state!==l?u(r,this.state===o?e:t,this.outcome):this.queue.push(new d(r,e,t)),r},d.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){s.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},s.resolve=function(e,t){var r=p(h,t);if("error"===r.status)return s.reject(e,r.value);var i=r.value;if(i)f(e,i);else{e.state=o,e.outcome=t;for(var n=-1,a=e.queue.length;++n<a;)e.queue[n].callFulfilled(t)}return e},s.reject=function(e,t){e.state=a,e.outcome=t;for(var r=-1,i=e.queue.length;++r<i;)e.queue[r].callRejected(t);return e},c.resolve=function(e){return e instanceof this?e:s.resolve(new this(n),e)},c.reject=function(e){var t=new this(n);return s.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var a=new Array(r),o=0,l=-1,c=new this(n);++l<r;)d(e[l],l);return c;function d(e,n){t.resolve(e).then((function(e){a[n]=e,++o!==r||i||(i=!0,s.resolve(c,a))}),(function(e){i||(i=!0,s.reject(c,e))}))}},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var a,o=-1,l=new this(n);++o<r;)a=e[o],t.resolve(a).then((function(e){i||(i=!0,s.resolve(l,e))}),(function(e){i||(i=!0,s.reject(l,e))}));return l}},{immediate:36}],38:[function(e,t,r){var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,r){var i=e("./zlib/deflate"),n=e("./utils/common"),s=e("./utils/strings"),a=e("./zlib/messages"),o=e("./zlib/zstream"),l=Object.prototype.toString,c=0,d=-1,u=0,h=8;function f(e){if(!(this instanceof f))return new f(e);this.options=n.assign({level:d,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var r=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==c)throw new Error(a[r]);if(t.header&&i.deflateSetHeader(this.strm,t.header),t.dictionary){var p;if(p="string"==typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=i.deflateSetDictionary(this.strm,p))!==c)throw new Error(a[r]);this._dict_set=!0}}function p(e,t){var r=new f(t);if(r.push(e,!0),r.err)throw r.msg||a[r.err];return r.result}f.prototype.push=function(e,t){var r,a,o=this.strm,d=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?o.input=s.string2buf(e):"[object ArrayBuffer]"===l.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new n.Buf8(d),o.next_out=0,o.avail_out=d),1!==(r=i.deflate(o,a))&&r!==c)return this.onEnd(r),!(this.ended=!0);0!==o.avail_out&&(0!==o.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(s.buf2binstring(n.shrinkBuf(o.output,o.next_out))):this.onData(n.shrinkBuf(o.output,o.next_out)))}while((0<o.avail_in||0===o.avail_out)&&1!==r);return 4===a?(r=i.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===c):2!==a||(this.onEnd(c),!(o.avail_out=0))},f.prototype.onData=function(e){this.chunks.push(e)},f.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=f,r.deflate=p,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,p(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,r){var i=e("./zlib/inflate"),n=e("./utils/common"),s=e("./utils/strings"),a=e("./zlib/constants"),o=e("./zlib/messages"),l=e("./zlib/zstream"),c=e("./zlib/gzheader"),d=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var r=i.inflateInit2(this.strm,t.windowBits);if(r!==a.Z_OK)throw new Error(o[r]);this.header=new c,i.inflateGetHeader(this.strm,this.header)}function h(e,t){var r=new u(t);if(r.push(e,!0),r.err)throw r.msg||o[r.err];return r.result}u.prototype.push=function(e,t){var r,o,l,c,u,h,f=this.strm,p=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;o=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?f.input=s.binstring2buf(e):"[object ArrayBuffer]"===d.call(e)?f.input=new Uint8Array(e):f.input=e,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new n.Buf8(p),f.next_out=0,f.avail_out=p),(r=i.inflate(f,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&m&&(h="string"==typeof m?s.string2buf(m):"[object ArrayBuffer]"===d.call(m)?new Uint8Array(m):m,r=i.inflateSetDictionary(this.strm,h)),r===a.Z_BUF_ERROR&&!0===g&&(r=a.Z_OK,g=!1),r!==a.Z_STREAM_END&&r!==a.Z_OK)return this.onEnd(r),!(this.ended=!0);f.next_out&&(0!==f.avail_out&&r!==a.Z_STREAM_END&&(0!==f.avail_in||o!==a.Z_FINISH&&o!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(l=s.utf8border(f.output,f.next_out),c=f.next_out-l,u=s.buf2string(f.output,l),f.next_out=c,f.avail_out=p-c,c&&n.arraySet(f.output,f.output,l,c,0),this.onData(u)):this.onData(n.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(g=!0)}while((0<f.avail_in||0===f.avail_out)&&r!==a.Z_STREAM_END);return r===a.Z_STREAM_END&&(o=a.Z_FINISH),o===a.Z_FINISH?(r=i.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===a.Z_OK):o!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(f.avail_out=0))},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=u,r.inflate=h,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},r.ungzip=h},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,r){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,r,i,n){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+i),n);else for(var s=0;s<i;s++)e[n+s]=t[r+s]},flattenChunks:function(e){var t,r,i,n,s,a;for(t=i=0,r=e.length;t<r;t++)i+=e[t].length;for(a=new Uint8Array(i),t=n=0,r=e.length;t<r;t++)s=e[t],a.set(s,n),n+=s.length;return a}},s={arraySet:function(e,t,r,i,n){for(var s=0;s<i;s++)e[n+s]=t[r+s]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,n)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,s))},r.setTyped(i)},{}],42:[function(e,t,r){var i=e("./common"),n=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var a=new i.Buf8(256),o=0;o<256;o++)a[o]=252<=o?6:248<=o?5:240<=o?4:224<=o?3:192<=o?2:1;function l(e,t){if(t<65537&&(e.subarray&&s||!e.subarray&&n))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var r="",a=0;a<t;a++)r+=String.fromCharCode(e[a]);return r}a[254]=a[254]=1,r.string2buf=function(e){var t,r,n,s,a,o=e.length,l=0;for(s=0;s<o;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(n=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(n-56320),s++),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new i.Buf8(l),s=a=0;a<l;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(n=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(n-56320),s++),r<128?t[a++]=r:(r<2048?t[a++]=192|r>>>6:(r<65536?t[a++]=224|r>>>12:(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63),t[a++]=128|r>>>6&63),t[a++]=128|63&r);return t},r.buf2binstring=function(e){return l(e,e.length)},r.binstring2buf=function(e){for(var t=new i.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,i,n,s,o=t||e.length,c=new Array(2*o);for(r=i=0;r<o;)if((n=e[r++])<128)c[i++]=n;else if(4<(s=a[n]))c[i++]=65533,r+=s-1;else{for(n&=2===s?31:3===s?15:7;1<s&&r<o;)n=n<<6|63&e[r++],s--;1<s?c[i++]=65533:n<65536?c[i++]=n:(n-=65536,c[i++]=55296|n>>10&1023,c[i++]=56320|1023&n)}return l(c,i)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0||0===r?t:r+a[e[r]]>t?r:t}},{"./common":41}],43:[function(e,t,r){t.exports=function(e,t,r,i){for(var n=65535&e,s=e>>>16&65535,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;s=s+(n=n+t[i++]|0)|0,--a;);n%=65521,s%=65521}return n|s<<16}},{}],44:[function(e,t,r){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,r){var i=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,n){var s=i,a=n+r;e^=-1;for(var o=n;o<a;o++)e=e>>>8^s[255&(e^t[o])];return~e}},{}],46:[function(e,t,r){var i,n=e("../utils/common"),s=e("./trees"),a=e("./adler32"),o=e("./crc32"),l=e("./messages"),c=0,d=4,u=0,h=-2,f=-1,p=4,m=2,g=8,y=9,_=286,v=30,E=19,S=2*_+1,T=15,b=3,R=258,w=R+b+1,A=42,L=113,C=1,I=2,k=3,D=4;function P(e,t){return e.msg=l[t],t}function O(e){return(e<<1)-(4<e?9:0)}function x(e){for(var t=e.length;0<=--t;)e[t]=0}function M(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(n.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function N(e,t){s._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,M(e.strm)}function F(e,t){e.pending_buf[e.pending++]=t}function U(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function B(e,t){var r,i,n=e.max_chain_length,s=e.strstart,a=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-w?e.strstart-(e.w_size-w):0,c=e.window,d=e.w_mask,u=e.prev,h=e.strstart+R,f=c[s+a-1],p=c[s+a];e.prev_length>=e.good_match&&(n>>=2),o>e.lookahead&&(o=e.lookahead);do{if(c[(r=t)+a]===p&&c[r+a-1]===f&&c[r]===c[s]&&c[++r]===c[s+1]){s+=2,r++;do{}while(c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&s<h);if(i=R-(h-s),s=h-R,a<i){if(e.match_start=t,o<=(a=i))break;f=c[s+a-1],p=c[s+a]}}}while((t=u[t&d])>l&&0!=--n);return a<=e.lookahead?a:e.lookahead}function H(e){var t,r,i,s,l,c,d,u,h,f,p=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-w)){for(n.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=r=e.hash_size;i=e.head[--t],e.head[t]=p<=i?i-p:0,--r;);for(t=r=p;i=e.prev[--t],e.prev[t]=p<=i?i-p:0,--r;);s+=p}if(0===e.strm.avail_in)break;if(c=e.strm,d=e.window,u=e.strstart+e.lookahead,f=void 0,(h=s)<(f=c.avail_in)&&(f=h),r=0===f?0:(c.avail_in-=f,n.arraySet(d,c.input,c.next_in,f,u),1===c.state.wrap?c.adler=a(c.adler,d,f,u):2===c.state.wrap&&(c.adler=o(c.adler,d,f,u)),c.next_in+=f,c.total_in+=f,f),e.lookahead+=r,e.lookahead+e.insert>=b)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+b-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<b)););}while(e.lookahead<w&&0!==e.strm.avail_in)}function j(e,t){for(var r,i;;){if(e.lookahead<w){if(H(e),e.lookahead<w&&t===c)return C;if(0===e.lookahead)break}if(r=0,e.lookahead>=b&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+b-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-w&&(e.match_length=B(e,r)),e.match_length>=b)if(i=s._tr_tally(e,e.strstart-e.match_start,e.match_length-b),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=b){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+b-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(N(e,!1),0===e.strm.avail_out))return C}return e.insert=e.strstart<b-1?e.strstart:b-1,t===d?(N(e,!0),0===e.strm.avail_out?k:D):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?C:I}function V(e,t){for(var r,i,n;;){if(e.lookahead<w){if(H(e),e.lookahead<w&&t===c)return C;if(0===e.lookahead)break}if(r=0,e.lookahead>=b&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+b-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=b-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-w&&(e.match_length=B(e,r),e.match_length<=5&&(1===e.strategy||e.match_length===b&&4096<e.strstart-e.match_start)&&(e.match_length=b-1)),e.prev_length>=b&&e.match_length<=e.prev_length){for(n=e.strstart+e.lookahead-b,i=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-b),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+b-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=b-1,e.strstart++,i&&(N(e,!1),0===e.strm.avail_out))return C}else if(e.match_available){if((i=s._tr_tally(e,0,e.window[e.strstart-1]))&&N(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return C}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<b-1?e.strstart:b-1,t===d?(N(e,!0),0===e.strm.avail_out?k:D):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?C:I}function G(e,t,r,i,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=n}function z(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(2*S),this.dyn_dtree=new n.Buf16(2*(2*v+1)),this.bl_tree=new n.Buf16(2*(2*E+1)),x(this.dyn_ltree),x(this.dyn_dtree),x(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(T+1),this.heap=new n.Buf16(2*_+1),x(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*_+1),x(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function K(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=m,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?A:L,e.adler=2===t.wrap?0:1,t.last_flush=c,s._tr_init(t),u):P(e,h)}function W(e){var t=K(e);return t===u&&function(e){e.window_size=2*e.w_size,x(e.head),e.max_lazy_match=i[e.level].max_lazy,e.good_match=i[e.level].good_length,e.nice_match=i[e.level].nice_length,e.max_chain_length=i[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=b-1,e.match_available=0,e.ins_h=0}(e.state),t}function $(e,t,r,i,s,a){if(!e)return h;var o=1;if(t===f&&(t=6),i<0?(o=0,i=-i):15<i&&(o=2,i-=16),s<1||y<s||r!==g||i<8||15<i||t<0||9<t||a<0||p<a)return P(e,h);8===i&&(i=9);var l=new z;return(e.state=l).strm=e,l.wrap=o,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+b-1)/b),l.window=new n.Buf8(2*l.w_size),l.head=new n.Buf16(l.hash_size),l.prev=new n.Buf16(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new n.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=a,l.method=r,W(e)}i=[new G(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(H(e),0===e.lookahead&&t===c)return C;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+r;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,N(e,!1),0===e.strm.avail_out))return C;if(e.strstart-e.block_start>=e.w_size-w&&(N(e,!1),0===e.strm.avail_out))return C}return e.insert=0,t===d?(N(e,!0),0===e.strm.avail_out?k:D):(e.strstart>e.block_start&&(N(e,!1),e.strm.avail_out),C)})),new G(4,4,8,4,j),new G(4,5,16,8,j),new G(4,6,32,32,j),new G(4,4,16,16,V),new G(8,16,32,32,V),new G(8,16,128,128,V),new G(8,32,128,256,V),new G(32,128,258,1024,V),new G(32,258,258,4096,V)],r.deflateInit=function(e,t){return $(e,t,g,15,8,0)},r.deflateInit2=$,r.deflateReset=W,r.deflateResetKeep=K,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?h:(e.state.gzhead=t,u):h},r.deflate=function(e,t){var r,n,a,l;if(!e||!e.state||5<t||t<0)return e?P(e,h):h;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||666===n.status&&t!==d)return P(e,0===e.avail_out?-5:h);if(n.strm=e,r=n.last_flush,n.last_flush=t,n.status===A)if(2===n.wrap)e.adler=0,F(n,31),F(n,139),F(n,8),n.gzhead?(F(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),F(n,255&n.gzhead.time),F(n,n.gzhead.time>>8&255),F(n,n.gzhead.time>>16&255),F(n,n.gzhead.time>>24&255),F(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),F(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(F(n,255&n.gzhead.extra.length),F(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=o(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(F(n,0),F(n,0),F(n,0),F(n,0),F(n,0),F(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),F(n,3),n.status=L);else{var f=g+(n.w_bits-8<<4)<<8;f|=(2<=n.strategy||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(f|=32),f+=31-f%31,n.status=L,U(n,f),0!==n.strstart&&(U(n,e.adler>>>16),U(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(a=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>a&&(e.adler=o(e.adler,n.pending_buf,n.pending-a,a)),M(e),a=n.pending,n.pending!==n.pending_buf_size));)F(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>a&&(e.adler=o(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){a=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(e.adler=o(e.adler,n.pending_buf,n.pending-a,a)),M(e),a=n.pending,n.pending===n.pending_buf_size)){l=1;break}l=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,F(n,l)}while(0!==l);n.gzhead.hcrc&&n.pending>a&&(e.adler=o(e.adler,n.pending_buf,n.pending-a,a)),0===l&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){a=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(e.adler=o(e.adler,n.pending_buf,n.pending-a,a)),M(e),a=n.pending,n.pending===n.pending_buf_size)){l=1;break}l=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,F(n,l)}while(0!==l);n.gzhead.hcrc&&n.pending>a&&(e.adler=o(e.adler,n.pending_buf,n.pending-a,a)),0===l&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&M(e),n.pending+2<=n.pending_buf_size&&(F(n,255&e.adler),F(n,e.adler>>8&255),e.adler=0,n.status=L)):n.status=L),0!==n.pending){if(M(e),0===e.avail_out)return n.last_flush=-1,u}else if(0===e.avail_in&&O(t)<=O(r)&&t!==d)return P(e,-5);if(666===n.status&&0!==e.avail_in)return P(e,-5);if(0!==e.avail_in||0!==n.lookahead||t!==c&&666!==n.status){var p=2===n.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(H(e),0===e.lookahead)){if(t===c)return C;break}if(e.match_length=0,r=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(N(e,!1),0===e.strm.avail_out))return C}return e.insert=0,t===d?(N(e,!0),0===e.strm.avail_out?k:D):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?C:I}(n,t):3===n.strategy?function(e,t){for(var r,i,n,a,o=e.window;;){if(e.lookahead<=R){if(H(e),e.lookahead<=R&&t===c)return C;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=b&&0<e.strstart&&(i=o[n=e.strstart-1])===o[++n]&&i===o[++n]&&i===o[++n]){a=e.strstart+R;do{}while(i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&n<a);e.match_length=R-(a-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=b?(r=s._tr_tally(e,1,e.match_length-b),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(N(e,!1),0===e.strm.avail_out))return C}return e.insert=0,t===d?(N(e,!0),0===e.strm.avail_out?k:D):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?C:I}(n,t):i[n.level].func(n,t);if(p!==k&&p!==D||(n.status=666),p===C||p===k)return 0===e.avail_out&&(n.last_flush=-1),u;if(p===I&&(1===t?s._tr_align(n):5!==t&&(s._tr_stored_block(n,0,0,!1),3===t&&(x(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),M(e),0===e.avail_out))return n.last_flush=-1,u}return t!==d?u:n.wrap<=0?1:(2===n.wrap?(F(n,255&e.adler),F(n,e.adler>>8&255),F(n,e.adler>>16&255),F(n,e.adler>>24&255),F(n,255&e.total_in),F(n,e.total_in>>8&255),F(n,e.total_in>>16&255),F(n,e.total_in>>24&255)):(U(n,e.adler>>>16),U(n,65535&e.adler)),M(e),0<n.wrap&&(n.wrap=-n.wrap),0!==n.pending?u:1)},r.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==A&&69!==t&&73!==t&&91!==t&&103!==t&&t!==L&&666!==t?P(e,h):(e.state=null,t===L?P(e,-3):u):h},r.deflateSetDictionary=function(e,t){var r,i,s,o,l,c,d,f,p=t.length;if(!e||!e.state)return h;if(2===(o=(r=e.state).wrap)||1===o&&r.status!==A||r.lookahead)return h;for(1===o&&(e.adler=a(e.adler,t,p,0)),r.wrap=0,p>=r.w_size&&(0===o&&(x(r.head),r.strstart=0,r.block_start=0,r.insert=0),f=new n.Buf8(r.w_size),n.arraySet(f,t,p-r.w_size,r.w_size,0),t=f,p=r.w_size),l=e.avail_in,c=e.next_in,d=e.input,e.avail_in=p,e.next_in=0,e.input=t,H(r);r.lookahead>=b;){for(i=r.strstart,s=r.lookahead-(b-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[i+b-1])&r.hash_mask,r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++,--s;);r.strstart=i,r.lookahead=b-1,H(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=b-1,r.match_available=0,e.next_in=c,e.input=d,e.avail_in=l,r.wrap=o,u},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,r){t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,r){t.exports=function(e,t){var r,i,n,s,a,o,l,c,d,u,h,f,p,m,g,y,_,v,E,S,T,b,R,w,A;r=e.state,i=e.next_in,w=e.input,n=i+(e.avail_in-5),s=e.next_out,A=e.output,a=s-(t-e.avail_out),o=s+(e.avail_out-257),l=r.dmax,c=r.wsize,d=r.whave,u=r.wnext,h=r.window,f=r.hold,p=r.bits,m=r.lencode,g=r.distcode,y=(1<<r.lenbits)-1,_=(1<<r.distbits)-1;e:do{p<15&&(f+=w[i++]<<p,p+=8,f+=w[i++]<<p,p+=8),v=m[f&y];t:for(;;){if(f>>>=E=v>>>24,p-=E,0==(E=v>>>16&255))A[s++]=65535&v;else{if(!(16&E)){if(!(64&E)){v=m[(65535&v)+(f&(1<<E)-1)];continue t}if(32&E){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}S=65535&v,(E&=15)&&(p<E&&(f+=w[i++]<<p,p+=8),S+=f&(1<<E)-1,f>>>=E,p-=E),p<15&&(f+=w[i++]<<p,p+=8,f+=w[i++]<<p,p+=8),v=g[f&_];r:for(;;){if(f>>>=E=v>>>24,p-=E,!(16&(E=v>>>16&255))){if(!(64&E)){v=g[(65535&v)+(f&(1<<E)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(T=65535&v,p<(E&=15)&&(f+=w[i++]<<p,(p+=8)<E&&(f+=w[i++]<<p,p+=8)),l<(T+=f&(1<<E)-1)){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=E,p-=E,(E=s-a)<T){if(d<(E=T-E)&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(R=h,(b=0)===u){if(b+=c-E,E<S){for(S-=E;A[s++]=h[b++],--E;);b=s-T,R=A}}else if(u<E){if(b+=c+u-E,(E-=u)<S){for(S-=E;A[s++]=h[b++],--E;);if(b=0,u<S){for(S-=E=u;A[s++]=h[b++],--E;);b=s-T,R=A}}}else if(b+=u-E,E<S){for(S-=E;A[s++]=h[b++],--E;);b=s-T,R=A}for(;2<S;)A[s++]=R[b++],A[s++]=R[b++],A[s++]=R[b++],S-=3;S&&(A[s++]=R[b++],1<S&&(A[s++]=R[b++]))}else{for(b=s-T;A[s++]=A[b++],A[s++]=A[b++],A[s++]=A[b++],2<(S-=3););S&&(A[s++]=A[b++],1<S&&(A[s++]=A[b++]))}break}}break}}while(i<n&&s<o);i-=S=p>>3,f&=(1<<(p-=S<<3))-1,e.next_in=i,e.next_out=s,e.avail_in=i<n?n-i+5:5-(i-n),e.avail_out=s<o?o-s+257:257-(s-o),r.hold=f,r.bits=p}},{}],49:[function(e,t,r){var i=e("../utils/common"),n=e("./adler32"),s=e("./crc32"),a=e("./inffast"),o=e("./inftrees"),l=1,c=2,d=0,u=-2,h=1,f=852,p=592;function m(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function g(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=h,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(f),t.distcode=t.distdyn=new i.Buf32(p),t.sane=1,t.back=-1,d):u}function _(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,y(e)):u}function v(e,t){var r,i;return e&&e.state?(i=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?u:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,_(e))):u}function E(e,t){var r,i;return e?(i=new g,(e.state=i).window=null,(r=v(e,t))!==d&&(e.state=null),r):u}var S,T,b=!0;function R(e){if(b){var t;for(S=new i.Buf32(512),T=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(l,e.lens,0,288,S,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(c,e.lens,0,32,T,0,e.work,{bits:5}),b=!1}e.lencode=S,e.lenbits=9,e.distcode=T,e.distbits=5}function w(e,t,r,n){var s,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new i.Buf8(a.wsize)),n>=a.wsize?(i.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(n<(s=a.wsize-a.wnext)&&(s=n),i.arraySet(a.window,t,r-n,s,a.wnext),(n-=s)?(i.arraySet(a.window,t,r-n,n,0),a.wnext=n,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0}r.inflateReset=_,r.inflateReset2=v,r.inflateResetKeep=y,r.inflateInit=function(e){return E(e,15)},r.inflateInit2=E,r.inflate=function(e,t){var r,f,p,g,y,_,v,E,S,T,b,A,L,C,I,k,D,P,O,x,M,N,F,U,B=0,H=new i.Buf8(4),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return u;12===(r=e.state).mode&&(r.mode=13),y=e.next_out,p=e.output,v=e.avail_out,g=e.next_in,f=e.input,_=e.avail_in,E=r.hold,S=r.bits,T=_,b=v,N=d;e:for(;;)switch(r.mode){case h:if(0===r.wrap){r.mode=13;break}for(;S<16;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}if(2&r.wrap&&35615===E){H[r.check=0]=255&E,H[1]=E>>>8&255,r.check=s(r.check,H,2,0),S=E=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&E)<<8)+(E>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&E)){e.msg="unknown compression method",r.mode=30;break}if(S-=4,M=8+(15&(E>>>=4)),0===r.wbits)r.wbits=M;else if(M>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<M,e.adler=r.check=1,r.mode=512&E?10:12,S=E=0;break;case 2:for(;S<16;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}if(r.flags=E,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=E>>8&1),512&r.flags&&(H[0]=255&E,H[1]=E>>>8&255,r.check=s(r.check,H,2,0)),S=E=0,r.mode=3;case 3:for(;S<32;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}r.head&&(r.head.time=E),512&r.flags&&(H[0]=255&E,H[1]=E>>>8&255,H[2]=E>>>16&255,H[3]=E>>>24&255,r.check=s(r.check,H,4,0)),S=E=0,r.mode=4;case 4:for(;S<16;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}r.head&&(r.head.xflags=255&E,r.head.os=E>>8),512&r.flags&&(H[0]=255&E,H[1]=E>>>8&255,r.check=s(r.check,H,2,0)),S=E=0,r.mode=5;case 5:if(1024&r.flags){for(;S<16;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}r.length=E,r.head&&(r.head.extra_len=E),512&r.flags&&(H[0]=255&E,H[1]=E>>>8&255,r.check=s(r.check,H,2,0)),S=E=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(_<(A=r.length)&&(A=_),A&&(r.head&&(M=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),i.arraySet(r.head.extra,f,g,A,M)),512&r.flags&&(r.check=s(r.check,f,A,g)),_-=A,g+=A,r.length-=A),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===_)break e;for(A=0;M=f[g+A++],r.head&&M&&r.length<65536&&(r.head.name+=String.fromCharCode(M)),M&&A<_;);if(512&r.flags&&(r.check=s(r.check,f,A,g)),_-=A,g+=A,M)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===_)break e;for(A=0;M=f[g+A++],r.head&&M&&r.length<65536&&(r.head.comment+=String.fromCharCode(M)),M&&A<_;);if(512&r.flags&&(r.check=s(r.check,f,A,g)),_-=A,g+=A,M)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;S<16;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}if(E!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}S=E=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;S<32;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}e.adler=r.check=m(E),S=E=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=y,e.avail_out=v,e.next_in=g,e.avail_in=_,r.hold=E,r.bits=S,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){E>>>=7&S,S-=7&S,r.mode=27;break}for(;S<3;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}switch(r.last=1&E,S-=1,3&(E>>>=1)){case 0:r.mode=14;break;case 1:if(R(r),r.mode=20,6!==t)break;E>>>=2,S-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}E>>>=2,S-=2;break;case 14:for(E>>>=7&S,S-=7&S;S<32;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}if((65535&E)!=(E>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&E,S=E=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(A=r.length){if(_<A&&(A=_),v<A&&(A=v),0===A)break e;i.arraySet(p,f,g,A,y),_-=A,g+=A,v-=A,y+=A,r.length-=A;break}r.mode=12;break;case 17:for(;S<14;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}if(r.nlen=257+(31&E),E>>>=5,S-=5,r.ndist=1+(31&E),E>>>=5,S-=5,r.ncode=4+(15&E),E>>>=4,S-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;S<3;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}r.lens[j[r.have++]]=7&E,E>>>=3,S-=3}for(;r.have<19;)r.lens[j[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,F={bits:r.lenbits},N=o(0,r.lens,0,19,r.lencode,0,r.work,F),r.lenbits=F.bits,N){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;k=(B=r.lencode[E&(1<<r.lenbits)-1])>>>16&255,D=65535&B,!((I=B>>>24)<=S);){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}if(D<16)E>>>=I,S-=I,r.lens[r.have++]=D;else{if(16===D){for(U=I+2;S<U;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}if(E>>>=I,S-=I,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}M=r.lens[r.have-1],A=3+(3&E),E>>>=2,S-=2}else if(17===D){for(U=I+3;S<U;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}S-=I,M=0,A=3+(7&(E>>>=I)),E>>>=3,S-=3}else{for(U=I+7;S<U;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}S-=I,M=0,A=11+(127&(E>>>=I)),E>>>=7,S-=7}if(r.have+A>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;A--;)r.lens[r.have++]=M}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,F={bits:r.lenbits},N=o(l,r.lens,0,r.nlen,r.lencode,0,r.work,F),r.lenbits=F.bits,N){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,F={bits:r.distbits},N=o(c,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,F),r.distbits=F.bits,N){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=_&&258<=v){e.next_out=y,e.avail_out=v,e.next_in=g,e.avail_in=_,r.hold=E,r.bits=S,a(e,b),y=e.next_out,p=e.output,v=e.avail_out,g=e.next_in,f=e.input,_=e.avail_in,E=r.hold,S=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;k=(B=r.lencode[E&(1<<r.lenbits)-1])>>>16&255,D=65535&B,!((I=B>>>24)<=S);){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}if(k&&!(240&k)){for(P=I,O=k,x=D;k=(B=r.lencode[x+((E&(1<<P+O)-1)>>P)])>>>16&255,D=65535&B,!(P+(I=B>>>24)<=S);){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}E>>>=P,S-=P,r.back+=P}if(E>>>=I,S-=I,r.back+=I,r.length=D,0===k){r.mode=26;break}if(32&k){r.back=-1,r.mode=12;break}if(64&k){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&k,r.mode=22;case 22:if(r.extra){for(U=r.extra;S<U;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}r.length+=E&(1<<r.extra)-1,E>>>=r.extra,S-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;k=(B=r.distcode[E&(1<<r.distbits)-1])>>>16&255,D=65535&B,!((I=B>>>24)<=S);){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}if(!(240&k)){for(P=I,O=k,x=D;k=(B=r.distcode[x+((E&(1<<P+O)-1)>>P)])>>>16&255,D=65535&B,!(P+(I=B>>>24)<=S);){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}E>>>=P,S-=P,r.back+=P}if(E>>>=I,S-=I,r.back+=I,64&k){e.msg="invalid distance code",r.mode=30;break}r.offset=D,r.extra=15&k,r.mode=24;case 24:if(r.extra){for(U=r.extra;S<U;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}r.offset+=E&(1<<r.extra)-1,E>>>=r.extra,S-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===v)break e;if(A=b-v,r.offset>A){if((A=r.offset-A)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}L=A>r.wnext?(A-=r.wnext,r.wsize-A):r.wnext-A,A>r.length&&(A=r.length),C=r.window}else C=p,L=y-r.offset,A=r.length;for(v<A&&(A=v),v-=A,r.length-=A;p[y++]=C[L++],--A;);0===r.length&&(r.mode=21);break;case 26:if(0===v)break e;p[y++]=r.length,v--,r.mode=21;break;case 27:if(r.wrap){for(;S<32;){if(0===_)break e;_--,E|=f[g++]<<S,S+=8}if(b-=v,e.total_out+=b,r.total+=b,b&&(e.adler=r.check=r.flags?s(r.check,p,b,y-b):n(r.check,p,b,y-b)),b=v,(r.flags?E:m(E))!==r.check){e.msg="incorrect data check",r.mode=30;break}S=E=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;S<32;){if(0===_)break e;_--,E+=f[g++]<<S,S+=8}if(E!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}S=E=0}r.mode=29;case 29:N=1;break e;case 30:N=-3;break e;case 31:return-4;default:return u}return e.next_out=y,e.avail_out=v,e.next_in=g,e.avail_in=_,r.hold=E,r.bits=S,(r.wsize||b!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&w(e,e.output,e.next_out,b-e.avail_out)?(r.mode=31,-4):(T-=e.avail_in,b-=e.avail_out,e.total_in+=T,e.total_out+=b,r.total+=b,r.wrap&&b&&(e.adler=r.check=r.flags?s(r.check,p,b,e.next_out-b):n(r.check,p,b,e.next_out-b)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==T&&0===b||4===t)&&N===d&&(N=-5),N)},r.inflateEnd=function(e){if(!e||!e.state)return u;var t=e.state;return t.window&&(t.window=null),e.state=null,d},r.inflateGetHeader=function(e,t){var r;return e&&e.state&&2&(r=e.state).wrap?((r.head=t).done=!1,d):u},r.inflateSetDictionary=function(e,t){var r,i=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?u:11===r.mode&&n(1,t,i,0)!==r.check?-3:w(e,t,i,i)?(r.mode=31,-4):(r.havedict=1,d):u},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,r){var i=e("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,l,c,d,u,h){var f,p,m,g,y,_,v,E,S,T=h.bits,b=0,R=0,w=0,A=0,L=0,C=0,I=0,k=0,D=0,P=0,O=null,x=0,M=new i.Buf16(16),N=new i.Buf16(16),F=null,U=0;for(b=0;b<=15;b++)M[b]=0;for(R=0;R<l;R++)M[t[r+R]]++;for(L=T,A=15;1<=A&&0===M[A];A--);if(A<L&&(L=A),0===A)return c[d++]=20971520,c[d++]=20971520,h.bits=1,0;for(w=1;w<A&&0===M[w];w++);for(L<w&&(L=w),b=k=1;b<=15;b++)if(k<<=1,(k-=M[b])<0)return-1;if(0<k&&(0===e||1!==A))return-1;for(N[1]=0,b=1;b<15;b++)N[b+1]=N[b]+M[b];for(R=0;R<l;R++)0!==t[r+R]&&(u[N[t[r+R]]++]=R);if(_=0===e?(O=F=u,19):1===e?(O=n,x-=257,F=s,U-=257,256):(O=a,F=o,-1),b=w,y=d,I=R=P=0,m=-1,g=(D=1<<(C=L))-1,1===e&&852<D||2===e&&592<D)return 1;for(;;){for(v=b-I,S=u[R]<_?(E=0,u[R]):u[R]>_?(E=F[U+u[R]],O[x+u[R]]):(E=96,0),f=1<<b-I,w=p=1<<C;c[y+(P>>I)+(p-=f)]=v<<24|E<<16|S,0!==p;);for(f=1<<b-1;P&f;)f>>=1;if(0!==f?(P&=f-1,P+=f):P=0,R++,0==--M[b]){if(b===A)break;b=t[r+u[R]]}if(L<b&&(P&g)!==m){for(0===I&&(I=L),y+=w,k=1<<(C=b-I);C+I<A&&!((k-=M[C+I])<=0);)C++,k<<=1;if(D+=1<<C,1===e&&852<D||2===e&&592<D)return 1;c[m=P&g]=L<<24|C<<16|y-d}}return 0!==P&&(c[y+P]=b-I<<24|64<<16),h.bits=L,0}},{"../utils/common":41}],51:[function(e,t,r){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,r){var i=e("../utils/common"),n=0,s=1;function a(e){for(var t=e.length;0<=--t;)e[t]=0}var o=0,l=29,c=256,d=c+1+l,u=30,h=19,f=2*d+1,p=15,m=16,g=7,y=256,_=16,v=17,E=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],T=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],w=new Array(2*(d+2));a(w);var A=new Array(2*u);a(A);var L=new Array(512);a(L);var C=new Array(256);a(C);var I=new Array(l);a(I);var k,D,P,O=new Array(u);function x(e,t,r,i,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=e&&e.length}function M(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function N(e){return e<256?L[e]:L[256+(e>>>7)]}function F(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function U(e,t,r){e.bi_valid>m-r?(e.bi_buf|=t<<e.bi_valid&65535,F(e,e.bi_buf),e.bi_buf=t>>m-e.bi_valid,e.bi_valid+=r-m):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function B(e,t,r){U(e,r[2*t],r[2*t+1])}function H(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function j(e,t,r){var i,n,s=new Array(p+1),a=0;for(i=1;i<=p;i++)s[i]=a=a+r[i-1]<<1;for(n=0;n<=t;n++){var o=e[2*n+1];0!==o&&(e[2*n]=H(s[o]++,o))}}function V(e){var t;for(t=0;t<d;t++)e.dyn_ltree[2*t]=0;for(t=0;t<u;t++)e.dyn_dtree[2*t]=0;for(t=0;t<h;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*y]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function G(e){8<e.bi_valid?F(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function z(e,t,r,i){var n=2*t,s=2*r;return e[n]<e[s]||e[n]===e[s]&&i[t]<=i[r]}function K(e,t,r){for(var i=e.heap[r],n=r<<1;n<=e.heap_len&&(n<e.heap_len&&z(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!z(t,i,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=i}function W(e,t,r){var i,n,s,a,o=0;if(0!==e.last_lit)for(;i=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],n=e.pending_buf[e.l_buf+o],o++,0===i?B(e,n,t):(B(e,(s=C[n])+c+1,t),0!==(a=S[s])&&U(e,n-=I[s],a),B(e,s=N(--i),r),0!==(a=T[s])&&U(e,i-=O[s],a)),o<e.last_lit;);B(e,y,t)}function $(e,t){var r,i,n,s=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=f,r=0;r<l;r++)0!==s[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):s[2*r+1]=0;for(;e.heap_len<2;)s[2*(n=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[n]=0,e.opt_len--,o&&(e.static_len-=a[2*n+1]);for(t.max_code=c,r=e.heap_len>>1;1<=r;r--)K(e,s,r);for(n=l;r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],K(e,s,1),i=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=i,s[2*n]=s[2*r]+s[2*i],e.depth[n]=(e.depth[r]>=e.depth[i]?e.depth[r]:e.depth[i])+1,s[2*r+1]=s[2*i+1]=n,e.heap[1]=n++,K(e,s,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,i,n,s,a,o,l=t.dyn_tree,c=t.max_code,d=t.stat_desc.static_tree,u=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,m=t.stat_desc.extra_base,g=t.stat_desc.max_length,y=0;for(s=0;s<=p;s++)e.bl_count[s]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<f;r++)g<(s=l[2*l[2*(i=e.heap[r])+1]+1]+1)&&(s=g,y++),l[2*i+1]=s,c<i||(e.bl_count[s]++,a=0,m<=i&&(a=h[i-m]),o=l[2*i],e.opt_len+=o*(s+a),u&&(e.static_len+=o*(d[2*i+1]+a)));if(0!==y){do{for(s=g-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[g]--,y-=2}while(0<y);for(s=g;0!==s;s--)for(i=e.bl_count[s];0!==i;)c<(n=e.heap[--r])||(l[2*n+1]!==s&&(e.opt_len+=(s-l[2*n+1])*l[2*n],l[2*n+1]=s),i--)}}(e,t),j(s,c,e.bl_count)}function Y(e,t,r){var i,n,s=-1,a=t[1],o=0,l=7,c=4;for(0===a&&(l=138,c=3),t[2*(r+1)+1]=65535,i=0;i<=r;i++)n=a,a=t[2*(i+1)+1],++o<l&&n===a||(o<c?e.bl_tree[2*n]+=o:0!==n?(n!==s&&e.bl_tree[2*n]++,e.bl_tree[2*_]++):o<=10?e.bl_tree[2*v]++:e.bl_tree[2*E]++,s=n,c=(o=0)===a?(l=138,3):n===a?(l=6,3):(l=7,4))}function q(e,t,r){var i,n,s=-1,a=t[1],o=0,l=7,c=4;for(0===a&&(l=138,c=3),i=0;i<=r;i++)if(n=a,a=t[2*(i+1)+1],!(++o<l&&n===a)){if(o<c)for(;B(e,n,e.bl_tree),0!=--o;);else 0!==n?(n!==s&&(B(e,n,e.bl_tree),o--),B(e,_,e.bl_tree),U(e,o-3,2)):o<=10?(B(e,v,e.bl_tree),U(e,o-3,3)):(B(e,E,e.bl_tree),U(e,o-11,7));s=n,c=(o=0)===a?(l=138,3):n===a?(l=6,3):(l=7,4)}}a(O);var Z=!1;function X(e,t,r,n){U(e,(o<<1)+(n?1:0),3),function(e,t,r,n){G(e),n&&(F(e,r),F(e,~r)),i.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}r._tr_init=function(e){Z||(function(){var e,t,r,i,n,s=new Array(p+1);for(i=r=0;i<l-1;i++)for(I[i]=r,e=0;e<1<<S[i];e++)C[r++]=i;for(C[r-1]=i,i=n=0;i<16;i++)for(O[i]=n,e=0;e<1<<T[i];e++)L[n++]=i;for(n>>=7;i<u;i++)for(O[i]=n<<7,e=0;e<1<<T[i]-7;e++)L[256+n++]=i;for(t=0;t<=p;t++)s[t]=0;for(e=0;e<=143;)w[2*e+1]=8,e++,s[8]++;for(;e<=255;)w[2*e+1]=9,e++,s[9]++;for(;e<=279;)w[2*e+1]=7,e++,s[7]++;for(;e<=287;)w[2*e+1]=8,e++,s[8]++;for(j(w,d+1,s),e=0;e<u;e++)A[2*e+1]=5,A[2*e]=H(e,5);k=new x(w,S,c+1,d,p),D=new x(A,T,0,u,p),P=new x(new Array(0),b,0,h,g)}(),Z=!0),e.l_desc=new M(e.dyn_ltree,k),e.d_desc=new M(e.dyn_dtree,D),e.bl_desc=new M(e.bl_tree,P),e.bi_buf=0,e.bi_valid=0,V(e)},r._tr_stored_block=X,r._tr_flush_block=function(e,t,r,i){var a,o,l=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return n;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return s;for(t=32;t<c;t++)if(0!==e.dyn_ltree[2*t])return s;return n}(e)),$(e,e.l_desc),$(e,e.d_desc),l=function(e){var t;for(Y(e,e.dyn_ltree,e.l_desc.max_code),Y(e,e.dyn_dtree,e.d_desc.max_code),$(e,e.bl_desc),t=h-1;3<=t&&0===e.bl_tree[2*R[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),a=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=a&&(a=o)):a=o=r+5,r+4<=a&&-1!==t?X(e,t,r,i):4===e.strategy||o===a?(U(e,2+(i?1:0),3),W(e,w,A)):(U(e,4+(i?1:0),3),function(e,t,r,i){var n;for(U(e,t-257,5),U(e,r-1,5),U(e,i-4,4),n=0;n<i;n++)U(e,e.bl_tree[2*R[n]+1],3);q(e,e.dyn_ltree,t-1),q(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1),W(e,e.dyn_ltree,e.dyn_dtree)),V(e),i&&G(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(C[r]+c+1)]++,e.dyn_dtree[2*N(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){U(e,2,3),B(e,y,w),function(e){16===e.bi_valid?(F(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":41}],53:[function(e,t,r){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,i){(function(e){!function(e,t){if(!e.setImmediate){var r,i,n,s,a=1,o={},l=!1,c=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,r="[object process]"==={}.toString.call(e.process)?function(e){mh((function(){h(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?(s="setImmediate$"+Math.random()+"$",e.addEventListener?e.addEventListener("message",f,!1):e.attachEvent("onmessage",f),function(t){e.postMessage(s+t,"*")}):e.MessageChannel?((n=new MessageChannel).port1.onmessage=function(e){h(e.data)},function(e){n.port2.postMessage(e)}):c&&"onreadystatechange"in c.createElement("script")?(i=c.documentElement,function(e){var t=c.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):function(e){setTimeout(h,0,e)},d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var n={callback:e,args:t};return o[a]=n,r(a),a++},d.clearImmediate=u}function u(e){delete o[e]}function h(e){if(l)setTimeout(h,0,e);else{var r=o[e];if(r){l=!0;try{!function(e){var r=e.callback,i=e.args;switch(i.length){case 0:r();break;case 1:r(i[0]);break;case 2:r(i[0],i[1]);break;case 3:r(i[0],i[1],i[2]);break;default:r.apply(t,i)}}(r)}finally{u(e),l=!1}}}}function f(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(s)&&h(+t.data.slice(s.length))}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)}(Ih);var kh=Ih.exports;const Dh={SDK_VERSION:"2.6.3",COMMIT_ID:"73cc626",NEGOTIATE_SDP_URL_PATH:"/webrtc/v1/pullstream",STOP_PLAY_URL_PATH:"/webrtc/v1/stopstream",OPS_REPORT_DOMAIN:"log-collection-new.hwcloudlive.com",SHARE_PULL_DOMAIN:["global-lll.huaweicloud.com","global-lll.huaweicloud.cn"],GSLB_DOMAIN:"hcdnl-pull302-global-gslb.livehwc3.cn",GSLB_REQUEST_TIMEOUT:4e3,DNS_REQUEST_TIMEOUT:3e3,PULLSTREAM_REQUEST_TIMEOUT:6e3,REQUEST_DEFAULT_TIMEOUT:5e3,OPS_AUTH_TOKEN:"Token 1dc3549b538515311e23d68684a67fb93341f3f5",OPS_REPORT_INTERVAL:5e3,STATISTIC_INTERVAL:100,PUBLIC_DNS_SERVER:["dns.alidns.com","doh.pub"]};let Ph=function(e){return e[e.HWLLS_OK=0]="HWLLS_OK",e[e.HWLLS_ERROR_INVALID_URL=5e7]="HWLLS_ERROR_INVALID_URL",e[e.HWLLS_ERROR_INVALID_PARAMETER=50000001]="HWLLS_ERROR_INVALID_PARAMETER",e[e.HWLLS_ERROR_SERVER_CONNECT_FAIL=50000002]="HWLLS_ERROR_SERVER_CONNECT_FAIL",e[e.HWLLS_ERROR_SERVER_NO_RESPONSE=50000003]="HWLLS_ERROR_SERVER_NO_RESPONSE",e[e.HWLLS_ERROR_AUTH_FAIL=50000004]="HWLLS_ERROR_AUTH_FAIL",e[e.HWLLS_ERROR_STREAM_NOT_EXIST=50000005]="HWLLS_ERROR_STREAM_NOT_EXIST",e[e.HWLLS_ERROR_WEBRTC_UNSUPPORTED=50000006]="HWLLS_ERROR_WEBRTC_UNSUPPORTED",e[e.HWLLS_MEDIA_NETWORK_ERROR=50000007]="HWLLS_MEDIA_NETWORK_ERROR",e[e.HWLLS_ERROR_BAD_REQUEST=50000008]="HWLLS_ERROR_BAD_REQUEST",e[e.HWLLS_ERROR_STREAM_INVALID_PARAMETER=50000009]="HWLLS_ERROR_STREAM_INVALID_PARAMETER",e[e.HWLLS_ERROR_ENCODING_NOT_ACCEPTED=500000010]="HWLLS_ERROR_ENCODING_NOT_ACCEPTED",e[e.HWLLS_INTERNAL_ERROR=50000020]="HWLLS_INTERNAL_ERROR",e[e.HWLLS_BUSSINESS_DOWNGRADE=50000021]="HWLLS_BUSSINESS_DOWNGRADE",e[e.HWLLS_PLAY_WEBRTC_RETRY_FAILED=50000022]="HWLLS_PLAY_WEBRTC_RETRY_FAILED",e[e.HWLLS_PLAY_FLV_RETRY_FAILED=50000023]="HWLLS_PLAY_FLV_RETRY_FAILED",e[e.HWLLS_PLAY_HLS_RETRY_FAILED=50000024]="HWLLS_PLAY_HLS_RETRY_FAILED",e[e.HWLLS_ERROR_LIVE_UNSUPPORTED=50000030]="HWLLS_ERROR_LIVE_UNSUPPORTED",e[e.HWLLS_ERROR_UNEXPECTED_EOF=50000031]="HWLLS_ERROR_UNEXPECTED_EOF",e[e.HWLLS_ERROR_MEDIA_ERROR=50000032]="HWLLS_ERROR_MEDIA_ERROR",e[e.HWLLS_PLAY_NOT_ALLOW=51e6]="HWLLS_PLAY_NOT_ALLOW",e[e.HWLLS_PLAY_TIMEOUT=51000001]="HWLLS_PLAY_TIMEOUT",e}({});const Oh={[Ph.HWLLS_OK]:"success",[Ph.HWLLS_ERROR_INVALID_URL]:"url invalid.",[Ph.HWLLS_ERROR_INVALID_PARAMETER]:"parameter invalid.",[Ph.HWLLS_ERROR_SERVER_CONNECT_FAIL]:"server not available or server internal error.",[Ph.HWLLS_ERROR_SERVER_NO_RESPONSE]:"server respone timeout.",[Ph.HWLLS_ERROR_AUTH_FAIL]:"server authnicate failed.",[Ph.HWLLS_ERROR_STREAM_NOT_EXIST]:"stream not exist.",[Ph.HWLLS_MEDIA_NETWORK_ERROR]:"media connection establish failed, please switch network or try again later.",[Ph.HWLLS_ERROR_BAD_REQUEST]:"bad request.",[Ph.HWLLS_ERROR_STREAM_INVALID_PARAMETER]:"request stream or content invalid.",[Ph.HWLLS_INTERNAL_ERROR]:"internal error",[Ph.HWLLS_BUSSINESS_DOWNGRADE]:"fatal error, bussiness downgrade: hls/http-flv etc.",[Ph.HWLLS_PLAY_WEBRTC_RETRY_FAILED]:"recover play with webrtc protocol timeOut, pls comfirm the server is avaliable.",[Ph.HWLLS_PLAY_FLV_RETRY_FAILED]:"recover play with flv format timeOut, pls comfirm the server is avaliable.",[Ph.HWLLS_PLAY_HLS_RETRY_FAILED]:"recover play with hls format timeOut, pls comfirm the server is avaliable.",[Ph.HWLLS_PLAY_NOT_ALLOW]:"the user didn't interact with the document first, please trigger by gesture.",[Ph.HWLLS_PLAY_TIMEOUT]:"play timeout, please confirm the stream server status.",[Ph.HWLLS_ERROR_UNEXPECTED_EOF]:"related to unexpected network EOF which cannot be recovered.",[Ph.HWLLS_ERROR_ENCODING_NOT_ACCEPTED]:"server does not accept content-encoding request"};class xh extends Error{constructor(e,t){let r="";r=e in Ph?Oh[e]:"unknow error",super(t),this.code=e,this.message=t||r}getCode(){return this.code}getMsg(){return this.message}toString(){return'["code": '.concat(this.code,', "message": "').concat(this.message,'"]')}}var Mh="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Nh=qr,Fh=ei,Uh=oi,Bh=RangeError,Hh=function(e){if(void 0===e)return 0;var t=Fh(e),r=Uh(t);if(t!==r)throw Bh("Wrong length or index");return r},jh=Array,Vh=Math.abs,Gh=Math.pow,zh=Math.floor,Kh=Math.log,Wh=Math.LN2,$h={pack:function(e,t,r){var i,n,s,a=jh(r),o=8*r-t-1,l=(1<<o)-1,c=l>>1,d=23===t?Gh(2,-24)-Gh(2,-77):0,u=e<0||0===e&&1/e<0?1:0,h=0;for((e=Vh(e))!=e||e===1/0?(n=e!=e?1:0,i=l):(i=zh(Kh(e)/Wh),e*(s=Gh(2,-i))<1&&(i--,s*=2),(e+=i+c>=1?d/s:d*Gh(2,1-c))*s>=2&&(i++,s/=2),i+c>=l?(n=0,i=l):i+c>=1?(n=(e*s-1)*Gh(2,t),i+=c):(n=e*Gh(2,c-1)*Gh(2,t),i=0));t>=8;)a[h++]=255&n,n/=256,t-=8;for(i=i<<t|n,o+=t;o>0;)a[h++]=255&i,i/=256,o-=8;return a[--h]|=128*u,a},unpack:function(e,t){var r,i=e.length,n=8*i-t-1,s=(1<<n)-1,a=s>>1,o=n-7,l=i-1,c=e[l--],d=127&c;for(c>>=7;o>0;)d=256*d+e[l--],o-=8;for(r=d&(1<<-o)-1,d>>=-o,o+=t;o>0;)r=256*r+e[l--],o-=8;if(0===d)d=1-a;else{if(d===s)return r?NaN:c?-1/0:1/0;r+=Gh(2,t),d-=a}return(c?-1:1)*r*Gh(2,d-t)}},Yh=!c((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),qh=Fe,Zh=V,Xh=xe,Jh=Yh,Qh=fr("IE_PROTO"),ef=Object,tf=ef.prototype,rf=Jh?ef.getPrototypeOf:function(e){var t=Xh(e);if(qh(t,Qh))return t[Qh];var r=t.constructor;return Zh(r)&&t instanceof r?r.prototype:t instanceof ef?tf:null},nf=xe,sf=ni,af=ci,of=function(e){for(var t=nf(this),r=af(t),i=arguments.length,n=sf(i>1?arguments[1]:void 0,r),s=i>2?arguments[2]:void 0,a=void 0===s?r:sf(s,r);a>n;)t[n++]=e;return t},lf=dt,cf=At,df=S,uf=ni,hf=ci,ff=function(e,t,r){var i=lf(t);i in e?cf.f(e,i,df(0,r)):e[i]=r},pf=Array,mf=Math.max,gf=function(e,t,r){for(var i=hf(e),n=uf(t,i),s=uf(void 0===r?i:r,i),a=pf(mf(s-n,0)),o=0;n<s;n++,o++)ff(a,o,e[n]);return a.length=o,a},yf=o,_f=L,vf=d,Ef=Mh,Sf=Jt,Tf=Kt,bf=function(e,t,r){for(var i in t)Nh(e,i,t[i],r);return e},Rf=c,wf=vn,Af=ei,Lf=oi,Cf=Hh,If=$h,kf=rf,Df=on,Pf=Zr.f,Of=At.f,xf=of,Mf=gf,Nf=un,Ff=Sf.PROPER,Uf=Sf.CONFIGURABLE,Bf=Pr.get,Hf=Pr.set,jf="ArrayBuffer",Vf="DataView",Gf="prototype",zf="Wrong index",Kf=yf[jf],Wf=Kf,$f=Wf&&Wf[Gf],Yf=yf[Vf],qf=Yf&&Yf[Gf],Zf=Object.prototype,Xf=yf.Array,Jf=yf.RangeError,Qf=_f(xf),ep=_f([].reverse),tp=If.pack,rp=If.unpack,ip=function(e){return[255&e]},np=function(e){return[255&e,e>>8&255]},sp=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},ap=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},op=function(e){return tp(e,23,4)},lp=function(e){return tp(e,52,8)},cp=function(e,t){Of(e[Gf],t,{get:function(){return Bf(this)[t]}})},dp=function(e,t,r,i){var n=Cf(r),s=Bf(e);if(n+t>s.byteLength)throw Jf(zf);var a=Bf(s.buffer).bytes,o=n+s.byteOffset,l=Mf(a,o,o+t);return i?l:ep(l)},up=function(e,t,r,i,n,s){var a=Cf(r),o=Bf(e);if(a+t>o.byteLength)throw Jf(zf);for(var l=Bf(o.buffer).bytes,c=a+o.byteOffset,d=i(+n),u=0;u<t;u++)l[c+u]=d[s?u:t-u-1]};if(Ef){var hp=Ff&&Kf.name!==jf;if(Rf((function(){Kf(1)}))&&Rf((function(){new Kf(-1)}))&&!Rf((function(){return new Kf,new Kf(1.5),new Kf(NaN),hp&&!Uf})))hp&&Uf&&Tf(Kf,"name",jf);else{(Wf=function(e){return wf(this,$f),new Kf(Cf(e))})[Gf]=$f;for(var fp,pp=Pf(Kf),mp=0;pp.length>mp;)(fp=pp[mp++])in Wf||Tf(Wf,fp,Kf[fp]);$f.constructor=Wf}Df&&kf(qf)!==Zf&&Df(qf,Zf);var gp=new Yf(new Wf(2)),yp=_f(qf.setInt8);gp.setInt8(0,2147483648),gp.setInt8(1,2147483649),!gp.getInt8(0)&&gp.getInt8(1)||bf(qf,{setInt8:function(e,t){yp(this,e,t<<24>>24)},setUint8:function(e,t){yp(this,e,t<<24>>24)}},{unsafe:!0})}else Wf=function(e){wf(this,$f);var t=Cf(e);Hf(this,{bytes:Qf(Xf(t),0),byteLength:t}),vf||(this.byteLength=t)},$f=Wf[Gf],Yf=function(e,t,r){wf(this,qf),wf(e,$f);var i=Bf(e).byteLength,n=Af(t);if(n<0||n>i)throw Jf("Wrong offset");if(n+(r=void 0===r?i-n:Lf(r))>i)throw Jf("Wrong length");Hf(this,{buffer:e,byteLength:r,byteOffset:n}),vf||(this.buffer=e,this.byteLength=r,this.byteOffset=n)},qf=Yf[Gf],vf&&(cp(Wf,"byteLength"),cp(Yf,"buffer"),cp(Yf,"byteLength"),cp(Yf,"byteOffset")),bf(qf,{getInt8:function(e){return dp(this,1,e)[0]<<24>>24},getUint8:function(e){return dp(this,1,e)[0]},getInt16:function(e){var t=dp(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=dp(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return ap(dp(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return ap(dp(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return rp(dp(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return rp(dp(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){up(this,1,e,ip,t)},setUint8:function(e,t){up(this,1,e,ip,t)},setInt16:function(e,t){up(this,2,e,np,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){up(this,2,e,np,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){up(this,4,e,sp,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){up(this,4,e,sp,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){up(this,4,e,op,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){up(this,8,e,lp,t,arguments.length>2?arguments[2]:void 0)}});Nf(Wf,jf),Nf(Yf,Vf);var _p={ArrayBuffer:Wf,DataView:Yf},vp=Ji,Ep=L,Sp=c,Tp=Dt,bp=ni,Rp=oi,wp=Qn,Ap=_p.ArrayBuffer,Lp=_p.DataView,Cp=Lp.prototype,Ip=Ep(Ap.prototype.slice),kp=Ep(Cp.getUint8),Dp=Ep(Cp.setUint8);vp({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:Sp((function(){return!new Ap(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(Ip&&void 0===t)return Ip(Tp(this),e);for(var r=Tp(this).byteLength,i=bp(e,r),n=bp(void 0===t?r:t,r),s=new(wp(this,Ap))(Rp(n-i)),a=new Lp(this),o=new Lp(s),l=0;i<n;)Dp(o,l++,kp(a,i++));return s}});var Pp=gn,Op="ArrayBuffer",xp=_p[Op];Ji({global:!0,constructor:!0,forced:o[Op]!==xp},{ArrayBuffer:xp}),Pp(Op);var Mp=Wt.exports,Np=At,Fp=d,Up=function(e,t,r){return r.get&&Mp(r.get,t,{getter:!0}),r.set&&Mp(r.set,t,{setter:!0}),Np.f(e,t,r)},Bp=Jl,Hp=c,jp=o.RegExp,Vp=jp.prototype,Gp=Fp&&Hp((function(){var e=!0;try{jp(".","d")}catch(IU){e=!1}var t={},r="",i=e?"dgimsy":"gimsy",n=function(e,i){Object.defineProperty(t,e,{get:function(){return r+=i,!0}})},s={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var a in e&&(s.hasIndices="d"),s)n(a,s[a]);return Object.getOwnPropertyDescriptor(Vp,"flags").get.call(t)!==i||r!==i}));Gp&&Up(Vp,"flags",{configurable:!0,get:Bp});var zp=Qe,Kp=Cc,Wp=At.f,$p=zp("unscopables"),Yp=Array.prototype;null==Yp[$p]&&Wp(Yp,$p,{configurable:!0,value:Kp(null)});var qp,Zp,Xp,Jp=function(e){Yp[$p][e]=!0},Qp=c,em=V,tm=rf,rm=qr,im=Qe("iterator"),nm=!1;[].keys&&("next"in(Xp=[].keys())?(Zp=tm(tm(Xp)))!==Object.prototype&&(qp=Zp):nm=!0);var sm=null==qp||Qp((function(){var e={};return qp[im].call(e)!==e}));sm&&(qp={}),em(qp[im])||rm(qp,im,(function(){return this}));var am={IteratorPrototype:qp,BUGGY_SAFARI_ITERATORS:nm},om=am.IteratorPrototype,lm=Cc,cm=S,dm=un,um=Do,hm=function(){return this},fm=Ji,pm=p,mm=V,gm=function(e,t,r,i){var n=t+" Iterator";return e.prototype=lm(om,{next:cm(+!i,r)}),dm(e,n,!1),um[n]=hm,e},ym=rf,_m=on,vm=un,Em=Kt,Sm=qr,Tm=Do,bm=Jt.PROPER,Rm=Jt.CONFIGURABLE,wm=am.IteratorPrototype,Am=am.BUGGY_SAFARI_ITERATORS,Lm=Qe("iterator"),Cm="keys",Im="values",km="entries",Dm=function(){return this},Pm=j,Om=Jp,xm=Do,Mm=Pr,Nm=At.f,Fm=function(e,t,r,i,n,s,a){gm(r,t,i);var o,l,c,d=function(e){if(e===n&&m)return m;if(!Am&&e in f)return f[e];switch(e){case Cm:case Im:case km:return function(){return new r(this,e)}}return function(){return new r(this)}},u=t+" Iterator",h=!1,f=e.prototype,p=f[Lm]||f["@@iterator"]||n&&f[n],m=!Am&&p||d(n),g="Array"==t&&f.entries||p;if(g&&(o=ym(g.call(new e)))!==Object.prototype&&o.next&&(ym(o)!==wm&&(_m?_m(o,wm):mm(o[Lm])||Sm(o,Lm,Dm)),vm(o,u,!0)),bm&&n==Im&&p&&p.name!==Im&&(Rm?Em(f,"name",Im):(h=!0,m=function(){return pm(p,this)})),n)if(l={values:d(Im),keys:s?m:d(Cm),entries:d(km)},a)for(c in l)(Am||h||!(c in f))&&Sm(f,c,l[c]);else fm({target:t,proto:!0,forced:Am||h},l);return f[Lm]!==m&&Sm(f,Lm,m,{name:n}),Tm[t]=m,l},Um=d,Bm="Array Iterator",Hm=Mm.set,jm=Mm.getterFor(Bm),Vm=Fm(Array,"Array",(function(e,t){Hm(this,{type:Bm,target:Pm(e),index:0,kind:t})}),(function(){var e=jm(this),t=e.target,r=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:i,done:!1}:"values"==r?{value:t[i],done:!1}:{value:[i,t[i]],done:!1}}),"values"),Gm=xm.Arguments=xm.Array;if(Om("keys"),Om("values"),Om("entries"),Um&&"values"!==Gm.name)try{Nm(Gm,"name",{value:"values"})}catch(IU){}var zm,Km,Wm,$m={exports:{}},Ym=Mh,qm=d,Zm=o,Xm=V,Jm=z,Qm=Fe,eg=Ln,tg=fe,rg=Kt,ig=qr,ng=At.f,sg=Y,ag=rf,og=on,lg=Qe,cg=Ve,dg=Pr.enforce,ug=Pr.get,hg=Zm.Int8Array,fg=hg&&hg.prototype,pg=Zm.Uint8ClampedArray,mg=pg&&pg.prototype,gg=hg&&ag(hg),yg=fg&&ag(fg),_g=Object.prototype,vg=Zm.TypeError,Eg=lg("toStringTag"),Sg=cg("TYPED_ARRAY_TAG"),Tg="TypedArrayConstructor",bg=Ym&&!!og&&"Opera"!==eg(Zm.opera),Rg=!1,wg={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ag={BigInt64Array:8,BigUint64Array:8},Lg=function(e){var t=ag(e);if(Jm(t)){var r=ug(t);return r&&Qm(r,Tg)?r[Tg]:Lg(t)}},Cg=function(e){if(!Jm(e))return!1;var t=eg(e);return Qm(wg,t)||Qm(Ag,t)};for(zm in wg)(Wm=(Km=Zm[zm])&&Km.prototype)?dg(Wm)[Tg]=Km:bg=!1;for(zm in Ag)(Wm=(Km=Zm[zm])&&Km.prototype)&&(dg(Wm)[Tg]=Km);if((!bg||!Xm(gg)||gg===Function.prototype)&&(gg=function(){throw vg("Incorrect invocation")},bg))for(zm in wg)Zm[zm]&&og(Zm[zm],gg);if((!bg||!yg||yg===_g)&&(yg=gg.prototype,bg))for(zm in wg)Zm[zm]&&og(Zm[zm].prototype,yg);if(bg&&ag(mg)!==yg&&og(mg,yg),qm&&!Qm(yg,Eg))for(zm in Rg=!0,ng(yg,Eg,{get:function(){return Jm(this)?this[Sg]:void 0}}),wg)Zm[zm]&&rg(Zm[zm],Sg,zm);var Ig={NATIVE_ARRAY_BUFFER_VIEWS:bg,TYPED_ARRAY_TAG:Rg&&Sg,aTypedArray:function(e){if(Cg(e))return e;throw vg("Target is not a typed array")},aTypedArrayConstructor:function(e){if(Xm(e)&&(!og||sg(gg,e)))return e;throw vg(tg(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r,i){if(qm){if(r)for(var n in wg){var s=Zm[n];if(s&&Qm(s.prototype,e))try{delete s.prototype[e]}catch(IU){try{s.prototype[e]=t}catch(a){}}}yg[e]&&!r||ig(yg,e,r?t:bg&&fg[e]||t,i)}},exportTypedArrayStaticMethod:function(e,t,r){var i,n;if(qm){if(og){if(r)for(i in wg)if((n=Zm[i])&&Qm(n,e))try{delete n[e]}catch(IU){}if(gg[e]&&!r)return;try{return ig(gg,e,r?t:bg&&gg[e]||t)}catch(IU){}}for(i in wg)!(n=Zm[i])||n[e]&&!r||ig(n,e,t)}},getTypedArrayConstructor:Lg,isView:function(e){if(!Jm(e))return!1;var t=eg(e);return"DataView"===t||Qm(wg,t)||Qm(Ag,t)},isTypedArray:Cg,TypedArray:gg,TypedArrayPrototype:yg},kg=o,Dg=c,Pg=ml,Og=Ig.NATIVE_ARRAY_BUFFER_VIEWS,xg=kg.ArrayBuffer,Mg=kg.Int8Array,Ng=!Og||!Dg((function(){Mg(1)}))||!Dg((function(){new Mg(-1)}))||!Pg((function(e){new Mg,new Mg(null),new Mg(1.5),new Mg(e)}),!0)||Dg((function(){return 1!==new Mg(new xg(2),1,void 0).length})),Fg=z,Ug=Math.floor,Bg=Number.isInteger||function(e){return!Fg(e)&&isFinite(e)&&Ug(e)===e},Hg=ei,jg=RangeError,Vg=function(e){var t=Hg(e);if(t<0)throw jg("The argument can't be less than 0");return t},Gg=RangeError,zg=function(e,t){var r=Vg(e);if(r%t)throw Gg("Wrong offset");return r},Kg=ls,Wg=p,$g=qn,Yg=xe,qg=ci,Zg=$o,Xg=Ho,Jg=Mo,Qg=Ig.aTypedArrayConstructor,ey=D,ty=Array.isArray||function(e){return"Array"==ey(e)},ry=Kn,iy=z,ny=Qe("species"),sy=Array,ay=function(e){var t;return ty(e)&&(t=e.constructor,(ry(t)&&(t===sy||ty(t.prototype))||iy(t)&&null===(t=t[ny]))&&(t=void 0)),void 0===t?sy:t},oy=ls,ly=N,cy=xe,dy=ci,uy=function(e,t){return new(ay(e))(0===t?0:t)},hy=L([].push),fy=function(e){var t=1==e,r=2==e,i=3==e,n=4==e,s=6==e,a=7==e,o=5==e||s;return function(l,c,d,u){for(var h,f,p=cy(l),m=ly(p),g=oy(c,d),y=dy(m),_=0,v=u||uy,E=t?v(l,y):r||a?v(l,0):void 0;y>_;_++)if((o||_ in m)&&(f=g(h=m[_],_,p),e))if(t)E[_]=f;else if(f)switch(e){case 3:return!0;case 5:return h;case 6:return _;case 2:hy(E,h)}else switch(e){case 4:return!1;case 7:hy(E,h)}return s?-1:i||n?n:E}},py={forEach:fy(0),map:fy(1),filter:fy(2),some:fy(3),every:fy(4),find:fy(5),findIndex:fy(6),filterReject:fy(7)},my=V,gy=z,yy=on,_y=function(e,t,r){var i,n;return yy&&my(i=t.constructor)&&i!==r&&gy(n=i.prototype)&&n!==r.prototype&&yy(e,n),e},vy=Ji,Ey=o,Sy=p,Ty=d,by=Ng,Ry=Ig,wy=_p,Ay=vn,Ly=S,Cy=Kt,Iy=Bg,ky=oi,Dy=Hh,Py=zg,Oy=dt,xy=Fe,My=Ln,Ny=z,Fy=ue,Uy=Cc,By=Y,Hy=on,jy=Zr.f,Vy=function(e){var t,r,i,n,s,a,o=$g(this),l=Yg(e),c=arguments.length,d=c>1?arguments[1]:void 0,u=void 0!==d,h=Xg(l);if(h&&!Jg(h))for(a=(s=Zg(l,h)).next,l=[];!(n=Wg(a,s)).done;)l.push(n.value);for(u&&c>2&&(d=Kg(d,arguments[2])),r=qg(l),i=new(Qg(o))(r),t=0;r>t;t++)i[t]=u?d(l[t],t):l[t];return i},Gy=py.forEach,zy=gn,Ky=At,Wy=l,$y=_y,Yy=Pr.get,qy=Pr.set,Zy=Pr.enforce,Xy=Ky.f,Jy=Wy.f,Qy=Math.round,e_=Ey.RangeError,t_=wy.ArrayBuffer,r_=t_.prototype,i_=wy.DataView,n_=Ry.NATIVE_ARRAY_BUFFER_VIEWS,s_=Ry.TYPED_ARRAY_TAG,a_=Ry.TypedArray,o_=Ry.TypedArrayPrototype,l_=Ry.aTypedArrayConstructor,c_=Ry.isTypedArray,d_="BYTES_PER_ELEMENT",u_="Wrong length",h_=function(e,t){l_(e);for(var r=0,i=t.length,n=new e(i);i>r;)n[r]=t[r++];return n},f_=function(e,t){Xy(e,t,{get:function(){return Yy(this)[t]}})},p_=function(e){var t;return By(r_,e)||"ArrayBuffer"==(t=My(e))||"SharedArrayBuffer"==t},m_=function(e,t){return c_(e)&&!Fy(t)&&t in e&&Iy(+t)&&t>=0},g_=function(e,t){return t=Oy(t),m_(e,t)?Ly(2,e[t]):Jy(e,t)},y_=function(e,t,r){return t=Oy(t),!(m_(e,t)&&Ny(r)&&xy(r,"value"))||xy(r,"get")||xy(r,"set")||r.configurable||xy(r,"writable")&&!r.writable||xy(r,"enumerable")&&!r.enumerable?Xy(e,t,r):(e[t]=r.value,e)};Ty?(n_||(Wy.f=g_,Ky.f=y_,f_(o_,"buffer"),f_(o_,"byteOffset"),f_(o_,"byteLength"),f_(o_,"length")),vy({target:"Object",stat:!0,forced:!n_},{getOwnPropertyDescriptor:g_,defineProperty:y_}),$m.exports=function(e,t,r){var i=e.match(/\d+$/)[0]/8,n=e+(r?"Clamped":"")+"Array",s="get"+e,a="set"+e,o=Ey[n],l=o,c=l&&l.prototype,d={},u=function(e,t){Xy(e,t,{get:function(){return function(e,t){var r=Yy(e);return r.view[s](t*i+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,n){var s=Yy(e);r&&(n=(n=Qy(n))<0?0:n>255?255:255&n),s.view[a](t*i+s.byteOffset,n,!0)}(this,t,e)},enumerable:!0})};n_?by&&(l=t((function(e,t,r,n){return Ay(e,c),$y(Ny(t)?p_(t)?void 0!==n?new o(t,Py(r,i),n):void 0!==r?new o(t,Py(r,i)):new o(t):c_(t)?h_(l,t):Sy(Vy,l,t):new o(Dy(t)),e,l)})),Hy&&Hy(l,a_),Gy(jy(o),(function(e){e in l||Cy(l,e,o[e])})),l.prototype=c):(l=t((function(e,t,r,n){Ay(e,c);var s,a,o,d=0,h=0;if(Ny(t)){if(!p_(t))return c_(t)?h_(l,t):Sy(Vy,l,t);s=t,h=Py(r,i);var f=t.byteLength;if(void 0===n){if(f%i)throw e_(u_);if((a=f-h)<0)throw e_(u_)}else if((a=ky(n)*i)+h>f)throw e_(u_);o=a/i}else o=Dy(t),s=new t_(a=o*i);for(qy(e,{buffer:s,byteOffset:h,byteLength:a,length:o,view:new i_(s)});d<o;)u(e,d++)})),Hy&&Hy(l,a_),c=l.prototype=Uy(o_)),c.constructor!==l&&Cy(c,"constructor",l),Zy(c).TypedArrayConstructor=l,s_&&Cy(c,s_,n);var h=l!=o;d[n]=l,vy({global:!0,constructor:!0,forced:h,sham:!n_},d),d_ in l||Cy(l,d_,i),d_ in c||Cy(c,d_,i),zy(n)}):$m.exports=function(){},(0,$m.exports)("Uint8",(function(e){return function(t,r,i){return e(this,t,r,i)}}));var __=ot,v_=TypeError,E_=of,S_=function(e){var t=__(e,"number");if("number"==typeof t)throw v_("Can't convert number to bigint");return BigInt(t)},T_=Ln,b_=p,R_=c,w_=Ig.aTypedArray,A_=Ig.exportTypedArrayMethod,L_=L("".slice);A_("fill",(function(e){var t=arguments.length;w_(this);var r="Big"===L_(T_(this),0,3)?S_(e):+e;return b_(E_,this,r,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),R_((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})));var C_=o,I_=p,k_=Ig,D_=ci,P_=zg,O_=xe,x_=c,M_=C_.RangeError,N_=C_.Int8Array,F_=N_&&N_.prototype,U_=F_&&F_.set,B_=k_.aTypedArray,H_=k_.exportTypedArrayMethod,j_=!x_((function(){var e=new Uint8ClampedArray(2);return I_(U_,e,{length:1,0:3},1),3!==e[1]})),V_=j_&&k_.NATIVE_ARRAY_BUFFER_VIEWS&&x_((function(){var e=new N_(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));H_("set",(function(e){B_(this);var t=P_(arguments.length>1?arguments[1]:void 0,1),r=O_(e);if(j_)return I_(U_,this,r,t);var i=this.length,n=D_(r),s=0;if(n+t>i)throw M_("Wrong length");for(;s<n;)this[t+s]=r[s++]}),!j_||V_);var G_=gf,z_=Math.floor,K_=function(e,t){var r=e.length,i=z_(r/2);return r<8?W_(e,t):$_(e,K_(G_(e,0,i),t),K_(G_(e,i),t),t)},W_=function(e,t){for(var r,i,n=e.length,s=1;s<n;){for(i=s,r=e[s];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==s++&&(e[i]=r)}return e},$_=function(e,t,r,i){for(var n=t.length,s=r.length,a=0,o=0;a<n||o<s;)e[a+o]=a<n&&o<s?i(t[a],r[o])<=0?t[a++]:r[o++]:a<n?t[a++]:r[o++];return e},Y_=K_,q_=q.match(/firefox\/(\d+)/i),Z_=!!q_&&+q_[1],X_=/MSIE|Trident/.test(q),J_=q.match(/AppleWebKit\/(\d+)\./),Q_=!!J_&&+J_[1],ev=L,tv=c,rv=ye,iv=Y_,nv=Z_,sv=X_,av=re,ov=Q_,lv=Ig.aTypedArray,cv=Ig.exportTypedArrayMethod,dv=o.Uint16Array,uv=dv&&ev(dv.prototype.sort),hv=!(!uv||tv((function(){uv(new dv(2),null)}))&&tv((function(){uv(new dv(2),{})}))),fv=!!uv&&!tv((function(){if(av)return av<74;if(nv)return nv<67;if(sv)return!0;if(ov)return ov<602;var e,t,r=new dv(516),i=Array(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,i[e]=e-2*t+3;for(uv(r,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==i[e])return!0}));cv("sort",(function(e){return void 0!==e&&rv(e),fv?uv(this,e):iv(lv(this),function(e){return function(t,r){return void 0!==e?+e(t,r)||0:r!=r?-1:t!=t?1:0===t&&0===r?1/t>0&&1/r<0?1:-1:t>r}}(e))}),!fv||hv);var pv=Ji,mv=ga,gv=c,yv=$,_v=V,vv=Qn,Ev=jl,Sv=qr,Tv=mv&&mv.prototype;if(pv({target:"Promise",proto:!0,real:!0,forced:!!mv&&gv((function(){Tv.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=vv(this,yv("Promise")),r=_v(e);return this.then(r?function(r){return Ev(t,e()).then((function(){return r}))}:e,r?function(r){return Ev(t,e()).then((function(){throw r}))}:e)}}),_v(mv)){var bv=yv("Promise").prototype.finally;Tv.finally!==bv&&Sv(Tv,"finally",bv,{unsafe:!0})}var Rv=pt("span").classList,wv=Rv&&Rv.constructor&&Rv.constructor.prototype,Av=wv===Object.prototype?void 0:wv,Lv=o,Cv={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Iv=Av,kv=Vm,Dv=Kt,Pv=Qe,Ov=Pv("iterator"),xv=Pv("toStringTag"),Mv=kv.values,Nv=function(e,t){if(e){if(e[Ov]!==Mv)try{Dv(e,Ov,Mv)}catch(IU){e[Ov]=Mv}if(e[xv]||Dv(e,xv,t),Cv[t])for(var r in kv)if(e[r]!==kv[r])try{Dv(e,r,kv[r])}catch(IU){e[r]=kv[r]}}};for(var Fv in Cv)Nv(Lv[Fv]&&Lv[Fv].prototype,Fv);function Uv(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function Bv(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Uv(Object(r),!0).forEach((function(t){$l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Uv(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}Nv(Iv,"DOMTokenList");const Hv="httpRequest";const jv=new class{constructor(){this.defaultRequestOption={method:"GET",mode:"cors",cache:"default",referrerPolicy:"strict-origin-when-cross-origin"}}async fetch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Dh.REQUEST_DEFAULT_TIMEOUT,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5?arguments[5]:void 0,a=null,o=null;n=n||1;let l=0;for(;l<n;)for(let c=0;c<e.length;c++){let d=null;const u={};a=Zv.generateRandomId(16,10),Qv.debug(Hv,"[HTTP_ID:".concat(a,"] fetch request start: ").concat(Qv.shieldUrlParameters(e[c])));try{this.extendInfosHandle(e[c],"start",u,s),d=await this.doFetch(e[c],t,r,i,a),this.extendInfosHandle(e[c],"end",u,s,d),Qv.debug(Hv,"[HTTP_ID:".concat(a,"] fetch request success"))}catch(IU){Qv.error(Hv,"[HTTP_ID:".concat(a,"], requestUrl: ").concat(Qv.shieldUrlParameters(e[c]),", fetch request failed")),this.extendInfosHandle(e[c],"end",u,s,IU),c>=e.length-1&&(l++,l<n&&await Zv.sleep(500*Zv.getRandom()+500)),o=IU}if(d)return o=null,d}if(o)throw o}doFetch(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,a=null,o=null;AbortController&&(a=new AbortController,o=a.signal);const l=new Promise(((e,r)=>{t=setTimeout((()=>{clearTimeout(t),r(new xh(Ph.HWLLS_ERROR_SERVER_NO_RESPONSE)),a&&a.abort()}),n)})),c=new Promise(((n,a)=>{let l=null;l=o?fetch(e,Bv(Bv(Bv(Bv({},this.defaultRequestOption),r),{headers:i}),{signal:o})):fetch(e,Bv(Bv(Bv({},this.defaultRequestOption),r),{headers:i})),l.then((t=>{if(/webrtc\/v1\/pullstream/gi.test(e)&&Zv.syncLocalTime(t.headers.get("Date")),!t.ok)return Qv.error(Hv,"[HTTP_ID:".concat(s,"] doFetch failed: ").concat(t.status)),void(t.status>=500||0===t.status?a(new xh(Ph.HWLLS_ERROR_SERVER_CONNECT_FAIL,"".concat(t.status," _ ").concat(t.statusText||"fetch failed","."))):n({httpCode:t.status}));let r;const o=t.headers.get("Content-Type")||i["Content-Type"];r=/.*application\/json.*/.test(o)?t.json():/^text.*/.test(o)?t.text():t.arrayBuffer(),r.then((e=>{n({httpCode:t.status,data:e})})).catch((t=>{Qv.error(Hv,"[HTTP_ID:".concat(s,"], requestUrl: ").concat(Qv.shieldUrlParameters(e),", doFetch get response failed: ").concat(t)),a(new xh(Ph.HWLLS_INTERNAL_ERROR,t.message||"get respone error."))}))})).catch((t=>{Qv.error(Hv,"[HTTP_ID:".concat(s,"], requestUrl: ").concat(Qv.shieldUrlParameters(e),", doFetch failed for exception: ").concat(t)),a(new xh(Ph.HWLLS_ERROR_SERVER_CONNECT_FAIL,t.getMsg?t.getMsg():t.message))})).finally((()=>{clearTimeout(t)}))}));return Promise.race([l,c])}extendInfosHandle(e,t,r,i,n){i&&("start"===t?Object.assign(r,{id:i.length+1,domain:e,start_ms:Zv.getCurrentLocalTimestamp(),end_ms:0,rspCode:"",errMsg:""}):"end"===t?(n instanceof xh?(r.end_ms=Zv.getCurrentLocalTimestamp(),r.rspCode=n.getCode(),r.errMsg=n.getMsg()):(r.end_ms=Zv.getCurrentLocalTimestamp(),r.rspCode=n.httpCode),r.delay_ms=r.end_ms-r.start_ms,i.push(r)):Qv.info(Hv,"cannot handle"))}},Vv=1e4,Gv="HWLLSReport";const zv=new class{constructor(){this.records=[],this.initEmergencyReport(),this.regularReport(Dh.OPS_REPORT_INTERVAL)}async addRecord(e){this.records.push(e),this.records.length>Vv&&this.records.splice(0,this.records.length-Vv)}immediateReportRecords(){0!==this.records.length&&Zv.getAreaDetectionCompleted()&&this.reportRecords(this.records)}initEmergencyReport(){window.onbeforeunload=()=>{Qv.info(Gv,"app is closing, emergency report"),0!==this.records.length&&Zv.getAreaDetectionCompleted()&&this.reportRecordsEmergency(this.records)}}async sendRequest(e,t){try{var r;const t=this.getReportUrl(),i=await jv.fetch([t],{method:"POST",body:JSON.stringify({request_id:Zv.generateStandardUuid(),timestamp:Math.round(Zv.getCurrentSyncTimestamp()/1e3),logs:e})},{"Content-Type":"application/json;charset=UTF-8",Authorization:Dh.OPS_AUTH_TOKEN});if(i.httpCode&&0!=(null===(r=i.data)||void 0===r?void 0:r.Code))throw Qv.error(Gv,"sendRequest and get fail Respone: ".concat(JSON.stringify(i))),new xh(Ph.HWLLS_INTERNAL_ERROR)}catch(IU){Qv.error(Gv,"sendRequest failed"),t.push(...e)}}async reportRecords(e){const t=[],r=[];do{r.push(this.sendRequest(e.splice(0,50),t))}while(e.length>0);Promise.all(r).finally((()=>{this.records.push(...t),t.length=0,this.records.length>Vv&&this.records.splice(0,this.records.length-Vv)}))}async reportRecordsEmergency(e){if(!navigator.sendBeacon)return void this.reportRecords(e);const t=this.getReportUrl();navigator.sendBeacon(t,new Blob([JSON.stringify({request_id:Zv.generateStandardUuid(),timestamp:Math.round(Zv.getCurrentSyncTimestamp()/1e3),logs:e})],{type:"application/json;charset=UTF-8"}))}regularReport(e){this.reportInterval&&clearInterval(this.reportInterval),this.reportInterval=setInterval((()=>{0!==this.records.length&&Zv.getAreaDetectionCompleted()&&this.reportRecords(this.records)}),e)}getReportUrl(){return"https://".concat(Dh.OPS_REPORT_DOMAIN,"/v2/log/log_report?service=LLL")}},Kv=window.crypto||window.webkitCrypto||window.mozCrypto||window.oCrypto||window.msCrypto,Wv={Mac:/(mac os x)\s+([\w_]+)/,Windows:/(windows nt)\s+([\w.]+)/,Ios:/(i(?:pad|phone|pod)).*cpu(?: i(?:pad|phone|pod))? os (\d+(?:[.|_]\d+)+)/,Android:/(android)\s+([\d.]+)/,Ipad:/(ipad).*os\s([\d_]+)/,Iphone:/(iphone\sos)\s([\d_]+)/,Linux:/(x11;)\s(linux)\s(x86_64|mips64|aarch64)/,ChromiumOS:/(x11;)\s(cros)\s(x86_64|mips64|aarch64)\s([\w.]+)\)/},$v=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","_"],Yv="CommonUtil",qv="https://".concat(Dh.GSLB_DOMAIN,"/v1/live/dns?dns=").concat(Dh.SHARE_PULL_DOMAIN[0],"&withdomain=1&dualstack=1");const Zv=new class{constructor(){this.uuidCount=0,this.timeDiff=0,this.platform=(()=>{const e=navigator.userAgent.toLowerCase(),t=e.match(/(micromessenger)\/([\w.()]+)/i),r=t?" -WeChat".concat(t[2]):"";let i;for(const n in Wv)if(Object.prototype.hasOwnProperty.call(Wv,n)){const t=e.match(Wv[n]);if(t)return i="Ios"===n?t[2].replace(/_/g,"."):"Linux"===n?t[3]:"ChromiumOS"===n?t[4]:t[2],"".concat(n," ").concat(i).concat(r)}return"unknown"})(),this.browserVersion=(()=>{const e=navigator.userAgent.match(/(chrome|CriOS|safari|firefox|microMessenger)\/(\d+(\.\d+)*)/i);if(e&&e.length>2){let t=e[2];if(/safari/gi.test(e[1])){const e=/.*Version\/([\d\.]+)\s.*/gi.exec(navigator.userAgent);e&&2===e.length&&(t=e[1])}return"".concat("CriOS"===e[1]?"Chrome":e[1],"-").concat(t)}return e&&e.length>1?e[1]:""})(),this.areaDetectionCompleted=!1,this.responeInfo={gslbRequestUrl:"",respone:null}}async sleep(e){return new Promise((t=>{const r=setTimeout((()=>{clearTimeout(r),t()}),e)}))}getDeviceID(){return this.deviceID||(this.deviceID=this.generateStandardUuid()),this.deviceID}generateStandardUuid(){let e;if(Kv&&(e="function"==typeof Kv.randomUUID?Kv.randomUUID():""),!e){let t=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(t+=performance.now()),e="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/[x]/g,(()=>{const e=(t+16*this.getRandom())%16|0;return t=Math.floor(t/16),e.toString(16)}))}return e}getRandom(){return this.getRandomArray(1)[0]/256}generateUuid(e){let t="";const r=this.getRandomArray(33),i=e?22:33;for(let a=0;a<i;a++)t+=$v[Math.round(r[a]%64)];let n="";for(let a=0;a<33-i;a++)n+=$v[63&e],e>>=6;let s=this.uuidCount.toString(16);for(let a=3-s.length;a>0;a--)s="0"+s;return this.uuidCount>4094?this.uuidCount=0:this.uuidCount++,"".concat(t).concat(n).concat(s)}generateRandomId(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:62,r="";const i=this.getRandomArray(e);for(let n=0;n<e;n++)r+=$v[Math.round(i[n]%t)];return r}getPlatform(){return this.platform}getBrowserVersion(){return this.browserVersion}syncLocalTime(e){try{if(e){console.debug(Yv,"syncLocalTime, serverTime: ".concat(e));const t=new Date(e).getTime();this.timeDiff=(new Date).getTime()-t,console.debug(Yv,"syncLocalTime, timeDiff: ".concat(this.timeDiff))}}catch(IU){console.error(Yv,"syncLocalTime error: ".concat(IU))}}getTimeDiff(){return this.timeDiff}getCurrentLocalTimestamp(){return(new Date).getTime()}getCurrentSyncTimestamp(){return Math.abs(this.timeDiff)>=36e5?(new Date).getTime()-this.timeDiff:(new Date).getTime()}getCurrentTimeInfo(){const e=new Date(this.getCurrentLocalTimestamp()),t=e.getFullYear(),r=e.getMonth()+1,i=r<10?"0".concat(r):r,n=e.getDate(),s=n<10?"0".concat(n):n,a=e.getHours(),o=a<10?"0".concat(a):a,l=e.getMinutes(),c=l<10?"0".concat(l):l,d=e.getSeconds(),u=d<10?"0".concat(d):d,h=e.getMilliseconds(),f="".concat(h+1e3).substring(1),p=e.getTimezoneOffset()/60,m=p>=0?p:-p,g=(p<=0?"+":"-")+(m<10?"0".concat(m):"".concat(m))+":00";return{year:"".concat(t),month:"".concat(i),day:"".concat(s),hour:"".concat(o),min:"".concat(c),sec:"".concat(u),millsec:f,zoneOff:g}}adjustTimeByServerTime(e){return e-this.timeDiff}convertString2Timestamp(e){return new Date(e).getTime()}generateStreamId(){return"2xxxxxxx-8xxx-xxxx-yxxx-xxxx".replace(/[xy]/g,(e=>{const t=16*this.getRandom()|0;return("x"==e?t:3&t|8).toString(16)}))}isWKWebview(){return/I.*-WeChat.*/gi.test(this.platform)}isAppleDevice(){return/^(Mac|I).*/gi.test(this.platform)}isMobileDevice(){return!/^(Mac|Windows).*/gi.test(this.platform)}isTencentX5BrowserKernel(){return/.*(tbs|xweb).*/gi.test(navigator.userAgent)}isMobileWeChatBrowser(){return this.isMobileDevice()&&/.*MicroMessenger.*/gi.test(navigator.userAgent)}dnsRequestEncode(e){const t=new DataView(new ArrayBuffer(12)),r=32767&(e.flags||0);t.setUint16(0,e.id||0),t.setUint16(2,0|r),t.setUint16(4,e.questions.length),t.setUint16(6,0),t.setUint16(8,0),t.setUint16(10,0);const i=e.questions[0].name.split("."),n=new Uint8Array(i.length+e.questions[0].name.replace(/\./gi,"").length+1),s=new TextEncoder;let a=0;for(let c=0;c<i.length;c++)n[c+a]=i[c].length,n.set(s.encode(i[c]),c+1+a),a+=i[c].length;n[n.byteLength-1]=0;const o=new DataView(new ArrayBuffer(4));o.setUint16(0,1),o.setUint16(2,1);const l=new Uint8Array(n.byteLength+t.byteLength+o.byteLength);return l.set(new Uint8Array(t.buffer),0),l.set(n,t.byteLength),l.set(new Uint8Array(o.buffer),t.byteLength+n.byteLength),window.btoa((new TextDecoder).decode(l)).replace(/=/gi,"")}getAppUrl(){const{origin:e,pathname:t}=window.location;return"".concat(e).concat(t)}getValue(e,t){return e||t}setValue(e,t){return!e||e<0?t:e}createLoadingMask(){const e=document.createElement("div");return e.setAttribute("id","loadingMask"),e.style.display="block",e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style["z-index"]=99,e.style.background="rgba(0,0,0,0.8) url(data:image/jpeg;base64,R0lGODlhgACAAOMAAP///93d3bu7u5mZmf///wAAAAAAAAAAAP///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQFBQAEACwAAAAAgACAAAAE/pDISau9OOvNu/9gKI5kaZ6oCKxA6r5wyLJxbdvzfO98mdO9oHDzWw2PyEmxlWwGl87oDiqtEgLYwIlaGngHVlE2a+KOvt/wZzz2FbvotJrDJpPMobh8rqnbVW9nel58G35/IHgeg3uFGIdagD+Cg450h5I5IoxgloaYMoEgnJ6XfqGTo4ylpqcfihqcnax9oB6wGaS0n7YcuBeyu61sr6IcusK8dbfGsavJw20dvxXI0LWuRM0Y1tcZkJEa1BLB3tGIGOME3eaPkNqpueztF+/wQM6VfAL8Ain24vDJ03cCzYl+/VAATDEvT5wSCCOe6IXiGRyCISJqLEGxIEaH/g05aBxJYlkMPSRkNQIxkuQIaTUMUlIJseVGetxUrhRh0yVOcjp3kuh5s11QoSaISjR3lJANpQihNZ21A2pCVlOPWOVXKmuSrZaaVoEaVuccomVDRumZ9uO+oo7cWoqKFenPu3jz6t3Lt6/fv4ADCx5MuDDhqeWMIrZIYXHia467RX4sbLI1y4wrY0Y5YTNnqZ5lAg3tFDRpqutIKw4NzDNO1oZjy55Nu7bt27hz697Nu/cO0Z6Ad/0cl3ghymqQW6FZXC2SoG2d9xDb3GwSr9GZC8EenDoP7rTAvxCv+ehJ70zRmyCf3vx693vVq7K+ya7H0iC155eeUzjDhzPx2NeagAMC6EJm8yG4iIIJ+veecfXJtaCD+1GYEoMNohahhgFa2Jl9o0E403EYfuhhiAb2pVxjEprY4k/SlYjiiau9OCN+/dnYnogWyHgjjncJ6OOPHNIjpI5E6kXgkEkGuSSSRBZpGo850sgilN0x+WOGVmZJZZUg9qgliVi62OWVXw5X5pYVhlldih+MaeaZYay4gZxRTglnnGvO6WZyffop5TGBOoGnoBftWRedYqZ5p6Lh/TkQpHwCKduhvrGZ6YaMbqqpp5VSCiqYlo6aj6SmupjqqqZGAAAh+QQFBQAEACwAAAAAgACAAAAE/pDISau9OOvNu/9gKI5kaZ6oGKxB6r5wyLJxbdvzfO98mdO9oHDzWw2PyEmxlWwGl87oDiqtEgRYwYlaAngBVlE2a+KOvt/wZzz2FbvotJrDJpPMobh8rqnbVW9nel58G35/IHgeg3uFGIdagD+Cg450h5I5IoxgloaYMoEgnJ6XfqGTo4ylpqcfihqcnax9oB6wGaS0n7YcuBeyu61sr6IcusK8dbfGsavJw20dvxXI0LWuRM0Y1tcZkJEa1BLB3tGIGOME3eaPkNqpueztF+/wQM6VfAP8Ayn24vDJ03einz8TBvmhAJhiXoiEB0dA7HeiF4pnJSYqlKhx4wiL/icwiujo8SHJkiCWxdBD4iTKDy5fepBWA03LmBljRqRnQedOjjp5UvD5M2dQekRjJDW3tEbTXU9vRHU0dUdVNVd5+LS0VQpOqi7nnORKEqxGsmc9TSy1FipFVgaFyp1Lt67du3jz6t3Lt6/fv4AD9yTakSfhwoMPp/WmGPGExmWvQXZMYPLiZJbbSsgMkTHnuI8/v4UmevRm0e1KX/hsmLPg17Bjy55Nu7bt27hz6959U+Y+02w7qxWOVvPvy1gjFxqbnPnysF6PPv+KJKsV60q7BpduVbtb7jCwDwePQvx26gW9tyZvEj1d9SDYdwDtFDhM9/edt7dfPmFv5fsZ4hcgf0b595+A+RF3IIEL+paggUAx+CB9KVC2YHoOxofcahKehmCE0ymIgYgcfviehYlBOCKKJ5o4lIuhwYgUixVsmCKJctFYo4we4riejzd2GCOQTNlYoooa6OgZj0NSuIGSmEH5IpE7GkmalUc6+SSW3zHZpJBTelkckhxwGSSYY2pZpphfohkimWtSmaWatEg5Z4YZ2CmWnlXCGSebVfDZJ51/+pkmnkkCGiahZhlaqJtnFgWXo48imiij40mqoZxbWsqXmbytyGmokZI6kqKkgmrqopCuWhmlrh4Z66yuRgAAIfkEBQUABAAsAAAAAIAAgAAABP6QyEmrvTjrzbv/YCiOZGmeqCisQuq+cMiycW3b83zvfJnTvaBw81sNj8hJsZVsBpfO6A4qrRIG2MGJWgp4A1ZRNmvijr7f8Gc89hW76LSawyaTzKG4fK6p21VvZ3pefBt+fyB4HoN7hRiHWoA/goOOdIeSOSKMYJaGmDKBIJyel36hk6OMpaanH4oanJ2sfaAesBmktJ+2HLgXsrutbK+iHLrCvHW3xrGrycNtHb8VyNC1rkTNGNbXGZCRGtQSwd7RiBjjBN3mj5Daqbns7Rfv8EDOlXzSJ/bi+PL0nQBAEEA/YgezpZgXomDBEv5I9ELxrITDixLBQVRIUaCIi/4gM4ILF2JZDD0kQKoUOZLlDTQpVYZk2ZIeBpkrTYxEaFMCzpwodvIz93PmC6HokhXFaAMpFmhLHQZxStJS1IdDqJa6SrCJU6tXqwgFW3ROzUJlC2l09LMURz5AWQ0la7Cn3bt48+rdy7ev37+AAwseTLhwBapr2yGOOGFx4muOGUd+LGxyRMsTd2FWuNkktM48r4BOSms0OtOKR9frbBO04dewY8ueTbu27du4c+ve7VIuaUdvzXoGzlgN5TBn9x2PMpZ4cq9ILX1NotVTdSHXrU/nkb309hjdk4VP2Dx19BTjzaVfc17v95Ll4T9t+vtc8A7xQQx3sZ/9c/+ZAdU4F3kDCtifB8XJF1pQ9xlYXzQMNjhCggrOt5GFOgV42IMSUKigWhpScOCGEva0nIglnmiXh42VKJqL6rHYoYsq0iPjjCOSmKN5O6LYY4swiheijgWuFqRmQxLJoY8/Ipkkk0UaeaR2Uz4JZZSV3XglhvZxCZmVW1bVpY1ghilGmcpNieOC+KFpnJtrYvkNnFLUOGeTFtiZJp55qgkkn1bQGeeSd7Lplp9/yomNoYcquqijhXrppJgVErpobYLylulum+rWaW6f4haqqIzyBqCpqKbKQQQAIfkEBQUABAAsAAAAAIAAgAAABP6QyEmrvTjrzbv/YCiOZGmeqDisQ+q+cMiycW3b83zvfJnTvaBw81sNj8hJsZVsBpfO6A4qrRJ0JmpJwBVYVbls0dTtfj9a8G9bNp85admY1Ha/NUumOjyq2+8YeXogcR5+f4AXeSOFHYdeiUSNkmshj5Fwk3hzIJeYlJVonIaHn5maiqMcj5Cmm6qgWKR+rqewGagVrLW2fB25FJ68sbLERo6lw73Fr74bwsrNzri3FtDR1MDAu9jLQNLfGdfdgYvgx+Lj5KnVFKHptHfMJObNq8knAfoBJ+/0wJ3wldi3zwfAc4NQCBxBsOG/envmkYnHsKFDRoLQyZF4og4Ji/4gH2YUeaPMR5AWDWbUuK4CypBiVrJc9xImCpnhsNVMCQPnTF47L9bwmdBUUIJPfLo6WnAI0U9M9TVRmihqFZmRjr4ZWbVmIkFZX35qZ8WmKY5vkLZcy7at27dw48qdS7eu3bt48+qNSZSsKwCAAwseTHgwu74HARVezFhwBcQrsTWezNgdZLDRKGs2rOQyRF6bQwOw7NlvItGbH5eeNgz15MOlW7pevLe27du4c+vezbu379/Ag/NAe4b4Vn/ykB9PfARz8s/FnVvB+jWyFKqAsDfXnp37cO/dcSYVP+wpDvC1zL9Q3409X+ts3UeU7hb9L+p7bhjPxnW+6XL7zdAnEnQe9OdfUe/lRAh9ovyHUE8O8sdagwoeiKBKym1U4YI/WWiLNx1qGF6GpG1Y4oT1EXiiiRIwmKJp2jBXnoorhtiZjOkBpCOOZx3kI4+Y0KgaiUMSGY2QRQbYIpDPRZiYi0cyJyWTX0AJIIpXGtljhEtqmaSS1XHZJZYSgtkkmVmymKaakSC55oXG2BimmGOaeSOdUbj55oB2XodnnWyWKeeZge7J56CEJohome0VKiicBTpKF5XBUQqcpb9h6pumvXHaKZrC3bdoqKSWSkAEACH5BAUFAAQALAAAAACAAIAAAAT+kMhJq7046827/2AojmRpnqg4rEPqvnDIsnFt2/N873yZ072gcPNbDY/ISbGVbAaXzugOKq0SdCaqD2gF/bJFMLbb0arCJDM5o/aiR+21Zck8f+FxOYVed99ldHpEeYN/foaCGIGAiGWEiUqPim8fi5Aalh6Sc5uXfIdjjp2eoxKlV6eJn5qUha2XmKWyqaSvk423uLCxthejmbuiuhWdwMEcq7w5yMbHrsvPXGy0x8m5ob7NztHS133e3VbYaZvjnL0hAuoCJ8OV1NPoH+vrW/LC5vbQJfT95Nr4wonZJ6KfwX/WQH1L4U6DwYcIE74zgkNgh4cQI0rchgFjRn3+fChyvODxY7uQ+Y6VPAgDZUpYK/1VdLnwUkx6T2jWlHOz3hCdO7v0VNdEZ6KhVVwejbkm5FKPgjZaKVnrZRWTVXfhHMm1q9evYMOKHUu2rNmzaNOqXcs2HtB7sALInUu3rt262d4CjHu3r9+5xPQ65fi3sN89gqVeMswYb6TE8KI0nhwAMWS4eig3DnzZKiTNhfN2/gq6b9vTqFOrXs26tevXsGPLnn3WcxUAuAFUayglt++qvJv4Hq5bz2A9xIc3RZkoOfGkNJs7f54E6KXpyY9Yh4WdOo/tx7orn6mUq/jfLY16PZ/bBXiw7HGfLF82Psi9ym7YvsBeI2bRIr3GEBx/4vm3H4AWGVhCdwYGxcqADxI0wnT3oYAfIxBm4B1CDJWT4GMZatieHBfydqFXiplyT4pflQjXiSOxiIqJMG5zYjGRqfLLfzUGA+OO//k4C4Q9QiIjiAceCUuPpxRpHJNBzhjlk1Om4iQZTtJypThaTimlhLt5+eWHboG55JXUKNnFlvBsWZSYKoZomZlGwjlmgBgeuCadEep5Dpk64mkHnxHGliNtcRKKaECCLqpQo472CWik4DhIqTKQXiqMppx2akEEACH5BAUFAAQALAAAAACAAIAAAAT+kMhJq7046827/2AojmRpnqg4rEPqvnDIsnFt2/N873yZ072gcPNbDY/ISbGVbAaXzugOKq0SdCaqD2gF/bJFMLbb0arCJDM5o/aiR+21Zck8f+FxOYVed99ldHpEeYN/foaCGIGAiGWEiUqPim8fi5Aalh6Sc5uXfIdjjp2eoxKlV6eJn5qUha2XmKWyqaSvk423uLCxthejmbuiuhWdwMEcq7w5yMbHrsvPXGy0x8m5ob7NztHS133e3VbYaZvjnL2M33bh69Au2qDqldR76HjDrPbK+vvsW/jczAmDF60GwGl85A0kqOyGQGYJFS5kuC1SRIn5LlZEqDHFRX/+1T5ivNdxo8iR/0oGO/lE5C6WQ2CqcpmEph6bTlSu0Skl4UyKNYEGpdfSnSB+XR6SUbqxqdOnUKNKnUq1qtWrWLNq3cq160lrGwWIHUu2rNmy2b4K1XO2rVuyxNT6rPi2rtt6cteSscsXrcW8SOX0HSwAL+CDbAnzjXuYKSTFddM2hgq5bdfLmDNr3sy5s+fPoEOLHv3ZcZUAqAOENKontetagZG4nq36JlgytGfvjJgoN+0qONf4zt1EpqDhxGMGP45cdw/ju5o7N7j8mPTXMKBXvJ76XfWm3FGf+A41fMrbGW8AWA+ABHdyc9uhFMGevXvp8IkSvVC/fonm+bHKJp8RL/RnnwnDnTdfQAt6YOCBCE6Xn0flgDTBg+ulgN1u/ByEYXtaoWcYUx+CiBVFm3yYlYgjWihBiScWg5SKVgk1Co1U2RgYjlKtVQqPT7F4joAZwBiVXqcAaRKSsRFgpFN6oYIYBUo6E6WURG5Q5Uq00LIlLFdiaZoFX/7U5F9jVvAkl2ei6WKRGG6jX5sXPignnabg6aSdd6YpmZ9k9tcUoEMSqiaEpelJWosELipGlo7OM2Wk4DRIaaFvXspRo5qS1OmnoGYQAQAh+QQFBQAEACwAAAAAgACAAAAE/pDISau9OOvNu/9gKI5kaZ6oOKxD6r5wyLJxbdvzfO98mdO9oHDzWw2PyEmxlWwGl87oDiqtEnQmqg9oBf2yRTC229GqwiQzOaP2okfttWXJPH/hcTmFXnffZXR6RHmDf36GghiBgIhlhIlKj4pvH4uQGpYeknObl3yHY46dnqMSpVeniZ+alIWtl5ilsqmkr5ONt7iwsbYXo5m7oroVncDBHKu8OcjGx67Lz1xstMfJuaG+zc7R0td93t1W2Gmb45y9jN924evQLtqg6pXUe+h4w6z2yvr77Fv43MwJgxetBsBpfOQNJKjshkBmCRUuZLgtUkSJ+S5WRKgxxUV//tU+YrzXcaPIkf9KBjv5ROQulkNgqnKZhKYem05UrtEpJeFMijWBBqXX0p0gfl0eklG6sanTp1CjSp1KtarVq1izat3KtetJaya/xhEL1hlZYGfLvkxrhi3RnG4NxT14c24ou0yP4jVSz67TvdniQvXbtbDhw4gTK17MuLHjx5AjM85bRYBlASGN6rnMuRbSJJxDY64rFIno0DsjJjotugrONaxPN5EpKLbsmK9r20bdg/au3bwN5j4GvDMM3xWLX343vKlyyyeaQ32eUq2wGwGyByChnJxPknxhaNfOHbh3om8tjB9fYvd5ze1AjlhP3kTs6igh0v1Av7794Od5xrQJAAQCwEF/2aVgXGr8FFjggQhuZd0EDjq4AYIJZkVRhQ9eGCFWE1LIoYEefmgVUCOSWCJ9VwmVogcYnjjKix3ESFVpNNZo4mA4jsifjTx+JkGOOvYXVYgWEAnhjmEJOaSPIADZ5H4UKFkki02VJiKHIkhpFjVWXrleRUhiEOaSRn7pZJVQdskkLESdKaZ/K63JJpckvAknfCDIOWeW8nXg55WQDSqZB4YeykGiimrAaKNmtgmpCI9OmmSFlppgYaacdopBBAAh+QQFBQAEACwAAAAAgACAAAAE/pDISau9OOvNu/9gKI5kaZ6oOKxD6r5wyLJxbdvzfO98mdO9oHDzWw2PyEmxlWwGl87oDiqtEnQmqg9oBf2yRTC229GqwiQzOaP2okfttWXJPH/hcTmFXnffZXR6RHmDf36GghiBgIhlhIlKj4pvH4uQGpYeknObl3yHY46dnqMSpVeniZ+alIWtl5ilsqmkr5ONt7iwsbYXo5m7oroVncDBHKu8OcjGx67Lz1xstMfJuaG+zc7R0td93t1W2Gmb45y9jN924evQLtqg6pXUe+h4w6z2yvr77Fv43MwJgxetBsBpfOQNJKjshkBmCRUuZLgtUkSJ+S5WRKgxxUV//tU+YrzXcaPIkf9KBjv5ROQulkNgqnKZhKYem05UrtEpJeFMijWBBqXX0p0gfl0eklG6sanTp1CjSp1KtarVq1izat3KtetJaya/xhEL1hlZYGfLvkxrhi3RnG4NxT14c24ou0yP4jVSz67TvdniQvXbtbDhw4gTK17MuLHjx5AjM85bhbI4unCN1n3rUOgRn3o99+CZNGLljz9NDyW9FOdo16FZw5C5EvY727VRz8YdUjcK2oN5ZwRtVXhAzBYAKAdwQ4BzAeRUt6O3fHmN58+jq51o+UL16jCwY0+JNDByDN+tvxCfXcx5YppHpFfvgn1793xTppivnEOA/wFw2GCfcx6B5AR/zG0AIIACDrgVgglmsOCCGwxIYFYI+jfhfw3ah2GGCm4YYIUWYgViiBt2UKJVJ6I4oQcrUtWiBiKO2CF7Vc1Io4gfxAgVhB/U2KOPTum4Y4pDevijkRLymKSSRfIXgpAgELkNAFhmmaUIVFbpYFNahsmlk15CeWWYW46JZAhWwoKmliN0WaaZu7yJJQlyzinemWiWkKee9wVjp59kivClM30SuuYIOG4Epwl/shkoY5FKpuaLlp5QaaZBFsrppRR+iqenooKwaKmXoqrqqhlEAAAh+QQFBQAEACwAAAAAgACAAAAE/pDISau9OOvNu/9gKI5kaZ6oOKxD6r5wyLJxbdvzfO98mdO9oHDzWw2PyEmxlWwGl87oDiqtEnQmqg9oBf2yRTC229GqwiQzOaP2okfttWXJPH/hcTmFXnffZXR6RHmDf36GghiBgIhlhIlKj4pvH4uQGpYeknObl3yHY46dnqMSpVeniZ+alIWtl5ilsqmkr5ONt7iwsbYXo5m7oroVncDBHKu8OcjGx67Lz1xstMfJuaG+zc7R0td93t1W2Gmb45y9jN924evQLtqg6pXUe+h4w6z2yvr77Fv43MwJgxetBsBpfOQNJKjshkBmCRUuZLgtUkSJ+S5WRKgxxUV//tU+YrzXcaPIkf9KBjv5ROQulkNgqnKZhKYem05UrtEpJeFMijWBBqXX0p0gfl0eklG6sanTp1CjSp1KtarVq1izat3KtetJaya/xhEL1hlZYGfLvkxrhi3RnG4NxT14c24ou0yP4jVSz67TvdniQvXbtbDhw4gTK17MuLHjx5AjMwZAGcBavrsqa66VN4rmz5b1vrUB+vPP0S9Kgz4t9Ibq0qzV9ngNG5LMILRXw7rtOvdmszhh+P4d9mOM4ZUHBy+BnDJV3iKaY13+ATmJANgDOAQZkO6F4dezYzdoNB7S77RLiBcPg6jPEQDiy5d/Yn329uc5lgcxPz4K+/e92NCafihtMF8KAI63gQAMCgCRd67okaB2CzbI4IP7VTUhhRlYaGF3BTY1IQceNohhZxttSGKJDoKI1YgrljgRZlTBGKOHGWX4lI0VyjhjiMHw2COOOaIIi4oesNjij0BCIuSQH86TXyJIJsmiedzt8iSUJmLZpBxbcnlhOjpqmaAISrZj5BphirmklxVVCUKaaq5ZRZtukjPlnQCWQCdJdkpxJgl/1vkln+z5eWVKNDqTqKI+pgRZoZJBSmSlJlCKKZqLbkpop55yGmmoonZJ6qdjnqrqqhdEAAAh+QQFBQAEACwAAAAAgACAAAAE/pDISau9OOvNu/9gKI5kaZ6oOKxD6r5wyLJxbdvzfO98mdO9oHDzWw2PyEmxlWwGl87oDiqtEnQmqg9oBf2yRTC229GqwiQzOaP2okfttWXJPH/hcTmFXnffZXR6RHmDf36GghiBgIhlhIlKj4pvH4uQGpYeknObl3yHY46dnqMSpVeniZ+alIWtl5ilsqmkr5ONt7iwsbYXo5m7oroVncDBHKu8OcjGx67Lz1xstMfJuaG+zc7R0td93t1W2Gmb45y9jN924evQLtqg6pXUe+h4w6z2yvr77Fv43MwJgxetBsBpfOQNJKjshkBmCRUuZLgtUkSJ+S5WRKgxxUV//tU+YrzXcaPIkf9KBjv5ROQulkNgqnKZhKYem05UrtEpJeFMijWBBqXX0p0gfl0eklG6sanTp1CjSp1KtarVq1izat3KtSuAr2DDih0rFupJaxPIql0b1ulZnxTYyl1r8i1cCXPzlq1o9y4BvYAB1O1rJrDewYQRGZbrNrHRtIvJmnVspKvly5gza97MubPnz6BDi+4coHSAlyDlmF5di6mU1bBPHxV6JDbsn0Rj2I6Nm7aN3bZ7oxUCPDgkmUGK84aF/Iby286av3jOuqn0E9RNT/7oIntpqtdBeMeKM0R2EgLSC3CYuh896ujVpzf4eJ5f8cVLyJcPg+j9D8Cd0LCfev0h5V5lIyxnwoAEvuCbN9hphwKD87kC0UHC6EHhegUFhNJTG3LIEVPDUbXhha49eEyIKLaHSm6JnNgiggd+uI2MM9qo4iU4BpRRfSBSaB+Q4NAYpJA/umiRgTwimaSRHkbF4pCu1QOjFD1OZOOSRAaTpZbtVCnIlzmGqaSGTsYDpZZbdjFlOmISs6MTZIJJUpdjMphSnOfgieaAe56ZDYZrABromlS2SQZ/Yvh5YWhXjvaio5KWWWmjfF7aZ6aaWklppxCCmpKopJaaQQQAIfkEBQUABAAsAAAAAIAAgAAABP6QyEmrvTjrzbv/YCiOZGmeqDisQ+q+cMiycW3b83zvfJnTvaBw81sNj8hJsZVsBpfO6A4qrRJ0JqoPaAX9skUwttvRqsIkMzmj9qJH7bVlyTx/4XE5hV5332V0ekR5g39+hoIYgYCIZYSJSo+Kbx+LkBqWHpJzm5d8h2OOnZ6jEqVXp4mfmpSFrZeYpbKppK+Tjbe4sLG2F6OZu6K6FZ3AwRyrvDnIxseuy89cbLTHybmhvs3O0dLXfd7dVgDjACnae+GcvYzfIuTkKOd465XQI+/4J9TTw6z0GvgCbulnx17BfxkCKkxj0AVBftZAKFw4r53DdMIiSpwocFtGjf4hOFL0mI0PthIiO5I0ZfLkiZT5VrZ0mQLmu20zMcKwCQ9WTiNDeI6rNbOJUFU5q9hEanJNSqb7doiE+jDKSEEIu9z0qXOl169gw4odS7as2bNo06pdy7btygBw48qdS3cu2J9NLdTdy1euV7wtK/QdzJck4KITCCu26/Fw4MSLIxt2bC2y5MaUgVkm/Dczrs2Fv3qm6ba06dOoU6tezbq169ewY4MVQFvALtJyausm2rWK7t+2scpzAvw31apCigM/nnWH8uLMo5Z4Dh0S3iPUl3NN2iO7cWfXbXjfLfNnjPG175pPgZ422fDT0aNdP0J+xRu4lYHsMJ5h/opAHbW0T3YDNaRPcyUNqNyByPljIDsPeqCdGA1+1NtHJ5DH4EP/DeegHh5yKN12/0iyn1ghIuRheZu0uCJmWRUzIoi/NPdiNTUid+NtszS4o3U39oggkEOe8iONRhZ55Bo/prJkF0fS8mQVUQ7JkpVQUqPljEecqN+FCVZI5T5kcilEVGhiGUWaYqLTphRvRhLnlWAiaREodUL0mpmw8bmnmrIRA2igckZIqIP/Hfqlohsy6uijHEQAACH5BAkFAAQALAAAAACAAIAAAAT+kMhJq7046827/2AojmRpnqg4rEPqvnDIsnFt2/N873yZ072gcPNbDY/ISbGVbAaXzugOKq0SAFjAieoDWkHZrIk7+n0/4XDXTCKfM2lxu7jOvTlxuYpedt8teXogfh1LRn8agVp7bDKEiBWKjHaOfJCJgZM6lY2XcJmDlh6GnniSH48YhkylmHmhnRykrRuKi4WiRLO0rnGouRq7vL1po8CqqcMUp7LHF8LKn6/NscjO0ZHMGckSq9gd2taUwdzfEra61RXe5qbT5Jvw6lIB9QEp4c9e2+W4hyX27KHIN6Zfun0hAio8AcqFQX7XNiicWKJhiocWVrFKOJHiCF/+MeZRYyeiY0cSanAg/KVxI0eTC9uJ03gC5kmZSlquJGHTozmdO030jIkN6L8YQwMqM+rSRlKBpZgeeVrPk9QkVCEZrZJUa8s3Pb1C+2JTbESuPhGdPaM0alCccOPKnUu3rt27ePPq3cu3r9++AgILHky4MGGZTElSMMy48eCfiRUTcEy5cdHINCdU3nw4GubMEjiLFnD5M5nRnEubjoWaMuTV8Ra3NowY9tG/uHPr3s27t+/fwIMLH068RmyzvNZGUe5E8hnnVkDfkV5Fp9mxSLaqBdrk6nXqPLxfEn+DvFvuKtGr/grD/FLtKNx/k8+SPV34mrD7a+rw7UHo++nNN9JtF43DiYD/iTSgf/kRWB9zGWGkj4IN8gcLhfI4eOBxW0g4IYMjFbgWhxFCKM8fCHZj4EwkygVgThS+iFOKBJRD43w02nijZ/306OF5GKoYZI0/jmfQkUVuB+FDOwI5JJFPypgcRlQm+YWU65iIpVUSdmmlFE3CuGKALbYSppBjLgiikk9S8OOZ1cEJZZpqrvlckXh+eUSSfJoYZ5tZAuqmn3/ayaKGxpTJJaKJ0lnfb3oKF2lwkwJXKaSEFiemopom2GlBjH4qqqgRAAA7) no-repeat center/80px",e}debounce(e){var t=this;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,i=arguments.length>2?arguments[2]:void 0,n=null;return{exec:function(){for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];n&&(clearTimeout(n),n=null),i&&!n&&e.apply(t,a),n=setTimeout((()=>{e.apply(t,a)}),r)},cancel:()=>{clearTimeout(n),n=null}}}isIpv6(e){return!(!e||/^(\d{1,3}\.){3}\d{1,3}$/gi.test(e))}configurationEnvironment(){const e=Intl.DateTimeFormat().resolvedOptions().timeZone;Qv.log("CommonUtil","resolvedOptions ".concat(JSON.stringify(Intl.DateTimeFormat().resolvedOptions())));const t=!/Shanghai/.test(e);Qv.log("CommonUtil","isOverseas:".concat(!/Shanghai/.test(e))),this.configuringTheEnvironment(t),this.gslbConfigurationEnvironment()}getAreaDetectionCompleted(){return this.areaDetectionCompleted}async gslbConfigurationEnvironment(){jv.fetch([qv],{method:"GET",mode:"cors"},{"Content-Type":"application/json"},Dh.GSLB_REQUEST_TIMEOUT,1,[]).then((e=>{this.gslbResponeConfigurationEnvironment(e),Qv.info("CommonUtil","gslb respone ".concat(JSON.stringify(e))),this.areaDetectionCompleted=!0,zv.immediateReportRecords()})).catch((e=>{Qv.info("CommonUtil","gslb respone failed"),this.areaDetectionCompleted=!0,zv.immediateReportRecords()}))}gslbResponeConfigurationEnvironment(e){var t;if(200===e.httpCode&&0===(null===(t=e.data)||void 0===t?void 0:t.errno)&&e.data.user_loc){this.responeInfo={respone:e,gslbRequestUrl:qv};const t=this.detectedUserLocConfigurationEnvironment(e.data.user_loc);this.configuringTheEnvironment(t),Qv.info("CommonUtil","gslbGetIsOverseas success")}}anonymizationSdp(e){let t=Qv.shieldIpAddress(e);return t=Qv.shieldIcePassword(t),t}detectedUserLocConfigurationEnvironment(e){if(!e)return!1;let t=!0;return/ä¸­å½/.test(e)&&(t=!1,(/é¦æ¸¯/.test(e)||/å°æ¹¾/.test(e)||/æ¾³é¨/.test(e))&&(t=!0)),Qv.info("CommonUtil","detectedUserLocGetIsOveseas isOverseas:".concat(t)),t}configuringTheEnvironment(e){e?(Dh.OPS_REPORT_DOMAIN="log-collection-ap-southeast-3.rocket-cdn.com",Dh.PUBLIC_DNS_SERVER=["dns.google","cloudflare-dns.com"]):(Dh.OPS_REPORT_DOMAIN="log-collection-new.hwcloudlive.com",Dh.PUBLIC_DNS_SERVER=["dns.alidns.com","doh.pub"])}getRandomArray(e){const t=new Uint8Array(e);return Kv&&Kv.getRandomValues(t),t}},Xv={none:0,error:1,warn:2,log:3,info:3,debug:4,trace:5,verbose:5},Jv={domain:"",appName:"",streamName:"",svrsid:""};class Qv{static setLogLevel(e){if(!(Xv[e]>=0))throw new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER,"log level is invalid");return Qv.logLevel=e,!0}static setExtraInfos(e){void 0!==e.domain&&(Jv.domain=e.domain),void 0!==e.appName&&(Jv.appName=e.appName),void 0!==e.streamName&&(Jv.streamName=e.streamName),void 0!==e.svrsid&&(Jv.svrsid=e.svrsid)}static shieldIpAddress(e){return e?e.replace(/\b(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\.(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\.(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\b/g,"$1.*.*.$2"):null}static shieldIcePassword(e){return e.replace(/^(a=ice-pwd:).+/gm,"$1*******************")}static shieldUrlParameters(e){if(!e)return e;const t=e.match(/([^?|=|&]+)=([^&]+)/g);return t&&t.forEach((t=>{const r=/([^=]*)=(.*)/g.exec(t);e=e.replace(t,"".concat(r[1],"=").concat(Qv.secretString(r[2])))})),e}static secretString(e){if(!e)return null;const t="********",r=Math.ceil(e.length/3),i=Math.ceil((e.length-r)/2);return 0===i?"".concat(e.substr(0,r)).concat(t):"".concat(e.substr(0,r)).concat(t).concat(e.substr(-i,i))}static async getLogFileInfo(){const e=Zv.getCurrentTimeInfo(),t="".concat(e.year,"-").concat(e.month,"-").concat(e.day,"T").concat(e.hour,":").concat(e.min,":").concat(e.sec).concat(e.zoneOff),r="".concat(e.year,"-").concat(e.month,"-").concat(e.day,"T").concat(e.hour,".").concat(e.min,".").concat(e.sec).concat(e.zoneOff.replace(":",".")),i=Qv.getLogBuffer();if(0===i.length)return null;const n="LLL_".concat(Jv.domain||"runtime","##").concat(Jv.appName||"default","##").concat(Jv.streamName||"default","##"),s="".concat(n).concat(Jv.svrsid||"default","##").concat(r),a=encodeURIComponent("".concat(n).concat(t)),o=new kh;o.folder("".concat(t,"#").concat(Zv.generateRandomId(6))).file("".concat(s,".log"),"".concat(i.join("\n")));return{content:await o.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}}),urlFileNameEncode:a,fileName:s}}static async uploadLog(){const e=await Qv.getLogFileInfo(),t=new FormData;t.append("file",e.content,"".concat(e.fileName,".zip")),jv.fetch(["https://".concat(Dh.OPS_REPORT_DOMAIN,"/v1/api/hwrtc_client/log_collect?file=").concat(e.urlFileNameEncode)],{method:"POST",body:t,mode:"cors"},{Authorization:Dh.OPS_AUTH_TOKEN})}static error(e,t){Qv.print("error",e,t)}static warn(e,t){Qv.print("warn",e,t)}static info(e,t){Qv.print("info",e,t)}static log(e,t){Qv.print("log",e,t)}static debug(e,t){Qv.print("debug",e,t)}static trace(e,t){Qv.print("trace",e,t)}static verbose(e,t){Qv.print("verbose",e,t)}static clearLogs(){Qv.logBuffer=[]}static setlogBufferSize(e){Qv.logBufferSize=e}static getlogBufferSize(){return Qv.logBufferSize}static getLogBuffer(){return Qv.logBuffer}static print(e,t,r){const i=Zv.getCurrentTimeInfo(),n="".concat(i.year,"-").concat(i.month,"-").concat(i.day," ").concat(i.hour,":").concat(i.min,":").concat(i.sec,".").concat(i.millsec," [HWLLS] [").concat(e,"] [").concat(t,"] [").concat(r,"]");for(this.logBuffer.push(n);this.logBuffer.length>=this.logBufferSize;)this.logBuffer.shift();if(Xv[Qv.logLevel]>=Xv[e]){const t=Xv[e]>=4?"debug":e,r=t in console?console[t]:null;"function"==typeof r&&r(n)}}}$l(Qv,"logLevel","log"),$l(Qv,"logBuffer",[]),$l(Qv,"logBufferSize",1e4);let eE=!0,tE=!0;function rE(e,t,r){const i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)}function iE(e,t,r){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,n=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return n.apply(this,arguments);const s=e=>{const t=r(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,s),n.apply(this,[e,s])};const s=i.removeEventListener;i.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(r))return s.apply(this,arguments);const i=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function nE(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(eE=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function sE(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(tE=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function aE(){if("object"==typeof window){if(eE)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function oE(e,t){tE&&console.warn(e+" is deprecated, please use "+t+" instead.")}function lE(e){return"[object Object]"===Object.prototype.toString.call(e)}function cE(e){return lE(e)?Object.keys(e).reduce((function(t,r){const i=lE(e[r]),n=i?cE(e[r]):e[r],s=i&&!Object.keys(n).length;return void 0===n||s?t:Object.assign(t,{[r]:n})}),{}):e}function dE(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith("Id")?dE(e,e.get(t[i]),r):i.endsWith("Ids")&&t[i].forEach((t=>{dE(e,e.get(t),r)}))})))}function uE(e,t,r){const i=r?"outbound-rtp":"inbound-rtp",n=new Map;if(null===t)return n;const s=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)})),s.forEach((t=>{e.forEach((r=>{r.type===i&&r.trackId===t.id&&dE(e,r,n)}))})),n}const hE=aE;function fE(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((r=>{if("require"===r||"advanced"===r||"mediaSource"===r)return;const i="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[n("min",r)]=i.ideal,t.optional.push(e),e={},e[n("max",r)]=i.ideal,t.optional.push(e)):(e[n("",r)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[n("",r)]=i.exact):["min","max"].forEach((e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[n(e,r)]=i[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},n=function(e,n){if(t.version>=61)return n(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});const a=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?t=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(t=["front"]),t)return r.mediaDevices.enumerateDevices().then((r=>{let a=(r=r.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&r.length&&t.includes("back")&&(a=r[r.length-1]),a&&(e.video.deviceId=s.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),hE("chrome: "+JSON.stringify(e)),n(e)}))}e.video=i(e.video)}return hE("chrome: "+JSON.stringify(e)),n(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(e,t,i){n(e,(e=>{r.webkitGetUserMedia(e,t,(e=>{i&&i(s(e))}))}))}.bind(r),r.mediaDevices.getUserMedia){const e=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return n(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(s(e))))))}}}function pE(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function mE(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.track.id)):{track:r.track};const n=new Event("track");n.track=r.track,n.receiver=i,n.transceiver={receiver:i},n.streams=[t.stream],this.dispatchEvent(n)})),t.stream.getTracks().forEach((r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.id)):{track:r};const n=new Event("track");n.track=r,n.receiver=i,n.transceiver={receiver:i},n.streams=[t.stream],this.dispatchEvent(n)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else iE(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function gE(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let n=r.apply(this,arguments);return n||(n=t(this,e),this._senders.push(n)),n};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function yE(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,i]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const n=function(e){const t={};return e.result().forEach((e=>{const r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{r[t]=e.stat(t)})),t[r.id]=r})),t},s=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const i=function(e){r(s(n(e)))};return t.apply(this,[i,e])}return new Promise(((e,r)=>{t.apply(this,[function(t){e(s(n(t)))},r])})).then(r,i)}}function _E(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>uE(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),iE(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>uE(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,r,i;return this.getSenders().forEach((r=>{r.track===e&&(t?i=!0:t=r)})),this.getReceivers().forEach((t=>(t.track===e&&(r?i=!0:r=t),t.track===e))),i||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function vE(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(i)&&this._shimmedLocalStreams[r.id].push(i):this._shimmedLocalStreams[r.id]=[r,i],i};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();r.apply(this,arguments);const i=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const r=this._shimmedLocalStreams[t].indexOf(e);-1!==r&&this._shimmedLocalStreams[t].splice(r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),n.apply(this,arguments)}}function EE(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return vE(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}i.apply(this,[t])};const n=e.RTCPeerConnection.prototype.removeStream;function s(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],n=e._streams[i.id];r=r.replace(new RegExp(n.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const n=this._streams[r.id];if(n)n.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new e.MediaStream([t]);this._streams[r.id]=i,this._reverseStreams[i.id]=r,this.addStream(i)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[t=>{const r=s(this,t);e[0].apply(null,[r])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then((e=>s(this,e)))}};e.RTCPeerConnection.prototype[t]=i[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],n=e._streams[i.id];r=r.replace(new RegExp(i.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=o.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((r=>{this._streams[r].getTracks().find((t=>e.track===t))&&(t=this._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function SE(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}))}function TE(e,t){iE(e,"negotiationneeded",(e=>{const r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e}))}var bE=Object.freeze({__proto__:null,shimMediaStream:pE,shimOnTrack:mE,shimGetSendersWithDtmf:gE,shimGetStats:yE,shimSenderReceiverGetStats:_E,shimAddTrackRemoveTrackWithNative:vE,shimAddTrackRemoveTrack:EE,shimPeerConnection:SE,fixNegotiationNeeded:TE,shimGetUserMedia:fE,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((t=>{const i=r.video&&r.video.width,n=r.video&&r.video.height,s=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},i&&(r.video.mandatory.maxWidth=i),n&&(r.video.mandatory.maxHeight=n),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function RE(e,t){const r=e&&e.navigator,i=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,i){oE("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},t=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(r){return"object"==typeof r&&"object"==typeof r.audio&&(r=JSON.parse(JSON.stringify(r)),e(r.audio,"autoGainControl","mozAutoGainControl"),e(r.audio,"noiseSuppression","mozNoiseSuppression")),t(r)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const r=t.apply(this,arguments);return e(r,"mozAutoGainControl","autoGainControl"),e(r,"mozNoiseSuppression","noiseSuppression"),r}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(r){return"audio"===this.kind&&"object"==typeof r&&(r=JSON.parse(JSON.stringify(r)),e(r,"autoGainControl","mozAutoGainControl"),e(r,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[r])}}}}function wE(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function AE(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}));const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,s]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!n)try{e.forEach((e=>{e.type=r[e.type]||e.type}))}catch(i){if("TypeError"!==i.name)throw i;e.forEach(((t,i)=>{e.set(i,Object.assign({},t,{type:r[t.type]||t.type}))}))}return e})).then(n,s)}}function LE(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function CE(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),iE(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function IE(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){oE("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function kE(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function DE(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],r=e&&"sendEncodings"in e;r&&e.sendEncodings.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(r){const{sender:t}=i,r=t.getParameters();(!("encodings"in r)||1===r.encodings.length&&0===Object.keys(r.encodings[0]).length)&&(r.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(r).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return i})}function PE(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function OE(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function xE(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var ME=Object.freeze({__proto__:null,shimOnTrack:wE,shimPeerConnection:AE,shimSenderGetStats:LE,shimReceiverGetStats:CE,shimRemoveStream:IE,shimRTCDataChannel:kE,shimAddTransceiver:DE,shimGetParameters:PE,shimCreateOffer:OE,shimCreateAnswer:xE,shimGetUserMedia:RE,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}});function NE(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((r=>t.call(this,r,e))),e.getVideoTracks().forEach((r=>t.call(this,r,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...r){return r&&r.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const r=e.getTracks();this.getSenders().forEach((e=>{r.includes(e.track)&&this.removeTrack(e)}))})}}function FE(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}))}),t.apply(e,arguments)}}}function UE(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,n=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],n=r.apply(this,[i]);return t?(n.then(e,t),Promise.resolve()):n},t.createAnswer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n};let o=function(e,t,r){const i=n.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i};t.setLocalDescription=o,o=function(e,t,r){const i=s.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.setRemoteDescription=o,o=function(e,t,r){const i=a.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.addIceCandidate=o}function BE(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,r=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>r(HE(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,i){t.mediaDevices.getUserMedia(e).then(r,i)}.bind(t))}function HE(e){return e&&void 0!==e.video?Object.assign({},e,{video:cE(e.video)}):e}function jE(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){const t=[];for(let r=0;r<e.iceServers.length;r++){let i=e.iceServers[r];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(oE("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[r])}e.iceServers=t}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function VE(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function GE(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const r=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video")}return t.apply(this,arguments)}}function zE(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var KE=Object.freeze({__proto__:null,shimLocalStreamsAPI:NE,shimRemoteStreamsAPI:FE,shimCallbacksAPI:UE,shimGetUserMedia:BE,shimConstraints:HE,shimRTCIceServerUrls:jE,shimTrackEventTransceiver:VE,shimCreateOfferLegacy:GE,shimAudioContext:zE}),WE={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){const r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter((e=>0===e.indexOf(r)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const r={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let i=8;i<t.length;i+=2)switch(t[i]){case"raddr":r.relatedAddress=t[i+1];break;case"rport":r.relatedPort=parseInt(t[i+1],10);break;case"tcptype":r.tcpType=t[i+1];break;case"ufrag":r.ufrag=t[i+1],r.usernameFragment=t[i+1];break;default:void 0===r[t[i]]&&(r[t[i]]=t[i+1])}return r},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let r;const i=e.substring(e.indexOf(" ")+1).split(";");for(let n=0;n<i.length;n++)r=i[n].trim().split("="),t[r[0].trim()]=r[1];return t},t.writeFmtp=function(e){let t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+r+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),r={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(r.attribute=e.substring(t+1,i),r.value=e.substring(i+1)):r.attribute=e.substring(t+1),r},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,r){return{role:"auto",fingerprints:t.matchPrefix(e+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,r){return t.matchPrefix(e+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,r){const i=t.matchPrefix(e+r,"a=ice-ufrag:")[0],n=t.matchPrefix(e+r,"a=ice-pwd:")[0];return i&&n?{usernameFragment:i.substring(12),password:n.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");r.profile=i[2];for(let s=3;s<i.length;s++){const n=i[s],a=t.matchPrefix(e,"a=rtpmap:"+n+" ")[0];if(a){const i=t.parseRtpMap(a),s=t.matchPrefix(e,"a=fmtp:"+n+" ");switch(i.parameters=s.length?t.parseFmtp(s[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+n+" ").map(t.parseRtcpFb),r.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{r.headerExtensions.push(t.parseExtmap(e))}));const n=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach((e=>{n.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),r},t.writeRtpDescription=function(e,r){let i="";i+="m="+e+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach((e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));let n=0;return r.codecs.forEach((e=>{e.maxptime>n&&(n=e.maxptime)})),n>0&&(i+="a=maxptime:"+n+"\r\n"),r.headerExtensions&&r.headerExtensions.forEach((e=>{i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){const r=[],i=t.parseRtpParameters(e),n=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),o=a.length>0&&a[0].ssrc;let l;const c=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));c.length>0&&c[0].length>1&&c[0][0]===o&&(l=c[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:o,codecPayloadType:parseInt(e.parameters.apt,10)};o&&l&&(t.rtx={ssrc:l}),r.push(t),n&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:o,mechanism:s?"red+ulpfec":"red"},r.push(t))}})),0===r.length&&o&&r.push({ssrc:o});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,r.forEach((e=>{e.maxBitrate=d}))),r},t.parseRtcpParameters=function(e){const r={},i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const n=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=n.length>0,r.compound=0===n.length;const s=t.matchPrefix(e,"a=rtcp-mux");return r.mux=s.length>0,r},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let r;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const n=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return n.length>0?(r=n[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(e){const r=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let n;i.length>0&&(n=parseInt(i[0].substring(19),10)),isNaN(n)&&(n=65536);const s=t.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:r.fmt,maxMessageSize:n};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:n}}},t.writeSctpDescription=function(e,t){let r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,r,i){let n;const s=void 0!==r?r:2;n=e||t.generateSessionId();return"v=0\r\no="+(i||"thisisadapterortc")+" "+n+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,r){const i=t.splitLines(e);for(let t=0;t<i.length;t++)switch(i[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[t].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const r=t.splitLines(e)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(e){const r=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const r=t.splitLines(e);for(let t=0;t<r.length;t++)if(r[t].length<2||"="!==r[t].charAt(1))return!1;return!0},e.exports=t}(WE);var $E=WE.exports,YE=Object.freeze(e({__proto__:null,default:$E},[WE.exports]));function qE(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const r=new t(e),i=$E.parseCandidate(e.candidate),n=Object.assign(r,i);return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,iE(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function ZE(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=$E.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=$E.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),r=function(e){let r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r}(e),i=function(e,r){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const n=$E.matchPrefix(e.sdp,"a=max-message-size:");return n.length>0?i=parseInt(n[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(i=2147483637),i}(arguments[0],e);let n;n=0===r&&0===i?Number.POSITIVE_INFINITY:0===r||0===i?Math.max(r,i):Math.min(r,i);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>n}),this._sctp=s}return r.apply(this,arguments)}}function XE(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const r=e.send;e.send=function(){const i=arguments[0],n=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&n>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=r.apply(this,arguments);return t(e,this),e},iE(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function JE(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}function QE(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const r=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return r.apply(this,arguments)}}function eS(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function tS(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return r.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return r.apply(this,[e]);return("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>r.apply(this,[e])))})}var rS=Object.freeze({__proto__:null,shimRTCIceCandidate:qE,shimMaxMessageSize:ZE,shimSendThrowTypeError:XE,shimConnectionState:JE,removeExtmapAllowMixed:QE,shimAddIceCandidateNullOrEmpty:eS,shimParameterlessSetLocalDescription:tS});const iS=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=aE,i=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:r}=e;if(r.mozGetUserMedia)t.browser="firefox",t.version=rE(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=rE(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=rE(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),n={browserDetails:i,commonShim:rS,extractVersion:rE,disableLog:nE,disableWarnings:sE,sdp:YE};switch(i.browser){case"chrome":if(!bE||!SE||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),n;if(null===i.version)return r("Chrome shim can not determine version, not shimming."),n;r("adapter.js shimming chrome."),n.browserShim=bE,eS(e,i),tS(e),fE(e,i),pE(e),SE(e,i),mE(e),EE(e,i),gE(e),yE(e),_E(e),TE(e,i),qE(e),JE(e),ZE(e,i),XE(e),QE(e,i);break;case"firefox":if(!ME||!AE||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),n;r("adapter.js shimming firefox."),n.browserShim=ME,eS(e,i),tS(e),RE(e,i),AE(e,i),wE(e),IE(e),LE(e),CE(e),kE(e),DE(e),PE(e),OE(e),xE(e),qE(e),JE(e),ZE(e,i),XE(e);break;case"safari":if(!KE||!t.shimSafari)return r("Safari shim is not included in this adapter release."),n;r("adapter.js shimming safari."),n.browserShim=KE,eS(e,i),tS(e),jE(e),GE(e),UE(e),NE(e),FE(e),VE(e),BE(e),zE(e),qE(e),ZE(e,i),XE(e),QE(e,i);break;default:r("Unsupported browser!")}return n}({window:"undefined"==typeof window?void 0:window});var nS={exports:{}};!function(e,t){var r;self,r=function(){return function(){var e={"./node_modules/es6-promise/dist/es6-promise.js":
/*!******************************************************!*\
    !*** ./node_modules/es6-promise/dist/es6-promise.js ***!
    \******************************************************/function(e,t,r){
/*!
   * @overview es6-promise - a tiny implementation of Promises/A+.
   * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
   * @license   Licensed under MIT license
   *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
   * @version   v4.2.8+1e68dce6
   */
e.exports=function(){function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function t(e){return"function"==typeof e}var i=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},n=0,s=void 0,a=void 0,o=function(e,t){E[n]=e,E[n+1]=t,2===(n+=2)&&(a?a(S):b())};function l(e){a=e}function c(e){o=e}var d="undefined"!=typeof window?window:void 0,u=d||{},h=u.MutationObserver||u.WebKitMutationObserver,f="undefined"==typeof self&&void 0!==Ch&&"[object process]"==={}.toString.call(Ch),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function m(){return function(){return mh(S)}}function g(){return void 0!==s?function(){s(S)}:v()}function y(){var e=0,t=new h(S),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function _(){var e=new MessageChannel;return e.port1.onmessage=S,function(){return e.port2.postMessage(0)}}function v(){var e=setTimeout;return function(){return e(S,1)}}var E=new Array(1e3);function S(){for(var e=0;e<n;e+=2)(0,E[e])(E[e+1]),E[e]=void 0,E[e+1]=void 0;n=0}function T(){try{var e=Function("return this")().require("vertx");return s=e.runOnLoop||e.runOnContext,g()}catch(t){return v()}}var b=void 0;function R(e,t){var r=this,i=new this.constructor(L);void 0===i[A]&&$(i);var n=r._state;if(n){var s=arguments[n-1];o((function(){return G(n,i,s,r._result)}))}else j(r,i,e,t);return i}function w(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(L);return F(r,e),r}b=f?m():h?y():p?_():void 0===d?T():v();var A=Math.random().toString(36).substring(2);function L(){}var C=void 0,I=1,k=2;function D(){return new TypeError("You cannot resolve a promise with itself")}function P(){return new TypeError("A promises callback cannot return that same promise.")}function O(e,t,r,i){try{e.call(t,r,i)}catch(n){return n}}function x(e,t,r){o((function(e){var i=!1,n=O(r,t,(function(r){i||(i=!0,t!==r?F(e,r):B(e,r))}),(function(t){i||(i=!0,H(e,t))}),"Settle: "+(e._label||" unknown promise"));!i&&n&&(i=!0,H(e,n))}),e)}function M(e,t){t._state===I?B(e,t._result):t._state===k?H(e,t._result):j(t,void 0,(function(t){return F(e,t)}),(function(t){return H(e,t)}))}function N(e,r,i){r.constructor===e.constructor&&i===R&&r.constructor.resolve===w?M(e,r):void 0===i?B(e,r):t(i)?x(e,r,i):B(e,r)}function F(t,r){if(t===r)H(t,D());else if(e(r)){var i=void 0;try{i=r.then}catch(IU){return void H(t,IU)}N(t,r,i)}else B(t,r)}function U(e){e._onerror&&e._onerror(e._result),V(e)}function B(e,t){e._state===C&&(e._result=t,e._state=I,0!==e._subscribers.length&&o(V,e))}function H(e,t){e._state===C&&(e._state=k,e._result=t,o(U,e))}function j(e,t,r,i){var n=e._subscribers,s=n.length;e._onerror=null,n[s]=t,n[s+I]=r,n[s+k]=i,0===s&&e._state&&o(V,e)}function V(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var i=void 0,n=void 0,s=e._result,a=0;a<t.length;a+=3)i=t[a],n=t[a+r],i?G(r,i,n,s):n(s);e._subscribers.length=0}}function G(e,r,i,n){var s=t(i),a=void 0,o=void 0,l=!0;if(s){try{a=i(n)}catch(c){l=!1,o=c}if(r===a)return void H(r,P())}else a=n;r._state!==C||(s&&l?F(r,a):!1===l?H(r,o):e===I?B(r,a):e===k&&H(r,a))}function z(e,t){try{t((function(t){F(e,t)}),(function(t){H(e,t)}))}catch(r){H(e,r)}}var K=0;function W(){return K++}function $(e){e[A]=K++,e._state=void 0,e._result=void 0,e._subscribers=[]}function Y(){return new Error("Array Methods must be provided an Array")}var q=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(L),this.promise[A]||$(this.promise),i(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?B(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&B(this.promise,this._result))):H(this.promise,Y())}return e.prototype._enumerate=function(e){for(var t=0;this._state===C&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,i=r.resolve;if(i===w){var n=void 0,s=void 0,a=!1;try{n=e.then}catch(l){a=!0,s=l}if(n===R&&e._state!==C)this._settledAt(e._state,t,e._result);else if("function"!=typeof n)this._remaining--,this._result[t]=e;else if(r===te){var o=new r(L);a?H(o,s):N(o,e,n),this._willSettleAt(o,t)}else this._willSettleAt(new r((function(t){return t(e)})),t)}else this._willSettleAt(i(e),t)},e.prototype._settledAt=function(e,t,r){var i=this.promise;i._state===C&&(this._remaining--,e===k?H(i,r):this._result[t]=r),0===this._remaining&&B(i,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;j(e,void 0,(function(e){return r._settledAt(I,t,e)}),(function(e){return r._settledAt(k,t,e)}))},e}();function Z(e){return new q(this,e).promise}function X(e){var t=this;return i(e)?new t((function(r,i){for(var n=e.length,s=0;s<n;s++)t.resolve(e[s]).then(r,i)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))}function J(e){var t=new this(L);return H(t,e),t}function Q(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ee(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var te=function(){function e(t){this[A]=W(),this._result=this._state=void 0,this._subscribers=[],L!==t&&("function"!=typeof t&&Q(),this instanceof e?z(this,t):ee())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var r=this,i=r.constructor;return t(e)?r.then((function(t){return i.resolve(e()).then((function(){return t}))}),(function(t){return i.resolve(e()).then((function(){throw t}))})):r.then(e,e)},e}();function re(){var e=void 0;if(void 0!==r.g)e=r.g;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(n){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(n){}if("[object Promise]"===i&&!t.cast)return}e.Promise=te}return te.prototype.then=R,te.all=Z,te.race=X,te.resolve=w,te.reject=J,te._setScheduler=l,te._setAsap=c,te._asap=o,te.polyfill=re,te.Promise=te,te}()},"./node_modules/events/events.js":
/*!***************************************!*\
    !*** ./node_modules/events/events.js ***!
    \***************************************/function(e){var t,r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var n=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(r,i){function n(r){e.removeListener(t,s),i(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",n),r([].slice.call(arguments))}m(e,t,s,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&m(e,"error",t,r)}(e,n,{once:!0})}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function c(e,t,r,i){var n,s,a,c;if(o(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),a=s[t]),void 0===a)a=s[t]=r,++e._eventsCount;else if("function"==typeof a?a=s[t]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),(n=l(e))>0&&a.length>n&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=a.length,c=d,console&&console.warn&&console.warn(c)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=d.bind(i);return n.listener=r,i.wrapFn=n,n}function h(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):p(n,n.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}function m(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(s){i.once&&e.removeEventListener(t,n),r(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var l=s[e];if(void 0===l)return!1;if("function"==typeof l)i(l,this,t);else{var c=l.length,d=p(l,c);for(r=0;r<c;++r)i(d[r],this,t)}return!0},s.prototype.addListener=function(e,t){return c(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return c(this,e,t,!0)},s.prototype.once=function(e,t){return o(t),this.on(e,u(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,u(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,i,n,s,a;if(o(t),void 0===(i=this._events))return this;if(void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){a=r[s].listener,n=s;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,s=Object.keys(r);for(i=0;i<s.length;++i)"removeListener"!==(n=s[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},s.prototype.listenerCount=f,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
    !*** ./node_modules/webworkify-webpack/index.js ***!
    \**************************************************/function(e,t,r){function i(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var i=r(r.s=ENTRY_MODULE);return i.default||i}var n="[\\.|\\-|\\+|\\w|/|@]+",s="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+n+").*?\\)";function a(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e,t,i){var o={};o[i]=[];var l=t.toString(),c=l.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!c)return o;for(var d,u=c[1],h=new RegExp("(\\\\n|\\W)"+a(u)+s,"g");d=h.exec(l);)"dll-reference"!==d[3]&&o[i].push(d[3]);for(h=new RegExp("\\("+a(u)+'\\("(dll-reference\\s('+n+'))"\\)\\)'+s,"g");d=h.exec(l);)e[d[2]]||(o[i].push(d[1]),e[d[2]]=r(d[1]).m),o[d[2]]=o[d[2]]||[],o[d[2]].push(d[4]);for(var f,p=Object.keys(o),m=0;m<p.length;m++)for(var g=0;g<o[p[m]].length;g++)f=o[p[m]][g],isNaN(1*f)||(o[p[m]][g]=1*o[p[m]][g]);return o}function l(e){return Object.keys(e).reduce((function(t,r){return t||e[r].length>0}),!1)}e.exports=function(e,t){t=t||{};var n={main:r.m},s=t.all?{main:Object.keys(n.main)}:function(e,t){for(var r={main:[t]},i={main:[]},n={main:{}};l(r);)for(var s=Object.keys(r),a=0;a<s.length;a++){var c=s[a],d=r[c].pop();if(n[c]=n[c]||{},!n[c][d]&&e[c][d]){n[c][d]=!0,i[c]=i[c]||[],i[c].push(d);for(var u=o(e,e[c][d],c),h=Object.keys(u),f=0;f<h.length;f++)r[h[f]]=r[h[f]]||[],r[h[f]]=r[h[f]].concat(u[h[f]])}}return i}(n,e),a="";Object.keys(s).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;s[e][t];)t++;s[e].push(t),n[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+e+" = ("+i.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+s[e].map((function(t){return JSON.stringify(t)+": "+n[e][t].toString()})).join(",")+"});\n"})),a=a+"new (("+i.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+s.main.map((function(e){return JSON.stringify(e)+": "+n.main[e].toString()})).join(",")+"}))(self);";var c=new window.Blob([a],{type:"text/javascript"});if(t.bare)return c;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(c),u=new window.Worker(d);return u.objectURL=d,u}},"./src/config.js":
/*!***********************!*\
    !*** ./src/config.js ***!
    \***********************/function(e,t,r){r.r(t),r.d(t,{defaultConfig:function(){return i},createDefaultConfig:function(){return n}});var i={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function n(){return Object.assign({},i)}},"./src/core/features.js":
/*!******************************!*\
    !*** ./src/core/features.js ***!
    \******************************/function(e,t,r){r.r(t);var i=r(/*! ../io/io-controller.js */"./src/io/io-controller.js"),n=r(/*! ../config.js */"./src/config.js"),s=function(){function e(){}return e.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},e.supportNetworkStreamIO=function(){var e=new i.default({},(0,n.createDefaultConfig)()),t=e.loaderType;return e.destroy(),"fetch-stream-loader"==t||"xhr-moz-chunked-loader"==t},e.getNetworkLoaderTypeName=function(){var e=new i.default({},(0,n.createDefaultConfig)()),t=e.loaderType;return e.destroy(),t},e.supportNativeMediaPlayback=function(t){null==e.videoElement&&(e.videoElement=window.document.createElement("video"));var r=e.videoElement.canPlayType(t);return"probably"===r||"maybe"==r},e.getFeatureList=function(){var t={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return t.mseFlvPlayback=e.supportMSEH264Playback(),t.networkStreamIO=e.supportNetworkStreamIO(),t.networkLoaderName=e.getNetworkLoaderTypeName(),t.mseLiveFlvPlayback=t.mseFlvPlayback&&t.networkStreamIO,t.nativeMP4H264Playback=e.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),t.nativeWebmVP8Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),t.nativeWebmVP9Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp9"'),t},e}();t.default=s},"./src/core/media-info.js":
/*!********************************!*\
    !*** ./src/core/media-info.js ***!
    \********************************/function(e,t,r){r.r(t);var i=function(){function e(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return e.prototype.isComplete=function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t},e.prototype.isSeekable=function(){return!0===this.hasKeyframesIndex},e.prototype.getNearestKeyframe=function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,r=this._search(t.times,e);return{index:r,milliseconds:t.times[r],fileposition:t.filepositions[r]}},e.prototype._search=function(e,t){var r=0,i=e.length-1,n=0,s=0,a=i;for(t<e[0]&&(r=0,s=a+1);s<=a;){if((n=s+Math.floor((a-s)/2))===i||t>=e[n]&&t<e[n+1]){r=n;break}e[n]<t?s=n+1:a=n-1}return r},e}();t.default=i},"./src/core/media-segment-info.js":
/*!****************************************!*\
    !*** ./src/core/media-segment-info.js ***!
    \****************************************/function(e,t,r){r.r(t),r.d(t,{SampleInfo:function(){return i},MediaSegmentInfo:function(){return n},IDRSampleList:function(){return s},MediaSegmentInfoList:function(){return a}});var i=function(e,t,r,i,n){this.dts=e,this.pts=t,this.duration=r,this.originalDts=i,this.isSyncPoint=n,this.fileposition=null},n=function(){function e(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return e.prototype.appendSyncPoint=function(e){e.isSyncPoint=!0,this.syncPoints.push(e)},e}(),s=function(){function e(){this._list=[]}return e.prototype.clear=function(){this._list=[]},e.prototype.appendArray=function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))},e.prototype.getLastSyncPointBeforeDts=function(e){if(0==this._list.length)return null;var t=this._list,r=0,i=t.length-1,n=0,s=0,a=i;for(e<t[0].dts&&(r=0,s=a+1);s<=a;){if((n=s+Math.floor((a-s)/2))===i||e>=t[n].dts&&e<t[n+1].dts){r=n;break}t[n].dts<e?s=n+1:a=n-1}return this._list[r]},e}(),a=function(){function e(e){this._type=e,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return 0===this._list.length},e.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},e.prototype._searchNearestSegmentBefore=function(e){var t=this._list;if(0===t.length)return-2;var r=t.length-1,i=0,n=0,s=r,a=0;if(e<t[0].originalBeginDts)return a=-1;for(;n<=s;){if((i=n+Math.floor((s-n)/2))===r||e>t[i].lastSample.originalDts&&e<t[i+1].originalBeginDts){a=i;break}t[i].originalBeginDts<e?n=i+1:s=i-1}return a},e.prototype._searchNearestSegmentAfter=function(e){return this._searchNearestSegmentBefore(e)+1},e.prototype.append=function(e){var t=this._list,r=e,i=this._lastAppendLocation,n=0;-1!==i&&i<t.length&&r.originalBeginDts>=t[i].lastSample.originalDts&&(i===t.length-1||i<t.length-1&&r.originalBeginDts<t[i+1].originalBeginDts)?n=i+1:t.length>0&&(n=this._searchNearestSegmentBefore(r.originalBeginDts)+1),this._lastAppendLocation=n,this._list.splice(n,0,r)},e.prototype.getLastSegmentBefore=function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null},e.prototype.getLastSampleBefore=function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null},e.prototype.getLastSyncPointBefore=function(e){for(var t=this._searchNearestSegmentBefore(e),r=this._list[t].syncPoints;0===r.length&&t>0;)t--,r=this._list[t].syncPoints;return r.length>0?r[r.length-1]:null},e}()},"./src/core/mse-controller.js":
/*!************************************!*\
    !*** ./src/core/mse-controller.js ***!
    \************************************/function(e,t,r){r.r(t);var i=r(/*! events */"./node_modules/events/events.js"),n=r.n(i),s=r(/*! ../utils/logger.js */"./src/utils/logger.js"),a=r(/*! ../utils/browser.js */"./src/utils/browser.js"),o=r(/*! ./mse-events.js */"./src/core/mse-events.js"),l=r(/*! ./media-segment-info.js */"./src/core/media-segment-info.js"),c=r(/*! ../utils/exception.js */"./src/utils/exception.js"),d=function(){function e(e){this.TAG="MSEController",this._config=e,this._emitter=new(n()),this._config.isLive&&null==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new l.IDRSampleList}return e.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){if(this._mediaSource)throw new c.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var t=this._mediaSource=new window.MediaSource;t.addEventListener("sourceopen",this.e.onSourceOpen),t.addEventListener("sourceended",this.e.onSourceEnded),t.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL},e.prototype.detachMediaElement=function(){if(this._mediaSource){var e=this._mediaSource;for(var t in this._sourceBuffers){var r=this._pendingSegments[t];r.splice(0,r.length),this._pendingSegments[t]=null,this._pendingRemoveRanges[t]=null,this._lastInitSegments[t]=null;var i=this._sourceBuffers[t];if(i){if("closed"!==e.readyState){try{e.removeSourceBuffer(i)}catch(IU){s.default.e(this.TAG,IU.message)}i.removeEventListener("error",this.e.onSourceBufferError),i.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[t]=null,this._sourceBuffers[t]=null}}if("open"===e.readyState)try{e.endOfStream()}catch(IU){s.default.e(this.TAG,IU.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},e.prototype.appendInitSegment=function(e,t){if(!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(e),void this._pendingSegments[e.type].push(e);var r=e,i=""+r.container;r.codec&&r.codec.length>0&&(i+=";codecs="+r.codec);var n=!1;if(s.default.v(this.TAG,"Received Initialization Segment, mimeType: "+i),this._lastInitSegments[r.type]=r,i!==this._mimeTypes[r.type]){if(this._mimeTypes[r.type])s.default.v(this.TAG,"Notice: "+r.type+" mimeType changed, origin: "+this._mimeTypes[r.type]+", target: "+i);else{n=!0;try{var l=this._sourceBuffers[r.type]=this._mediaSource.addSourceBuffer(i);l.addEventListener("error",this.e.onSourceBufferError),l.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(IU){return s.default.e(this.TAG,IU.message),void this._emitter.emit(o.default.ERROR,{code:IU.code,msg:IU.message})}}this._mimeTypes[r.type]=i}t||this._pendingSegments[r.type].push(r),n||this._sourceBuffers[r.type]&&!this._sourceBuffers[r.type].updating&&this._doAppendSegments(),a.default.safari&&"audio/mpeg"===r.container&&r.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=r.mediaDuration/1e3,this._updateMediaSourceDuration())},e.prototype.appendMediaSegment=function(e){var t=e;this._pendingSegments[t.type].push(t),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var r=this._sourceBuffers[t.type];!r||r.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},e.prototype.seek=function(e){for(var t in this._sourceBuffers)if(this._sourceBuffers[t]){var r=this._sourceBuffers[t];if("open"===this._mediaSource.readyState)try{r.abort()}catch(IU){s.default.e(this.TAG,IU.message)}this._idrList.clear();var i=this._pendingSegments[t];if(i.splice(0,i.length),"closed"!==this._mediaSource.readyState){for(var n=0;n<r.buffered.length;n++){var o=r.buffered.start(n),l=r.buffered.end(n);this._pendingRemoveRanges[t].push({start:o,end:l})}if(r.updating||this._doRemoveRanges(),a.default.safari){var c=this._lastInitSegments[t];c&&(this._pendingSegments[t].push(c),r.updating||this._doAppendSegments())}}}},e.prototype.endOfStream=function(){var e=this._mediaSource,t=this._sourceBuffers;e&&"open"===e.readyState?t.video&&t.video.updating||t.audio&&t.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream()):e&&"closed"===e.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},e.prototype.getNearestKeyframe=function(e){return this._idrList.getLastSyncPointBeforeDts(e)},e.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var r=this._sourceBuffers[t];if(r){var i=r.buffered;if(i.length>=1&&e-i.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},e.prototype._doCleanupSourceBuffer=function(){var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var r=this._sourceBuffers[t];if(r){for(var i=r.buffered,n=!1,s=0;s<i.length;s++){var a=i.start(s),o=i.end(s);if(a<=e&&e<o+3){if(e-a>=this._config.autoCleanupMaxBackwardDuration){n=!0;var l=e-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[t].push({start:a,end:l})}}else o<e&&(n=!0,this._pendingRemoveRanges[t].push({start:a,end:o}))}n&&!r.updating&&this._doRemoveRanges()}}},e.prototype._updateMediaSourceDuration=function(){var e=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var t=this._mediaSource.duration,r=this._pendingMediaDuration;r>0&&(isNaN(t)||r>t)&&(s.default.v(this.TAG,"Update MediaSource duration from "+t+" to "+r),this._mediaSource.duration=r),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},e.prototype._doRemoveRanges=function(){for(var e in this._pendingRemoveRanges)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating)for(var t=this._sourceBuffers[e],r=this._pendingRemoveRanges[e];r.length&&!t.updating;){var i=r.shift();t.remove(i.start,i.end)}},e.prototype._doAppendSegments=function(){var e=this._pendingSegments;for(var t in e)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating&&e[t].length>0){var r=e[t].shift();if(r.timestampOffset){var i=this._sourceBuffers[t].timestampOffset,n=r.timestampOffset/1e3;Math.abs(i-n)>.1&&(s.default.v(this.TAG,"Update MPEG audio timestampOffset from "+i+" to "+n),this._sourceBuffers[t].timestampOffset=n),delete r.timestampOffset}if(!r.data||0===r.data.byteLength)continue;try{this._sourceBuffers[t].appendBuffer(r.data),this._isBufferFull=!1,"video"===t&&r.hasOwnProperty("info")&&this._idrList.appendArray(r.info.syncPoints)}catch(IU){this._pendingSegments[t].unshift(r),22===IU.code?(this._isBufferFull||this._emitter.emit(o.default.BUFFER_FULL),this._isBufferFull=!0):(s.default.e(this.TAG,IU.message),this._emitter.emit(o.default.ERROR,{code:IU.code,msg:IU.message}))}}},e.prototype._onSourceOpen=function(){if(s.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var e=this._pendingSourceBufferInit;e.length;){var t=e.shift();this.appendInitSegment(t,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(o.default.SOURCE_OPEN)},e.prototype._onSourceEnded=function(){s.default.v(this.TAG,"MediaSource onSourceEnded")},e.prototype._onSourceClose=function(){s.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},e.prototype._hasPendingSegments=function(){var e=this._pendingSegments;return e.video.length>0||e.audio.length>0},e.prototype._hasPendingRemoveRanges=function(){var e=this._pendingRemoveRanges;return e.video.length>0||e.audio.length>0},e.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(o.default.UPDATE_END)},e.prototype._onSourceBufferError=function(e){s.default.e(this.TAG,"SourceBuffer Error: "+e)},e}();t.default=d},"./src/core/mse-events.js":
/*!********************************!*\
    !*** ./src/core/mse-events.js ***!
    \********************************/function(e,t,r){r.r(t),t.default={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"}},"./src/core/transmuxer.js":
/*!********************************!*\
    !*** ./src/core/transmuxer.js ***!
    \********************************/function(e,t,r){r.r(t);var i=r(/*! events */"./node_modules/events/events.js"),n=r.n(i),s=r(/*! webworkify-webpack */"./node_modules/webworkify-webpack/index.js"),a=r.n(s),o=r(/*! ../utils/logger.js */"./src/utils/logger.js"),l=r(/*! ../utils/logging-control.js */"./src/utils/logging-control.js"),c=r(/*! ./transmuxing-controller.js */"./src/core/transmuxing-controller.js"),d=r(/*! ./transmuxing-events.js */"./src/core/transmuxing-events.js"),u=r(/*! ./media-info.js */"./src/core/media-info.js"),h=function(){function e(e,t){if(this.TAG="Transmuxer",this._emitter=new(n()),t.enableWorker&&"undefined"!=typeof Worker)try{this._worker=a()(/*! ./transmuxing-worker */"./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[e,t]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},l.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:l.default.getConfig()})}catch(IU){o.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new c.default(e,t)}else this._controller=new c.default(e,t);if(this._controller){var r=this._controller;r.on(d.default.IO_ERROR,this._onIOError.bind(this)),r.on(d.default.DEMUX_ERROR,this._onDemuxError.bind(this)),r.on(d.default.INIT_SEGMENT,this._onInitSegment.bind(this)),r.on(d.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),r.on(d.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),r.on(d.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),r.on(d.default.MEDIA_INFO,this._onMediaInfo.bind(this)),r.on(d.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),r.on(d.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),r.on(d.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),r.on(d.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return e.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),l.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.hasWorker=function(){return null!=this._worker},e.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},e.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},e.prototype.seek=function(e){this._worker?this._worker.postMessage({cmd:"seek",param:e}):this._controller.seek(e)},e.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},e.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},e.prototype._onInitSegment=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(d.default.INIT_SEGMENT,e,t)}))},e.prototype._onMediaSegment=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(d.default.MEDIA_SEGMENT,e,t)}))},e.prototype._onLoadingComplete=function(){var e=this;Promise.resolve().then((function(){e._emitter.emit(d.default.LOADING_COMPLETE)}))},e.prototype._onRecoveredEarlyEof=function(){var e=this;Promise.resolve().then((function(){e._emitter.emit(d.default.RECOVERED_EARLY_EOF)}))},e.prototype._onMediaInfo=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(d.default.MEDIA_INFO,e)}))},e.prototype._onMetaDataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(d.default.METADATA_ARRIVED,e)}))},e.prototype._onScriptDataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(d.default.SCRIPTDATA_ARRIVED,e)}))},e.prototype._onStatisticsInfo=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(d.default.STATISTICS_INFO,e)}))},e.prototype._onIOError=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(d.default.IO_ERROR,e,t)}))},e.prototype._onDemuxError=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(d.default.DEMUX_ERROR,e,t)}))},e.prototype._onRecommendSeekpoint=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(d.default.RECOMMEND_SEEKPOINT,e)}))},e.prototype._onLoggingConfigChanged=function(e){this._worker&&this._worker.postMessage({cmd:"logging_config",param:e})},e.prototype._onWorkerMessage=function(e){var t=e.data,r=t.data;if("destroyed"===t.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(t.msg){case d.default.INIT_SEGMENT:case d.default.MEDIA_SEGMENT:this._emitter.emit(t.msg,r.type,r.data);break;case d.default.LOADING_COMPLETE:case d.default.RECOVERED_EARLY_EOF:this._emitter.emit(t.msg);break;case d.default.MEDIA_INFO:Object.setPrototypeOf(r,u.default.prototype),this._emitter.emit(t.msg,r);break;case d.default.METADATA_ARRIVED:case d.default.SCRIPTDATA_ARRIVED:case d.default.STATISTICS_INFO:this._emitter.emit(t.msg,r);break;case d.default.IO_ERROR:case d.default.DEMUX_ERROR:this._emitter.emit(t.msg,r.type,r.info);break;case d.default.RECOMMEND_SEEKPOINT:this._emitter.emit(t.msg,r);break;case"logcat_callback":o.default.emitter.emit("log",r.type,r.logcat)}},e}();t.default=h},"./src/core/transmuxing-controller.js":
/*!********************************************!*\
    !*** ./src/core/transmuxing-controller.js ***!
    \********************************************/function(e,t,r){r.r(t);var i=r(/*! events */"./node_modules/events/events.js"),n=r.n(i),s=r(/*! ../utils/logger.js */"./src/utils/logger.js"),a=r(/*! ../utils/browser.js */"./src/utils/browser.js"),o=r(/*! ./media-info.js */"./src/core/media-info.js"),l=r(/*! ../demux/flv-demuxer.js */"./src/demux/flv-demuxer.js"),c=r(/*! ../remux/mp4-remuxer.js */"./src/remux/mp4-remuxer.js"),d=r(/*! ../demux/demux-errors.js */"./src/demux/demux-errors.js"),u=r(/*! ../io/io-controller.js */"./src/io/io-controller.js"),h=r(/*! ./transmuxing-events.js */"./src/core/transmuxing-events.js"),f=function(){function e(e,t){this.TAG="TransmuxingController",this._emitter=new(n()),this._config=t,e.segments||(e.segments=[{duration:e.duration,filesize:e.filesize,url:e.url}]),"boolean"!=typeof e.cors&&(e.cors=!0),"boolean"!=typeof e.withCredentials&&(e.withCredentials=!1),this._mediaDataSource=e,this._currentSegmentIndex=0;var r=0;this._mediaDataSource.segments.forEach((function(i){i.timestampBase=r,r+=i.duration,i.cors=e.cors,i.withCredentials=e.withCredentials,t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy)})),isNaN(r)||this._mediaDataSource.duration===r||(this._mediaDataSource.duration=r),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return e.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},e.prototype._loadSegment=function(e,t){this._currentSegmentIndex=e;var r=this._mediaDataSource.segments[e],i=this._ioctl=new u.default(r,this._config,e);i.onError=this._onIOException.bind(this),i.onSeeked=this._onIOSeeked.bind(this),i.onComplete=this._onIOComplete.bind(this),i.onRedirect=this._onIORedirect.bind(this),i.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),t?this._demuxer.bindDataSource(this._ioctl):i.onDataArrival=this._onInitChunkArrival.bind(this),i.open(t)},e.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},e.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},e.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},e.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},e.prototype.seek=function(e){if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var t=this._searchSegmentIndexContains(e);if(t===this._currentSegmentIndex){var r=this._mediaInfo.segments[t];if(null==r)this._pendingSeekTime=e;else{var i=r.getNearestKeyframe(e);this._remuxer.seek(i.milliseconds),this._ioctl.seek(i.fileposition),this._pendingResolveSeekPoint=i.milliseconds}}else{var n=this._mediaInfo.segments[t];null==n?(this._pendingSeekTime=e,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(t)):(i=n.getNearestKeyframe(e),this._internalAbort(),this._remuxer.seek(e),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[t].timestampBase,this._loadSegment(t,i.fileposition),this._pendingResolveSeekPoint=i.milliseconds,this._reportSegmentMediaInfo(t))}this._enableStatisticsReporter()}},e.prototype._searchSegmentIndexContains=function(e){for(var t=this._mediaDataSource.segments,r=t.length-1,i=0;i<t.length;i++)if(e<t[i].timestampBase){r=i-1;break}return r},e.prototype._onInitChunkArrival=function(e,t){var r=this,i=null,n=0;if(t>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,n=this._demuxer.parseChunks(e,t);else if((i=l.default.probe(e)).match){this._demuxer=new l.default(i,this._config),this._remuxer||(this._remuxer=new c.default(this._config));var a=this._mediaDataSource;null==a.duration||isNaN(a.duration)||(this._demuxer.overridedDuration=a.duration),"boolean"==typeof a.hasAudio&&(this._demuxer.overridedHasAudio=a.hasAudio),"boolean"==typeof a.hasVideo&&(this._demuxer.overridedHasVideo=a.hasVideo),this._demuxer.timestampBase=a.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),n=this._demuxer.parseChunks(e,t)}else i=null,s.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then((function(){r._internalAbort()})),this._emitter.emit(h.default.DEMUX_ERROR,d.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),n=0;return n},e.prototype._onMediaInfo=function(e){var t=this;null==this._mediaInfo&&(this._mediaInfo=Object.assign({},e),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,o.default.prototype));var r=Object.assign({},e);Object.setPrototypeOf(r,o.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=r,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then((function(){var e=t._pendingSeekTime;t._pendingSeekTime=null,t.seek(e)}))},e.prototype._onMetaDataArrived=function(e){this._emitter.emit(h.default.METADATA_ARRIVED,e)},e.prototype._onScriptDataArrived=function(e){this._emitter.emit(h.default.SCRIPTDATA_ARRIVED,e)},e.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},e.prototype._onIOComplete=function(e){var t=e+1;t<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(t)):(this._remuxer.flushStashedSamples(),this._emitter.emit(h.default.LOADING_COMPLETE),this._disableStatisticsReporter())},e.prototype._onIORedirect=function(e){var t=this._ioctl.extraData;this._mediaDataSource.segments[t].redirectedURL=e},e.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(h.default.RECOVERED_EARLY_EOF)},e.prototype._onIOException=function(e,t){s.default.e(this.TAG,"IOException: type = "+e+", code = "+t.code+", msg = "+t.msg),this._emitter.emit(h.default.IO_ERROR,e,t),this._disableStatisticsReporter()},e.prototype._onDemuxException=function(e,t){s.default.e(this.TAG,"DemuxException: type = "+e+", info = "+t),this._emitter.emit(h.default.DEMUX_ERROR,e,t)},e.prototype._onRemuxerInitSegmentArrival=function(e,t){this._emitter.emit(h.default.INIT_SEGMENT,e,t)},e.prototype._onRemuxerMediaSegmentArrival=function(e,t){if(null==this._pendingSeekTime&&(this._emitter.emit(h.default.MEDIA_SEGMENT,e,t),null!=this._pendingResolveSeekPoint&&"video"===e)){var r=t.info.syncPoints,i=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,a.default.safari&&r.length>0&&r[0].originalDts===i&&(i=r[0].pts),this._emitter.emit(h.default.RECOMMEND_SEEKPOINT,i)}},e.prototype._enableStatisticsReporter=function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},e.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype._reportSegmentMediaInfo=function(e){var t=this._mediaInfo.segments[e],r=Object.assign({},t);r.duration=this._mediaInfo.duration,r.segmentCount=this._mediaInfo.segmentCount,delete r.segments,delete r.keyframesIndex,this._emitter.emit(h.default.MEDIA_INFO,r)},e.prototype._reportStatisticsInfo=function(){var e={};e.url=this._ioctl.currentURL,e.hasRedirect=this._ioctl.hasRedirect,e.hasRedirect&&(e.redirectedURL=this._ioctl.currentRedirectedURL),e.speed=this._ioctl.currentSpeed,e.loaderType=this._ioctl.loaderType,e.currentSegmentIndex=this._currentSegmentIndex,e.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(h.default.STATISTICS_INFO,e)},e}();t.default=f},"./src/core/transmuxing-events.js":
/*!****************************************!*\
    !*** ./src/core/transmuxing-events.js ***!
    \****************************************/function(e,t,r){r.r(t),t.default={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"}},"./src/core/transmuxing-worker.js":
/*!****************************************!*\
    !*** ./src/core/transmuxing-worker.js ***!
    \****************************************/function(e,t,r){r.r(t);var i=r(/*! ../utils/logging-control.js */"./src/utils/logging-control.js"),n=r(/*! ../utils/polyfill.js */"./src/utils/polyfill.js"),s=r(/*! ./transmuxing-controller.js */"./src/core/transmuxing-controller.js"),a=r(/*! ./transmuxing-events.js */"./src/core/transmuxing-events.js");t.default=function(e){var t=null,r=function(t,r){e.postMessage({msg:"logcat_callback",data:{type:t,logcat:r}})}.bind(this);function o(t,r){var i={msg:a.default.INIT_SEGMENT,data:{type:t,data:r}};e.postMessage(i,[r.data])}function l(t,r){var i={msg:a.default.MEDIA_SEGMENT,data:{type:t,data:r}};e.postMessage(i,[r.data])}function c(){var t={msg:a.default.LOADING_COMPLETE};e.postMessage(t)}function d(){var t={msg:a.default.RECOVERED_EARLY_EOF};e.postMessage(t)}function u(t){var r={msg:a.default.MEDIA_INFO,data:t};e.postMessage(r)}function h(t){var r={msg:a.default.METADATA_ARRIVED,data:t};e.postMessage(r)}function f(t){var r={msg:a.default.SCRIPTDATA_ARRIVED,data:t};e.postMessage(r)}function p(t){var r={msg:a.default.STATISTICS_INFO,data:t};e.postMessage(r)}function m(t,r){e.postMessage({msg:a.default.IO_ERROR,data:{type:t,info:r}})}function g(t,r){e.postMessage({msg:a.default.DEMUX_ERROR,data:{type:t,info:r}})}function y(t){e.postMessage({msg:a.default.RECOMMEND_SEEKPOINT,data:t})}n.default.install(),e.addEventListener("message",(function(n){switch(n.data.cmd){case"init":(t=new s.default(n.data.param[0],n.data.param[1])).on(a.default.IO_ERROR,m.bind(this)),t.on(a.default.DEMUX_ERROR,g.bind(this)),t.on(a.default.INIT_SEGMENT,o.bind(this)),t.on(a.default.MEDIA_SEGMENT,l.bind(this)),t.on(a.default.LOADING_COMPLETE,c.bind(this)),t.on(a.default.RECOVERED_EARLY_EOF,d.bind(this)),t.on(a.default.MEDIA_INFO,u.bind(this)),t.on(a.default.METADATA_ARRIVED,h.bind(this)),t.on(a.default.SCRIPTDATA_ARRIVED,f.bind(this)),t.on(a.default.STATISTICS_INFO,p.bind(this)),t.on(a.default.RECOMMEND_SEEKPOINT,y.bind(this));break;case"destroy":t&&(t.destroy(),t=null),e.postMessage({msg:"destroyed"});break;case"start":t.start();break;case"stop":t.stop();break;case"seek":t.seek(n.data.param);break;case"pause":t.pause();break;case"resume":t.resume();break;case"logging_config":var _=n.data.param;i.default.applyConfig(_),!0===_.enableCallback?i.default.addLogListener(r):i.default.removeLogListener(r)}}))}},"./src/demux/amf-parser.js":
/*!*********************************!*\
    !*** ./src/demux/amf-parser.js ***!
    \*********************************/function(e,t,r){r.r(t);var i,n=r(/*! ../utils/logger.js */"./src/utils/logger.js"),s=r(/*! ../utils/utf8-conv.js */"./src/utils/utf8-conv.js"),a=r(/*! ../utils/exception.js */"./src/utils/exception.js"),o=(i=new ArrayBuffer(2),new DataView(i).setInt16(0,256,!0),256===new Int16Array(i)[0]),l=function(){function e(){}return e.parseScriptData=function(t,r,i){var s={};try{var a=e.parseValue(t,r,i),o=e.parseValue(t,r+a.size,i-a.size);s[a.data]=o.data}catch(l){n.default.e("AMF",l.toString())}return s},e.parseObject=function(t,r,i){if(i<3)throw new a.IllegalStateException("Data not enough when parse ScriptDataObject");var n=e.parseString(t,r,i),s=e.parseValue(t,r+n.size,i-n.size),o=s.objectEnd;return{data:{name:n.data,value:s.data},size:n.size+s.size,objectEnd:o}},e.parseVariable=function(t,r,i){return e.parseObject(t,r,i)},e.parseString=function(e,t,r){if(r<2)throw new a.IllegalStateException("Data not enough when parse String");var i=new DataView(e,t,r).getUint16(0,!o);return{data:i>0?(0,s.default)(new Uint8Array(e,t+2,i)):"",size:2+i}},e.parseLongString=function(e,t,r){if(r<4)throw new a.IllegalStateException("Data not enough when parse LongString");var i=new DataView(e,t,r).getUint32(0,!o);return{data:i>0?(0,s.default)(new Uint8Array(e,t+4,i)):"",size:4+i}},e.parseDate=function(e,t,r){if(r<10)throw new a.IllegalStateException("Data size invalid when parse Date");var i=new DataView(e,t,r),n=i.getFloat64(0,!o),s=i.getInt16(8,!o);return{data:new Date(n+=60*s*1e3),size:10}},e.parseValue=function(t,r,i){if(i<1)throw new a.IllegalStateException("Data not enough when parse Value");var s,l=new DataView(t,r,i),c=1,d=l.getUint8(0),u=!1;try{switch(d){case 0:s=l.getFloat64(1,!o),c+=8;break;case 1:s=!!l.getUint8(1),c+=1;break;case 2:var h=e.parseString(t,r+1,i-1);s=h.data,c+=h.size;break;case 3:s={};var f=0;for(9==(16777215&l.getUint32(i-4,!o))&&(f=3);c<i-4;){var p=e.parseObject(t,r+c,i-c-f);if(p.objectEnd)break;s[p.data.name]=p.data.value,c+=p.size}c<=i-3&&9==(16777215&l.getUint32(c-1,!o))&&(c+=3);break;case 8:for(s={},c+=4,f=0,9==(16777215&l.getUint32(i-4,!o))&&(f=3);c<i-8;){var m=e.parseVariable(t,r+c,i-c-f);if(m.objectEnd)break;s[m.data.name]=m.data.value,c+=m.size}c<=i-3&&9==(16777215&l.getUint32(c-1,!o))&&(c+=3);break;case 9:s=void 0,c=1,u=!0;break;case 10:s=[];var g=l.getUint32(1,!o);c+=4;for(var y=0;y<g;y++){var _=e.parseValue(t,r+c,i-c);s.push(_.data),c+=_.size}break;case 11:var v=e.parseDate(t,r+1,i-1);s=v.data,c+=v.size;break;case 12:var E=e.parseString(t,r+1,i-1);s=E.data,c+=E.size;break;default:c=i,n.default.w("AMF","Unsupported AMF value type "+d)}}catch(S){n.default.e("AMF",S.toString())}return{data:s,size:c,objectEnd:u}},e}();t.default=l},"./src/demux/demux-errors.js":
/*!***********************************!*\
    !*** ./src/demux/demux-errors.js ***!
    \***********************************/function(e,t,r){r.r(t),t.default={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},"./src/demux/exp-golomb.js":
/*!*********************************!*\
    !*** ./src/demux/exp-golomb.js ***!
    \*********************************/function(e,t,r){r.r(t);var i=r(/*! ../utils/exception.js */"./src/utils/exception.js"),n=function(){function e(e){this.TAG="ExpGolomb",this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}return e.prototype.destroy=function(){this._buffer=null},e.prototype._fillCurrentWord=function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new i.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),r=new Uint8Array(4);r.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(r.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t},e.prototype.readBits=function(e){if(e>32)throw new i.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var r=this._current_word_bits_left?this._current_word:0;r>>>=32-this._current_word_bits_left;var n=e-this._current_word_bits_left;this._fillCurrentWord();var s=Math.min(n,this._current_word_bits_left),a=this._current_word>>>32-s;return this._current_word<<=s,this._current_word_bits_left-=s,r=r<<s|a},e.prototype.readBool=function(){return 1===this.readBits(1)},e.prototype.readByte=function(){return this.readBits(8)},e.prototype._skipLeadingZero=function(){var e;for(e=0;e<this._current_word_bits_left;e++)if(this._current_word&2147483648>>>e)return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()},e.prototype.readUEG=function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1},e.prototype.readSEG=function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)},e}();t.default=n},"./src/demux/flv-demuxer.js":
/*!**********************************!*\
    !*** ./src/demux/flv-demuxer.js ***!
    \**********************************/function(e,t,r){r.r(t);var i=r(/*! ../utils/logger.js */"./src/utils/logger.js"),n=r(/*! ./amf-parser.js */"./src/demux/amf-parser.js"),s=r(/*! ./sps-parser.js */"./src/demux/sps-parser.js"),a=r(/*! ./demux-errors.js */"./src/demux/demux-errors.js"),o=r(/*! ../core/media-info.js */"./src/core/media-info.js"),l=r(/*! ../utils/exception.js */"./src/utils/exception.js"),c=function(){function e(e,t){var r;this.TAG="FLVDemuxer",this._config=t,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=e.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=e.hasAudioTrack,this._hasVideo=e.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new o.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=(r=new ArrayBuffer(2),new DataView(r).setInt16(0,256,!0),256===new Int16Array(r)[0])}return e.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},e.probe=function(e){var t=new Uint8Array(e),r={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return r;var i=(4&t[4])>>>2!=0,n=!!(1&t[4]),s=function(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}(t,5);return s<9?r:{match:!0,consumed:s,dataOffset:s,hasAudioTrack:i,hasVideoTrack:n}},e.prototype.bindDataSource=function(e){return e.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(e.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(e){this._timestampBase=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedDuration",{get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasAudio",{set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasVideo",{set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e},enumerable:!1,configurable:!0}),e.prototype.resetMediaInfo=function(){this._mediaInfo=new o.default},e.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},e.prototype.parseChunks=function(t,r){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new l.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var n=0,s=this._littleEndian;if(0===r){if(!(t.byteLength>13))return 0;n=e.probe(t).dataOffset}for(this._firstParse&&(this._firstParse=!1,r+n!==this._dataOffset&&i.default.w(this.TAG,"First time parsing but chunk byteStart invalid!"),0!==(a=new DataView(t,n)).getUint32(0,!s)&&i.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),n+=4);n<t.byteLength;){this._dispatch=!0;var a=new DataView(t,n);if(n+11+4>t.byteLength)break;var o=a.getUint8(0),c=16777215&a.getUint32(0,!s);if(n+11+c+4>t.byteLength)break;if(8===o||9===o||18===o){var d=a.getUint8(4),u=a.getUint8(5),h=a.getUint8(6)|u<<8|d<<16|a.getUint8(7)<<24;16777215&a.getUint32(7,!s)&&i.default.w(this.TAG,"Meet tag which has StreamID != 0!");var f=n+11;switch(o){case 8:this._parseAudioData(t,f,c,h);break;case 9:this._parseVideoData(t,f,c,h,r+n);break;case 18:this._parseScriptData(t,f,c)}var p=a.getUint32(11+c,!s);p!==11+c&&i.default.w(this.TAG,"Invalid PrevTagSize "+p),n+=11+c+4}else i.default.w(this.TAG,"Unsupported tag type "+o+", skipped"),n+=11+c+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),n},e.prototype._parseScriptData=function(e,t,r){var s=n.default.parseScriptData(e,t,r);if(s.hasOwnProperty("onMetaData")){if(null==s.onMetaData||"object"!=typeof s.onMetaData)return void i.default.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&i.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=s;var a=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},a)),"boolean"==typeof a.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=a.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof a.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=a.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof a.audiodatarate&&(this._mediaInfo.audioDataRate=a.audiodatarate),"number"==typeof a.videodatarate&&(this._mediaInfo.videoDataRate=a.videodatarate),"number"==typeof a.width&&(this._mediaInfo.width=a.width),"number"==typeof a.height&&(this._mediaInfo.height=a.height),"number"==typeof a.duration){if(!this._durationOverrided){var o=Math.floor(a.duration*this._timescale);this._duration=o,this._mediaInfo.duration=o}}else this._mediaInfo.duration=0;if("number"==typeof a.framerate){var l=Math.floor(1e3*a.framerate);if(l>0){var c=l/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=c,this._referenceFrameRate.fps_num=l,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=c}}if("object"==typeof a.keyframes){this._mediaInfo.hasKeyframesIndex=!0;var d=a.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(d),a.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=a,i.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(s).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},s))},e.prototype._parseKeyframesIndex=function(e){for(var t=[],r=[],i=1;i<e.times.length;i++){var n=this._timestampBase+Math.floor(1e3*e.times[i]);t.push(n),r.push(e.filepositions[i])}return{times:t,filepositions:r}},e.prototype._parseAudioData=function(e,t,r,n){if(r<=1)i.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){this._littleEndian;var s=new DataView(e,t,r).getUint8(0),o=s>>>4;if(2===o||10===o){var l=0,c=(12&s)>>>2;if(c>=0&&c<=4){l=this._flvSoundRateTable[c];var d=1&s,u=this._audioMetadata,h=this._audioTrack;if(u||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(u=this._audioMetadata={}).type="audio",u.id=h.id,u.timescale=this._timescale,u.duration=this._duration,u.audioSampleRate=l,u.channelCount=0===d?1:2),10===o){var f=this._parseAACAudioData(e,t+1,r-1);if(null==f)return;if(0===f.packetType){u.config&&i.default.w(this.TAG,"Found another AudioSpecificConfig!");var p=f.data;u.audioSampleRate=p.samplingRate,u.channelCount=p.channelCount,u.codec=p.codec,u.originalCodec=p.originalCodec,u.config=p.config,u.refSampleDuration=1024/u.audioSampleRate*u.timescale,i.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",u),(y=this._mediaInfo).audioCodec=u.originalCodec,y.audioSampleRate=u.audioSampleRate,y.audioChannelCount=u.channelCount,y.hasVideo?null!=y.videoCodec&&(y.mimeType='video/x-flv; codecs="'+y.videoCodec+","+y.audioCodec+'"'):y.mimeType='video/x-flv; codecs="'+y.audioCodec+'"',y.isComplete()&&this._onMediaInfo(y)}else if(1===f.packetType){var m=this._timestampBase+n,g={unit:f.data,length:f.data.byteLength,dts:m,pts:m};h.samples.push(g),h.length+=f.data.length}else i.default.e(this.TAG,"Flv: Unsupported AAC data type "+f.packetType)}else if(2===o){if(!u.codec){var y;if(null==(p=this._parseMP3AudioData(e,t+1,r-1,!0)))return;u.audioSampleRate=p.samplingRate,u.channelCount=p.channelCount,u.codec=p.codec,u.originalCodec=p.originalCodec,u.refSampleDuration=1152/u.audioSampleRate*u.timescale,i.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",u),(y=this._mediaInfo).audioCodec=u.codec,y.audioSampleRate=u.audioSampleRate,y.audioChannelCount=u.channelCount,y.audioDataRate=p.bitRate,y.hasVideo?null!=y.videoCodec&&(y.mimeType='video/x-flv; codecs="'+y.videoCodec+","+y.audioCodec+'"'):y.mimeType='video/x-flv; codecs="'+y.audioCodec+'"',y.isComplete()&&this._onMediaInfo(y)}var _=this._parseMP3AudioData(e,t+1,r-1,!1);if(null==_)return;m=this._timestampBase+n;var v={unit:_,length:_.byteLength,dts:m,pts:m};h.samples.push(v),h.length+=_.length}}else this._onError(a.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+c)}else this._onError(a.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+o)}},e.prototype._parseAACAudioData=function(e,t,r){if(!(r<=1)){var n={},s=new Uint8Array(e,t,r);return n.packetType=s[0],0===s[0]?n.data=this._parseAACAudioSpecificConfig(e,t+1,r-1):n.data=s.subarray(1),n}i.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},e.prototype._parseAACAudioSpecificConfig=function(e,t,r){var i,n,s=new Uint8Array(e,t,r),o=null,l=0,c=null;if(l=i=s[0]>>>3,(n=(7&s[0])<<1|s[1]>>>7)<0||n>=this._mpegSamplingRates.length)this._onError(a.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var d=this._mpegSamplingRates[n],u=(120&s[1])>>>3;if(!(u<0||u>=8)){5===l&&(c=(7&s[1])<<1|s[2]>>>7,s[2]);var h=self.navigator.userAgent.toLowerCase();return-1!==h.indexOf("firefox")?n>=6?(l=5,o=new Array(4),c=n-3):(l=2,o=new Array(2),c=n):-1!==h.indexOf("android")?(l=2,o=new Array(2),c=n):(l=5,c=n,o=new Array(4),n>=6?c=n-3:1===u&&(l=2,o=new Array(2),c=n)),o[0]=l<<3,o[0]|=(15&n)>>>1,o[1]=(15&n)<<7,o[1]|=(15&u)<<3,5===l&&(o[1]|=(15&c)>>>1,o[2]=(1&c)<<7,o[2]|=8,o[3]=0),{config:o,samplingRate:d,channelCount:u,codec:"mp4a.40."+l,originalCodec:"mp4a.40."+i}}this._onError(a.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},e.prototype._parseMP3AudioData=function(e,t,r,n){if(!(r<4)){this._littleEndian;var s=new Uint8Array(e,t,r),a=null;if(n){if(255!==s[0])return;var o=s[1]>>>3&3,l=(6&s[1])>>1,c=(240&s[2])>>>4,d=(12&s[2])>>>2,u=3&~(s[3]>>>6)?2:1,h=0,f=0;switch(o){case 0:h=this._mpegAudioV25SampleRateTable[d];break;case 2:h=this._mpegAudioV20SampleRateTable[d];break;case 3:h=this._mpegAudioV10SampleRateTable[d]}switch(l){case 1:c<this._mpegAudioL3BitRateTable.length&&(f=this._mpegAudioL3BitRateTable[c]);break;case 2:c<this._mpegAudioL2BitRateTable.length&&(f=this._mpegAudioL2BitRateTable[c]);break;case 3:c<this._mpegAudioL1BitRateTable.length&&(f=this._mpegAudioL1BitRateTable[c])}a={bitRate:f,samplingRate:h,channelCount:u,codec:"mp3",originalCodec:"mp3"}}else a=s;return a}i.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},e.prototype._parseVideoData=function(e,t,r,n,s){if(r<=1)i.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var o=new Uint8Array(e,t,r)[0],l=(240&o)>>>4,c=15&o;7===c?this._parseAVCVideoPacket(e,t+1,r-1,n,s,l):this._onError(a.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+c)}},e.prototype._parseAVCVideoPacket=function(e,t,r,n,s,o){if(r<4)i.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var l=this._littleEndian,c=new DataView(e,t,r),d=c.getUint8(0),u=(16777215&c.getUint32(0,!l))<<8>>8;if(0===d)this._parseAVCDecoderConfigurationRecord(e,t+4,r-4);else if(1===d)this._parseAVCVideoData(e,t+4,r-4,n,s,o,u);else if(2!==d)return void this._onError(a.default.FORMAT_ERROR,"Flv: Invalid video packet type "+d)}},e.prototype._parseAVCDecoderConfigurationRecord=function(e,t,r){if(r<7)i.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var n=this._videoMetadata,o=this._videoTrack,l=this._littleEndian,c=new DataView(e,t,r);n?void 0!==n.avcc&&i.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(n=this._videoMetadata={}).type="video",n.id=o.id,n.timescale=this._timescale,n.duration=this._duration);var d=c.getUint8(0),u=c.getUint8(1);if(c.getUint8(2),c.getUint8(3),1===d&&0!==u)if(this._naluLengthSize=1+(3&c.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var h=31&c.getUint8(5);if(0!==h){h>1&&i.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+h);for(var f=6,p=0;p<h;p++){var m=c.getUint16(f,!l);if(f+=2,0!==m){var g=new Uint8Array(e,t+f,m);f+=m;var y=s.default.parseSPS(g);if(0===p){n.codecWidth=y.codec_size.width,n.codecHeight=y.codec_size.height,n.presentWidth=y.present_size.width,n.presentHeight=y.present_size.height,n.profile=y.profile_string,n.level=y.level_string,n.bitDepth=y.bit_depth,n.chromaFormat=y.chroma_format,n.sarRatio=y.sar_ratio,n.frameRate=y.frame_rate,!1!==y.frame_rate.fixed&&0!==y.frame_rate.fps_num&&0!==y.frame_rate.fps_den||(n.frameRate=this._referenceFrameRate);var _=n.frameRate.fps_den,v=n.frameRate.fps_num;n.refSampleDuration=n.timescale*(_/v);for(var E=g.subarray(1,4),S="avc1.",T=0;T<3;T++){var b=E[T].toString(16);b.length<2&&(b="0"+b),S+=b}n.codec=S;var R=this._mediaInfo;R.width=n.codecWidth,R.height=n.codecHeight,R.fps=n.frameRate.fps,R.profile=n.profile,R.level=n.level,R.refFrames=y.ref_frames,R.chromaFormat=y.chroma_format_string,R.sarNum=n.sarRatio.width,R.sarDen=n.sarRatio.height,R.videoCodec=S,R.hasAudio?null!=R.audioCodec&&(R.mimeType='video/x-flv; codecs="'+R.videoCodec+","+R.audioCodec+'"'):R.mimeType='video/x-flv; codecs="'+R.videoCodec+'"',R.isComplete()&&this._onMediaInfo(R)}}}var w=c.getUint8(f);if(0!==w){for(w>1&&i.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+w),f++,p=0;p<w;p++)m=c.getUint16(f,!l),f+=2,0!==m&&(f+=m);n.avcc=new Uint8Array(r),n.avcc.set(new Uint8Array(e,t,r),0),i.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",n)}else this._onError(a.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(a.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(a.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(a.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},e.prototype._parseAVCVideoData=function(e,t,r,n,s,a,o){for(var l=this._littleEndian,c=new DataView(e,t,r),d=[],u=0,h=0,f=this._naluLengthSize,p=this._timestampBase+n,m=1===a;h<r;){if(h+4>=r){i.default.w(this.TAG,"Malformed Nalu near timestamp "+p+", offset = "+h+", dataSize = "+r);break}var g=c.getUint32(h,!l);if(3===f&&(g>>>=8),g>r-f)return void i.default.w(this.TAG,"Malformed Nalus near timestamp "+p+", NaluSize > DataSize!");var y=31&c.getUint8(h+f);5===y&&(m=!0);var _=new Uint8Array(e,t+h,f+g),v={type:y,data:_};d.push(v),u+=_.byteLength,h+=f+g}if(d.length){var E=this._videoTrack,S={units:d,length:u,isKeyframe:m,dts:p,cts:o,pts:p+o};m&&(S.fileposition=s),E.samples.push(S),E.length+=u}},e}();t.default=c},"./src/demux/sps-parser.js":
/*!*********************************!*\
    !*** ./src/demux/sps-parser.js ***!
    \*********************************/function(e,t,r){r.r(t);var i=r(/*! ./exp-golomb.js */"./src/demux/exp-golomb.js"),n=function(){function e(){}return e._ebsp2rbsp=function(e){for(var t=e,r=t.byteLength,i=new Uint8Array(r),n=0,s=0;s<r;s++)s>=2&&3===t[s]&&0===t[s-1]&&0===t[s-2]||(i[n]=t[s],n++);return new Uint8Array(i.buffer,0,n)},e.parseSPS=function(t){var r=e._ebsp2rbsp(t),n=new i.default(r);n.readByte();var s=n.readByte();n.readByte();var a=n.readByte();n.readUEG();var o=e.getProfileString(s),l=e.getLevelString(a),c=1,d=420,u=8;if((100===s||110===s||122===s||244===s||44===s||83===s||86===s||118===s||128===s||138===s||144===s)&&(3===(c=n.readUEG())&&n.readBits(1),c<=3&&(d=[0,420,422,444][c]),u=n.readUEG()+8,n.readUEG(),n.readBits(1),n.readBool()))for(var h=3!==c?8:12,f=0;f<h;f++)n.readBool()&&(f<6?e._skipScalingList(n,16):e._skipScalingList(n,64));n.readUEG();var p=n.readUEG();if(0===p)n.readUEG();else if(1===p){n.readBits(1),n.readSEG(),n.readSEG();var m=n.readUEG();for(f=0;f<m;f++)n.readSEG()}var g=n.readUEG();n.readBits(1);var y=n.readUEG(),_=n.readUEG(),v=n.readBits(1);0===v&&n.readBits(1),n.readBits(1);var E=0,S=0,T=0,b=0;n.readBool()&&(E=n.readUEG(),S=n.readUEG(),T=n.readUEG(),b=n.readUEG());var R=1,w=1,A=0,L=!0,C=0,I=0;if(n.readBool()){if(n.readBool()){var k=n.readByte();k>0&&k<16?(R=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][k-1],w=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][k-1]):255===k&&(R=n.readByte()<<8|n.readByte(),w=n.readByte()<<8|n.readByte())}if(n.readBool()&&n.readBool(),n.readBool()&&(n.readBits(4),n.readBool()&&n.readBits(24)),n.readBool()&&(n.readUEG(),n.readUEG()),n.readBool()){var D=n.readBits(32),P=n.readBits(32);L=n.readBool(),A=(C=P)/(I=2*D)}}var O=1;1===R&&1===w||(O=R/w);var x=0,M=0;0===c?(x=1,M=2-v):(x=3===c?1:2,M=(1===c?2:1)*(2-v));var N=16*(y+1),F=16*(_+1)*(2-v);N-=(E+S)*x,F-=(T+b)*M;var U=Math.ceil(N*O);return n.destroy(),n=null,{profile_string:o,level_string:l,bit_depth:u,ref_frames:g,chroma_format:d,chroma_format_string:e.getChromaFormatString(d),frame_rate:{fixed:L,fps:A,fps_den:I,fps_num:C},sar_ratio:{width:R,height:w},codec_size:{width:N,height:F},present_size:{width:U,height:F}}},e._skipScalingList=function(e,t){for(var r=8,i=8,n=0;n<t;n++)0!==i&&(i=(r+e.readSEG()+256)%256),r=0===i?r:i},e.getProfileString=function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},e.getLevelString=function(e){return(e/10).toFixed(1)},e.getChromaFormatString=function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},e}();t.default=n},"./src/flv.js":
/*!********************!*\
    !*** ./src/flv.js ***!
    \********************/function(e,t,r){r.r(t);var i=r(/*! ./utils/polyfill.js */"./src/utils/polyfill.js"),n=r(/*! ./core/features.js */"./src/core/features.js"),s=r(/*! ./io/loader.js */"./src/io/loader.js"),a=r(/*! ./player/flv-player.js */"./src/player/flv-player.js"),o=r(/*! ./player/native-player.js */"./src/player/native-player.js"),l=r(/*! ./player/player-events.js */"./src/player/player-events.js"),c=r(/*! ./player/player-errors.js */"./src/player/player-errors.js"),d=r(/*! ./utils/logging-control.js */"./src/utils/logging-control.js"),u=r(/*! ./utils/exception.js */"./src/utils/exception.js");i.default.install();var h={createPlayer:function(e,t){var r=e;if(null==r||"object"!=typeof r)throw new u.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!r.hasOwnProperty("type"))throw new u.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");return"flv"===r.type?new a.default(r,t):new o.default(r,t)},isSupported:function(){return n.default.supportMSEH264Playback()},getFeatureList:function(){return n.default.getFeatureList()}};h.BaseLoader=s.BaseLoader,h.LoaderStatus=s.LoaderStatus,h.LoaderErrors=s.LoaderErrors,h.Events=l.default,h.ErrorTypes=c.ErrorTypes,h.ErrorDetails=c.ErrorDetails,h.FlvPlayer=a.default,h.NativePlayer=o.default,h.LoggingControl=d.default,Object.defineProperty(h,"version",{enumerable:!0,get:function(){return"1.6.2"}}),t.default=h},"./src/index.js":
/*!**********************!*\
    !*** ./src/index.js ***!
    \**********************/function(e,t,r){e.exports=r(/*! ./flv.js */"./src/flv.js").default},"./src/io/fetch-stream-loader.js":
/*!***************************************!*\
    !*** ./src/io/fetch-stream-loader.js ***!
    \***************************************/function(e,t,r){r.r(t);var i,n=r(/*! ../utils/browser.js */"./src/utils/browser.js"),s=r(/*! ./loader.js */"./src/io/loader.js"),a=r(/*! ../utils/exception.js */"./src/utils/exception.js"),o=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),l=function(e){function t(t,r){var i=e.call(this,"fetch-stream-loader")||this;return i.TAG="FetchStreamLoader",i._seekHandler=t,i._config=r,i._needStash=!0,i._requestAbort=!1,i._contentLength=null,i._receivedLength=0,i}return o(t,e),t.isSupported=function(){try{var e=n.default.msedge&&n.default.version.minor>=15048,t=!n.default.msedge||e;return self.fetch&&self.ReadableStream&&t}catch(r){return!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),e.prototype.destroy.call(this)},t.prototype.open=function(e,t){var r=this;this._dataSource=e,this._range=t;var i=e.url;this._config.reuseRedirectedURL&&null!=e.redirectedURL&&(i=e.redirectedURL);var n=this._seekHandler.getConfig(i,t),o=new self.Headers;if("object"==typeof n.headers){var l=n.headers;for(var c in l)l.hasOwnProperty(c)&&o.append(c,l[c])}var d={method:"GET",headers:o,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"==typeof this._config.headers)for(var c in this._config.headers)o.append(c,this._config.headers[c]);!1===e.cors&&(d.mode="same-origin"),e.withCredentials&&(d.credentials="include"),e.referrerPolicy&&(d.referrerPolicy=e.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,d.signal=this._abortController.signal),this._status=s.LoaderStatus.kConnecting,self.fetch(n.url,d).then((function(e){if(r._requestAbort)return r._status=s.LoaderStatus.kIdle,void e.body.cancel();if(e.ok&&e.status>=200&&e.status<=299){if(e.url!==n.url&&r._onURLRedirect){var t=r._seekHandler.removeURLParameters(e.url);r._onURLRedirect(t)}var i=e.headers.get("Content-Length");return null!=i&&(r._contentLength=parseInt(i),0!==r._contentLength&&r._onContentLengthKnown&&r._onContentLengthKnown(r._contentLength)),r._pump.call(r,e.body.getReader())}if(r._status=s.LoaderStatus.kError,!r._onError)throw new a.RuntimeException("FetchStreamLoader: Http code invalid, "+e.status+" "+e.statusText);r._onError(s.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})})).catch((function(e){if(!r._abortController||!r._abortController.signal.aborted){if(r._status=s.LoaderStatus.kError,!r._onError)throw e;r._onError(s.LoaderErrors.EXCEPTION,{code:-1,msg:e.message})}}))},t.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==s.LoaderStatus.kBuffering||!n.default.chrome)&&this._abortController)try{this._abortController.abort()}catch(e){}},t.prototype._pump=function(e){var t=this;return e.read().then((function(r){if(r.done)if(null!==t._contentLength&&t._receivedLength<t._contentLength){t._status=s.LoaderStatus.kError;var i=s.LoaderErrors.EARLY_EOF,n={code:-1,msg:"Fetch stream meet Early-EOF"};if(!t._onError)throw new a.RuntimeException(n.msg);t._onError(i,n)}else t._status=s.LoaderStatus.kComplete,t._onComplete&&t._onComplete(t._range.from,t._range.from+t._receivedLength-1);else{if(t._abortController&&t._abortController.signal.aborted)return void(t._status=s.LoaderStatus.kComplete);if(!0===t._requestAbort)return t._status=s.LoaderStatus.kComplete,e.cancel();t._status=s.LoaderStatus.kBuffering;var o=r.value.buffer,l=t._range.from+t._receivedLength;t._receivedLength+=o.byteLength,t._onDataArrival&&t._onDataArrival(o,l,t._receivedLength),t._pump(e)}})).catch((function(e){if(t._abortController&&t._abortController.signal.aborted)t._status=s.LoaderStatus.kComplete;else if(11!==e.code||!n.default.msedge){t._status=s.LoaderStatus.kError;var r=0,i=null;if(19!==e.code&&"network error"!==e.message||!(null===t._contentLength||null!==t._contentLength&&t._receivedLength<t._contentLength)?(r=s.LoaderErrors.EXCEPTION,i={code:e.code,msg:e.message}):(r=s.LoaderErrors.EARLY_EOF,i={code:e.code,msg:"Fetch stream meet Early-EOF"}),!t._onError)throw new a.RuntimeException(i.msg);t._onError(r,i)}}))},t}(s.BaseLoader);t.default=l},"./src/io/io-controller.js":
/*!*********************************!*\
    !*** ./src/io/io-controller.js ***!
    \*********************************/function(e,t,r){r.r(t);var i=r(/*! ../utils/logger.js */"./src/utils/logger.js"),n=r(/*! ./speed-sampler.js */"./src/io/speed-sampler.js"),s=r(/*! ./loader.js */"./src/io/loader.js"),a=r(/*! ./fetch-stream-loader.js */"./src/io/fetch-stream-loader.js"),o=r(/*! ./xhr-moz-chunked-loader.js */"./src/io/xhr-moz-chunked-loader.js"),l=r(/*! ./xhr-range-loader.js */"./src/io/xhr-range-loader.js"),c=r(/*! ./websocket-loader.js */"./src/io/websocket-loader.js"),d=r(/*! ./range-seek-handler.js */"./src/io/range-seek-handler.js"),u=r(/*! ./param-seek-handler.js */"./src/io/param-seek-handler.js"),h=r(/*! ../utils/exception.js */"./src/utils/exception.js"),f=function(){function e(e,t,r){this.TAG="IOController",this._config=t,this._extraData=r,this._stashInitialSize=393216,null!=t.stashInitialSize&&t.stashInitialSize>0&&(this._stashInitialSize=t.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===t.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=e,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(e.url),this._refTotalLength=e.filesize?e.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new n.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return e.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},e.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},e.prototype.isPaused=function(){return this._paused},Object.defineProperty(e.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extraData",{get:function(){return this._extraData},set:function(e){this._extraData=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(e){this._onSeeked=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(e){this._onRedirect=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(e){this._onRecoveredEarlyEof=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasRedirect",{get:function(){return null!=this._redirectedURL||null!=this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentSpeed",{get:function(){return this._loaderClass===l.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),e.prototype._selectSeekHandler=function(){var e=this._config;if("range"===e.seekType)this._seekHandler=new d.default(this._config.rangeLoadZeroStart);else if("param"===e.seekType){var t=e.seekParamStart||"bstart",r=e.seekParamEnd||"bend";this._seekHandler=new u.default(t,r)}else{if("custom"!==e.seekType)throw new h.InvalidArgumentException("Invalid seekType in config: "+e.seekType);if("function"!=typeof e.customSeekHandler)throw new h.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new e.customSeekHandler}},e.prototype._selectLoader=function(){if(null!=this._config.customLoader)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=c.default;else if(a.default.isSupported())this._loaderClass=a.default;else if(o.default.isSupported())this._loaderClass=o.default;else{if(!l.default.isSupported())throw new h.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=l.default}},e.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},e.prototype.open=function(e){this._currentRange={from:0,to:-1},e&&(this._currentRange.from=e),this._speedSampler.reset(),e||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},e.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},e.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},e.prototype.resume=function(){if(this._paused){this._paused=!1;var e=this._resumeFrom;this._resumeFrom=0,this._internalSeek(e,!0)}},e.prototype.seek=function(e){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(e,!0)},e.prototype._internalSeek=function(e,t){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(t),this._loader.destroy(),this._loader=null;var r={from:e,to:-1};this._currentRange={from:r.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,r),this._onSeeked&&this._onSeeked()},e.prototype.updateUrl=function(e){if(!e||"string"!=typeof e||0===e.length)throw new h.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=e},e.prototype._expandBuffer=function(e){for(var t=this._stashSize;t+1048576<e;)t*=2;if((t+=1048576)!==this._bufferSize){var r=new ArrayBuffer(t);if(this._stashUsed>0){var i=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(r,0,t).set(i,0)}this._stashBuffer=r,this._bufferSize=t}},e.prototype._normalizeSpeed=function(e){var t=this._speedNormalizeList,r=t.length-1,i=0,n=0,s=r;if(e<t[0])return t[0];for(;n<=s;){if((i=n+Math.floor((s-n)/2))===r||e>=t[i]&&e<t[i+1])return t[i];t[i]<e?n=i+1:s=i-1}},e.prototype._adjustStashSize=function(e){var t=0;(t=this._config.isLive||e<512?e:e>=512&&e<=1024?Math.floor(1.5*e):2*e)>8192&&(t=8192);var r=1024*t+1048576;this._bufferSize<r&&this._expandBuffer(r),this._stashSize=1024*t},e.prototype._dispatchChunks=function(e,t){return this._currentRange.to=t+e.byteLength-1,this._onDataArrival(e,t)},e.prototype._onURLRedirect=function(e){this._redirectedURL=e,this._onRedirect&&this._onRedirect(e)},e.prototype._onContentLengthKnown=function(e){e&&this._fullRequestFlag&&(this._totalLength=e,this._fullRequestFlag=!1)},e.prototype._onLoaderChunkArrival=function(e,t,r){if(!this._onDataArrival)throw new h.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(e.byteLength);var i=this._speedSampler.lastSecondKBps;if(0!==i){var n=this._normalizeSpeed(i);this._speedNormalized!==n&&(this._speedNormalized=n,this._adjustStashSize(n))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=t),this._stashUsed+e.byteLength<=this._stashSize)(o=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;else if(o=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var s=this._stashBuffer.slice(0,this._stashUsed);(l=this._dispatchChunks(s,this._stashByteStart))<s.byteLength?l>0&&(c=new Uint8Array(s,l),o.set(c,0),this._stashUsed=c.byteLength,this._stashByteStart+=l):(this._stashUsed=0,this._stashByteStart+=l),this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else(l=this._dispatchChunks(e,t))<e.byteLength&&((a=e.byteLength-l)>this._bufferSize&&(this._expandBuffer(a),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e,l),0),this._stashUsed+=a,this._stashByteStart=t+l);else if(0===this._stashUsed){var a;(l=this._dispatchChunks(e,t))<e.byteLength&&((a=e.byteLength-l)>this._bufferSize&&this._expandBuffer(a),(o=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(e,l),0),this._stashUsed+=a,this._stashByteStart=t+l)}else{var o,l;if(this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength),(o=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength,(l=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&l>0){var c=new Uint8Array(this._stashBuffer,l);o.set(c,0)}this._stashUsed-=l,this._stashByteStart+=l}}},e.prototype._flushStashBuffer=function(e){if(this._stashUsed>0){var t=this._stashBuffer.slice(0,this._stashUsed),r=this._dispatchChunks(t,this._stashByteStart),n=t.byteLength-r;if(r<t.byteLength){if(!e){if(r>0){var s=new Uint8Array(this._stashBuffer,0,this._bufferSize),a=new Uint8Array(t,r);s.set(a,0),this._stashUsed=a.byteLength,this._stashByteStart+=r}return 0}i.default.w(this.TAG,n+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,n}return 0},e.prototype._onLoaderComplete=function(e,t){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},e.prototype._onLoaderError=function(e,t){switch(i.default.e(this.TAG,"Loader error, code = "+t.code+", msg = "+t.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,e=s.LoaderErrors.UNRECOVERABLE_EARLY_EOF),e){case s.LoaderErrors.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var r=this._currentRange.to+1;return void(r<this._totalLength&&(i.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(r,!1)))}e=s.LoaderErrors.UNRECOVERABLE_EARLY_EOF;case s.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case s.LoaderErrors.CONNECTING_TIMEOUT:case s.LoaderErrors.HTTP_STATUS_CODE_INVALID:case s.LoaderErrors.EXCEPTION:}if(!this._onError)throw new h.RuntimeException("IOException: "+t.msg);this._onError(e,t)},e}();t.default=f},"./src/io/loader.js":
/*!**************************!*\
    !*** ./src/io/loader.js ***!
    \**************************/function(e,t,r){r.r(t),r.d(t,{LoaderStatus:function(){return n},LoaderErrors:function(){return s},BaseLoader:function(){return a}});var i=r(/*! ../utils/exception.js */"./src/utils/exception.js"),n={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},s={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},a=function(){function e(e){this._type=e||"undefined",this._status=n.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return e.prototype.destroy=function(){this._status=n.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},e.prototype.isWorking=function(){return this._status===n.kConnecting||this._status===n.kBuffering},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(e){this._onContentLengthKnown=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(e){this._onURLRedirect=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),e.prototype.open=function(e,t){throw new i.NotImplementedException("Unimplemented abstract function!")},e.prototype.abort=function(){throw new i.NotImplementedException("Unimplemented abstract function!")},e}()},"./src/io/param-seek-handler.js":
/*!**************************************!*\
    !*** ./src/io/param-seek-handler.js ***!
    \**************************************/function(e,t,r){r.r(t);var i=function(){function e(e,t){this._startName=e,this._endName=t}return e.prototype.getConfig=function(e,t){var r=e;if(0!==t.from||-1!==t.to){var i=!0;-1===r.indexOf("?")&&(r+="?",i=!1),i&&(r+="&"),r+=this._startName+"="+t.from.toString(),-1!==t.to&&(r+="&"+this._endName+"="+t.to.toString())}return{url:r,headers:{}}},e.prototype.removeURLParameters=function(e){var t=e.split("?")[0],r=void 0,i=e.indexOf("?");-1!==i&&(r=e.substring(i+1));var n="";if(null!=r&&r.length>0)for(var s=r.split("&"),a=0;a<s.length;a++){var o=s[a].split("="),l=a>0;o[0]!==this._startName&&o[0]!==this._endName&&(l&&(n+="&"),n+=s[a])}return 0===n.length?t:t+"?"+n},e}();t.default=i},"./src/io/range-seek-handler.js":
/*!**************************************!*\
    !*** ./src/io/range-seek-handler.js ***!
    \**************************************/function(e,t,r){r.r(t);var i=function(){function e(e){this._zeroStart=e||!1}return e.prototype.getConfig=function(e,t){var r={};if(0!==t.from||-1!==t.to){var i=void 0;i=-1!==t.to?"bytes="+t.from.toString()+"-"+t.to.toString():"bytes="+t.from.toString()+"-",r.Range=i}else this._zeroStart&&(r.Range="bytes=0-");return{url:e,headers:r}},e.prototype.removeURLParameters=function(e){return e},e}();t.default=i},"./src/io/speed-sampler.js":
/*!*********************************!*\
    !*** ./src/io/speed-sampler.js ***!
    \*********************************/function(e,t,r){r.r(t);var i=function(){function e(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return e.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},e.prototype.addBytes=function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())},Object.defineProperty(e.prototype,"currentKBps",{get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0==e&&(e=1),this._intervalBytes/e/1024},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"averageKBps",{get:function(){var e=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/e/1024},enumerable:!1,configurable:!0}),e}();t.default=i},"./src/io/websocket-loader.js":
/*!************************************!*\
    !*** ./src/io/websocket-loader.js ***!
    \************************************/function(e,t,r){r.r(t);var i,n=r(/*! ./loader.js */"./src/io/loader.js"),s=r(/*! ../utils/exception.js */"./src/utils/exception.js"),a=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=function(e){function t(){var t=e.call(this,"websocket-loader")||this;return t.TAG="WebSocketLoader",t._needStash=!0,t._ws=null,t._requestAbort=!1,t._receivedLength=0,t}return a(t,e),t.isSupported=function(){try{return void 0!==self.WebSocket}catch(e){return!1}},t.prototype.destroy=function(){this._ws&&this.abort(),e.prototype.destroy.call(this)},t.prototype.open=function(e){try{var t=this._ws=new self.WebSocket(e.url);t.binaryType="arraybuffer",t.onopen=this._onWebSocketOpen.bind(this),t.onclose=this._onWebSocketClose.bind(this),t.onmessage=this._onWebSocketMessage.bind(this),t.onerror=this._onWebSocketError.bind(this),this._status=n.LoaderStatus.kConnecting}catch(i){this._status=n.LoaderStatus.kError;var r={code:i.code,msg:i.message};if(!this._onError)throw new s.RuntimeException(r.msg);this._onError(n.LoaderErrors.EXCEPTION,r)}},t.prototype.abort=function(){var e=this._ws;!e||0!==e.readyState&&1!==e.readyState||(this._requestAbort=!0,e.close()),this._ws=null,this._status=n.LoaderStatus.kComplete},t.prototype._onWebSocketOpen=function(e){this._status=n.LoaderStatus.kBuffering},t.prototype._onWebSocketClose=function(e){!0!==this._requestAbort?(this._status=n.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},t.prototype._onWebSocketMessage=function(e){var t=this;if(e.data instanceof ArrayBuffer)this._dispatchArrayBuffer(e.data);else if(e.data instanceof Blob){var r=new FileReader;r.onload=function(){t._dispatchArrayBuffer(r.result)},r.readAsArrayBuffer(e.data)}else{this._status=n.LoaderStatus.kError;var i={code:-1,msg:"Unsupported WebSocket message type: "+e.data.constructor.name};if(!this._onError)throw new s.RuntimeException(i.msg);this._onError(n.LoaderErrors.EXCEPTION,i)}},t.prototype._dispatchArrayBuffer=function(e){var t=e,r=this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,r,this._receivedLength)},t.prototype._onWebSocketError=function(e){this._status=n.LoaderStatus.kError;var t={code:e.code,msg:e.message};if(!this._onError)throw new s.RuntimeException(t.msg);this._onError(n.LoaderErrors.EXCEPTION,t)},t}(n.BaseLoader);t.default=o},"./src/io/xhr-moz-chunked-loader.js":
/*!******************************************!*\
    !*** ./src/io/xhr-moz-chunked-loader.js ***!
    \******************************************/function(e,t,r){r.r(t);var i,n=r(/*! ../utils/logger.js */"./src/utils/logger.js"),s=r(/*! ./loader.js */"./src/io/loader.js"),a=r(/*! ../utils/exception.js */"./src/utils/exception.js"),o=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),l=function(e){function t(t,r){var i=e.call(this,"xhr-moz-chunked-loader")||this;return i.TAG="MozChunkedLoader",i._seekHandler=t,i._config=r,i._needStash=!0,i._xhr=null,i._requestAbort=!1,i._contentLength=null,i._receivedLength=0,i}return o(t,e),t.isSupported=function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(t){return n.default.w("MozChunkedLoader",t.message),!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),e.prototype.destroy.call(this)},t.prototype.open=function(e,t){this._dataSource=e,this._range=t;var r=e.url;this._config.reuseRedirectedURL&&null!=e.redirectedURL&&(r=e.redirectedURL);var i=this._seekHandler.getConfig(r,t);this._requestURL=i.url;var n=this._xhr=new XMLHttpRequest;if(n.open("GET",i.url,!0),n.responseType="moz-chunked-arraybuffer",n.onreadystatechange=this._onReadyStateChange.bind(this),n.onprogress=this._onProgress.bind(this),n.onloadend=this._onLoadEnd.bind(this),n.onerror=this._onXhrError.bind(this),e.withCredentials&&(n.withCredentials=!0),"object"==typeof i.headers){var a=i.headers;for(var o in a)a.hasOwnProperty(o)&&n.setRequestHeader(o,a[o])}if("object"==typeof this._config.headers)for(var o in a=this._config.headers)a.hasOwnProperty(o)&&n.setRequestHeader(o,a[o]);this._status=s.LoaderStatus.kConnecting,n.send()},t.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=s.LoaderStatus.kComplete},t.prototype._onReadyStateChange=function(e){var t=e.target;if(2===t.readyState){if(null!=t.responseURL&&t.responseURL!==this._requestURL&&this._onURLRedirect){var r=this._seekHandler.removeURLParameters(t.responseURL);this._onURLRedirect(r)}if(0!==t.status&&(t.status<200||t.status>299)){if(this._status=s.LoaderStatus.kError,!this._onError)throw new a.RuntimeException("MozChunkedLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(s.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else this._status=s.LoaderStatus.kBuffering}},t.prototype._onProgress=function(e){if(this._status!==s.LoaderStatus.kError){null===this._contentLength&&null!==e.total&&0!==e.total&&(this._contentLength=e.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var t=e.target.response,r=this._range.from+this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,r,this._receivedLength)}},t.prototype._onLoadEnd=function(e){!0!==this._requestAbort?this._status!==s.LoaderStatus.kError&&(this._status=s.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},t.prototype._onXhrError=function(e){this._status=s.LoaderStatus.kError;var t=0,r=null;if(this._contentLength&&e.loaded<this._contentLength?(t=s.LoaderErrors.EARLY_EOF,r={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(t=s.LoaderErrors.EXCEPTION,r={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new a.RuntimeException(r.msg);this._onError(t,r)},t}(s.BaseLoader);t.default=l},"./src/io/xhr-range-loader.js":
/*!************************************!*\
    !*** ./src/io/xhr-range-loader.js ***!
    \************************************/function(e,t,r){r.r(t);var i,n=r(/*! ../utils/logger.js */"./src/utils/logger.js"),s=r(/*! ./speed-sampler.js */"./src/io/speed-sampler.js"),a=r(/*! ./loader.js */"./src/io/loader.js"),o=r(/*! ../utils/exception.js */"./src/utils/exception.js"),l=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),c=function(e){function t(t,r){var i=e.call(this,"xhr-range-loader")||this;return i.TAG="RangeLoader",i._seekHandler=t,i._config=r,i._needStash=!1,i._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],i._currentChunkSizeKB=384,i._currentSpeedNormalized=0,i._zeroSpeedChunkCount=0,i._xhr=null,i._speedSampler=new s.default,i._requestAbort=!1,i._waitForTotalLength=!1,i._totalLengthReceived=!1,i._currentRequestURL=null,i._currentRedirectedURL=null,i._currentRequestRange=null,i._totalLength=null,i._contentLength=null,i._receivedLength=0,i._lastTimeLoaded=0,i}return l(t,e),t.isSupported=function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(t){return n.default.w("RangeLoader",t.message),!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),e.prototype.destroy.call(this)},Object.defineProperty(t.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),t.prototype.open=function(e,t){this._dataSource=e,this._range=t,this._status=a.LoaderStatus.kConnecting;var r=!1;null!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(r=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||r?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},t.prototype._openSubRange=function(){var e=1024*this._currentChunkSizeKB,t=this._range.from+this._receivedLength,r=t+e;null!=this._contentLength&&r-this._range.from>=this._contentLength&&(r=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:r},this._internalOpen(this._dataSource,this._currentRequestRange)},t.prototype._internalOpen=function(e,t){this._lastTimeLoaded=0;var r=e.url;this._config.reuseRedirectedURL&&(null!=this._currentRedirectedURL?r=this._currentRedirectedURL:null!=e.redirectedURL&&(r=e.redirectedURL));var i=this._seekHandler.getConfig(r,t);this._currentRequestURL=i.url;var n=this._xhr=new XMLHttpRequest;if(n.open("GET",i.url,!0),n.responseType="arraybuffer",n.onreadystatechange=this._onReadyStateChange.bind(this),n.onprogress=this._onProgress.bind(this),n.onload=this._onLoad.bind(this),n.onerror=this._onXhrError.bind(this),e.withCredentials&&(n.withCredentials=!0),"object"==typeof i.headers){var s=i.headers;for(var a in s)s.hasOwnProperty(a)&&n.setRequestHeader(a,s[a])}if("object"==typeof this._config.headers)for(var a in s=this._config.headers)s.hasOwnProperty(a)&&n.setRequestHeader(a,s[a]);n.send()},t.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=a.LoaderStatus.kComplete},t.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},t.prototype._onReadyStateChange=function(e){var t=e.target;if(2===t.readyState){if(null!=t.responseURL){var r=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&r!==this._currentRedirectedURL&&(this._currentRedirectedURL=r,this._onURLRedirect&&this._onURLRedirect(r))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=a.LoaderStatus.kBuffering}else{if(this._status=a.LoaderStatus.kError,!this._onError)throw new o.RuntimeException("RangeLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(a.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}}},t.prototype._onProgress=function(e){if(this._status!==a.LoaderStatus.kError){if(null===this._contentLength){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var r=e.total;this._internalAbort(),null!=r&0!==r&&(this._totalLength=r)}if(-1===this._range.to?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var i=e.loaded-this._lastTimeLoaded;this._lastTimeLoaded=e.loaded,this._speedSampler.addBytes(i)}},t.prototype._normalizeSpeed=function(e){var t=this._chunkSizeKBList,r=t.length-1,i=0,n=0,s=r;if(e<t[0])return t[0];for(;n<=s;){if((i=n+Math.floor((s-n)/2))===r||e>=t[i]&&e<t[i+1])return t[i];t[i]<e?n=i+1:s=i-1}},t.prototype._onLoad=function(e){if(this._status!==a.LoaderStatus.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(0===t&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps)),0!==t){var r=this._normalizeSpeed(t);this._currentSpeedNormalized!==r&&(this._currentSpeedNormalized=r,this._currentChunkSizeKB=r)}var i=e.target.response,n=this._range.from+this._receivedLength;this._receivedLength+=i.byteLength;var s=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():s=!0,this._onDataArrival&&this._onDataArrival(i,n,this._receivedLength),s&&(this._status=a.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},t.prototype._onXhrError=function(e){this._status=a.LoaderStatus.kError;var t=0,r=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=a.LoaderErrors.EARLY_EOF,r={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=a.LoaderErrors.EXCEPTION,r={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new o.RuntimeException(r.msg);this._onError(t,r)},t}(a.BaseLoader);t.default=c},"./src/player/flv-player.js":
/*!**********************************!*\
    !*** ./src/player/flv-player.js ***!
    \**********************************/function(e,t,r){r.r(t);var i=r(/*! events */"./node_modules/events/events.js"),n=r.n(i),s=r(/*! ../utils/logger.js */"./src/utils/logger.js"),a=r(/*! ../utils/browser.js */"./src/utils/browser.js"),o=r(/*! ./player-events.js */"./src/player/player-events.js"),l=r(/*! ../core/transmuxer.js */"./src/core/transmuxer.js"),c=r(/*! ../core/transmuxing-events.js */"./src/core/transmuxing-events.js"),d=r(/*! ../core/mse-controller.js */"./src/core/mse-controller.js"),u=r(/*! ../core/mse-events.js */"./src/core/mse-events.js"),h=r(/*! ./player-errors.js */"./src/player/player-errors.js"),f=r(/*! ../config.js */"./src/config.js"),p=r(/*! ../utils/exception.js */"./src/utils/exception.js"),m=function(){function e(e,t){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(n()),this._config=(0,f.createDefaultConfig)(),"object"==typeof t&&Object.assign(this._config,t),"flv"!==e.type.toLowerCase())throw new p.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");!0===e.isLive&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=e,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var r=a.default.chrome&&(a.default.version.major<50||50===a.default.version.major&&a.default.version.build<2661);this._alwaysSeekKeyframe=!!(r||a.default.msedge||a.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return e.prototype.destroy=function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){var r=this;e===o.default.MEDIA_INFO?null!=this._mediaInfo&&Promise.resolve().then((function(){r._emitter.emit(o.default.MEDIA_INFO,r.mediaInfo)})):e===o.default.STATISTICS_INFO&&null!=this._statisticsInfo&&Promise.resolve().then((function(){r._emitter.emit(o.default.STATISTICS_INFO,r.statisticsInfo)})),this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){var t=this;if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),e.addEventListener("seeking",this.e.onvSeeking),e.addEventListener("canplay",this.e.onvCanPlay),e.addEventListener("stalled",this.e.onvStalled),e.addEventListener("progress",this.e.onvProgress),this._msectl=new d.default(this._config),this._msectl.on(u.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(u.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(u.default.SOURCE_OPEN,(function(){t._mseSourceOpened=!0,t._hasPendingLoad&&(t._hasPendingLoad=!1,t.load())})),this._msectl.on(u.default.ERROR,(function(e){t._emitter.emit(o.default.ERROR,h.ErrorTypes.MEDIA_ERROR,h.ErrorDetails.MEDIA_MSE_ERROR,e)})),this._msectl.attachMediaElement(e),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(r){}},e.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},e.prototype.load=function(){var e=this;if(!this._mediaElement)throw new p.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new p.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");this._hasPendingLoad||(this._config.deferLoadAfterSourceOpen&&!1===this._mseSourceOpened?this._hasPendingLoad=!0:(this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new l.default(this._mediaDataSource,this._config),this._transmuxer.on(c.default.INIT_SEGMENT,(function(t,r){e._msectl.appendInitSegment(r)})),this._transmuxer.on(c.default.MEDIA_SEGMENT,(function(t,r){if(e._msectl.appendMediaSegment(r),e._config.lazyLoad&&!e._config.isLive){var i=e._mediaElement.currentTime;r.info.endDts>=1e3*(i+e._config.lazyLoadMaxDuration)&&null==e._progressChecker&&(s.default.v(e.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),e._suspendTransmuxer())}})),this._transmuxer.on(c.default.LOADING_COMPLETE,(function(){e._msectl.endOfStream(),e._emitter.emit(o.default.LOADING_COMPLETE)})),this._transmuxer.on(c.default.RECOVERED_EARLY_EOF,(function(){e._emitter.emit(o.default.RECOVERED_EARLY_EOF)})),this._transmuxer.on(c.default.IO_ERROR,(function(t,r){e._emitter.emit(o.default.ERROR,h.ErrorTypes.NETWORK_ERROR,t,r)})),this._transmuxer.on(c.default.DEMUX_ERROR,(function(t,r){e._emitter.emit(o.default.ERROR,h.ErrorTypes.MEDIA_ERROR,t,{code:-1,msg:r})})),this._transmuxer.on(c.default.MEDIA_INFO,(function(t){e._mediaInfo=t,e._emitter.emit(o.default.MEDIA_INFO,Object.assign({},t))})),this._transmuxer.on(c.default.METADATA_ARRIVED,(function(t){e._emitter.emit(o.default.METADATA_ARRIVED,t)})),this._transmuxer.on(c.default.SCRIPTDATA_ARRIVED,(function(t){e._emitter.emit(o.default.SCRIPTDATA_ARRIVED,t)})),this._transmuxer.on(c.default.STATISTICS_INFO,(function(t){e._statisticsInfo=e._fillStatisticsInfo(t),e._emitter.emit(o.default.STATISTICS_INFO,Object.assign({},e._statisticsInfo))})),this._transmuxer.on(c.default.RECOMMEND_SEEKPOINT,(function(t){e._mediaElement&&!e._config.accurateSeek&&(e._requestSetTime=!0,e._mediaElement.currentTime=t/1e3)})),this._transmuxer.open()))},e.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},e.prototype.play=function(){return this._mediaElement.play()},e.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._internalSeek(e):this._pendingSeekTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),e.prototype._fillStatisticsInfo=function(e){if(e.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,r=0,i=0;if(this._mediaElement.getVideoPlaybackQuality){var n=this._mediaElement.getVideoPlaybackQuality();r=n.totalVideoFrames,i=n.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(r=this._mediaElement.webkitDecodedFrameCount,i=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=r,e.droppedFrames=i),e},e.prototype._onmseUpdateEnd=function(){if(this._config.lazyLoad&&!this._config.isLive){for(var e=this._mediaElement.buffered,t=this._mediaElement.currentTime,r=0,i=0;i<e.length;i++){var n=e.start(i),a=e.end(i);if(n<=t&&t<a){r=a;break}}r>=t+this._config.lazyLoadMaxDuration&&null==this._progressChecker&&(s.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},e.prototype._onmseBufferFull=function(){s.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),null==this._progressChecker&&this._suspendTransmuxer()},e.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),null==this._progressChecker&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},e.prototype._checkProgressAndResume=function(){for(var e=this._mediaElement.currentTime,t=this._mediaElement.buffered,r=!1,i=0;i<t.length;i++){var n=t.start(i),a=t.end(i);if(e>=n&&e<a){e>=a-this._config.lazyLoadRecoverDuration&&(r=!0);break}}r&&(window.clearInterval(this._progressChecker),this._progressChecker=null,r&&(s.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},e.prototype._isTimepointBuffered=function(e){for(var t=this._mediaElement.buffered,r=0;r<t.length;r++){var i=t.start(r),n=t.end(r);if(e>=i&&e<n)return!0}return!1},e.prototype._internalSeek=function(e){var t=this._isTimepointBuffered(e),r=!1,i=0;if(e<1&&this._mediaElement.buffered.length>0){var n=this._mediaElement.buffered.start(0);(n<1&&e<n||a.default.safari)&&(r=!0,i=a.default.safari?.1:n)}if(r)this._requestSetTime=!0,this._mediaElement.currentTime=i;else if(t){if(this._alwaysSeekKeyframe){var s=this._msectl.getNearestKeyframe(Math.floor(1e3*e));this._requestSetTime=!0,this._mediaElement.currentTime=null!=s?s.dts/1e3:e}else this._requestSetTime=!0,this._mediaElement.currentTime=e;null!=this._progressChecker&&this._checkProgressAndResume()}else null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e)},e.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var e=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(e)||(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},e.prototype._checkAndResumeStuckPlayback=function(e){var t=this._mediaElement;if(e||!this._receivedCanPlay||t.readyState<2){var r=t.buffered;r.length>0&&t.currentTime<r.start(0)&&(s.default.w(this.TAG,"Playback seems stuck at "+t.currentTime+", seek to "+r.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=r.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},e.prototype._onvLoadedMetadata=function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},e.prototype._onvSeeking=function(e){var t=this._mediaElement.currentTime,r=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(t<1&&r.length>0){var i=r.start(0);if(i<1&&t<i||a.default.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=a.default.safari?.1:i)}if(this._isTimepointBuffered(t)){if(this._alwaysSeekKeyframe){var n=this._msectl.getNearestKeyframe(Math.floor(1e3*t));null!=n&&(this._requestSetTime=!0,this._mediaElement.currentTime=n.dts/1e3)}null!=this._progressChecker&&this._checkProgressAndResume()}else this._seekpointRecord={seekPoint:t,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},e.prototype._onvCanPlay=function(e){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},e.prototype._onvStalled=function(e){this._checkAndResumeStuckPlayback(!0)},e.prototype._onvProgress=function(e){this._checkAndResumeStuckPlayback()},e}();t.default=m},"./src/player/native-player.js":
/*!*************************************!*\
    !*** ./src/player/native-player.js ***!
    \*************************************/function(e,t,r){r.r(t);var i=r(/*! events */"./node_modules/events/events.js"),n=r.n(i),s=r(/*! ./player-events.js */"./src/player/player-events.js"),a=r(/*! ../config.js */"./src/config.js"),o=r(/*! ../utils/exception.js */"./src/utils/exception.js"),l=function(){function e(e,t){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(n()),this._config=(0,a.createDefaultConfig)(),"object"==typeof t&&Object.assign(this._config,t),"flv"===e.type.toLowerCase())throw new o.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(e.hasOwnProperty("segments"))throw new o.InvalidArgumentException("NativePlayer("+e.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=e,this._mediaElement=null}return e.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){var r=this;e===s.default.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){r._emitter.emit(s.default.MEDIA_INFO,r.mediaInfo)})):e===s.default.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){r._emitter.emit(s.default.STATISTICS_INFO,r.statisticsInfo)})),this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(t){}},e.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype.load=function(){if(!this._mediaElement)throw new o.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},e.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype.play=function(){return this._mediaElement.play()},e.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._mediaElement.currentTime=e:this._pendingSeekTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mediaInfo",{get:function(){var e={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(e.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(e.width=this._mediaElement.videoWidth,e.height=this._mediaElement.videoHeight)),e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){var e={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,r=0,i=0;if(this._mediaElement.getVideoPlaybackQuality){var n=this._mediaElement.getVideoPlaybackQuality();r=n.totalVideoFrames,i=n.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(r=this._mediaElement.webkitDecodedFrameCount,i=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=r,e.droppedFrames=i),e},enumerable:!1,configurable:!0}),e.prototype._onvLoadedMetadata=function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(s.default.MEDIA_INFO,this.mediaInfo)},e.prototype._reportStatisticsInfo=function(){this._emitter.emit(s.default.STATISTICS_INFO,this.statisticsInfo)},e}();t.default=l},"./src/player/player-errors.js":
/*!*************************************!*\
    !*** ./src/player/player-errors.js ***!
    \*************************************/function(e,t,r){r.r(t),r.d(t,{ErrorTypes:function(){return s},ErrorDetails:function(){return a}});var i=r(/*! ../io/loader.js */"./src/io/loader.js"),n=r(/*! ../demux/demux-errors.js */"./src/demux/demux-errors.js"),s={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},a={NETWORK_EXCEPTION:i.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:i.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:i.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:i.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:n.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:n.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:n.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":
/*!*************************************!*\
    !*** ./src/player/player-events.js ***!
    \*************************************/function(e,t,r){r.r(t),t.default={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"}},"./src/remux/aac-silent.js":
/*!*********************************!*\
    !*** ./src/remux/aac-silent.js ***!
    \*********************************/function(e,t,r){r.r(t);var i=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}();t.default=i},"./src/remux/mp4-generator.js":
/*!************************************!*\
    !*** ./src/remux/mp4-generator.js ***!
    \************************************/function(e,t,r){r.r(t);var i=function(){function e(){}return e.init=function(){for(var t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=e.constants={};r.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),r.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),r.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),r.STSC=r.STCO=r.STTS,r.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),r.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),r.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),r.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},e.box=function(e){for(var t=8,r=null,i=Array.prototype.slice.call(arguments,1),n=i.length,s=0;s<n;s++)t+=i[s].byteLength;(r=new Uint8Array(t))[0]=t>>>24&255,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r.set(e,4);var a=8;for(s=0;s<n;s++)r.set(i[s],a),a+=i[s].byteLength;return r},e.generateInitSegment=function(t){var r=e.box(e.types.ftyp,e.constants.FTYP),i=e.moov(t),n=new Uint8Array(r.byteLength+i.byteLength);return n.set(r,0),n.set(i,r.byteLength),n},e.moov=function(t){var r=e.mvhd(t.timescale,t.duration),i=e.trak(t),n=e.mvex(t);return e.box(e.types.moov,r,i,n)},e.mvhd=function(t,r){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},e.trak=function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.tkhd=function(t){var r=t.id,i=t.duration,n=t.presentWidth,s=t.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>>8&255,255&n,0,0,s>>>8&255,255&s,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))},e.mdhd=function(t){var r=t.timescale,i=t.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,i>>>24&255,i>>>16&255,i>>>8&255,255&i,85,196,0,0]))},e.hdlr=function(t){var r=null;return r="audio"===t.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,r)},e.minf=function(t){var r=null;return r="audio"===t.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,r,e.dinf(),e.stbl(t))},e.dinf=function(){return e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF))},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO))},e.stsd=function(t){return"audio"===t.type?"mp3"===t.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp3(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(t))},e.mp3=function(t){var r=t.channelCount,i=t.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return e.box(e.types[".mp3"],n)},e.mp4a=function(t){var r=t.channelCount,i=t.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return e.box(e.types.mp4a,n,e.esds(t))},e.esds=function(t){var r=t.config||[],i=r.length,n=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(r).concat([6,1,2]));return e.box(e.types.esds,n)},e.avc1=function(t){var r=t.avcc,i=t.codecWidth,n=t.codecHeight,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>>8&255,255&i,n>>>8&255,255&n,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.avc1,s,e.box(e.types.avcC,r))},e.mvex=function(t){return e.box(e.types.mvex,e.trex(t))},e.trex=function(t){var r=t.id,i=new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,i)},e.moof=function(t,r){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,r))},e.mfhd=function(t){var r=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,r)},e.traf=function(t,r){var i=t.id,n=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i])),s=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),a=e.sdtp(t),o=e.trun(t,a.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,n,s,o,a)},e.sdtp=function(t){for(var r=t.samples||[],i=r.length,n=new Uint8Array(4+i),s=0;s<i;s++){var a=r[s].flags;n[s+4]=a.isLeading<<6|a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy}return e.box(e.types.sdtp,n)},e.trun=function(t,r){var i=t.samples||[],n=i.length,s=12+16*n,a=new Uint8Array(s);r+=8+s,a.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var o=0;o<n;o++){var l=i[o].duration,c=i[o].size,d=i[o].flags,u=i[o].cts;a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.isNonSync,0,0,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*o)}return e.box(e.types.trun,a)},e.mdat=function(t){return e.box(e.types.mdat,t)},e}();i.init(),t.default=i},"./src/remux/mp4-remuxer.js":
/*!**********************************!*\
    !*** ./src/remux/mp4-remuxer.js ***!
    \**********************************/function(e,t,r){r.r(t);var i=r(/*! ../utils/logger.js */"./src/utils/logger.js"),n=r(/*! ./mp4-generator.js */"./src/remux/mp4-generator.js"),s=r(/*! ./aac-silent.js */"./src/remux/aac-silent.js"),a=r(/*! ../utils/browser.js */"./src/utils/browser.js"),o=r(/*! ../core/media-segment-info.js */"./src/core/media-segment-info.js"),l=r(/*! ../utils/exception.js */"./src/utils/exception.js"),c=function(){function e(e){this.TAG="MP4Remuxer",this._config=e,this._isLive=!0===e.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new o.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new o.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!a.default.chrome||!(a.default.version.major<50||50===a.default.version.major&&a.default.version.build<2661)),this._fillSilentAfterSeek=a.default.msedge||a.default.msie,this._mp3UseMpegAudio=!a.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return e.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},e.prototype.bindDataSource=function(e){return e.onDataAvailable=this.remux.bind(this),e.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(e.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e},enumerable:!1,configurable:!0}),e.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},e.prototype.seek=function(e){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},e.prototype.remux=function(e,t){if(!this._onMediaSegment)throw new l.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)},e.prototype._onTrackMetadataReceived=function(e,t){var r=null,i="mp4",s=t.codec;if("audio"===e)this._audioMeta=t,"mp3"===t.codec&&this._mp3UseMpegAudio?(i="mpeg",s="",r=new Uint8Array):r=n.default.generateInitSegment(t);else{if("video"!==e)return;this._videoMeta=t,r=n.default.generateInitSegment(t)}if(!this._onInitSegment)throw new l.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(e,{type:e,data:r.buffer,codec:s,container:e+"/"+i,mediaDuration:t.duration})},e.prototype._calculateDtsBase=function(e,t){this._dtsBaseInited||(e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},e.prototype.flushStashedSamples=function(){var e=this._videoStashedLastSample,t=this._audioStashedLastSample,r={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=e&&(r.samples.push(e),r.length=e.length);var i={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=t&&(i.samples.push(t),i.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(r,!0),this._remuxAudio(i,!0)},e.prototype._remuxAudio=function(e,t){if(null!=this._audioMeta){var r,l=e,c=l.samples,d=void 0,u=-1,h=this._audioMeta.refSampleDuration,f="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,p=this._dtsBaseInited&&void 0===this._audioNextDts,m=!1;if(c&&0!==c.length&&(1!==c.length||t)){var g=0,y=null,_=0;f?(g=0,_=l.length):(g=8,_=8+l.length);var v=null;if(c.length>1&&(_-=(v=c.pop()).length),null!=this._audioStashedLastSample){var E=this._audioStashedLastSample;this._audioStashedLastSample=null,c.unshift(E),_+=E.length}null!=v&&(this._audioStashedLastSample=v);var S=c[0].dts-this._dtsBase;if(this._audioNextDts)d=S-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())d=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(m=!0);else{var T=this._audioSegmentInfoList.getLastSampleBefore(S);if(null!=T){var b=S-(T.originalDts+T.duration);b<=3&&(b=0),d=S-(T.dts+T.duration+b)}else d=0}if(m){var R=S-d,w=this._videoSegmentInfoList.getLastSegmentBefore(S);if(null!=w&&w.beginDts<R){if(N=s.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var A=w.beginDts,L=R-w.beginDts;i.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+A+", duration: "+L),c.unshift({unit:N,dts:A,pts:A}),_+=N.byteLength}}else m=!1}for(var C=[],I=0;I<c.length;I++){var k=(E=c[I]).unit,D=E.dts-this._dtsBase,P=(A=D,!1),O=null,x=0;if(!(D<-.001)){if("mp3"!==this._audioMeta.codec){var M=D;if(this._audioNextDts&&(M=this._audioNextDts),(d=D-M)<=-3*h){i.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+D+" ms ,curRefDts: "+M+" ms)  due to dtsCorrection: "+d+" ms overlap.");continue}if(d>=3*h&&this._fillAudioTimestampGap&&!a.default.safari){P=!0;var N,F=Math.floor(d/h);i.default.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\noriginalDts: "+D+" ms, curRefDts: "+M+" ms, dtsCorrection: "+Math.round(d)+" ms, generate: "+F+" frames"),A=Math.floor(M),x=Math.floor(M+h)-A,null==(N=s.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))&&(i.default.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),N=k),O=[];for(var U=0;U<F;U++){M+=h;var B=Math.floor(M),H=Math.floor(M+h)-B,j={dts:B,pts:B,cts:0,unit:N,size:N.byteLength,duration:H,originalDts:D,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};O.push(j),_+=j.size}this._audioNextDts=M+h}else A=Math.floor(M),x=Math.floor(M+h)-A,this._audioNextDts=M+h}else A=D-d,x=I!==c.length-1?c[I+1].dts-this._dtsBase-d-A:null!=v?v.dts-this._dtsBase-d-A:C.length>=1?C[C.length-1].duration:Math.floor(h),this._audioNextDts=A+x;-1===u&&(u=A),C.push({dts:A,pts:A,cts:0,unit:E.unit,size:E.unit.byteLength,duration:x,originalDts:D,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),P&&C.push.apply(C,O)}}if(0===C.length)return l.samples=[],void(l.length=0);for(f?y=new Uint8Array(_):((y=new Uint8Array(_))[0]=_>>>24&255,y[1]=_>>>16&255,y[2]=_>>>8&255,y[3]=255&_,y.set(n.default.types.mdat,4)),I=0;I<C.length;I++)k=C[I].unit,y.set(k,g),g+=k.byteLength;var V=C[C.length-1];r=V.dts+V.duration;var G=new o.MediaSegmentInfo;G.beginDts=u,G.endDts=r,G.beginPts=u,G.endPts=r,G.originalBeginDts=C[0].originalDts,G.originalEndDts=V.originalDts+V.duration,G.firstSample=new o.SampleInfo(C[0].dts,C[0].pts,C[0].duration,C[0].originalDts,!1),G.lastSample=new o.SampleInfo(V.dts,V.pts,V.duration,V.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(G),l.samples=C,l.sequenceNumber++;var z=null;z=f?new Uint8Array:n.default.moof(l,u),l.samples=[],l.length=0;var K={type:"audio",data:this._mergeBoxes(z,y).buffer,sampleCount:C.length,info:G};f&&p&&(K.timestampOffset=u),this._onMediaSegment("audio",K)}}},e.prototype._remuxVideo=function(e,t){if(null!=this._videoMeta){var r,i,s=e,a=s.samples,l=void 0,c=-1,d=-1;if(a&&0!==a.length&&(1!==a.length||t)){var u=8,h=null,f=8+e.length,p=null;if(a.length>1&&(f-=(p=a.pop()).length),null!=this._videoStashedLastSample){var m=this._videoStashedLastSample;this._videoStashedLastSample=null,a.unshift(m),f+=m.length}null!=p&&(this._videoStashedLastSample=p);var g=a[0].dts-this._dtsBase;if(this._videoNextDts)l=g-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())l=0;else{var y=this._videoSegmentInfoList.getLastSampleBefore(g);if(null!=y){var _=g-(y.originalDts+y.duration);_<=3&&(_=0),l=g-(y.dts+y.duration+_)}else l=0}for(var v=new o.MediaSegmentInfo,E=[],S=0;S<a.length;S++){var T=(m=a[S]).dts-this._dtsBase,b=m.isKeyframe,R=T-l,w=m.cts,A=R+w;-1===c&&(c=R,d=A);var L=0;if(L=S!==a.length-1?a[S+1].dts-this._dtsBase-l-R:null!=p?p.dts-this._dtsBase-l-R:E.length>=1?E[E.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),b){var C=new o.SampleInfo(R,A,L,m.dts,!0);C.fileposition=m.fileposition,v.appendSyncPoint(C)}E.push({dts:R,pts:A,cts:w,units:m.units,size:m.length,isKeyframe:b,duration:L,originalDts:T,flags:{isLeading:0,dependsOn:b?2:1,isDependedOn:b?1:0,hasRedundancy:0,isNonSync:b?0:1}})}for((h=new Uint8Array(f))[0]=f>>>24&255,h[1]=f>>>16&255,h[2]=f>>>8&255,h[3]=255&f,h.set(n.default.types.mdat,4),S=0;S<E.length;S++)for(var I=E[S].units;I.length;){var k=I.shift().data;h.set(k,u),u+=k.byteLength}var D=E[E.length-1];if(r=D.dts+D.duration,i=D.pts+D.duration,this._videoNextDts=r,v.beginDts=c,v.endDts=r,v.beginPts=d,v.endPts=i,v.originalBeginDts=E[0].originalDts,v.originalEndDts=D.originalDts+D.duration,v.firstSample=new o.SampleInfo(E[0].dts,E[0].pts,E[0].duration,E[0].originalDts,E[0].isKeyframe),v.lastSample=new o.SampleInfo(D.dts,D.pts,D.duration,D.originalDts,D.isKeyframe),this._isLive||this._videoSegmentInfoList.append(v),s.samples=E,s.sequenceNumber++,this._forceFirstIDR){var P=E[0].flags;P.dependsOn=2,P.isNonSync=0}var O=n.default.moof(s,c);s.samples=[],s.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(O,h).buffer,sampleCount:E.length,info:v})}}},e.prototype._mergeBoxes=function(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r},e}();t.default=c},"./src/utils/browser.js":
/*!******************************!*\
    !*** ./src/utils/browser.js ***!
    \******************************/function(e,t,r){r.r(t);var i={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],r=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],n={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:r[0]||""},s={};if(n.browser){s[n.browser]=!0;var a=n.majorVersion.split(".");s.version={major:parseInt(n.majorVersion,10),string:n.version},a.length>1&&(s.version.minor=parseInt(a[1],10)),a.length>2&&(s.version.build=parseInt(a[2],10))}if(n.platform&&(s[n.platform]=!0),(s.chrome||s.opr||s.safari)&&(s.webkit=!0),s.rv||s.iemobile){s.rv&&delete s.rv;var o="msie";n.browser=o,s[o]=!0}if(s.edge){delete s.edge;var l="msedge";n.browser=l,s[l]=!0}if(s.opr){var c="opera";n.browser=c,s[c]=!0}if(s.safari&&s.android){var d="android";n.browser=d,s[d]=!0}for(var u in s.name=n.browser,s.platform=n.platform,i)i.hasOwnProperty(u)&&delete i[u];Object.assign(i,s)}(),t.default=i},"./src/utils/exception.js":
/*!********************************!*\
    !*** ./src/utils/exception.js ***!
    \********************************/function(e,t,r){r.r(t),r.d(t,{RuntimeException:function(){return s},IllegalStateException:function(){return a},InvalidArgumentException:function(){return o},NotImplementedException:function(){return l}});var i,n=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=function(){function e(e){this._message=e}return Object.defineProperty(e.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return this.name+": "+this.message},e}(),a=function(e){function t(t){return e.call(this,t)||this}return n(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),t}(s),o=function(e){function t(t){return e.call(this,t)||this}return n(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),t}(s),l=function(e){function t(t){return e.call(this,t)||this}return n(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),t}(s)},"./src/utils/logger.js":
/*!*****************************!*\
    !*** ./src/utils/logger.js ***!
    \*****************************/function(e,t,r){r.r(t);var i=r(/*! events */"./node_modules/events/events.js"),n=r.n(i),s=function(){function e(){}return e.e=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","error",i),e.ENABLE_ERROR&&(console.error?console.error(i):console.warn?console.warn(i):console.log(i))},e.i=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","info",i),e.ENABLE_INFO&&(console.info?console.info(i):console.log(i))},e.w=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","warn",i),e.ENABLE_WARN&&(console.warn?console.warn(i):console.log(i))},e.d=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","debug",i),e.ENABLE_DEBUG&&(console.debug?console.debug(i):console.log(i))},e.v=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","verbose",i),e.ENABLE_VERBOSE&&console.log(i)},e}();s.GLOBAL_TAG="flv.js",s.FORCE_GLOBAL_TAG=!1,s.ENABLE_ERROR=!0,s.ENABLE_INFO=!0,s.ENABLE_WARN=!0,s.ENABLE_DEBUG=!0,s.ENABLE_VERBOSE=!0,s.ENABLE_CALLBACK=!1,s.emitter=new(n()),t.default=s},"./src/utils/logging-control.js":
/*!**************************************!*\
    !*** ./src/utils/logging-control.js ***!
    \**************************************/function(e,t,r){r.r(t);var i=r(/*! events */"./node_modules/events/events.js"),n=r.n(i),s=r(/*! ./logger.js */"./src/utils/logger.js"),a=function(){function e(){}return Object.defineProperty(e,"forceGlobalTag",{get:function(){return s.default.FORCE_GLOBAL_TAG},set:function(t){s.default.FORCE_GLOBAL_TAG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"globalTag",{get:function(){return s.default.GLOBAL_TAG},set:function(t){s.default.GLOBAL_TAG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableAll",{get:function(){return s.default.ENABLE_VERBOSE&&s.default.ENABLE_DEBUG&&s.default.ENABLE_INFO&&s.default.ENABLE_WARN&&s.default.ENABLE_ERROR},set:function(t){s.default.ENABLE_VERBOSE=t,s.default.ENABLE_DEBUG=t,s.default.ENABLE_INFO=t,s.default.ENABLE_WARN=t,s.default.ENABLE_ERROR=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableDebug",{get:function(){return s.default.ENABLE_DEBUG},set:function(t){s.default.ENABLE_DEBUG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableVerbose",{get:function(){return s.default.ENABLE_VERBOSE},set:function(t){s.default.ENABLE_VERBOSE=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableInfo",{get:function(){return s.default.ENABLE_INFO},set:function(t){s.default.ENABLE_INFO=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableWarn",{get:function(){return s.default.ENABLE_WARN},set:function(t){s.default.ENABLE_WARN=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableError",{get:function(){return s.default.ENABLE_ERROR},set:function(t){s.default.ENABLE_ERROR=t,e._notifyChange()},enumerable:!1,configurable:!0}),e.getConfig=function(){return{globalTag:s.default.GLOBAL_TAG,forceGlobalTag:s.default.FORCE_GLOBAL_TAG,enableVerbose:s.default.ENABLE_VERBOSE,enableDebug:s.default.ENABLE_DEBUG,enableInfo:s.default.ENABLE_INFO,enableWarn:s.default.ENABLE_WARN,enableError:s.default.ENABLE_ERROR,enableCallback:s.default.ENABLE_CALLBACK}},e.applyConfig=function(e){s.default.GLOBAL_TAG=e.globalTag,s.default.FORCE_GLOBAL_TAG=e.forceGlobalTag,s.default.ENABLE_VERBOSE=e.enableVerbose,s.default.ENABLE_DEBUG=e.enableDebug,s.default.ENABLE_INFO=e.enableInfo,s.default.ENABLE_WARN=e.enableWarn,s.default.ENABLE_ERROR=e.enableError,s.default.ENABLE_CALLBACK=e.enableCallback},e._notifyChange=function(){var t=e.emitter;if(t.listenerCount("change")>0){var r=e.getConfig();t.emit("change",r)}},e.registerListener=function(t){e.emitter.addListener("change",t)},e.removeListener=function(t){e.emitter.removeListener("change",t)},e.addLogListener=function(t){s.default.emitter.addListener("log",t),s.default.emitter.listenerCount("log")>0&&(s.default.ENABLE_CALLBACK=!0,e._notifyChange())},e.removeLogListener=function(t){s.default.emitter.removeListener("log",t),0===s.default.emitter.listenerCount("log")&&(s.default.ENABLE_CALLBACK=!1,e._notifyChange())},e}();a.emitter=new(n()),t.default=a},"./src/utils/polyfill.js":
/*!*******************************!*\
    !*** ./src/utils/polyfill.js ***!
    \*******************************/function(e,t,r){r.r(t);var i=function(){function e(){}return e.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Object.assign=Object.assign||function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}return t},"function"!=typeof self.Promise&&r(/*! es6-promise */"./node_modules/es6-promise/dist/es6-promise.js").polyfill()},e}();i.install(),t.default=i},"./src/utils/utf8-conv.js":
/*!********************************!*\
    !*** ./src/utils/utf8-conv.js ***!
    \********************************/function(e,t,r){function i(e,t,r){var i=e;if(t+r<i.length){for(;r--;)if(128!=(192&i[++t]))return!1;return!0}return!1}r.r(t),t.default=function(e){for(var t=[],r=e,n=0,s=e.length;n<s;)if(r[n]<128)t.push(String.fromCharCode(r[n])),++n;else{if(r[n]<192);else if(r[n]<224){if(i(r,n,1)&&(a=(31&r[n])<<6|63&r[n+1])>=128){t.push(String.fromCharCode(65535&a)),n+=2;continue}}else if(r[n]<240){if(i(r,n,2)&&(a=(15&r[n])<<12|(63&r[n+1])<<6|63&r[n+2])>=2048&&55296!=(63488&a)){t.push(String.fromCharCode(65535&a)),n+=3;continue}}else if(r[n]<248){var a;if(i(r,n,3)&&(a=(7&r[n])<<18|(63&r[n+1])<<12|(63&r[n+2])<<6|63&r[n+3])>65536&&a<1114112){a-=65536,t.push(String.fromCharCode(a>>>10|55296)),t.push(String.fromCharCode(1023&a|56320)),n+=4;continue}}t.push(String.fromCharCode(65533)),++n}return t.join("")}}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,r),s.exports}return r.m=e,r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r("./src/index.js")}()},e.exports=r()}(nS);var sS=i(nS.exports);function aS(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var oS={exports:{}};!function(e,t){var r,i,n,s,a;r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var n=a.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=a.normalizePath(n.path),a.buildURLFromParts(n)}var s=a.parseURL(t);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return r.alwaysNormalize?(s.path=a.normalizePath(s.path),a.buildURLFromParts(s)):t;var o=a.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=i.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var c={scheme:o.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(c.netLoc=o.netLoc,"/"!==s.path[0]))if(s.path){var d=o.path,u=d.substring(0,d.lastIndexOf("/")+1)+s.path;c.path=a.normalizePath(u)}else c.path=o.path,s.params||(c.params=o.params,s.query||(c.query=o.query));return null===c.path&&(c.path=r.alwaysNormalize?a.normalizePath(s.path):s.path),a.buildURLFromParts(c)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(n,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=a}(oS);var lS=oS.exports;function cS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function dS(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?cS(Object(r),!0).forEach((function(t){hS(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cS(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function uS(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function hS(e,t,r){return(t=uS(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fS(){return fS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},fS.apply(this,arguments)}const pS=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},mS=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=gS},gS=Number.MAX_SAFE_INTEGER||9007199254740991;let yS=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e}({}),_S=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),vS=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown",e}({});const ES=function(){},SS={trace:ES,debug:ES,log:ES,warn:ES,info:ES,error:ES};let TS=SS;function bS(e,...t){t.forEach((function(t){TS[t]=e[t]?e[t].bind(e):function(e){const t=self.console[e];return t?t.bind(self.console,`[${e}] >`):ES}(t)}))}const RS=TS,wS=/^(\d+)x(\d+)$/,AS=/(.+?)=(".*?"|.*?)(?:,|$)/g;class LS{constructor(e){"string"==typeof e&&(e=LS.parseAttrList(e)),fS(this,e)}get clientAttrs(){return Object.keys(this).filter((e=>"X-"===e.substring(0,2)))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const r=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)r[e]=parseInt(t.slice(2*e,2*e+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}bool(e){return"YES"===this[e]}decimalResolution(e){const t=wS.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const r={};for(AS.lastIndex=0;null!==(t=AS.exec(e));){let e=t[2];0===e.indexOf('"')&&e.lastIndexOf('"')===e.length-1&&(e=e.slice(1,-1));r[t[1].trim()]=e}return r}}function CS(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}class IS{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const r=t.attr;for(const t in r)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==r[t]){RS.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=fS(new LS({}),r,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=new Date(this.attr["END-DATE"]);pS(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(pS(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&pS(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class kS{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var DS="audio",PS="video",OS="audiovideo";class xS{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[DS]:null,[PS]:null,[OS]:null},this.baseurl=e}setByteRange(e,t){const r=e.split("@",2);let i;i=1===r.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(r[1]),this._byteRange=[i,parseInt(r[0])+i]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=lS.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class MS extends xS{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new kS,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;if(!pS(this.programDateTime))return null;const e=pS(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),t=e.length;if(t>1||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,r,i,n,s=!1){const{elementaryStreams:a}=this,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,n)):a[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:n,partial:s}}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[DS]=null,e[PS]=null,e[OS]=null}}class NS extends xS{constructor(e,t,r,i,n){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new kS,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const s=e.enumeratedString("BYTERANGE");s&&this.setByteRange(s,n),n&&(this.fragOffset=n.fragOffset+n.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}class FS{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&pS(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function US(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))}function BS(e){const t=e.split(":");let r=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),i=e[e.length-1].split(",");if(2===i.length){const t="base64"===i[0],n=i[1];t?(e.splice(-1,1),r=US(n)):r=function(e){const t=HS(e).subarray(0,16),r=new Uint8Array(16);return r.set(t,16-t.length),r}(n)}}return r}function HS(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(e=>e.charCodeAt(0)))}const jS="undefined"!=typeof self?self:void 0;var VS={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},GS="org.w3.clearkey",zS="com.apple.streamingkeydelivery",KS="com.microsoft.playready",WS="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function $S(e){switch(e){case zS:return VS.FAIRPLAY;case KS:return VS.PLAYREADY;case WS:return VS.WIDEVINE;case GS:return VS.CLEARKEY}}var YS="edef8ba979d64acea3c827dcd51d21ed";function qS(e){switch(e){case VS.FAIRPLAY:return zS;case VS.PLAYREADY:return KS;case VS.WIDEVINE:return WS;case VS.CLEARKEY:return GS}}function ZS(e){const{drmSystems:t,widevineLicenseUrl:r}=e,i=t?[VS.FAIRPLAY,VS.WIDEVINE,VS.PLAYREADY,VS.CLEARKEY].filter((e=>!!t[e])):[];return!i[VS.WIDEVINE]&&r&&i.push(VS.WIDEVINE),i}const XS=null!=jS&&null!=(JS=jS.navigator)&&JS.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var JS;function QS(e,t,r){return Uint8Array.prototype.slice?e.slice(t,r):new Uint8Array(Array.prototype.slice.call(e,t,r))}const eT=(e,t)=>t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,tT=(e,t)=>t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,rT=(e,t)=>{const r=t;let i=0;for(;eT(e,t);){i+=10;i+=iT(e,t+6),tT(e,t+10)&&(i+=10),t+=i}if(i>0)return e.subarray(r,r+i)},iT=(e,t)=>{let r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,r|=(127&e[t+2])<<7,r|=127&e[t+3],r},nT=(e,t)=>eT(e,t)&&iT(e,t+6)+10<=e.length-t,sT=e=>{const t=lT(e);for(let r=0;r<t.length;r++){const e=t[r];if(aT(e))return fT(e)}},aT=e=>e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info,oT=e=>{const t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=iT(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}},lT=e=>{let t=0;const r=[];for(;eT(e,t);){const i=iT(e,t+6);t+=10;const n=t+i;for(;t+8<n;){const i=oT(e.subarray(t)),n=cT(i);n&&r.push(n),t+=i.size+10}tT(e,t)&&(t+=10)}return r},cT=e=>"PRIV"===e.type?dT(e):"W"===e.type[0]?hT(e):uT(e),dT=e=>{if(e.size<2)return;const t=pT(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}},uT=e=>{if(e.size<2)return;if("TXXX"===e.type){let t=1;const r=pT(e.data.subarray(t),!0);t+=r.length+1;const i=pT(e.data.subarray(t));return{key:e.type,info:r,data:i}}const t=pT(e.data.subarray(1));return{key:e.type,data:t}},hT=e=>{if("WXXX"===e.type){if(e.size<2)return;let t=1;const r=pT(e.data.subarray(t),!0);t+=r.length+1;const i=pT(e.data.subarray(t));return{key:e.type,info:r,data:i}}const t=pT(e.data);return{key:e.type,data:t}},fT=e=>{if(8===e.data.byteLength){const t=new Uint8Array(e.data),r=1&t[3];let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,r&&(i+=47721858.84),Math.round(i)}},pT=(e,t=!1)=>{const r=gT();if(r){const i=r.decode(e);if(t){const e=i.indexOf("\0");return-1!==e?i.substring(0,e):i}return i.replace(/\0/g,"")}const i=e.length;let n,s,a,o="",l=0;for(;l<i;){if(n=e[l++],0===n&&t)return o;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(n);break;case 12:case 13:s=e[l++],o+=String.fromCharCode((31&n)<<6|63&s);break;case 14:s=e[l++],a=e[l++],o+=String.fromCharCode((15&n)<<12|(63&s)<<6|63&a)}}return o};let mT;function gT(){if(!navigator.userAgent.includes("PlayStation 4"))return mT||void 0===self.TextDecoder||(mT=new self.TextDecoder("utf-8")),mT}const yT=function(e){let t="";for(let r=0;r<e.length;r++){let i=e[r].toString(16);i.length<2&&(i="0"+i),t+=i}return t},_T=Math.pow(2,32)-1,vT=[].push,ET={video:1,audio:2,id3:3,text:4};function ST(e){return String.fromCharCode.apply(null,e)}function TT(e,t){const r=e[t]<<8|e[t+1];return r<0?65536+r:r}function bT(e,t){const r=wT(e,t);return r<0?4294967296+r:r}function RT(e,t){let r=bT(e,t);return r*=Math.pow(2,32),r+=bT(e,t+4),r}function wT(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function AT(e,t,r){e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}function LT(e,t){const r=[];if(!t.length)return r;const i=e.byteLength;for(let n=0;n<i;){const s=bT(e,n),a=s>1?n+s:i;if(ST(e.subarray(n+4,n+8))===t[0])if(1===t.length)r.push(e.subarray(n+8,a));else{const i=LT(e.subarray(n+8,a),t.slice(1));i.length&&vT.apply(r,i)}n=a}return r}function CT(e){const t=[],r=e[0];let i=8;const n=bT(e,i);i+=4;let s=0,a=0;0===r?(s=bT(e,i),a=bT(e,i+4),i+=8):(s=RT(e,i),a=RT(e,i+8),i+=16),i+=2;let o=e.length+a;const l=TT(e,i);i+=2;for(let c=0;c<l;c++){let r=i;const s=bT(e,r);r+=4;const a=2147483647&s;if(1===(2147483648&s)>>>31)return RS.warn("SIDX has hierarchical references (not supported)"),null;const l=bT(e,r);r+=4,t.push({referenceSize:a,subsegmentDuration:l,info:{duration:l/n,start:o,end:o+a-1}}),o+=a,r+=4,i=r}return{earliestPresentationTime:s,timescale:n,version:r,referencesCount:l,references:t}}function IT(e){const t=[],r=LT(e,["moov","trak"]);for(let i=0;i<r.length;i++){const e=r[i],n=LT(e,["tkhd"])[0];if(n){let r=n[0];const i=bT(n,0===r?12:20),s=LT(e,["mdia","mdhd"])[0];if(s){r=s[0];const n=bT(s,0===r?12:20),a=LT(e,["mdia","hdlr"])[0];if(a){const r=ST(a.subarray(8,12)),s={soun:DS,vide:PS}[r];if(s){const r=kT(LT(e,["mdia","minf","stbl","stsd"])[0]);t[i]={timescale:n,type:s},t[s]=dS({timescale:n,id:i},r)}}}}}return LT(e,["moov","mvex","trex"]).forEach((e=>{const r=bT(e,4),i=t[r];i&&(i.default={duration:bT(e,12),flags:bT(e,20)})})),t}function kT(e){const t=e.subarray(8),r=t.subarray(86),i=ST(t.subarray(4,8));let n=i;const s="enca"===i||"encv"===i;if(s){const e=LT(t,[i])[0];LT(e.subarray("enca"===i?28:78),["sinf"]).forEach((e=>{const t=LT(e,["schm"])[0];if(t){const r=ST(t.subarray(4,8));if("cbcs"===r||"cenc"===r){const t=LT(e,["frma"])[0];t&&(n=ST(t))}}}))}switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const e=LT(r,["avcC"])[0];n+="."+PT(e[1])+PT(e[2])+PT(e[3]);break}case"mp4a":{const e=LT(t,[i])[0],r=LT(e.subarray(28),["esds"])[0];if(r&&r.length>12){let e=4;if(3!==r[e++])break;e=DT(r,e),e+=2;const t=r[e++];if(128&t&&(e+=2),64&t&&(e+=r[e++]),4!==r[e++])break;e=DT(r,e);const i=r[e++];if(64!==i)break;if(n+="."+PT(i),e+=12,5!==r[e++])break;e=DT(r,e);const s=r[e++];let a=(248&s)>>3;31===a&&(a+=1+((7&s)<<3)+((224&r[e])>>5)),n+="."+a}break}case"hvc1":case"hev1":{const e=LT(r,["hvcC"])[0],t=e[1],i=["","A","B","C"][t>>6],s=31&t,a=bT(e,2),o=(32&t)>>5?"H":"L",l=e[12],c=e.subarray(6,12);n+="."+i+s,n+="."+a.toString(16).toUpperCase(),n+="."+o+l;let d="";for(let r=c.length;r--;){const e=c[r];if(e||d){d="."+e.toString(16).toUpperCase()+d}}n+=d;break}case"dvh1":case"dvhe":{const e=LT(r,["dvcC"])[0],t=e[2]>>1&127,i=e[2]<<5&32|e[3]>>3&31;n+="."+OT(t)+"."+OT(i);break}case"vp09":{const e=LT(r,["vpcC"])[0],t=e[4],i=e[5],s=e[6]>>4&15;n+="."+OT(t)+"."+OT(i)+"."+OT(s);break}case"av01":{const e=LT(r,["av1C"])[0],t=e[1]>>>5,i=31&e[1],s=e[2]>>>7?"H":"M",a=(64&e[2])>>6,o=(32&e[2])>>5,l=2===t&&a?o?12:10:a?10:8,c=(16&e[2])>>4,d=(8&e[2])>>3,u=(4&e[2])>>2,h=3&e[2],f=1,p=1,m=1,g=0;n+="."+t+"."+OT(i)+s+"."+OT(l)+"."+c+"."+d+u+h+"."+OT(f)+"."+OT(p)+"."+OT(m)+"."+g;break}}return{codec:n,encrypted:s}}function DT(e,t){const r=t+5;for(;128&e[t++]&&t<r;);return t}function PT(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function OT(e){return(e<10?"0":"")+e}function xT(e){const t=LT(e,["schm"])[0];if(t){const r=ST(t.subarray(4,8));if("cbcs"===r||"cenc"===r)return LT(e,["schi","tenc"])[0]}return RS.error("[eme] missing 'schm' box"),null}function MT(e){const t=bT(e,0);let r=8;1&t&&(r+=4),4&t&&(r+=4);let i=0;const n=bT(e,4);for(let s=0;s<n;s++){if(256&t){i+=bT(e,r),r+=4}512&t&&(r+=4),1024&t&&(r+=4),2048&t&&(r+=4)}return i}function NT(e,t){const r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function FT(e,t){const r=[],i=t.samples,n=t.timescale,s=t.id;let a=!1;return LT(i,["moof"]).map((o=>{const l=o.byteOffset-8;LT(o,["traf"]).map((o=>{const c=LT(o,["tfdt"]).map((e=>{const t=e[0];let r=bT(e,4);return 1===t&&(r*=Math.pow(2,32),r+=bT(e,8)),r/n}))[0];return void 0!==c&&(e=c),LT(o,["tfhd"]).map((c=>{const d=bT(c,4),u=16777215&bT(c,0);let h=0;const f=!!(16&u);let p=0;const m=!!(32&u);let g=8;d===s&&(!!(1&u)&&(g+=8),!!(2&u)&&(g+=4),!!(8&u)&&(h=bT(c,g),g+=4),f&&(p=bT(c,g),g+=4),m&&(g+=4),"video"===t.type&&(a=function(e){if(!e)return!1;const t=e.indexOf("."),r=t<0?e:e.substring(0,t);return"hvc1"===r||"hev1"===r||"dvh1"===r||"dvhe"===r}(t.codec)),LT(o,["trun"]).map((s=>{const o=s[0],c=16777215&bT(s,0),d=!!(1&c);let u=0;const f=!!(4&c),m=!!(256&c);let g=0;const y=!!(512&c);let _=0;const v=!!(1024&c),E=!!(2048&c);let S=0;const T=bT(s,4);let b=8;d&&(u=bT(s,b),b+=4),f&&(b+=4);let R=u+l;for(let l=0;l<T;l++){if(m?(g=bT(s,b),b+=4):g=h,y?(_=bT(s,b),b+=4):_=p,v&&(b+=4),E&&(S=0===o?bT(s,b):wT(s,b),b+=4),t.type===PS){let t=0;for(;t<_;){const s=bT(i,R);if(R+=4,UT(a,i[R])){BT(i.subarray(R,R+s),a?2:1,e+S/n,r)}R+=s,t+=s+4}}e+=g/n}})))}))}))})),r}function UT(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function BT(e,t,r,i){const n=HT(e);let s=0;s+=t;let a=0,o=0,l=0;for(;s<n.length;){a=0;do{if(s>=n.length)break;l=n[s++],a+=l}while(255===l);o=0;do{if(s>=n.length)break;l=n[s++],o+=l}while(255===l);const e=n.length-s;let t=s;if(o<e)s+=o;else if(o>e){RS.error(`Malformed SEI payload. ${o} is too small, only ${e} bytes left to parse.`);break}if(4===a){if(181===n[t++]){const e=TT(n,t);if(t+=2,49===e){const e=bT(n,t);if(t+=4,1195456820===e){const e=n[t++];if(3===e){const s=n[t++],o=64&s,l=o?2+3*(31&s):0,c=new Uint8Array(l);if(o){c[0]=s;for(let e=1;e<l;e++)c[e]=n[t++]}i.push({type:e,payloadType:a,pts:r,bytes:c})}}}}}else if(5===a&&o>16){const e=[];for(let r=0;r<16;r++){const i=n[t++].toString(16);e.push(1==i.length?"0"+i:i),3!==r&&5!==r&&7!==r&&9!==r||e.push("-")}const s=o-16,l=new Uint8Array(s);for(let r=0;r<s;r++)l[r]=n[t++];i.push({payloadType:a,pts:r,uuid:e.join(""),userData:pT(l),userDataBytes:l})}}}function HT(e){const t=e.byteLength,r=[];let i=1;for(;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return e;const n=t-r.length,s=new Uint8Array(n);let a=0;for(i=0;i<n;a++,i++)a===r[0]&&(a++,r.shift()),s[i]=e[a];return s}function jT(e,t,r){if(16!==e.byteLength)throw new RangeError("Invalid system id");let i,n,s;if(t){i=1,n=new Uint8Array(16*t.length);for(let e=0;e<t.length;e++){const r=t[e];if(16!==r.byteLength)throw new RangeError("Invalid key");n.set(r,16*e)}}else i=0,n=new Uint8Array;i>0?(s=new Uint8Array(4),t.length>0&&new DataView(s.buffer).setUint32(0,t.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return r&&r.byteLength>0&&new DataView(a.buffer).setUint32(0,r.byteLength,!1),function(e,...t){const r=t.length;let i=8,n=r;for(;n--;)i+=t[n].byteLength;const s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=255&i,s.set(e,4),n=0,i=8;n<r;n++)s.set(t[n],i),i+=t[n].byteLength;return s}([112,115,115,104],new Uint8Array([i,0,0,0]),e,s,n,a,r||new Uint8Array)}let VT={};class GT{static clearKeyUriToKeyIdMap(){VT={}}constructor(e,t,r,i=[1],n=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=n,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case zS:case WS:case KS:case GS:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof e&&("AES-128"!==this.method||this.iv||RS.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const t=function(e){const t=new Uint8Array(16);for(let r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}(e);return new GT(this.method,this.uri,"identity",this.keyFormatVersions,t)}const t=BS(this.uri);if(t)switch(this.keyFormat){case WS:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case KS:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=jT(e,null,t);const r=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),i=String.fromCharCode.apply(null,Array.from(r)),n=i.substring(i.indexOf("<"),i.length),s=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(s){const e=s.childNodes[0]?s.childNodes[0].nodeValue:s.getAttribute("VALUE");if(e){const t=US(e).subarray(0,16);!function(e){const t=function(e,t,r){const i=e[t];e[t]=e[r],e[r]=i};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}(t),this.keyId=t}}break}default:{let e=t.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=VT[this.uri];if(!e){const t=Object.keys(VT).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);new DataView(e.buffer,12,4).setUint32(0,t),VT[this.uri]=e}this.keyId=e}return this}}const zT=/\{\$([a-zA-Z0-9-_]+)\}/g;function KT(e){return zT.test(e)}function WT(e,t,r){if(null!==e.variableList||e.hasVariableRefs)for(let i=r.length;i--;){const n=r[i],s=t[n];s&&(t[n]=$T(e,s))}}function $T(e,t){if(null!==e.variableList||e.hasVariableRefs){const r=e.variableList;return t.replace(zT,(t=>{const i=t.substring(2,t.length-1),n=null==r?void 0:r[i];return void 0===n?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),t):n}))}return t}function YT(e,t,r){let i,n,s=e.variableList;if(s||(e.variableList=s={}),"QUERYPARAM"in t){i=t.QUERYPARAM;try{const e=new self.URL(r).searchParams;if(!e.has(i))throw new Error(`"${i}" does not match any query parameter in URI: "${r}"`);n=e.get(i)}catch(IU){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${IU.message}`))}}else i=t.NAME,n=t.VALUE;i in s?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):s[i]=n||""}function qT(e,t,r){const i=t.IMPORT;if(r&&i in r){let t=e.variableList;t||(e.variableList=t={}),t[i]=r[i]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}function ZT(e=!0){if("undefined"==typeof self)return;return(e||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}const XT={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function JT(e,t,r=!0){return!e.split(",").some((e=>!QT(e,t,r)))}function QT(e,t,r=!0){var i;const n=ZT(r);return null!=(i=null==n?void 0:n.isTypeSupported(eb(e,t)))&&i}function eb(e,t){return`${t}/mp4;codecs="${e}"`}function tb(e){if(e){const t=e.substring(0,4);return XT.video[t]}return 2}function rb(e){return e.split(",").reduce(((e,t)=>{const r=XT.video[t];return r?(2*r+e)/(e?3:2):(XT.audio[t]+e)/(e?2:1)}),0)}const ib={};const nb=/flac|opus/i;function sb(e,t=!0){return e.replace(nb,(e=>function(e,t=!0){if(ib[e])return ib[e];const r={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[e];for(let i=0;i<r.length;i++)if(QT(r[i],"audio",t))return ib[e]=r[i],r[i];return e}(e.toLowerCase(),t)))}function ab(e,t){return e&&"mp4a"!==e?e:t}const ob=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,lb=/#EXT-X-MEDIA:(.*)/g,cb=/^#EXT(?:INF|-X-TARGETDURATION):/m,db=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),ub=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class hb{static findGroup(e,t){for(let r=0;r<e.length;r++){const i=e[r];if(i.id===t)return i}}static resolve(e,t){return lS.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return cb.test(e)}static parseMasterPlaylist(e,t){const r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:KT(e)},i=[];let n;for(ob.lastIndex=0;null!=(n=ob.exec(e));)if(n[1]){var s;const e=new LS(n[1]);WT(r,e,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const a=$T(r,n[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:hb.resolve(a,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),mb(e.CODECS,o),null!=(s=o.unknownCodecs)&&s.length||i.push(o),r.levels.push(o)}else if(n[3]){const e=n[3],i=n[4];switch(e){case"SESSION-DATA":{const e=new LS(i);WT(r,e,["DATA-ID","LANGUAGE","VALUE","URI"]);const t=e["DATA-ID"];t&&(null===r.sessionData&&(r.sessionData={}),r.sessionData[t]=e);break}case"SESSION-KEY":{const e=fb(i,t,r);e.encrypted&&e.isSupported()?(null===r.sessionKeys&&(r.sessionKeys=[]),r.sessionKeys.push(e)):RS.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${i}"`);break}case"DEFINE":{const e=new LS(i);WT(r,e,["NAME","VALUE","QUERYPARAM"]),YT(r,e,t)}break;case"CONTENT-STEERING":{const e=new LS(i);WT(r,e,["SERVER-URI","PATHWAY-ID"]),r.contentSteering={uri:hb.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":r.startTimeOffset=pb(i)}}const a=i.length>0&&i.length<r.levels.length;return r.levels=a?i:r.levels,0===r.levels.length&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,r){let i;const n={},s=r.levels,a={AUDIO:s.map((e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec}))),SUBTITLES:s.map((e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec}))),"CLOSED-CAPTIONS":[]};let o=0;for(lb.lastIndex=0;null!==(i=lb.exec(e));){const e=new LS(i[1]),s=e.TYPE;if(s){const i=a[s],l=n[s]||[];n[s]=l,WT(r,e,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const c=e.LANGUAGE,d=e["ASSOC-LANGUAGE"],u=e.CHANNELS,h=e.CHARACTERISTICS,f=e["INSTREAM-ID"],p={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||c||"",type:s,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:c,url:e.URI?hb.resolve(e.URI,t):""};if(d&&(p.assocLang=d),u&&(p.channels=u),h&&(p.characteristics=h),f&&(p.instreamId=f),null!=i&&i.length){const e=hb.findGroup(i,p.groupId)||i[0];gb(p,e,"audioCodec"),gb(p,e,"textCodec")}l.push(p)}}return n}static parseLevelPlaylist(e,t,r,i,n,s){const a=new FS(t),o=a.fragments;let l,c,d,u=null,h=0,f=0,p=0,m=0,g=null,y=new MS(i,t),_=-1,v=!1,E=null;for(db.lastIndex=0,a.m3u8=e,a.hasVariableRefs=KT(e);null!==(l=db.exec(e));){v&&(v=!1,y=new MS(i,t),y.start=p,y.sn=h,y.cc=m,y.level=r,u&&(y.initSegment=u,y.rawProgramDateTime=u.rawProgramDateTime,u.rawProgramDateTime=null,E&&(y.setByteRange(E),E=null)));const e=l[1];if(e){y.duration=parseFloat(e);const t=(" "+l[2]).slice(1);y.title=t||null,y.tagList.push(t?["INF",e,t]:["INF",e])}else if(l[3]){if(pS(y.duration)){y.start=p,d&&vb(y,d,a),y.sn=h,y.level=r,y.cc=m,o.push(y);const e=(" "+l[3]).slice(1);y.relurl=$T(a,e),yb(y,g),g=y,p+=y.duration,h++,f=0,v=!0}}else if(l[4]){const e=(" "+l[4]).slice(1);g?y.setByteRange(e,g):y.setByteRange(e)}else if(l[5])y.rawProgramDateTime=(" "+l[5]).slice(1),y.tagList.push(["PROGRAM-DATE-TIME",y.rawProgramDateTime]),-1===_&&(_=o.length);else{if(l=l[0].match(ub),!l){RS.warn("No matches on slow regex match for level playlist!");continue}for(c=1;c<l.length&&void 0===l[c];c++);const e=(" "+l[c]).slice(1),n=(" "+l[c+1]).slice(1),p=l[c+2]?(" "+l[c+2]).slice(1):"";switch(e){case"PLAYLIST-TYPE":a.type=n.toUpperCase();break;case"MEDIA-SEQUENCE":h=a.startSN=parseInt(n);break;case"SKIP":{const e=new LS(n);WT(a,e,["RECENTLY-REMOVED-DATERANGES"]);const t=e.decimalInteger("SKIPPED-SEGMENTS");if(pS(t)){a.skippedSegments=t;for(let e=t;e--;)o.unshift(null);h+=t}const r=e.enumeratedString("RECENTLY-REMOVED-DATERANGES");r&&(a.recentlyRemovedDateranges=r.split("\t"));break}case"TARGETDURATION":a.targetduration=Math.max(parseInt(n),1);break;case"VERSION":a.version=parseInt(n);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(n||p)&&y.tagList.push(p?[n,p]:[n]);break;case"DISCONTINUITY":m++,y.tagList.push(["DIS"]);break;case"GAP":y.gap=!0,y.tagList.push([e]);break;case"BITRATE":y.tagList.push([e,n]);break;case"DATERANGE":{const e=new LS(n);WT(a,e,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),WT(a,e,e.clientAttrs);const t=new IS(e,a.dateRanges[e.ID]);t.isValid||a.skippedSegments?a.dateRanges[t.id]=t:RS.warn(`Ignoring invalid DATERANGE tag: "${n}"`),y.tagList.push(["EXT-X-DATERANGE",n]);break}case"DEFINE":{const e=new LS(n);WT(a,e,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in e?qT(a,e,s):YT(a,e,t)}break;case"DISCONTINUITY-SEQUENCE":m=parseInt(n);break;case"KEY":{const e=fb(n,t,a);if(e.isSupported()){if("NONE"===e.method){d=void 0;break}d||(d={}),d[e.keyFormat]&&(d=fS({},d)),d[e.keyFormat]=e}else RS.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${n}"`);break}case"START":a.startTimeOffset=pb(n);break;case"MAP":{const e=new LS(n);if(WT(a,e,["BYTERANGE","URI"]),y.duration){const n=new MS(i,t);_b(n,e,r,d),u=n,y.initSegment=u,u.rawProgramDateTime&&!y.rawProgramDateTime&&(y.rawProgramDateTime=u.rawProgramDateTime)}else{const t=y.byteRangeEndOffset;if(t){const e=y.byteRangeStartOffset;E=`${t-e}@${e}`}else E=null;_b(y,e,r,d),u=y,v=!0}break}case"SERVER-CONTROL":{const e=new LS(n);a.canBlockReload=e.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=e.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&e.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=e.optionalFloat("PART-HOLD-BACK",0),a.holdBack=e.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const e=new LS(n);a.partTarget=e.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=a.partList;e||(e=a.partList=[]);const r=f>0?e[e.length-1]:void 0,i=f++,s=new LS(n);WT(a,s,["BYTERANGE","URI"]);const o=new NS(s,y,t,i,r);e.push(o),y.duration+=o.duration;break}case"PRELOAD-HINT":{const e=new LS(n);WT(a,e,["URI"]),a.preloadHint=e;break}case"RENDITION-REPORT":{const e=new LS(n);WT(a,e,["URI"]),a.renditionReports=a.renditionReports||[],a.renditionReports.push(e);break}default:RS.warn(`line parsed but not handled: ${l}`)}}}g&&!g.relurl?(o.pop(),p-=g.duration,a.partList&&(a.fragmentHint=g)):a.partList&&(yb(y,g),y.cc=m,a.fragmentHint=y,d&&vb(y,d,a));const S=o.length,T=o[0],b=o[S-1];if(p+=a.skippedSegments*a.targetduration,p>0&&S&&b){a.averagetargetduration=p/S;const e=b.sn;a.endSN="initSegment"!==e?e:0,a.live||(b.endList=!0),T&&(a.startCC=T.cc)}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(p+=a.fragmentHint.duration),a.totalduration=p,a.endCC=m,_>0&&function(e,t){let r=e[t];for(let i=t;i--;){const t=e[i];if(!t)return;t.programDateTime=r.programDateTime-1e3*t.duration,r=t}}(o,_),a}}function fb(e,t,r){var i,n;const s=new LS(e);WT(r,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const a=null!=(i=s.METHOD)?i:"",o=s.URI,l=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,d=null!=(n=s.KEYFORMAT)?n:"identity";o&&s.IV&&!l&&RS.error(`Invalid IV: ${s.IV}`);const u=o?hb.resolve(o,t):"",h=(c||"1").split("/").map(Number).filter(Number.isFinite);return new GT(a,u,d,h,l)}function pb(e){const t=new LS(e).decimalFloatingPoint("TIME-OFFSET");return pS(t)?t:null}function mb(e,t){let r=(e||"").split(/[ ,]+/).filter((e=>e));["video","audio","text"].forEach((e=>{const i=r.filter((t=>function(e,t){const r=XT[t];return!!r&&!!r[e.slice(0,4)]}(t,e)));i.length&&(t[`${e}Codec`]=i.join(","),r=r.filter((e=>-1===i.indexOf(e))))})),t.unknownCodecs=r}function gb(e,t,r){const i=t[r];i&&(e[r]=i)}function yb(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),pS(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function _b(e,t,r,i){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=r,e.sn="initSegment",i&&(e.levelkeys=i),e.initSegment=null}function vb(e,t,r){e.levelkeys=t;const{encryptedFragments:i}=r;i.length&&i[i.length-1].levelkeys===t||!Object.keys(t).some((e=>t[e].isCommonEncryption))||i.push(e)}var Eb="manifest",Sb="level",Tb="audioTrack",bb="subtitleTrack",Rb="main",wb="audio",Ab="subtitle";function Lb(e){const{type:t}=e;switch(t){case Tb:return wb;case bb:return Ab;default:return Rb}}function Cb(e,t){let r=e.url;return void 0!==r&&0!==r.indexOf("data:")||(r=t.url),r}class Ib{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.on(yS.LEVEL_LOADING,this.onLevelLoading,this),e.on(yS.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(yS.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.off(yS.LEVEL_LOADING,this.onLevelLoading,this),e.off(yS.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(yS.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,i=t.loader,n=new(r||i)(t);return this.loaders[e.type]=n,n}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Eb,url:r,deliveryDirectives:null})}onLevelLoading(e,t){const{id:r,level:i,pathwayId:n,url:s,deliveryDirectives:a}=t;this.load({id:r,level:i,pathwayId:n,responseType:"text",type:Sb,url:s,deliveryDirectives:a})}onAudioTrackLoading(e,t){const{id:r,groupId:i,url:n,deliveryDirectives:s}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:Tb,url:n,deliveryDirectives:s})}onSubtitleTrackLoading(e,t){const{id:r,groupId:i,url:n,deliveryDirectives:s}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:bb,url:n,deliveryDirectives:s})}load(e){var t;const r=this.hls.config;let i,n=this.getInternalLoader(e);if(n){const t=n.context;if(t&&t.url===e.url&&t.level===e.level)return void RS.trace("[playlist-loader]: playlist request ongoing");RS.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}if(i=e.type===Eb?r.manifestLoadPolicy.default:fS({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),pS(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===Sb&&null!==e.level?t=this.hls.levels[e.level].details:e.type===Tb&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===bb&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,r=t.targetduration;if(e&&r){const t=1e3*Math.max(3*e,.8*r);i=fS({},i,{maxTimeToFirstByteMs:Math.min(t,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,i.maxTimeToFirstByteMs)})}}}const s=i.errorRetry||i.timeoutRetry||{},a={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0},o={onSuccess:(e,t,r,i)=>{const n=this.getInternalLoader(r);this.resetInternalLoader(r.type);const s=e.data;0===s.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),hb.isMediaPlaylist(s)?this.handleTrackOrLevelPlaylist(e,t,r,i||null,n):this.handleMasterPlaylist(e,t,r,i)):this.handleManifestParsingError(e,r,new Error("no EXTM3U delimiter"),i||null,t)},onError:(e,t,r,i)=>{this.handleNetworkError(t,r,!1,e,i)},onTimeout:(e,t,r)=>{this.handleNetworkError(t,r,!0,void 0,e)}};n.load(e,a,o)}handleMasterPlaylist(e,t,r,i){const n=this.hls,s=e.data,a=Cb(e,r),o=hb.parseMasterPlaylist(s,a);if(o.playlistParsingError)return void this.handleManifestParsingError(e,r,o.playlistParsingError,i,t);const{contentSteering:l,levels:c,sessionData:d,sessionKeys:u,startTimeOffset:h,variableList:f}=o;this.variableList=f;const{AUDIO:p=[],SUBTITLES:m,"CLOSED-CAPTIONS":g}=hb.parseMasterPlaylistMedia(s,a,o);if(p.length){p.some((e=>!e.url))||!c[0].audioCodec||c[0].attrs.AUDIO||(RS.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new LS({}),bitrate:0,url:""}))}n.trigger(yS.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:m,captions:g,contentSteering:l,url:a,stats:t,networkDetails:i,sessionData:d,sessionKeys:u,startTimeOffset:h,variableList:f})}handleTrackOrLevelPlaylist(e,t,r,i,n){const s=this.hls,{id:a,level:o,type:l}=r,c=Cb(e,r),d=pS(o)?o:pS(a)?a:0,u=Lb(r),h=hb.parseLevelPlaylist(e.data,c,d,u,0,this.variableList);if(l===Eb){const e={attrs:new LS({}),bitrate:0,details:h,name:"",url:c};s.trigger(yS.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:c,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=h,this.handlePlaylistLoaded(h,e,t,r,i,n)}handleManifestParsingError(e,t,r,i,n){this.hls.trigger(yS.ERROR,{type:_S.NETWORK_ERROR,details:vS.MANIFEST_PARSING_ERROR,fatal:t.type===Eb,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:n})}handleNetworkError(e,t,r=!1,i,n){let s=`A network ${r?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===Sb?s+=`: ${e.level} id: ${e.id}`:e.type!==Tb&&e.type!==bb||(s+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(s);RS.warn(`[playlist-loader]: ${s}`);let o=vS.UNKNOWN,l=!1;const c=this.getInternalLoader(e);switch(e.type){case Eb:o=r?vS.MANIFEST_LOAD_TIMEOUT:vS.MANIFEST_LOAD_ERROR,l=!0;break;case Sb:o=r?vS.LEVEL_LOAD_TIMEOUT:vS.LEVEL_LOAD_ERROR,l=!1;break;case Tb:o=r?vS.AUDIO_TRACK_LOAD_TIMEOUT:vS.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case bb:o=r?vS.SUBTITLE_TRACK_LOAD_TIMEOUT:vS.SUBTITLE_LOAD_ERROR,l=!1}c&&this.resetInternalLoader(e.type);const d={type:_S.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:n};if(i){const r=(null==t?void 0:t.url)||e.url;d.response=dS({url:r,data:void 0},i)}this.hls.trigger(yS.ERROR,d)}handlePlaylistLoaded(e,t,r,i,n,s){const a=this.hls,{type:o,level:l,id:c,groupId:d,deliveryDirectives:u}=i,h=Cb(t,i),f=Lb(i),p="number"==typeof i.level&&f===Rb?l:void 0;if(!e.fragments.length){const e=new Error("No Segments found in Playlist");return void a.trigger(yS.ERROR,{type:_S.NETWORK_ERROR,details:vS.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:e,reason:e.message,response:t,context:i,level:p,parent:f,networkDetails:n,stats:r})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const m=e.playlistParsingError;if(m)a.trigger(yS.ERROR,{type:_S.NETWORK_ERROR,details:vS.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:m,reason:m.message,response:t,context:i,level:p,parent:f,networkDetails:n,stats:r});else switch(e.live&&s&&(s.getCacheAge&&(e.ageHeader=s.getCacheAge()||0),s.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case Eb:case Sb:a.trigger(yS.LEVEL_LOADED,{details:e,level:p||0,id:c||0,stats:r,networkDetails:n,deliveryDirectives:u});break;case Tb:a.trigger(yS.AUDIO_TRACK_LOADED,{details:e,id:c||0,groupId:d||"",stats:r,networkDetails:n,deliveryDirectives:u});break;case bb:a.trigger(yS.SUBTITLE_TRACK_LOADED,{details:e,id:c||0,groupId:d||"",stats:r,networkDetails:n,deliveryDirectives:u})}}}function kb(e,t){let r;try{r=new Event("addtrack")}catch(ZO){r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function Db(e,t){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(ZO){RS.debug(`[texttrack-utils]: ${ZO}`);try{const r=new self.TextTrackCue(t.startTime,t.endTime,t.text);r.id=t.id,e.addCue(r)}catch(i){RS.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}"disabled"===r&&(e.mode=r)}function Pb(e){const t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(let r=e.cues.length;r--;)e.removeCue(e.cues[r]);"disabled"===t&&(e.mode=t)}function Ob(e,t,r,i){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&e.cues.length>0){const n=function(e,t,r){const i=[],n=function(e,t){if(t<e[0].startTime)return 0;const r=e.length-1;if(t>e[r].endTime)return-1;let i=0,n=r;for(;i<=n;){const s=Math.floor((n+i)/2);if(t<e[s].startTime)n=s-1;else{if(!(t>e[s].startTime&&i<r))return s;i=s+1}}return e[i].startTime-t<t-e[n].startTime?i:n}(e,t);if(n>-1)for(let s=n,a=e.length;s<a;s++){const n=e[s];if(n.startTime>=t&&n.endTime<=r)i.push(n);else if(n.startTime>r)return i}return i}(e.cues,t,r);for(let t=0;t<n.length;t++)i&&!i(n[t])||e.removeCue(n[t])}"disabled"===n&&(e.mode=n)}function xb(e){const t=[];for(let r=0;r<e.length;r++){const i=e[r];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||t.push(e[r])}return t}var Mb="org.id3",Nb="com.apple.quicktime.HLS",Fb="https://aomedia.org/emsg/ID3";function Ub(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function Bb(e,t,r,i,n){let s=new e(t,r,"");try{s.value=i,n&&(s.type=n)}catch(a){s=new e(t,r,JSON.stringify(n?dS({type:n},i):i))}return s}const Hb=(()=>{const e=Ub();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function jb(e,t){return e.getTime()/1e3-t}class Vb{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(yS.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(yS.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.on(yS.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(yS.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(yS.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(yS.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(yS.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.off(yS.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(yS.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(yS.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(Pb(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if("metadata"===r.kind&&"id3"===r.label)return kb(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:i}}}=this;if(!r&&!i)return;const{samples:n}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const s=Ub();if(s)for(let a=0;a<n.length;a++){const e=n[a].type;if(e===Fb&&!r||!i)continue;const t=lT(n[a].data);if(t){const r=n[a].pts;let i=r+n[a].duration;i>Hb&&(i=Hb);i-r<=0&&(i=r+.25);for(let n=0;n<t.length;n++){const a=t[n];if(!aT(a)){this.updateId3CueEnds(r,e);const t=Bb(s,r,i,a,e);t&&this.id3Track.addCue(t)}}}}}updateId3CueEnds(e,t){var r;const i=null==(r=this.id3Track)?void 0:r.cues;if(i)for(let n=i.length;n--;){const r=i[n];r.type===t&&r.startTime<e&&r.endTime===Hb&&(r.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:i}){const{id3Track:n,hls:s}=this;if(!s)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:o}}=s;if(n&&(a||o)){let e;e="audio"===i?e=>e.type===Mb&&o:"video"===i?e=>e.type===Fb&&a:e=>e.type===Mb&&o||e.type===Fb&&a,Ob(n,t,r,e)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:r,id3Track:i}=this,{dateRanges:n}=t,s=Object.keys(n);if(i){const e=Object.keys(r).filter((e=>!s.includes(e)));for(let t=e.length;t--;){const n=e[t];Object.keys(r[n].cues).forEach((e=>{i.removeCue(r[n].cues[e])})),delete r[n]}}const a=t.fragments[t.fragments.length-1];if(0===s.length||!pS(null==a?void 0:a.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=a.programDateTime/1e3-a.start,l=Ub();for(let u=0;u<s.length;u++){const e=s[u],t=n[e],i=jb(t.startDate,o),a=r[e],h=(null==a?void 0:a.cues)||{};let f=(null==a?void 0:a.durationKnown)||!1,p=Hb;const m=t.endDate;if(m)p=jb(m,o),f=!0;else if(t.endOnNext&&!f){const e=s.reduce(((e,r)=>{if(r!==t.id){const i=n[r];if(i.class===t.class&&i.startDate>t.startDate&&(!e||t.startDate<e.startDate))return i}return e}),null);e&&(p=jb(e.startDate,o),f=!0)}const g=Object.keys(t.attr);for(let r=0;r<g.length;r++){const n=g[r];if("ID"===(d=n)||"CLASS"===d||"START-DATE"===d||"DURATION"===d||"END-DATE"===d||"END-ON-NEXT"===d)continue;const s=h[n];if(s)f&&!a.durationKnown&&(s.endTime=p);else if(l){let r=t.attr[n];CS(n)&&(c=r,r=Uint8Array.from(c.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer);const s=Bb(l,i,p,{key:n,data:r},Nb);s&&(s.id=e,this.id3Track.addCue(s),h[n]=s)}}r[e]={cues:h,dateRange:t,durationKnown:f}}var c,d}}class Gb{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(null===e)return null;const{holdBack:t,partHoldBack:r,targetduration:i}=e,{liveSyncDuration:n,liveSyncDurationCount:s,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&r||t;(o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==n?n:s*i);const c=i;return l+Math.min(1*this.stallCount,c)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(null===e||null===t||null===r)return null;const i=r.edge,n=e-t-this.edgeStalled,s=i-r.totalduration,a=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(s,n),a)}get drift(){const{levelDetails:e}=this;return null===e?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(yS.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(yS.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(yS.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(yS.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(yS.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(yS.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(yS.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(yS.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(yS.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(yS.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var r;t.details===vS.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(r=this.levelDetails)&&r.live&&RS.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(null===r)return;this._latency=r;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:n}=this.config;if(!i||1===n||!t.live)return;const s=this.targetLatency;if(null===s)return;const a=r-s;if(a<Math.min(this.maxLatency,s+t.targetduration)&&a>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,n)),r=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;e.playbackRate=Math.min(t,Math.max(1,r))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}const zb=["NONE","TYPE-0","TYPE-1",null];const Kb=["SDR","PQ","HLG"];var Wb="",$b="YES",Yb="v2";class qb{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Zb{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter((e=>!!e)).map((e=>e.substring(0,4))).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Xb(this._audioGroups,e)}hasSubtitleGroup(e){return Xb(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function Xb(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function Jb(e,t){const r=t.startPTS;if(pS(r)){let i,n=0;t.sn>e.sn?(n=r-e.start,i=e):(n=e.start-r,i=t),i.duration!==n&&(i.duration=n)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration}else t.start=Math.max(e.start-t.duration,0)}function Qb(e,t,r,i,n,s){i-r<=0&&(RS.warn("Fragment should have a positive duration",t),i=r+t.duration,s=n+t.duration);let a=r,o=i;const l=t.startPTS,c=t.endPTS;if(pS(l)){const e=Math.abs(l-r);pS(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,a=Math.max(r,l),r=Math.min(r,l),n=Math.min(n,t.startDTS),o=Math.min(i,c),i=Math.max(i,c),s=Math.max(s,t.endDTS)}const d=r-t.start;0!==t.start&&(t.start=r),t.duration=i-t.start,t.startPTS=r,t.maxStartPTS=a,t.startDTS=n,t.endPTS=i,t.minEndPTS=o,t.endDTS=s;const u=t.sn;if(!e||u<e.startSN||u>e.endSN)return 0;let h;const f=u-e.startSN,p=e.fragments;for(p[f]=t,h=f;h>0;h--)Jb(p[h],p[h-1]);for(h=f;h<p.length-1;h++)Jb(p[h],p[h+1]);return e.fragmentHint&&Jb(p[p.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function eR(e,t){let r=null;const i=e.fragments;for(let l=i.length-1;l>=0;l--){const e=i[l].initSegment;if(e){r=e;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;let n,s=0;if(function(e,t,r){const i=t.skippedSegments,n=Math.max(e.startSN,t.startSN)-t.startSN,s=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let c=n;c<=s;c++){const e=l[a+c];let n=o[c];i&&!n&&c<i&&(n=t.fragments[c]=e),e&&n&&r(e,n)}}(e,t,((e,i)=>{e.relurl&&(s=e.cc-i.cc),pS(e.startPTS)&&pS(e.endPTS)&&(i.start=i.startPTS=e.startPTS,i.startDTS=e.startDTS,i.maxStartPTS=e.maxStartPTS,i.endPTS=e.endPTS,i.endDTS=e.endDTS,i.minEndPTS=e.minEndPTS,i.duration=e.endPTS-e.startPTS,i.duration&&(n=i),t.PTSKnown=t.alignedSliding=!0),i.elementaryStreams=e.elementaryStreams,i.loader=e.loader,i.stats=e.stats,e.initSegment&&(i.initSegment=e.initSegment,r=e.initSegment)})),r){(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach((e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=r)?void 0:t.relurl)||(e.initSegment=r)}))}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some((e=>!e)),t.deltaUpdateFailed){RS.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=function(e,t,r){const i=fS({},e);r&&r.forEach((e=>{delete i[e]}));return Object.keys(t).forEach((e=>{const r=new IS(t[e].attr,i[e]);r.isValid?i[e]=r:RS.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[e].attr)}"`)})),i}(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));const a=t.fragments;if(s){RS.warn("discontinuity sliding from playlist, take drift into account");for(let e=0;e<a.length;e++)a[e].cc+=s}t.skippedSegments&&(t.startCC=t.fragments[0].cc),function(e,t,r){if(e&&t){let i=0;for(let n=0,s=e.length;n<=s;n++){const s=e[n],a=t[n+i];s&&a&&s.index===a.index&&s.fragment.sn===a.fragment.sn?r(s,a):i--}}}(e.partList,t.partList,((e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),n?Qb(t,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):tR(e,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const o=t.advancedDateTime;if(t.advanced&&o){const e=t.edge;t.driftStart||(t.driftStartTime=o,t.driftStart=e),t.driftEndTime=o,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function tR(e,t){const r=t.startSN+t.skippedSegments-e.startSN,i=e.fragments;r<0||r>=i.length||rR(t,i[r].start)}function rR(e,t){if(t){const r=e.fragments;for(let i=e.skippedSegments;i<r.length;i++)r[i].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function iR(e,t,r){var i;return null!=e&&e.details?nR(null==(i=e.details)?void 0:i.partList,t,r):null}function nR(e,t,r){if(e)for(let i=e.length;i--;){const n=e[i];if(n.index===r&&n.fragment.sn===t)return n}return null}function sR(e){e.forEach(((e,t)=>{const{details:r}=e;null!=r&&r.fragments&&r.fragments.forEach((e=>{e.level=t}))}))}function aR(e){switch(e.details){case vS.FRAG_LOAD_TIMEOUT:case vS.KEY_LOAD_TIMEOUT:case vS.LEVEL_LOAD_TIMEOUT:case vS.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function oR(e,t){const r=aR(t);return e.default[(r?"timeout":"error")+"Retry"]}function lR(e,t){const r="linear"===e.backoff?1:Math.pow(2,t);return Math.min(r*e.retryDelayMs,e.maxRetryDelayMs)}function cR(e){return dS(dS({},e),{errorRetry:null,timeoutRetry:null})}function dR(e,t,r,i){if(!e)return!1;const n=null==i?void 0:i.code,s=t<e.maxNumRetry&&(function(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}(n)||!!r);return e.shouldRetry?e.shouldRetry(e,t,r,i,s):s}const uR=function(e,t){let r=0,i=e.length-1,n=null,s=null;for(;r<=i;){n=(r+i)/2|0,s=e[n];const a=t(s);if(a>0)r=n+1;else{if(!(a<0))return s;i=n-1}}return null};function hR(e,t,r=0,i=0){let n=null;if(e){n=t[e.sn-t[0].sn+1]||null;const i=e.endDTS-r;i>0&&i<15e-7&&(r+=15e-7)}else 0===r&&0===t[0].start&&(n=t[0]);if(n&&(!e||e.level===n.level)&&0===fR(r,i,n))return n;const s=uR(t,fR.bind(null,r,i));return!s||s===e&&n?n:s}function fR(e=0,t=0,r){if(r.start<=e&&r.start+r.duration>e)return 0;const i=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-i<=e?1:r.start-i>e&&r.start?-1:0}function pR(e,t,r){const i=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-i>e}var mR=0,gR=2,yR=3,_R=5,vR=0,ER=1,SR=2;class TR{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=RS.log.bind(RS,`${t}:`),this.warn=RS.warn.bind(RS,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t){const r=null==t?void 0:t.renditionReports;if(r){let i=-1;for(let n=0;n<r.length;n++){const s=r[n];let a;try{a=new self.URL(s.URI,t.url).href}catch(IU){RS.warn(`Could not construct new URL for Rendition Report: ${IU}`),a=s.URI||""}if(a===e){i=n;break}a===e.substring(0,a.length)&&(i=n)}if(-1!==i){const e=r[i],n=parseInt(e["LAST-MSN"])||(null==t?void 0:t.lastPartSn);let s=parseInt(e["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);s>=0&&e>t.partTarget&&(s+=1)}return new qb(n,s>=0?s:void 0,Wb)}}}loadPlaylist(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,r){const{details:i,stats:n}=t,s=self.performance.now(),a=n.loading.first?Math.max(0,s-n.loading.first):0;if(i.advancedDateTime=Date.now()-a,i.live||null!=r&&r.live){if(i.reloaded(r),r&&this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),r&&i.fragments.length>0&&eR(r,i),!this.canLoad||!i.live)return;let a,o,l;if(i.canBlockReload&&i.endSN&&i.advanced){const e=this.hls.config.lowLatencyMode,n=i.lastPartSn,s=i.endSN,c=i.lastPartIndex,d=n===s;-1!==c?(o=d?s+1:n,l=d?e?0:c:c+1):o=s+1;const u=i.age,h=u+i.ageHeader;let f=Math.min(h-i.partTarget,1.5*i.targetduration);if(f>0){if(r&&f>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${f} with playlist age: ${i.age}`),f=0;else{const e=Math.floor(f/i.targetduration);if(o+=e,void 0!==l){l+=Math.round(f%i.targetduration/i.partTarget)}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${u.toFixed(2)}s goal: ${f} skip sn ${e} to part ${l}`)}i.tuneInGoal=f}if(a=this.getDeliveryDirectives(i,t.deliveryDirectives,o,l),e||!d)return void this.loadPlaylist(a)}else(i.canBlockReload||i.canSkipUntil)&&(a=this.getDeliveryDirectives(i,t.deliveryDirectives,o,l));const c=this.hls.mainForwardBufferInfo,d=c?c.end-c.len:0,u=function(e,t=1/0){let r=1e3*e.targetduration;if(e.updated){const i=e.fragments,n=4;if(i.length&&r*n>t){const e=1e3*i[i.length-1].duration;e<r&&(r=e)}}else r/=2;return Math.round(r)}(i,1e3*(i.edge-d));i.updated&&s>this.requestScheduled+u&&(this.requestScheduled=n.loading.start),void 0!==o&&i.canBlockReload?this.requestScheduled=n.loading.first+u-(1e3*i.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+u<s?this.requestScheduled=s:this.requestScheduled-s<=0&&(this.requestScheduled+=u);let h=this.requestScheduled-s;h=Math.max(0,h),this.log(`reload live playlist ${e} in ${Math.round(h)} ms`),this.timer=self.setTimeout((()=>this.loadPlaylist(a)),h)}else this.clearTimer()}getDeliveryDirectives(e,t,r,i){let n=function(e,t){const{canSkipUntil:r,canSkipDateRanges:i,endSN:n}=e;return r&&(void 0!==t?t-n:0)<r?i?Yb:$b:Wb}(e,r);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,n=Wb),new qb(r,i,n)}checkRetry(e){const t=e.details,r=aR(e),i=e.errorAction,{action:n,retryCount:s=0,retryConfig:a}=i||{},o=!!i&&!!a&&(n===_R||!i.resolved&&n===gR);if(o){var l;if(this.requestScheduled=-1,s>=a.maxNumRetry)return!1;if(r&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${s+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=lR(a,s);this.timer=self.setTimeout((()=>this.loadPlaylist()),e),this.warn(`Retrying playlist loading ${s+1}/${a.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,i.resolved=!0}return o}}class bR{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class RR{constructor(e,t,r,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new bR(e),this.fast_=new bR(t),this.defaultTTFB_=i,this.ttfb_=new bR(e)}update(e,t){const{slow_:r,fast_:i,ttfb_:n}=this;r.halfLife!==e&&(this.slow_=new bR(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new bR(t,i.getEstimate(),i.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new bR(e,n.getEstimate(),n.getTotalWeight()))}sample(e,t){const r=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/r;this.fast_.sample(r,i),this.slow_.sample(r,i)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const wR={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},AR={};function LR(e,t,r,i,n,s){const a=e.audioCodec?e.audioGroups:null,o=null==s?void 0:s.audioCodec,l=null==s?void 0:s.channels,c=l?parseInt(l):o?1/0:2;let d=null;if(null!=a&&a.length)try{d=1===a.length&&a[0]?t.groups[a[0]].channels:a.reduce(((e,r)=>{if(r){const i=t.groups[r];if(!i)throw new Error(`Audio track group ${r} not found`);Object.keys(i.channels).forEach((t=>{e[t]=(e[t]||0)+i.channels[t]}))}return e}),{2:0})}catch(IU){return!0}return void 0!==e.videoCodec&&(e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(i,30)||"SDR"!==e.videoRange&&e.videoRange!==r||e.bitrate>Math.max(n,8e6))||!!d&&pS(c)&&Object.keys(d).some((e=>parseInt(e)>c))}function CR(e,t,r){const i=e.videoCodec,n=e.audioCodec;if(!i||!n||!r)return Promise.resolve(wR);const s={width:e.width,height:e.height,bitrate:Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)),framerate:e.frameRate||30},a=e.videoRange;"SDR"!==a&&(s.transferFunction=a.toLowerCase());const o=i.split(",").map((e=>({type:"media-source",video:dS(dS({},s),{},{contentType:eb(e,"video")})})));return n&&e.audioGroups&&e.audioGroups.forEach((e=>{var r;e&&(null==(r=t.groups[e])||r.tracks.forEach((t=>{if(t.groupId===e){const e=t.channels||"",r=parseFloat(e);pS(r)&&r>2&&o.push.apply(o,n.split(",").map((e=>({type:"media-source",audio:{contentType:eb(e,"audio"),channels:""+r}}))))}})))})),Promise.all(o.map((e=>{const t=function(e){const{audio:t,video:r}=e,i=r||t;if(i){const e=i.contentType.split('"')[1];if(r)return`r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${e}_${Math.ceil(r.bitrate/1e5)}`;if(t)return`c${t.channels}${t.spatialRendering?"s":"n"}_${e}`}return""}(e);return AR[t]||(AR[t]=r.decodingInfo(e))}))).then((e=>({supported:!e.some((e=>!e.supported)),configurations:o,decodingInfoResults:e}))).catch((e=>({supported:!1,configurations:o,decodingInfoResults:[],error:e})))}function IR(e,t){let r=!1,i=[];return e&&(r="SDR"!==e,i=[e]),t&&(i=t.allowedVideoRanges||Kb.slice(0),r=void 0!==t.preferHDR?t.preferHDR:function(){if("function"==typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),i=r?i.filter((e=>"SDR"!==e)):["SDR"]),{preferHDR:r,allowedVideoRanges:i}}function kR(e,t){RS.log(`[abr] start candidates with "${e}" ignored because ${t}`)}function DR(e,t,r){if("attrs"in e){const r=t.indexOf(e);if(-1!==r)return r}for(let i=0;i<t.length;i++){if(PR(e,t[i],r))return i}return-1}function PR(e,t,r){const{groupId:i,name:n,lang:s,assocLang:a,characteristics:o,default:l}=e,c=e.forced;return(void 0===i||t.groupId===i)&&(void 0===n||t.name===n)&&(void 0===s||t.lang===s)&&(void 0===s||t.assocLang===a)&&(void 0===l||t.default===l)&&(void 0===c||t.forced===c)&&(void 0===o||function(e,t=""){const r=e.split(","),i=t.split(",");return r.length===i.length&&!r.some((e=>-1===i.indexOf(e)))}(o,t.characteristics))&&(void 0===r||r(e,t))}function OR(e,t){const{audioCodec:r,channels:i}=e;return!(void 0!==r&&(t.audioCodec||"").substring(0,4)!==r.substring(0,4)||void 0!==i&&i!==(t.channels||"2"))}function xR(e,t,r){for(let i=t;i;i--)if(r(e[i]))return i;for(let i=t+1;i<e.length;i++)if(r(e[i]))return i;return-1}class MR{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var NR="NOT_LOADED",FR="APPENDING",UR="PARTIAL",BR="OK";class HR{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(yS.BUFFER_APPENDED,this.onBufferAppended,this),e.on(yS.FRAG_BUFFERED,this.onFragBuffered,this),e.on(yS.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(yS.BUFFER_APPENDED,this.onBufferAppended,this),e.off(yS.FRAG_BUFFERED,this.onFragBuffered,this),e.off(yS.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let i=r.length;i--;){const t=r[i];if(!t)break;const n=t.end;if(t.start<=e&&null!==n&&e<=n)return t}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:r}=this,i=Object.keys(r);for(let n=i.length;n--;){const s=r[i[n]];if((null==s?void 0:s.body.type)===t&&s.buffered){const t=s.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,r,i){this.timeRanges&&(this.timeRanges[e]=t);const n=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach((i=>{const s=this.fragments[i];if(!s)return;if(n>=s.body.sn)return;if(!s.buffered&&!s.loaded)return void(s.body.type===r&&this.removeFragment(s.body));const a=s.range[e];a&&a.time.some((e=>{const r=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return r&&this.removeFragment(s.body),r}))}))}detectPartialFragments(e){const t=this.timeRanges,{frag:r,part:i}=e;if(!t||"initSegment"===r.sn)return;const n=VR(r),s=this.fragments[n];if(!s||s.buffered&&r.gap)return;const a=!r.relurl;if(Object.keys(t).forEach((e=>{const n=r.elementaryStreams[e];if(!n)return;const o=t[e],l=a||!0===n.partial;s.range[e]=this.getBufferedTimes(r,i,l,o)})),s.loaded=null,Object.keys(s.range).length){s.buffered=!0;(s.body.endList=r.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),jR(s)||this.removeParts(r.sn-1,r.type)}else this.removeFragment(s.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter((t=>t.fragment.sn>=e)))}fragBuffered(e,t){const r=VR(e);let i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,r,i){const n={time:[],partial:r},s=e.start,a=e.end,o=e.minEndPTS||a,l=e.maxStartPTS||s;for(let c=0;c<i.length;c++){const e=i.start(c)-this.bufferPadding,t=i.end(c)+this.bufferPadding;if(l>=e&&o<=t){n.time.push({startPTS:Math.max(s,i.start(c)),endPTS:Math.min(a,i.end(c))});break}if(s<t&&a>e){const e=Math.max(s,i.start(c)),t=Math.min(a,i.end(c));t>e&&(n.partial=!0,n.time.push({startPTS:e,endPTS:t}))}else if(a<=e)break}return n}getPartialFragment(e){let t,r,i,n=null,s=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach((l=>{const c=o[l];c&&jR(c)&&(r=c.body.start-a,i=c.body.end+a,e>=r&&e<=i&&(t=Math.min(e-r,i-e),s<=t&&(n=c.body,s=t)))})),n}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||jR(t))}getState(e){const t=VR(e),r=this.fragments[t];return r?r.buffered?jR(r)?UR:BR:FR:NR}isTimeBuffered(e,t,r){let i,n;for(let s=0;s<r.length;s++){if(i=r.start(s)-this.bufferPadding,n=r.end(s)+this.bufferPadding,e>=i&&t<=n)return!0;if(t<=i)return!1}return!1}onFragLoaded(e,t){const{frag:r,part:i}=t;if("initSegment"===r.sn||r.bitrateTest)return;const n=i?null:t,s=VR(r);this.fragments[s]={body:r,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:i,timeRanges:n}=t;if("initSegment"===r.sn)return;const s=r.type;if(i){let e=this.activePartLists[s];e||(this.activePartLists[s]=e=[]),e.push(i)}this.timeRanges=n,Object.keys(n).forEach((e=>{const t=n[e];this.detectEvictedFragments(e,t,s,i)}))}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=VR(e);return!!this.fragments[t]}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,r,i,n){i&&!this.hasGaps||Object.keys(this.fragments).forEach((s=>{const a=this.fragments[s];if(!a)return;const o=a.body;o.type!==r||i&&!o.gap||o.start<t&&o.end>e&&(a.buffered||n)&&this.removeFragment(o)}))}removeFragment(e){const t=VR(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const t=e.sn;this.activePartLists[e.type]=r.filter((e=>e.fragment.sn!==t))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function jR(e){var t,r,i;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(r=e.range.audio)?void 0:r.partial)||(null==(i=e.range.audiovideo)?void 0:i.partial))}function VR(e){return`${e.type}_${e.level}_${e.sn}`}const GR={length:0,start:()=>0,end:()=>0};class zR{static isBuffered(e,t){try{if(e){const r=zR.getBuffered(e);for(let e=0;e<r.length;e++)if(t>=r.start(e)&&t<=r.end(e))return!0}}catch(IU){}return!1}static bufferInfo(e,t,r){try{if(e){const i=zR.getBuffered(e),n=[];let s;for(s=0;s<i.length;s++)n.push({start:i.start(s),end:i.end(s)});return this.bufferedInfo(n,t,r)}}catch(IU){}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.sort((function(e,t){const r=e.start-t.start;return r||t.end-e.end}));let i=[];if(r)for(let l=0;l<e.length;l++){const t=i.length;if(t){const n=i[t-1].end;e[l].start-n<r?e[l].end>n&&(i[t-1].end=e[l].end):i.push(e[l])}else i.push(e[l])}else i=e;let n,s=0,a=t,o=t;for(let l=0;l<i.length;l++){const e=i[l].start,c=i[l].end;if(t+r>=e&&t<c)a=e,o=c,s=o-t;else if(t+r<e){n=e;break}}return{len:s,start:a||0,end:o||0,nextStart:n}}static getBuffered(e){try{return e.buffered}catch(t){return RS.log("failed to get media.buffered",t),GR}}}class KR{constructor(e,t,r,i=0,n=-1,s=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=r,this.size=i,this.part=n,this.partial=s}}function WR(e,t){for(let i=0,n=e.length;i<n;i++){var r;if((null==(r=e[i])?void 0:r.cc)===t)return e[i]}return null}function $R(e,t){if(e){const r=e.start+t;e.start=e.startPTS=r,e.endPTS=r+e.duration}}function YR(e,t){const r=t.fragments;for(let i=0,n=r.length;i<n;i++)$R(r[i],e);t.fragmentHint&&$R(t.fragmentHint,e),t.alignedSliding=!0}function qR(e,t,r){t&&(!function(e,t,r){if(function(e,t,r){return!(!t||!(r.endCC>r.startCC||e&&e.cc<r.startCC))}(e,r,t)){const e=function(e,t){const r=e.fragments,i=t.fragments;if(!i.length||!r.length)return void RS.log("No fragments to align");const n=WR(r,i[0].cc);if(n&&(!n||n.startPTS))return n;RS.log("No frag in previous level to align on")}(r,t);e&&pS(e.start)&&(RS.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),YR(e.start,t))}}(e,r,t),!r.alignedSliding&&t&&ZR(r,t),r.alignedSliding||!t||r.skippedSegments||tR(t,r))}function ZR(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const r=e.fragments,i=t.fragments;if(!r.length||!i.length)return;let n,s;const a=Math.min(t.endCC,e.endCC);t.startCC<a&&e.startCC<a&&(n=WR(i,a),s=WR(r,a)),n&&s||(n=i[Math.floor(i.length/2)],s=WR(r,n.cc)||r[Math.floor(r.length/2)]);const o=n.programDateTime,l=s.programDateTime;if(!o||!l)return;YR((l-o)/1e3-(s.start-n.start),e)}const XR=Math.pow(2,17);class JR{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new tw({type:_S.NETWORK_ERROR,details:vS.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(r?"part list":"url")),networkDetails:null}));this.abort();const i=this.config,n=i.fLoader,s=i.loader;return new Promise(((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some((e=>"GAP"===e[0])))return void o(ew(e));e.gap=!1}const l=this.loader=e.loader=n?new n(i):new s(i),c=QR(e),d=cR(i.fragLoadPolicy.default),u={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:XR};e.stats=l.stats,l.load(c,u,{onSuccess:(t,r,i,n)=>{this.resetLoader(e,l);let s=t.data;i.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),a({frag:e,part:null,payload:s,networkDetails:n})},onError:(t,i,n,s)=>{this.resetLoader(e,l),o(new tw({type:_S.NETWORK_ERROR,details:vS.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:dS({url:r,data:void 0},t),error:new Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:n,stats:s}))},onAbort:(t,r,i)=>{this.resetLoader(e,l),o(new tw({type:_S.NETWORK_ERROR,details:vS.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:i,stats:t}))},onTimeout:(t,r,i)=>{this.resetLoader(e,l),o(new tw({type:_S.NETWORK_ERROR,details:vS.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${u.timeout}ms`),networkDetails:i,stats:t}))},onProgress:(r,i,n,s)=>{t&&t({frag:e,part:null,payload:n,networkDetails:s})}})}))}loadPart(e,t,r){this.abort();const i=this.config,n=i.fLoader,s=i.loader;return new Promise(((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(ew(e,t));const l=this.loader=e.loader=n?new n(i):new s(i),c=QR(e,t),d=cR(i.fragLoadPolicy.default),u={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:XR};t.stats=l.stats,l.load(c,u,{onSuccess:(i,n,s,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const c={frag:e,part:t,payload:i.data,networkDetails:o};r(c),a(c)},onError:(r,i,n,s)=>{this.resetLoader(e,l),o(new tw({type:_S.NETWORK_ERROR,details:vS.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:dS({url:c.url,data:void 0},r),error:new Error(`HTTP Error ${r.code} ${r.text}`),networkDetails:n,stats:s}))},onAbort:(r,i,n)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new tw({type:_S.NETWORK_ERROR,details:vS.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:n,stats:r}))},onTimeout:(r,i,n)=>{this.resetLoader(e,l),o(new tw({type:_S.NETWORK_ERROR,details:vS.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${u.timeout}ms`),networkDetails:n,stats:r}))}})}))}updateStatsFromPart(e,t){const r=e.stats,i=t.stats,n=i.total;if(r.loaded+=i.loaded,n){const i=Math.round(e.duration/t.duration),s=Math.min(Math.round(r.loaded/n),i),a=(i-s)*Math.round(r.loaded/s);r.total=r.loaded+a}else r.total=Math.max(r.loaded,r.total);const s=r.loading,a=i.loading;s.start?s.first+=a.first-a.start:(s.start=a.start,s.first=a.first),s.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function QR(e,t=null){const r=t||e,i={frag:e,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},n=r.byteRangeStartOffset,s=r.byteRangeEndOffset;if(pS(n)&&pS(s)){var a;let t=n,r=s;if("initSegment"===e.sn&&"AES-128"===(null==(a=e.decryptdata)?void 0:a.method)){const e=s-n;e%16&&(r=s+(16-e%16)),0!==n&&(i.resetIV=!0,t=n-16)}i.rangeStart=t,i.rangeEnd=r}return i}function ew(e,t){const r=new Error(`GAP ${e.gap?"tag":"attribute"} found`),i={type:_S.MEDIA_ERROR,details:vS.FRAG_GAP,fatal:!1,frag:e,error:r,networkDetails:null};return t&&(i.part=t),(t||e).stats.aborted=!0,new tw(i)}class tw extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class rw{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class iw{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}class nw{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let i=0;i<4;i++)r[i]=t.getUint32(4*i);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],n=r[1],s=r[2],a=r[3],o=this.invSubMix,l=o[0],c=o[1],d=o[2],u=o[3],h=new Uint32Array(256);let f=0,p=0,m=0;for(m=0;m<256;m++)h[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){let r=p^p<<1^p<<2^p<<3^p<<4;r=r>>>8^255&r^99,e[f]=r,t[r]=f;const o=h[f],m=h[o],g=h[m];let y=257*h[r]^16843008*r;i[f]=y<<24|y>>>8,n[f]=y<<16|y>>>16,s[f]=y<<8|y>>>24,a[f]=y,y=16843009*g^65537*m^257*o^16843008*f,l[r]=y<<24|y>>>8,c[r]=y<<16|y>>>16,d[r]=y<<8|y>>>24,u[r]=y,f?(f=o^h[h[h[g^o]]],p^=h[h[p]]):f=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,i=0;for(;i<t.length&&r;)r=t[i]===this.key[i],i++;if(r)return;this.key=t;const n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);const s=this.ksRows=4*(n+6+1);let a,o;const l=this.keySchedule=new Uint32Array(s),c=this.invKeySchedule=new Uint32Array(s),d=this.sBox,u=this.rcon,h=this.invSubMix,f=h[0],p=h[1],m=h[2],g=h[3];let y,_;for(a=0;a<s;a++)a<n?y=l[a]=t[a]:(_=y,a%n==0?(_=_<<8|_>>>24,_=d[_>>>24]<<24|d[_>>>16&255]<<16|d[_>>>8&255]<<8|d[255&_],_^=u[a/n|0]<<24):n>6&&a%n==4&&(_=d[_>>>24]<<24|d[_>>>16&255]<<16|d[_>>>8&255]<<8|d[255&_]),l[a]=y=(l[a-n]^_)>>>0);for(o=0;o<s;o++)a=s-o,_=3&o?l[a]:l[a-4],c[o]=o<4||a<=4?_:f[d[_>>>24]]^p[d[_>>>16&255]]^m[d[_>>>8&255]]^g[d[255&_]],c[o]=c[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,r){const i=this.keySize+6,n=this.invKeySchedule,s=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],c=a[2],d=a[3],u=this.uint8ArrayToUint32Array_(r);let h=u[0],f=u[1],p=u[2],m=u[3];const g=new Int32Array(e),y=new Int32Array(g.length);let _,v,E,S,T,b,R,w,A,L,C,I,k,D;const P=this.networkToHostOrderSwap;for(;t<g.length;){for(A=P(g[t]),L=P(g[t+1]),C=P(g[t+2]),I=P(g[t+3]),T=A^n[0],b=I^n[1],R=C^n[2],w=L^n[3],k=4,D=1;D<i;D++)_=o[T>>>24]^l[b>>16&255]^c[R>>8&255]^d[255&w]^n[k],v=o[b>>>24]^l[R>>16&255]^c[w>>8&255]^d[255&T]^n[k+1],E=o[R>>>24]^l[w>>16&255]^c[T>>8&255]^d[255&b]^n[k+2],S=o[w>>>24]^l[T>>16&255]^c[b>>8&255]^d[255&R]^n[k+3],T=_,b=v,R=E,w=S,k+=4;_=s[T>>>24]<<24^s[b>>16&255]<<16^s[R>>8&255]<<8^s[255&w]^n[k],v=s[b>>>24]<<24^s[R>>16&255]<<16^s[w>>8&255]<<8^s[255&T]^n[k+1],E=s[R>>>24]<<24^s[w>>16&255]<<16^s[T>>8&255]<<8^s[255&b]^n[k+2],S=s[w>>>24]<<24^s[T>>16&255]<<16^s[b>>8&255]<<8^s[255&R]^n[k+3],y[t]=P(_^h),y[t+1]=P(S^f),y[t+2]=P(E^p),y[t+3]=P(v^m),h=A,f=L,p=C,m=I,t+=4}return y.buffer}}class sw{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(r){}null===this.subtle&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,r=t&&new DataView(e.buffer).getUint8(t-1);return r?QS(e,0,t-r):e}(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r){return this.useSoftware?new Promise(((i,n)=>{this.softwareDecrypt(new Uint8Array(e),t,r);const s=this.flush();s?i(s.buffer):n(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,r)}softwareDecrypt(e,t,r){const{currentIV:i,currentResult:n,remainderData:s}=this;this.logOnce("JS AES decrypt"),s&&(e=NT(s,e),this.remainderData=null);const a=this.getValidChunk(e);if(!a.length)return null;i&&(r=i);let o=this.softwareDecrypter;o||(o=this.softwareDecrypter=new nw),o.expandKey(t);const l=n;return this.currentResult=o.decrypt(a.buffer,0,r),this.currentIV=QS(a,-16).buffer,l||null}webCryptoDecrypt(e,t,r){const i=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new iw(i,t)),this.fastAesKey.expandKey().then((t=>{if(!i)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new rw(i,new Uint8Array(r)).decrypt(e.buffer,t)})).catch((i=>(RS.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,r))))}onWebCryptoError(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);const i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%16;return r!==e.length&&(t=QS(e,0,r),this.remainderData=QS(e,r)),t}logOnce(e){this.logEnabled&&(RS.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const aw=function(e){let t="";const r=e.length;for(let i=0;i<r;i++)t+=`[${e.start(i).toFixed(3)}-${e.end(i).toFixed(3)}]`;return t},ow="STOPPED",lw="IDLE",cw="KEY_LOADING",dw="FRAG_LOADING",uw="FRAG_LOADING_WAITING_RETRY",hw="WAITING_TRACK",fw="PARSING",pw="PARSED",mw="ENDED",gw="ERROR",yw="WAITING_INIT_PTS",_w="WAITING_LEVEL";class vw extends MR{constructor(e,t,r,i,n){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ow,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=n,this.logPrefix=i,this.log=RS.log.bind(RS,`${i}:`),this.warn=RS.warn.bind(RS,`${i}:`),this.hls=e,this.fragmentLoader=new JR(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new sw(e.config),e.on(yS.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ow}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const r=t.partList;if(null!=r&&r.length){const e=r[r.length-1];return zR.isBuffered(this.media,e.start+e.duration/2)}const i=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(i)}getLevelDetails(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levelLastLoaded)?void 0:e.details}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);const i=this.config;this.levels&&i.autoStartLoad&&this.state===ow&&this.startLoad(i.startPosition)}onMediaDetaching(){const e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:r,mediaBuffer:i,state:n}=this,s=r?r.currentTime:0,a=zR.bufferInfo(i||r,s,e.maxBufferHole);if(this.log(`media seeking to ${pS(s)?s.toFixed(3):s}, state: ${n}`),this.state===mw)this.resetLoadingState();else if(t){const r=e.maxFragLookUpTolerance,i=t.start-r,n=t.start+t.duration+r;if(!a.len||n<a.start||i>a.end){const e=s>n;(s<i||e)&&(e&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(s,1/0,this.playlistType,!0),this.lastCurrentTime=s),this.loadedmetadata||a.len||(this.nextLoadPosition=this.startPosition=s),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(yS.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=ow,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){this._doFragLoad(e,t,r,(t=>{if(this.fragContextChanged(e))return this.warn(`Fragment ${e.sn}${t.part?" p: "+t.part.index:""} of level ${e.level} was dropped during download.`),void this.fragmentTracker.removeFragment(e);e.stats.chunkCount++,this._handleFragmentLoadProgress(t)})).then((t=>{if(!t)return;const r=this.state;this.fragContextChanged(e)?(r===dw||!this.fragCurrent&&r===fw)&&(this.fragmentTracker.removeFragment(e),this.state=lw):("payload"in t&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(yS.FRAG_LOADED,t)),this._handleFragmentLoadComplete(t))})).catch((t=>{this.state!==ow&&this.state!==gw&&(this.warn(t),this.resetFragmentLoading(e))}))}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===FR){const t=e.type,i=this.getFwdBufferInfo(this.mediaBuffer,t),n=Math.max(e.duration,i?i.len:this.config.maxBufferLength);this.reduceMaxBufferLength(n)&&r.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===UR&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:r};this.hls.trigger(yS.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then((t=>{if(!t||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return t})).then((t=>{const{hls:r}=this,{payload:i}=t,n=e.decryptdata;if(i&&i.byteLength>0&&null!=n&&n.key&&n.iv&&"AES-128"===n.method){const s=self.performance.now();return this.decrypter.decrypt(new Uint8Array(i),n.key.buffer,n.iv.buffer).catch((t=>{throw r.trigger(yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t})).then((i=>{const n=self.performance.now();return r.trigger(yS.FRAG_DECRYPTED,{frag:e,payload:i,stats:{tstart:s,tdecrypt:n}}),t.payload=i,this.completeInitSegmentLoad(t)}))}return this.completeInitSegmentLoad(t)})).catch((t=>{this.state!==ow&&this.state!==gw&&(this.warn(t),this.resetFragmentLoading(e))}))}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state=lw,e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){var r,i,n,s;const a=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===Rb?"level":"track"} ${e.level} (frag:[${(null!=(r=e.startPTS)?r:NaN).toFixed(3)}-${(null!=(i=e.endPTS)?i:NaN).toFixed(3)}] > buffer:${a?aw(zR.getBuffered(a)):"(detached)"})`),"initSegment"!==e.sn){var o;if(e.type!==Ab){const t=e.elementaryStreams;if(!Object.keys(t).some((e=>!!t[e])))return void(this.state=lw)}const t=null==(o=this.levels)?void 0:o[e.level];null!=t&&t.fragmentError&&(this.log(`Resetting level fragment error count of ${t.fragmentError} on frag buffered`),t.fragmentError=0)}this.state=lw,a&&(!this.loadedmetadata&&e.type==Rb&&a.buffered.length&&(null==(n=this.fragCurrent)?void 0:n.sn)===(null==(s=this.fragPrevious)?void 0:s.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:i,partsLoaded:n}=e,s=!n||0===n.length||n.some((e=>!e)),a=new KR(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!s);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,i){var n;const s=null==t?void 0:t.details;if(!this.levels||!s)throw new Error(`frag load aborted, missing level${s?"":" detail"}s`);let a=null;if(!e.encrypted||null!=(n=e.decryptdata)&&n.key?!e.encrypted&&s.encryptedFragments.length&&this.keyLoader.loadClear(e,s.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${s.startSN}-${s.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${e.level}`),this.state=cw,this.fragCurrent=e,a=this.keyLoader.load(e).then((e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(yS.KEY_LOADED,e),this.state===cw&&(this.state=lw),e})),this.hls.trigger(yS.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),r=Math.max(e.start,r||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){const n=s.partList;if(n&&i){r>e.end&&s.fragmentHint&&(e=s.fragmentHint);const o=this.getNextPart(n,e,r);if(o>-1){const l=n[o];let c;return this.log(`Loading part sn: ${e.sn} p: ${l.index} cc: ${e.cc} of playlist [${s.startSN}-${s.endSN}] parts [0-${o}-${n.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=dw,c=a?a.then((r=>!r||this.fragContextChanged(r.frag)?null:this.doFragPartsLoad(e,l,t,i))).catch((e=>this.handleFragLoadError(e))):this.doFragPartsLoad(e,l,t,i).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(yS.FRAG_LOADING,{frag:e,part:l,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!e.url||this.loadedEndOfParts(n,r))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${s?"of ["+s.startSN+"-"+s.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),pS(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=dw;const o=this.config.progressive;let l;return l=o&&a?a.then((t=>!t||this.fragContextChanged(null==t?void 0:t.frag)?null:this.fragmentLoader.load(e,i))).catch((e=>this.handleFragLoadError(e))):Promise.all([this.fragmentLoader.load(e,o?i:void 0),a]).then((([e])=>(!o&&e&&i&&i(e),e))).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(yS.FRAG_LOADING,{frag:e,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):l}doFragPartsLoad(e,t,r,i){return new Promise(((n,s)=>{var a;const o=[],l=null==(a=r.details)?void 0:a.partList,c=t=>{this.fragmentLoader.loadPart(e,t,i).then((i=>{o[t.index]=i;const s=i.part;this.hls.trigger(yS.FRAG_LOADED,i);const a=iR(r,e.sn,t.index+1)||nR(l,e.sn,t.index+1);if(!a)return n({frag:e,part:s,partsLoaded:o});c(a)})).catch(s)};c(t)}))}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===vS.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(yS.ERROR,t)}else this.hls.trigger(yS.ERROR,{type:_S.OTHER_ERROR,details:vS.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==fw)return void(this.fragCurrent||this.state===ow||this.state===gw||(this.state=lw));const{frag:r,part:i,level:n}=t,s=self.performance.now();r.stats.parsing.end=s,i&&(i.stats.parsing.end=s),this.updateLevelTiming(r,i,n,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:i,sn:n,part:s}=e;if(null==t||!t[i])return this.warn(`Levels object was unset while buffering fragment ${n} of level ${i}. The current chunk will not be buffered.`),null;const a=t[i],o=s>-1?iR(a,n,s):null,l=o?o.fragment:function(e,t,r){if(null==e||!e.details)return null;const i=e.details;let n=i.fragments[t-i.startSN];return n||(n=i.fragmentHint,n&&n.sn===t?n:t<i.startSN&&r&&r.sn===t?r:null)}(a,n,r);return l?(r&&r!==l&&(l.stats=r.stats),{frag:l,part:o,level:a}):null}bufferFragmentData(e,t,r,i,n){var s;if(!e||this.state!==fw)return;const{data1:a,data2:o}=e;let l=a;if(a&&o&&(l=NT(a,o)),null==(s=l)||!s.length)return;const c={type:e.type,frag:t,part:r,chunkMeta:i,parent:t.type,data:l};if(this.hls.trigger(yS.BUFFER_APPENDING,c),e.dropped&&e.independent&&!r){if(n)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!zR.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const r=t.currentTime,i=zR.bufferInfo(t,r,0),n=e.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*n),a=Math.max(Math.min(e.start-s,i.end-s),r+s);e.start-a>s&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){const r=this.getLoadPosition();return pS(r)?this.getFwdBufferInfoAtPos(e,r,t):null}getFwdBufferInfoAtPos(e,t,r){const{config:{maxBufferHole:i}}=this,n=zR.bufferInfo(e,t,i);if(0===n.len&&void 0!==n.nextStart){const s=this.fragmentTracker.getBufferedFrag(t,r);if(s&&n.nextStart<s.end)return zR.bufferInfo(e,t,Math.max(n.nextStart,i))}return n}getMaxBufferLength(e){const{config:t}=this;let r;return r=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config,r=e||t.maxBufferLength;return t.maxMaxBufferLength>=r&&(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0)}getAppendedFrag(e,t=Rb){const r=this.fragmentTracker.getAppendedFrag(e,Rb);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,i=r.length;if(!i)return null;const{config:n}=this,s=r[0].start;let a;if(t.live){const o=n.initialLiveManifestSize;if(i<o)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${o})`),null;(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<s)&&(a=this.getInitialLiveFragment(t,r),this.startPosition=this.nextLoadPosition=a?this.hls.liveSyncPosition||a.start:e)}else e<=s&&(a=r[0]);if(!a){const r=n.lowLatencyMode?t.partEnd:t.fragmentEnd;a=this.getFragmentAtPosition(e,r,t)}return this.mapToInitFragWhenRequired(a)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===BR||r===UR&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,i,n){const s=e.gap,a=this.getNextFragment(this.nextLoadPosition,t);if(null===a)return a;if(e=a,s&&e&&!e.gap&&r.nextStart){const t=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,i);if(null!==t&&r.len+t.len>=n)return this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,r){let i=-1,n=!1,s=!0;for(let a=0,o=e.length;a<o;a++){const o=e[a];if(s=s&&!o.independent,i>-1&&r<o.start)break;const l=o.loaded;l?i=-1:(n||o.independent||s)&&o.fragment===t&&(i=a),n=l}return i}loadedEndOfParts(e,t){const r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e,t){const r=this.fragPrevious;let i=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),i=function(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!pS(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;r=r||0;for(let i=0;i<e.length;++i){const n=e[i];if(pR(t,r,n))return n}return null}(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const n=r.sn+1;if(n>=e.startSN&&n<=e.endSN){const s=t[n-e.startSN];r.cc===s.cc&&(i=s,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=function(e,t){return uR(e,(e=>e.cc<t?1:e.cc>t?-1:0))}(t,r.cc),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(i=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,r){const{config:i}=this;let{fragPrevious:n}=this,{fragments:s,endSN:a}=r;const{fragmentHint:o}=r,l=i.maxFragLookUpTolerance,c=r.partList,d=!!(i.lowLatencyMode&&null!=c&&c.length&&o);let u;if(d&&o&&!this.bitrateTest&&(s=s.concat(o),a=o.sn),e<t){u=hR(n,s,e,e>t-l?0:l)}else u=s[s.length-1];if(u){const e=u.sn-r.startSN,t=this.fragmentTracker.getState(u);if((t===BR||t===UR&&u.gap)&&(n=u),n&&u.sn===n.sn&&(!d||c[0].fragment.sn>u.sn)){if(n&&u.level===n.level){const t=s[e+1];u=u.sn<a&&this.fragmentTracker.getState(t)!==BR?t:null}}}return u}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const i=this.hls.liveSyncPosition,n=r.currentTime,s=e.fragments[0].start,a=e.edge,o=n>=s-t.maxFragLookUpTolerance&&n<=a;if(null!==i&&r.duration>i&&(n<i||!o)){const s=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&r.readyState<4||n<a-s)&&(this.loadedmetadata||(this.nextLoadPosition=i),r.readyState&&(this.warn(`Playback: ${n.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${i.toFixed(3)}`),r.currentTime=i))}}alignPlaylists(e,t,r){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const n=e.fragments[0].start,s=!t,a=e.alignedSliding&&pS(n);if(s||!a&&!n){const{fragPrevious:n}=this;qR(n,r,e);const s=e.fragments[0].start;return this.log(`Live playlist sliding: ${s.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${n?n.sn:"na"} fragments: ${i}`),s}return n}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let r=this.startPosition;if(r<t&&(r=-1),-1===r||-1===this.lastCurrentTime){const i=null!==this.startTimeOffset,n=i?this.startTimeOffset:e.startTimeOffset;null!==n&&pS(n)?(r=t+n,n<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Start time offset ${n} found in ${i?"multivariant":"media"} playlist, adjust startPosition to ${r}`),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===uw)||(this.state=lw)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;var i;if(this.fragContextChanged(r))return void this.warn(`Frag load error must match current frag to retry ${r.url} > ${null==(i=this.fragCurrent)?void 0:i.url}`);const n=t.details===vS.FRAG_GAP;n&&this.fragmentTracker.fragBuffered(r,!0);const s=t.errorAction,{action:a,retryCount:o=0,retryConfig:l}=s||{};if(s&&a===_R&&l){this.resetStartWhenNotLoaded(this.levelLastLoaded);const i=lR(l,o);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${o+1}/${l.maxNumRetry} in ${i}ms`),s.resolved=!0,this.retryDate=self.performance.now()+i,this.state=uw}else if(l&&s){if(this.resetFragmentErrors(e),!(o<l.maxNumRetry))return void RS.warn(`${t.details} reached or exceeded max retry (${o})`);n||a===yR||(s.resolved=!0)}else(null==s?void 0:s.action)===gR?this.state=_w:this.state=gw;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===fw||this.state===pw){const t=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,t),i=r&&r.len>.5;i&&this.reduceMaxBufferLength(r.len);const n=!i;return n&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),n}return!1}resetFragmentErrors(e){e===wb&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==ow&&(this.state=lw)}afterBufferFlushed(e,t,r){if(!e)return;const i=zR.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,r),this.state===mw&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=lw}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=e?e.details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,i){var n;const s=r.details;if(!s)return void this.warn("level.details undefined");if(!Object.keys(e.elementaryStreams).reduce(((t,n)=>{const a=e.elementaryStreams[n];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${n} duration reliably (${o})`),t||!1;const l=i?0:Qb(s,e,a.startPTS,a.endPTS,a.startDTS,a.endDTS);return this.hls.trigger(yS.LEVEL_PTS_UPDATED,{details:s,level:r,drift:l,type:n,frag:e,start:a.startPTS,end:a.endPTS}),!0}return t}),!1)&&null===(null==(n=this.transmuxer)?void 0:n.error)){const t=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(0===r.fragmentError&&(r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(t.message),this.hls.trigger(yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of level "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=pw,this.hls.trigger(yS.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}class Ew{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;return e.length?(r=1===e.length?e[0]:function(e,t){const r=new Uint8Array(t);let i=0;for(let n=0;n<e.length;n++){const t=e[n];r.set(t,i),i+=t.length}return r}(e,t),this.reset(),r):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function Sw(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class Tw{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=NT(this.cachedData,e),this.cachedData=null);let r,i=rT(e,0),n=i?i.length:0;const s=this._audioTrack,a=this._id3Track,o=i?sT(i):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&pS(o))&&(this.basePTS=bw(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&i.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Mb,duration:Number.POSITIVE_INFINITY});n<l;){if(this.canParse(e,n)){const t=this.appendFrame(s,e,n);t?(this.frameIndex++,this.lastPTS=t.sample.pts,n+=t.length,r=n):n=l}else nT(e,n)?(i=rT(e,n),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Mb,duration:Number.POSITIVE_INFINITY}),n+=i.length,r=n):n++;if(n===l&&r!==l){const t=QS(e,r);this.cachedData?this.cachedData=NT(this.cachedData,t):this.cachedData=t}}return{audioTrack:s,videoTrack:Sw(),id3Track:a,textTrack:Sw()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Sw(),id3Track:this._id3Track,textTrack:Sw()}}destroy(){}}const bw=(e,t,r)=>{if(pS(e))return 90*e;return 9e4*t+(r?9e4*r.baseTime/r.timescale:0)};function Rw(e,t){return 255===e[t]&&240==(246&e[t+1])}function ww(e,t){return 1&e[t+1]?7:9}function Aw(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function Lw(e,t){return t+1<e.length&&Rw(e,t)}function Cw(e,t){if(Lw(e,t)){const r=ww(e,t);if(t+r>=e.length)return!1;const i=Aw(e,t);if(i<=r)return!1;const n=t+i;return n===e.length||Lw(e,n)}return!1}function Iw(e,t,r,i,n){if(!e.samplerate){const s=function(e,t,r,i){let n,s,a,o;const l=navigator.userAgent.toLowerCase(),c=i,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n=1+((192&t[r+2])>>>6);const u=(60&t[r+2])>>>2;if(!(u>d.length-1))return a=(1&t[r+2])<<2,a|=(192&t[r+3])>>>6,RS.log(`manifest codec:${i}, ADTS type:${n}, samplingIndex:${u}`),/firefox/i.test(l)?u>=6?(n=5,o=new Array(4),s=u-3):(n=2,o=new Array(2),s=u):-1!==l.indexOf("android")?(n=2,o=new Array(2),s=u):(n=5,o=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&u>=6?s=u-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(u>=6&&1===a||/vivaldi/i.test(l))||!i&&1===a)&&(n=2,o=new Array(2)),s=u)),o[0]=n<<3,o[0]|=(14&u)>>1,o[1]|=(1&u)<<7,o[1]|=a<<3,5===n&&(o[1]|=(14&s)>>1,o[2]=(1&s)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:d[u],channelCount:a,codec:"mp4a.40."+n,manifestCodec:c};{const t=new Error(`invalid ADTS sampling index:${u}`);e.emit(yS.ERROR,yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}}(t,r,i,n);if(!s)return;e.config=s.config,e.samplerate=s.samplerate,e.channelCount=s.channelCount,e.codec=s.codec,e.manifestCodec=s.manifestCodec,RS.log(`parsed codec:${e.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function kw(e){return 9216e4/e}function Dw(e,t,r,i,n){const s=i+n*kw(e.samplerate),a=function(e,t){const r=ww(e,t);if(t+r<=e.length){const i=Aw(e,t)-r;if(i>0)return{headerLength:r,frameLength:i}}}(t,r);let o;if(a){const{frameLength:i,headerLength:n}=a,l=n+i,c=Math.max(0,r+l-t.length);c?(o=new Uint8Array(l-n),o.set(t.subarray(r+n,t.length),0)):o=t.subarray(r+n,r+l);const d={unit:o,pts:s};return c||e.samples.push(d),{sample:d,length:l,missing:c}}const l=t.length-r;o=new Uint8Array(l),o.set(t.subarray(r,t.length),0);return{sample:{unit:o,pts:s},length:l,missing:-1}}let Pw=null;const Ow=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],xw=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Mw=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Nw=[0,1,1,4];function Fw(e,t,r,i,n){if(r+24>t.length)return;const s=Uw(t,r);if(s&&r+s.frameLength<=t.length){const a=i+n*(9e4*s.samplesPerFrame/s.sampleRate),o={unit:t.subarray(r,r+s.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=s.channelCount,e.samplerate=s.sampleRate,e.samples.push(o),{sample:o,length:s.frameLength,missing:0}}}function Uw(e,t){const r=e[t+1]>>3&3,i=e[t+1]>>1&3,n=e[t+2]>>4&15,s=e[t+2]>>2&3;if(1!==r&&0!==n&&15!==n&&3!==s){const a=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*Ow[14*(3===r?3-i:3===i?3:4)+n-1],c=xw[3*(3===r?0:2===r?1:2)+s],d=3===o?1:2,u=Mw[r][i],h=Nw[i],f=8*u*h,p=Math.floor(u*l/c+a)*h;if(null===Pw){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Pw=e?parseInt(e[1]):0}return!!Pw&&Pw<=87&&2===i&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:c,channelCount:d,frameLength:p,samplesPerFrame:f}}}function Bw(e,t){return!(255!==e[t]||224&~e[t+1]||!(6&e[t+1]))}function Hw(e,t){return t+1<e.length&&Bw(e,t)}function jw(e,t){if(t+1<e.length&&Bw(e,t)){const r=4,i=Uw(e,t);let n=r;null!=i&&i.frameLength&&(n=i.frameLength);const s=t+n;return s===e.length||Hw(e,s)}return!1}const Vw=/\/emsg[-/]ID3/i;const Gw=(e,t)=>{let r=0,i=5;t+=i;const n=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;i>0;){a[0]=e[t];const o=Math.min(i,8),l=8-o;s[0]=4278190080>>>24+l<<l,n[0]=(a[0]&s[0])>>l,r=r?r<<o|n[0]:n[0],t+=1,i-=o}return r};class zw extends Tw{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const i=Kw(e,t,r,this.basePTS,this.frameIndex);if(-1!==i){return{sample:e.samples[e.samples.length-1],length:i,missing:0}}}static probe(e){if(!e)return!1;const t=rT(e,0);if(!t)return!1;const r=t.length;return 11===e[r]&&119===e[r+1]&&void 0!==sT(t)&&Gw(e,r)<16}}function Kw(e,t,r,i,n){if(r+8>t.length)return-1;if(11!==t[r]||119!==t[r+1])return-1;const s=t[r+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],o=63&t[r+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+s];if(r+l>t.length)return-1;const c=t[r+6]>>5;let d=0;2===c?d+=2:(1&c&&1!==c&&(d+=2),4&c&&(d+=2));const u=(t[r+6]<<8|t[r+7])>>12-d&1,h=[2,1,2,3,3,4,4,5][c]+u,f=t[r+5]>>3,p=7&t[r+5],m=new Uint8Array([s<<6|f<<1|p>>2,(3&p)<<6|c<<3|u<<2|o>>4,o<<4&224]),g=i+n*(1536/a*9e4),y=t.subarray(r,r+l);return e.config=m,e.channelCount=h,e.samplerate=a,e.samples.push({unit:y,pts:g}),l}class Ww{constructor(){this.VideoSample=null}createVideoSample(e,t,r,i){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:i,length:0}}getLastNalUnit(e){var t;let r,i=this.VideoSample;if(i&&0!==i.units.length||(i=e[e.length-1]),null!=(t=i)&&t.units){const e=i.units;r=e[e.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const r=t.samples,i=r.length;if(!i)return void t.dropped++;{const t=r[i-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}e.debug.length&&RS.log(e.pts+"/"+e.dts+":"+e.debug)}}class $w{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),n=Math.min(4,t);if(0===n)throw new Error("no bytes available");i.set(e.subarray(r,r+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&RS.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t,r=8,i=8;for(let n=0;n<e;n++)0!==i&&(t=this.readEG(),i=(r+t+256)%256),r=0===i?r:i}readSPS(){let e,t,r,i=0,n=0,s=0,a=0;const o=this.readUByte.bind(this),l=this.readBits.bind(this),c=this.readUEG.bind(this),d=this.readBoolean.bind(this),u=this.skipBits.bind(this),h=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);o();const m=o();if(l(5),u(3),o(),f(),100===m||110===m||122===m||244===m||44===m||83===m||86===m||118===m||128===m){const e=c();if(3===e&&u(1),f(),f(),u(1),d())for(t=3!==e?8:12,r=0;r<t;r++)d()&&p(r<6?16:64)}f();const g=c();if(0===g)c();else if(1===g)for(u(1),h(),h(),e=c(),r=0;r<e;r++)h();f(),u(1);const y=c(),_=c(),v=l(1);0===v&&u(1),u(1),d()&&(i=c(),n=c(),s=c(),a=c());let E=[1,1];if(d()&&d()){switch(o()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[o()<<8|o(),o()<<8|o()]}}return{width:Math.ceil(16*(y+1)-2*i-2*n),height:(2-v)*(_+1)*16-(v?2:4)*(s+a),pixelRatio:E}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class Yw extends Ww{parseAVCPES(e,t,r,i,n){const s=this.parseAVCNALu(e,r.data);let a,o=this.VideoSample,l=!1;r.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"")),s.forEach((i=>{var s;switch(i.type){case 1:{let t=!1;a=!0;const n=i.data;if(l&&n.length>4){const e=new $w(n).readSliceType();2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var c;if(t)null!=(c=o)&&c.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null);o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),o.frame=!0,o.key=t;break}case 5:a=!0,null!=(s=o)&&s.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),o.key=!0,o.frame=!0;break;case 6:a=!0,BT(i.data,1,r.pts,t.samples);break;case 7:{var d,u;a=!0,l=!0;const t=i.data,r=new $w(t).readSPS();if(!e.sps||e.width!==r.width||e.height!==r.height||(null==(d=e.pixelRatio)?void 0:d[0])!==r.pixelRatio[0]||(null==(u=e.pixelRatio)?void 0:u[1])!==r.pixelRatio[1]){e.width=r.width,e.height=r.height,e.pixelRatio=r.pixelRatio,e.sps=[t],e.duration=n;const i=t.subarray(1,4);let s="avc1.";for(let e=0;e<3;e++){let t=i[e].toString(16);t.length<2&&(t="0"+t),s+=t}e.codec=s}break}case 8:a=!0,e.pps=[i.data];break;case 9:a=!0,e.audFound=!0,o&&this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"");break;case 12:a=!0;break;default:a=!1,o&&(o.debug+="unknown NAL "+i.type+" ")}if(o&&a){o.units.push(i)}})),i&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}parseAVCNALu(e,t){const r=t.byteLength;let i=e.naluState||0;const n=i,s=[];let a,o,l,c=0,d=-1,u=0;for(-1===i&&(d=0,u=31&t[0],i=0,c=1);c<r;)if(a=t[c++],i)if(1!==i)if(a)if(1===a){if(o=c-i-1,d>=0){const e={data:t.subarray(d,o),type:u};s.push(e)}else{const r=this.getLastNalUnit(e.samples);r&&(n&&c<=4-n&&r.state&&(r.data=r.data.subarray(0,r.data.byteLength-n)),o>0&&(r.data=NT(r.data,t.subarray(0,o)),r.state=0))}c<r?(l=31&t[c],d=c,u=l,i=0):i=-1}else i=0;else i=3;else i=a?0:2;else i=a?0:1;if(d>=0&&i>=0){const e={data:t.subarray(d,r),type:u,state:i};s.push(e)}if(0===s.length){const r=this.getLastNalUnit(e.samples);r&&(r.data=NT(r.data,t))}return e.naluState=i,s}}class qw{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new sw(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,r){const i=e[t].unit;if(i.length<=16)return;const n=i.subarray(16,i.length-i.length%16),s=n.buffer.slice(n.byteOffset,n.byteOffset+n.length);this.decryptBuffer(s).then((n=>{const s=new Uint8Array(n);i.set(s,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}))}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t);let i=0;for(let n=32;n<e.length-16;n+=160,i+=16)r.set(e.subarray(n,n+16),i);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let i=0;for(let n=32;n<e.length-16;n+=160,i+=16)e.set(r.subarray(i,i+16),n);return e}decryptAvcSample(e,t,r,i,n){const s=HT(n.data),a=this.getAvcEncryptedData(s);this.decryptBuffer(a.buffer).then((a=>{n.data=this.getAvcDecryptedUnit(s,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,i)}))}decryptAvcSamples(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void i();const n=e[t].units;for(;!(r>=n.length);r++){const s=n[r];if(!(s.data.length<=48||1!==s.type&&5!==s.type||(this.decryptAvcSample(e,t,r,i,s),this.decrypter.isSync())))return}}}}const Zw=188;class Xw{constructor(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.videoParser=new Yw}static probe(e){const t=Xw.syncOffset(e);return t>0&&RS.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),-1!==t}static syncOffset(e){const t=e.length;let r=Math.min(940,t-Zw)+1,i=0;for(;i<r;){let n=!1,s=-1,a=0;for(let o=i;o<t;o+=Zw){if(71!==e[o]||t-o!==Zw&&71!==e[o+Zw]){if(a)return-1;break}if(a++,-1===s&&(s=o,0!==s&&(r=Math.min(s+18612,e.length-Zw)+1)),n||(n=0===Jw(e,o)),n&&a>1&&(0===s&&a>2||o+Zw>r))return s}i++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:ET[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Xw.createTrack("video"),this._audioTrack=Xw.createTrack("audio",i),this._id3Track=Xw.createTrack("id3"),this._txtTrack=Xw.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,i=!1){let n;r||(this.sampleAes=null);const s=this._videoTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let c=s.pid,d=s.pesData,u=a.pid,h=o.pid,f=a.pesData,p=o.pesData,m=null,g=this.pmtParsed,y=this._pmtId,_=e.length;if(this.remainderData&&(_=(e=NT(this.remainderData,e)).length,this.remainderData=null),_<Zw&&!i)return this.remainderData=e,{audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};const v=Math.max(0,Xw.syncOffset(e));_-=(_-v)%Zw,_<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,_,e.buffer.byteLength-_));let E=0;for(let T=v;T<_;T+=Zw)if(71===e[T]){const t=!!(64&e[T+1]),i=Jw(e,T);let _;if((48&e[T+3])>>4>1){if(_=T+5+e[T+4],_===T+Zw)continue}else _=T+4;switch(i){case c:t&&(d&&(n=rA(d))&&this.videoParser.parseAVCPES(s,l,n,!1,this._duration),d={data:[],size:0}),d&&(d.data.push(e.subarray(_,T+Zw)),d.size+=T+Zw-_);break;case u:if(t){if(f&&(n=rA(f)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,n);break;case"mp3":this.parseMPEGPES(a,n);break;case"ac3":this.parseAC3PES(a,n)}f={data:[],size:0}}f&&(f.data.push(e.subarray(_,T+Zw)),f.size+=T+Zw-_);break;case h:t&&(p&&(n=rA(p))&&this.parseID3PES(o,n),p={data:[],size:0}),p&&(p.data.push(e.subarray(_,T+Zw)),p.size+=T+Zw-_);break;case 0:t&&(_+=e[_]+1),y=this._pmtId=Qw(e,_);break;case y:{t&&(_+=e[_]+1);const i=eA(e,_,this.typeSupported,r);c=i.videoPid,c>0&&(s.pid=c,s.segmentCodec=i.segmentVideoCodec),u=i.audioPid,u>0&&(a.pid=u,a.segmentCodec=i.segmentAudioCodec),h=i.id3Pid,h>0&&(o.pid=h),null===m||g||(RS.warn(`MPEG-TS PMT found at ${T} after unknown PID '${m}'. Backtracking to sync byte @${v} to parse all TS packets.`),m=null,T=v-188),g=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=i}}else E++;if(E>0){const e=new Error(`Found ${E} TS packet/s that do not start with 0x47`);this.observer.emit(yS.ERROR,yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message})}s.pesData=d,a.pesData=f,o.pesData=p;const S={audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};return i&&this.extractRemainingSamples(S),S}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:i,textTrack:n}=e,s=r.pesData,a=t.pesData,o=i.pesData;let l;if(s&&(l=rA(s))?(this.videoParser.parseAVCPES(r,n,l,!0,this._duration),r.pesData=null):r.pesData=s,a&&(l=rA(a))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=a&&a.size&&RS.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;o&&(l=rA(o))?(this.parseID3PES(i,l),i.pesData=null):i.pesData=o}demuxSampleAes(e,t,r){const i=this.demux(e,r,!0,!this.config.progressive),n=this.sampleAes=new qw(this.observer,this.config,t);return this.decrypt(i,n)}decrypt(e,t){return new Promise((r=>{const{audioTrack:i,videoTrack:n}=e;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,(()=>{n.samples?t.decryptAvcSamples(n.samples,0,0,(()=>{r(e)})):r(e)})):n.samples&&t.decryptAvcSamples(n.samples,0,0,(()=>{r(e)}))}))}destroy(){this._duration=0}parseAACPES(e,t){let r=0;const i=this.aacOverFlow;let n,s,a,o=t.data;if(i){this.aacOverFlow=null;const t=i.missing,n=i.sample.unit.byteLength;if(-1===t)o=NT(i.sample.unit,o);else{const s=n-t;i.sample.unit.set(o.subarray(0,t),s),e.samples.push(i.sample),r=i.missing}}for(n=r,s=o.length;n<s-1&&!Lw(o,n);n++);if(n!==r){let e;const t=n<s-1;e=t?`AAC PES did not start with ADTS header,offset:${n}`:"No ADTS header found in AAC PES";const r=new Error(e);if(RS.warn(`parsing error: ${e}`),this.observer.emit(yS.ERROR,yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:r,reason:e}),!t)return}if(Iw(e,this.observer,o,n,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!i)return void RS.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=kw(e.samplerate);a=i.sample.pts+t}}let l,c=0;for(;n<s;){if(l=Dw(e,o,n,a,c),n+=l.length,l.missing){this.aacOverFlow=l;break}for(c++;n<s-1&&!Lw(o,n);n++);}}parseMPEGPES(e,t){const r=t.data,i=r.length;let n=0,s=0;const a=t.pts;if(void 0!==a)for(;s<i;)if(Hw(r,s)){const t=Fw(e,r,s,a,n);if(!t)break;s+=t.length,n++}else s++;else RS.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const r=t.data,i=t.pts;if(void 0===i)return void RS.warn("[tsdemuxer]: AC3 PES unknown PTS");const n=r.length;let s,a=0,o=0;for(;o<n&&(s=Kw(e,r,o,i,a++))>0;)o+=s}}parseID3PES(e,t){if(void 0===t.pts)return void RS.warn("[tsdemuxer]: ID3 PES unknown PTS");const r=fS({},t,{type:this._videoTrack?Fb:Mb,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function Jw(e,t){return((31&e[t+1])<<8)+e[t+2]}function Qw(e,t){return(31&e[t+10])<<8|e[t+11]}function eA(e,t,r,i){const n={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},s=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<s;){const s=Jw(e,t),a=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!i){tA("ADTS AAC");break}case 15:-1===n.audioPid&&(n.audioPid=s);break;case 21:-1===n.id3Pid&&(n.id3Pid=s);break;case 219:if(!i){tA("H.264");break}case 27:-1===n.videoPid&&(n.videoPid=s,n.segmentVideoCodec="avc");break;case 3:case 4:r.mpeg||r.mp3?-1===n.audioPid&&(n.audioPid=s,n.segmentAudioCodec="mp3"):RS.log("MPEG audio found, not supported in this browser");break;case 193:if(!i){tA("AC-3");break}case 129:r.ac3?-1===n.audioPid&&(n.audioPid=s,n.segmentAudioCodec="ac3"):RS.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===n.audioPid&&a>0){let i=t+5,o=a;for(;o>2;){if(106===e[i])!0!==r.ac3?RS.log("AC-3 audio found, not supported in this browser for now"):(n.audioPid=s,n.segmentAudioCodec="ac3");const t=e[i+1]+2;i+=t,o-=t}}break;case 194:case 135:RS.warn("Unsupported EC-3 in M2TS found");break;case 36:RS.warn("Unsupported HEVC in M2TS found")}t+=a+5}return n}function tA(e){RS.log(`${e} with AES-128-CBC encryption found in unencrypted stream`)}function rA(e){let t,r,i,n,s,a=0;const o=e.data;if(!e||0===e.size)return null;for(;o[0].length<19&&o.length>1;)o[0]=NT(o[0],o[1]),o.splice(1,1);t=o[0];if(1===(t[0]<<16)+(t[1]<<8)+t[2]){if(r=(t[4]<<8)+t[5],r&&r>e.size-6)return null;const l=t[7];192&l&&(n=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&l?(s=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,n-s>54e5&&(RS.warn(`${Math.round((n-s)/9e4)}s delta between PTS and DTS, align them`),n=s)):s=n),i=t[8];let c=i+9;if(e.size<=c)return null;e.size-=c;const d=new Uint8Array(e.size);for(let e=0,r=o.length;e<r;e++){t=o[e];let r=t.byteLength;if(c){if(c>r){c-=r;continue}t=t.subarray(c),r-=c,c=0}d.set(t,a),a+=r}return r&&(r-=i+3),{data:d,pts:n,dts:s,len:r}}return null}class iA{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const nA=Math.pow(2,32)-1;class sA{static init(){let e;for(e in sA.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},sA.types)sA.types.hasOwnProperty(e)&&(sA.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);sA.HDLR_TYPES={video:t,audio:r};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);sA.STTS=sA.STSC=sA.STCO=n,sA.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),sA.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),sA.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),sA.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const s=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);sA.FTYP=sA.box(sA.types.ftyp,s,o,s,a),sA.DINF=sA.box(sA.types.dinf,sA.box(sA.types.dref,i))}static box(e,...t){let r=8,i=t.length;const n=i;for(;i--;)r+=t[i].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=255&r,s.set(e,4),i=0,r=8;i<n;i++)s.set(t[i],r),r+=t[i].byteLength;return s}static hdlr(e){return sA.box(sA.types.hdlr,sA.HDLR_TYPES[e])}static mdat(e){return sA.box(sA.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(nA+1)),i=Math.floor(t%(nA+1));return sA.box(sA.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}static mdia(e){return sA.box(sA.types.mdia,sA.mdhd(e.timescale,e.duration),sA.hdlr(e.type),sA.minf(e))}static mfhd(e){return sA.box(sA.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?sA.box(sA.types.minf,sA.box(sA.types.smhd,sA.SMHD),sA.DINF,sA.stbl(e)):sA.box(sA.types.minf,sA.box(sA.types.vmhd,sA.VMHD),sA.DINF,sA.stbl(e))}static moof(e,t,r){return sA.box(sA.types.moof,sA.mfhd(e),sA.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=sA.trak(e[t]);return sA.box.apply(null,[sA.types.moov,sA.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(sA.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=sA.trex(e[t]);return sA.box.apply(null,[sA.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(nA+1)),i=Math.floor(t%(nA+1)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return sA.box(sA.types.mvhd,n)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let i,n;for(i=0;i<t.length;i++)n=t[i].flags,r[i+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return sA.box(sA.types.sdtp,r)}static stbl(e){return sA.box(sA.types.stbl,sA.stsd(e),sA.box(sA.types.stts,sA.STTS),sA.box(sA.types.stsc,sA.STSC),sA.box(sA.types.stsz,sA.STSZ),sA.box(sA.types.stco,sA.STCO))}static avc1(e){let t,r,i,n=[],s=[];for(t=0;t<e.sps.length;t++)r=e.sps[t],i=r.byteLength,n.push(i>>>8&255),n.push(255&i),n=n.concat(Array.prototype.slice.call(r));for(t=0;t<e.pps.length;t++)r=e.pps[t],i=r.byteLength,s.push(i>>>8&255),s.push(255&i),s=s.concat(Array.prototype.slice.call(r));const a=sA.box(sA.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|e.sps.length].concat(n).concat([e.pps.length]).concat(s))),o=e.width,l=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return sA.box(sA.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,sA.box(sA.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),sA.box(sA.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static audioStsd(e){const t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return sA.box(sA.types.mp4a,sA.audioStsd(e),sA.box(sA.types.esds,sA.esds(e)))}static mp3(e){return sA.box(sA.types[".mp3"],sA.audioStsd(e))}static ac3(e){return sA.box(sA.types["ac-3"],sA.audioStsd(e),sA.box(sA.types.dac3,e.config))}static stsd(e){return"audio"===e.type?"mp3"===e.segmentCodec&&"mp3"===e.codec?sA.box(sA.types.stsd,sA.STSD,sA.mp3(e)):"ac3"===e.segmentCodec?sA.box(sA.types.stsd,sA.STSD,sA.ac3(e)):sA.box(sA.types.stsd,sA.STSD,sA.mp4a(e)):sA.box(sA.types.stsd,sA.STSD,sA.avc1(e))}static tkhd(e){const t=e.id,r=e.duration*e.timescale,i=e.width,n=e.height,s=Math.floor(r/(nA+1)),a=Math.floor(r%(nA+1));return sA.box(sA.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,n>>8&255,255&n,0,0]))}static traf(e,t){const r=sA.sdtp(e),i=e.id,n=Math.floor(t/(nA+1)),s=Math.floor(t%(nA+1));return sA.box(sA.types.traf,sA.box(sA.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),sA.box(sA.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s])),sA.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,sA.box(sA.types.trak,sA.tkhd(e),sA.mdia(e))}static trex(e){const t=e.id;return sA.box(sA.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],i=r.length,n=12+16*i,s=new Uint8Array(n);let a,o,l,c,d,u;for(t+=8+n,s.set(["video"===e.type?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),a=0;a<i;a++)o=r[a],l=o.duration,c=o.size,d=o.flags,u=o.cts,s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,61440&d.degradPrio,15&d.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*a);return sA.box(sA.types.trun,s)}static initSegment(e){sA.types||sA.init();const t=sA.moov(e);return NT(sA.FTYP,t)}}sA.types=void 0,sA.HDLR_TYPES=void 0,sA.STTS=void 0,sA.STSC=void 0,sA.STCO=void 0,sA.STSZ=void 0,sA.VMHD=void 0,sA.SMHD=void 0,sA.STSD=void 0,sA.FTYP=void 0,sA.DINF=void 0;const aA=9e4;function oA(e,t,r=1,i=!1){const n=e*t*r;return i?Math.round(n):n}function lA(e,t=!1){return oA(e,1e3,1/aA,t)}let cA,dA=null,uA=null;class hA{constructor(e,t,r,i=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===dA){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);dA=e?parseInt(e[1]):0}if(null===uA){const e=navigator.userAgent.match(/Safari\/(\d+)/i);uA=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){RS.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){RS.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){RS.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e.reduce(((e,r)=>{const i=r.pts-e;return i<-4294967296?(t=!0,fA(e,r.pts)):i>0?e:r.pts}),e[0].pts);return t&&RS.debug("PTS rollover detected"),r}remux(e,t,r,i,n,s,a,o){let l,c,d,u,h,f,p=n,m=n;const g=e.pid>-1,y=t.pid>-1,_=t.samples.length,v=e.samples.length>0,E=a&&_>0||_>1;if((!g||v)&&(!y||E)||this.ISGenerated||a){if(this.ISGenerated){var S,T,b,R;const e=this.videoTrackConfig;!e||t.width===e.width&&t.height===e.height&&(null==(S=t.pixelRatio)?void 0:S[0])===(null==(T=e.pixelRatio)?void 0:T[0])&&(null==(b=t.pixelRatio)?void 0:b[1])===(null==(R=e.pixelRatio)?void 0:R[1])||this.resetInitSegment()}else d=this.generateIS(e,t,n,s);const r=this.isVideoContiguous;let i,a=-1;if(E&&(a=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!r&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,a>0){RS.warn(`[mp4-remuxer]: Dropped ${a} out of ${_} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(a),t.dropped+=a,m+=(t.samples[0].pts-e)/t.inputTimeScale,i=m}else-1===a&&(RS.warn(`[mp4-remuxer]: No keyframe found out of ${_} video samples`),f=!1);if(this.ISGenerated){if(v&&E){const r=this.getVideoStartPts(t.samples),i=(fA(e.samples[0].pts,r)-r)/t.inputTimeScale;p+=Math.max(0,i),m+=Math.max(0,-i)}if(v){if(e.samplerate||(RS.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,n,s)),c=this.remuxAudio(e,p,this.isAudioContiguous,s,y||E||o===wb?m:void 0),E){const i=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(RS.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,n,s)),l=this.remuxVideo(t,m,r,i)}}else E&&(l=this.remuxVideo(t,m,r,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=i)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(h=pA(r,n,this._initPTS,this._initDTS)),i.samples.length&&(u=mA(i,n,this._initPTS))),{audio:c,video:l,initSegment:d,independent:f,text:u,id3:h}}generateIS(e,t,r,i){const n=e.samples,s=t.samples,a=this.typeSupported,o={},l=this._initPTS;let c,d,u,h=!l||i,f="audio/mp4";if(h&&(c=d=1/0),e.config&&n.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):sA.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(u=e.inputTimeScale,l&&u===l.timescale?h=!1:c=d=n[0].pts-Math.round(u*r))}if(t.sps&&t.pps&&s.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:sA.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(u=t.inputTimeScale,l&&u===l.timescale)h=!1;else{const e=this.getVideoStartPts(s),t=Math.round(u*r);d=Math.min(d,fA(s[0].dts,e)-t),c=Math.min(c,e-t)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,h?(this._initPTS={baseTime:c,timescale:u},this._initDTS={baseTime:d,timescale:u}):c=u=void 0,{tracks:o,initPTS:c,timescale:u}}remuxVideo(e,t,r,i){const n=e.inputTimeScale,s=e.samples,a=[],o=s.length,l=this._initPTS;let c,d,u=this.nextAvcDts,h=8,f=this.videoSampleDuration,p=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,g=!1;if(!r||null===u){const e=t*n,i=s[0].pts-fA(s[0].dts,s[0].pts);dA&&null!==u&&Math.abs(e-i-u)<15e3?r=!0:u=e-i}const y=l.baseTime*n/l.timescale;for(let P=0;P<o;P++){const e=s[P];e.pts=fA(e.pts-y,u),e.dts=fA(e.dts-y,u),e.dts<s[P>0?P-1:P].dts&&(g=!0)}g&&s.sort((function(e,t){const r=e.dts-t.dts,i=e.pts-t.pts;return r||i})),c=s[0].dts,d=s[s.length-1].dts;const _=d-c,v=_?Math.round(_/(o-1)):f||e.inputTimeScale/30;if(r){const e=c-u,r=e>v,i=e<-1;if((r||i)&&(r?RS.warn(`AVC: ${lA(e,!0)} ms (${e}dts) hole between fragments detected at ${t.toFixed(3)}`):RS.warn(`AVC: ${lA(-e,!0)} ms (${e}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!i||u>=s[0].pts||dA)){c=u;const t=s[0].pts-e;if(r)s[0].dts=c,s[0].pts=t;else for(let r=0;r<s.length&&!(s[r].dts>t);r++)s[r].dts-=e,s[r].pts-=e;RS.log(`Video: Initial PTS/DTS adjusted: ${lA(t,!0)}/${lA(c,!0)}, delta: ${lA(e,!0)} ms`)}}c=Math.max(0,c);let E=0,S=0,T=c;for(let P=0;P<o;P++){const e=s[P],t=e.units,r=t.length;let i=0;for(let n=0;n<r;n++)i+=t[n].data.length;S+=i,E+=r,e.length=i,e.dts<T?(e.dts=T,T+=v/4|0||1):T=e.dts,p=Math.min(e.pts,p),m=Math.max(e.pts,m)}d=s[o-1].dts;const b=S+4*E+8;let R;try{R=new Uint8Array(b)}catch(ZO){return void this.observer.emit(yS.ERROR,yS.ERROR,{type:_S.MUX_ERROR,details:vS.REMUX_ALLOC_ERROR,fatal:!1,error:ZO,bytes:b,reason:`fail allocating video mdat ${b}`})}const w=new DataView(R.buffer);w.setUint32(0,b),R.set(sA.types.mdat,4);let A=!1,L=Number.POSITIVE_INFINITY,C=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY,k=Number.NEGATIVE_INFINITY;for(let P=0;P<o;P++){const e=s[P],t=e.units;let r,l=0;for(let i=0,n=t.length;i<n;i++){const e=t[i],r=e.data,n=e.data.byteLength;w.setUint32(h,n),h+=4,R.set(r,h),h+=n,l+=4+n}if(P<o-1)f=s[P+1].dts-e.dts,r=s[P+1].pts-e.pts;else{const t=this.config,a=P>0?e.dts-s[P-1].dts:v;if(r=P>0?e.pts-s[P-1].pts:v,t.stretchShortVideoTrack&&null!==this.nextAudioPts){const r=Math.floor(t.maxBufferHole*n),s=(i?p+i*n:this.nextAudioPts)-e.pts;s>r?(f=s-a,f<0?f=a:A=!0,RS.log(`[mp4-remuxer]: It is approximately ${s/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=a}else f=a}const c=Math.round(e.pts-e.dts);L=Math.min(L,f),I=Math.max(I,f),C=Math.min(C,r),k=Math.max(k,r),a.push(new gA(e.key,f,l,c))}if(a.length)if(dA){if(dA<70){const e=a[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(uA&&k-C<I-L&&v/I<.025&&0===a[0].cts){RS.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=c;for(let t=0,r=a.length;t<r;t++){const i=e+a[t].duration,n=e+a[t].cts;if(t<r-1){const e=i+a[t+1].cts;a[t].duration=e-n}else a[t].duration=t?a[t-1].duration:v;a[t].cts=0,e=i}}f=A||!f?v:f,this.nextAvcDts=u=d+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const D={data1:sA.moof(e.sequenceNumber++,c,fS({},e,{samples:a})),data2:R,startPTS:p/n,endPTS:(m+f)/n,startDTS:c/n,endDTS:u/n,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,D}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,r,i,n){const s=e.inputTimeScale,a=s/(e.samplerate?e.samplerate:s),o=this.getSamplesPerFrame(e),l=o*a,c=this._initPTS,d="mp3"===e.segmentCodec&&this.typeSupported.mpeg,u=[],h=void 0!==n;let f=e.samples,p=d?0:8,m=this.nextAudioPts||-1;const g=t*s,y=c.baseTime*s/c.timescale;if(this.isAudioContiguous=r=r||f.length&&m>0&&(i&&Math.abs(g-m)<9e3||Math.abs(fA(f[0].pts-y,g)-m)<20*l),f.forEach((function(e){e.pts=fA(e.pts-y,g)})),!r||m<0){if(f=f.filter((e=>e.pts>=0)),!f.length)return;m=0===n?0:i&&!h?Math.max(0,g):f[0].pts}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let r=0,i=m;r<f.length;r++){const n=f[r],a=n.pts,o=a-i,c=Math.abs(1e3*o/s);if(o<=-t*l&&h)0===r&&(RS.warn(`Audio frame @ ${(a/s).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*o/s)} ms.`),this.nextAudioPts=m=i=a);else if(o>=t*l&&c<1e4&&h){let t=Math.round(o/l);i=a-t*l,i<0&&(t--,i+=l),0===r&&(this.nextAudioPts=m=i),RS.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(i/s).toFixed(3)}s due to ${Math.round(1e3*o/s)} ms gap.`);for(let s=0;s<t;s++){const t=Math.max(i,0);let s=iA.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);s||(RS.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),s=n.unit.subarray()),f.splice(r,0,{unit:s,pts:t}),i+=l,r++}}n.pts=i,i+=l}}let _,v=null,E=null,S=0,T=f.length;for(;T--;)S+=f[T].unit.byteLength;for(let I=0,k=f.length;I<k;I++){const t=f[I],i=t.unit;let n=t.pts;if(null!==E){u[I-1].duration=Math.round((n-E)/a)}else{if(r&&"aac"===e.segmentCodec&&(n=m),v=n,!(S>0))return;S+=p;try{_=new Uint8Array(S)}catch(ZO){return void this.observer.emit(yS.ERROR,yS.ERROR,{type:_S.MUX_ERROR,details:vS.REMUX_ALLOC_ERROR,fatal:!1,error:ZO,bytes:S,reason:`fail allocating audio mdat ${S}`})}if(!d){new DataView(_.buffer).setUint32(0,S),_.set(sA.types.mdat,4)}}_.set(i,p);const s=i.byteLength;p+=s,u.push(new gA(!0,o,s,0)),E=n}const b=u.length;if(!b)return;const R=u[u.length-1];this.nextAudioPts=m=E+a*R.duration;const w=d?new Uint8Array(0):sA.moof(e.sequenceNumber++,v/a,fS({},e,{samples:u}));e.samples=[];const A=v/s,L=m/s,C={data1:w,data2:_,startPTS:A,endPTS:L,startDTS:A,endDTS:L,type:"audio",hasAudio:!0,hasVideo:!1,nb:b};return this.isAudioContiguous=!0,C}remuxEmptyAudio(e,t,r,i){const n=e.inputTimeScale,s=n/(e.samplerate?e.samplerate:n),a=this.nextAudioPts,o=this._initDTS,l=9e4*o.baseTime/o.timescale,c=(null!==a?a:i.startDTS*n)+l,d=i.endDTS*n+l,u=1024*s,h=Math.ceil((d-c)/u),f=iA.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(RS.warn("[mp4-remuxer]: remux empty Audio"),!f)return void RS.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");const p=[];for(let m=0;m<h;m++){const e=c+m*u;p.push({unit:f,pts:e,dts:e})}return e.samples=p,this.remuxAudio(e,t,r,!1)}}function fA(e,t){let r;if(null===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}function pA(e,t,r,i){const n=e.samples.length;if(!n)return;const s=e.inputTimeScale;for(let o=0;o<n;o++){const n=e.samples[o];n.pts=fA(n.pts-r.baseTime*s/r.timescale,t*s)/s,n.dts=fA(n.dts-i.baseTime*s/i.timescale,t*s)/s}const a=e.samples;return e.samples=[],{samples:a}}function mA(e,t,r){const i=e.samples.length;if(!i)return;const n=e.inputTimeScale;for(let a=0;a<i;a++){const i=e.samples[a];i.pts=fA(i.pts-r.baseTime*n/r.timescale,t*n)/n}e.samples.sort(((e,t)=>e.pts-t.pts));const s=e.samples;return e.samples=[],{samples:s}}class gA{constructor(e,t,r,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=i,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}function yA(e,t){const r=null==e?void 0:e.codec;if(r&&r.length>4)return r;if(t===DS){if("ec-3"===r||"ac-3"===r||"alac"===r)return r;if("fLaC"===r||"Opus"===r){return sb(r,!1)}const e="mp4a.40.5";return RS.info(`Parsed audio codec "${r}" or audio object type not handled. Using "${e}"`),e}return RS.warn(`Unhandled video codec "${r}"`),"hvc1"===r||"hev1"===r?"hvc1.1.6.L120.90":"av01"===r?"av01.0.04M.08":"avc1.42e01e"}try{cA=self.performance.now.bind(self.performance)}catch(ZO){RS.debug("Unable to use Performance API on this environment"),cA=null==jS?void 0:jS.Date.now}const _A=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,i){const n=this.videoTrack=Sw("video",1),s=this.audioTrack=Sw("audio",1),a=this.txtTrack=Sw("text",1);if(this.id3Track=Sw("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=IT(e);if(o.video){const{id:e,timescale:t,codec:r}=o.video;n.id=e,n.timescale=a.timescale=t,n.codec=r}if(o.audio){const{id:e,timescale:t,codec:r}=o.audio;s.id=e,s.timescale=t,s.codec=r}a.id=ET.text,n.sampleDuration=0,n.duration=s.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return function(e){const t=e.byteLength;for(let r=0;r<t;){const i=bT(e,r);if(i>8&&109===e[r+4]&&111===e[r+5]&&111===e[r+6]&&102===e[r+7])return!0;r=i>1?r+i:t}return!1}(e)}demux(e,t){this.timeOffset=t;let r=e;const i=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=NT(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},r=LT(e,["moof"]);if(r.length<2)return t.remainder=e,t;const i=r[r.length-1];return t.valid=QS(e,0,i.byteOffset-8),t.remainder=QS(e,i.byteOffset-8),t}(r);this.remainderData=t.remainder,i.samples=t.valid||new Uint8Array}else i.samples=r;const s=this.extractID3Track(i,t);return n.samples=FT(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return r.samples=FT(e,t),{videoTrack:t,audioTrack:Sw(),id3Track:i,textTrack:Sw()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const i=LT(e.samples,["emsg"]);i&&i.forEach((e=>{const i=function(e){const t=e[0];let r="",i="",n=0,s=0,a=0,o=0,l=0,c=0;if(0===t){for(;"\0"!==ST(e.subarray(c,c+1));)r+=ST(e.subarray(c,c+1)),c+=1;for(r+=ST(e.subarray(c,c+1)),c+=1;"\0"!==ST(e.subarray(c,c+1));)i+=ST(e.subarray(c,c+1)),c+=1;i+=ST(e.subarray(c,c+1)),c+=1,n=bT(e,12),s=bT(e,16),o=bT(e,20),l=bT(e,24),c=28}else if(1===t){c+=4,n=bT(e,c),c+=4;const t=bT(e,c);c+=4;const s=bT(e,c);for(c+=4,a=2**32*t+s,mS(a)||(a=Number.MAX_SAFE_INTEGER,RS.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=bT(e,c),c+=4,l=bT(e,c),c+=4;"\0"!==ST(e.subarray(c,c+1));)r+=ST(e.subarray(c,c+1)),c+=1;for(r+=ST(e.subarray(c,c+1)),c+=1;"\0"!==ST(e.subarray(c,c+1));)i+=ST(e.subarray(c,c+1)),c+=1;i+=ST(e.subarray(c,c+1)),c+=1}return{schemeIdUri:r,value:i,timeScale:n,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:e.subarray(c,e.byteLength)}}(e);if(Vw.test(i.schemeIdUri)){const e=pS(i.presentationTime)?i.presentationTime/i.timeScale:t+i.presentationTimeDelta/i.timeScale;let n=4294967295===i.eventDuration?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;n<=.001&&(n=Number.POSITIVE_INFINITY);const s=i.payload;r.samples.push({data:s,len:s.byteLength,dts:e,pts:e,type:Fb,duration:n})}}))}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},remux:class{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(function(e,t){if(!e||!t)return e;const r=t.keyId;r&&t.isCommonEncryption&&LT(e,["moov","trak"]).forEach((e=>{const t=LT(e,["mdia","minf","stbl","stsd"])[0].subarray(8);let i=LT(t,["enca"]);const n=i.length>0;n||(i=LT(t,["encv"])),i.forEach((e=>{LT(n?e.subarray(28):e.subarray(78),["sinf"]).forEach((e=>{const t=xT(e);if(t){const e=t.subarray(8,24);e.some((e=>0!==e))||(RS.log(`[eme] Patching keyId in 'enc${n?"a":"v"}>sinf>>tenc' box: ${yT(e)} -> ${yT(r)}`),t.set(r,8))}}))}))}));return e}(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const i=this.initData=IT(e);i.audio&&(t=yA(i.audio,DS)),i.video&&(r=yA(i.video,PS));const n={};i.audio&&i.video?n.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:i.audio?n.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?n.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:RS.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n}remux(e,t,r,i,n,s){var a,o;let{initPTS:l,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};pS(c)||(c=this.lastEndTime=n||0);const u=t.samples;if(null==u||!u.length)return d;const h={initPTS:void 0,timescale:1};let f=this.initData;if(null!=(a=f)&&a.length||(this.generateInitSegment(u),f=this.initData),null==(o=f)||!o.length)return RS.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const p=function(e,t){let r=0,i=0,n=0;const s=LT(e,["moof","traf"]);for(let a=0;a<s.length;a++){const e=s[a],o=LT(e,["tfhd"])[0],l=t[bT(o,4)];if(!l)continue;const c=l.default,d=bT(o,0)|(null==c?void 0:c.flags);let u=null==c?void 0:c.duration;8&d&&(u=bT(o,2&d?12:8));const h=l.timescale||9e4,f=LT(e,["trun"]);for(let t=0;t<f.length;t++)r=MT(f[t]),!r&&u&&(r=u*bT(f[t],4)),l.type===PS?i+=r/h:l.type===DS&&(n+=r/h)}if(0===i&&0===n){let t=1/0,r=0,i=0;const n=LT(e,["sidx"]);for(let e=0;e<n.length;e++){const s=CT(n[e]);if(null!=s&&s.references){t=Math.min(t,s.earliestPresentationTime/s.timescale);const e=s.references.reduce(((e,t)=>e+t.info.duration||0),0);r=Math.max(r,e+s.earliestPresentationTime/s.timescale),i=r-t}}if(i&&pS(i))return i}return i||n}(u,f),m=function(e,t){return LT(t,["moof","traf"]).reduce(((t,r)=>{const i=LT(r,["tfdt"])[0],n=i[0],s=LT(r,["tfhd"]).reduce(((t,r)=>{const s=bT(r,4),a=e[s];if(a){let e=bT(i,4);if(1===n){if(e===_T)return RS.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;e*=_T+1,e+=bT(i,8)}const r=e/(a.timescale||9e4);if(pS(r)&&(null===t||r<t))return r}return t}),null);return null!==s&&pS(s)&&(null===t||s<t)?s:t}),null)}(f,u),g=null===m?n:m;(function(e,t,r,i){if(null===e)return!0;const n=Math.max(i,1),s=t-e.baseTime/e.timescale;return Math.abs(s-r)>n}(l,g,n,p)||h.timescale!==l.timescale&&s)&&(h.initPTS=g-n,l&&1===l.timescale&&RS.warn("Adjusting initPTS by "+(h.initPTS-l.baseTime)),this.initPTS=l={baseTime:h.initPTS,timescale:1});const y=e?g-l.baseTime/l.timescale:c,_=y+p;!function(e,t,r){LT(t,["moof","traf"]).forEach((t=>{LT(t,["tfhd"]).forEach((i=>{const n=bT(i,4),s=e[n];if(!s)return;const a=s.timescale||9e4;LT(t,["tfdt"]).forEach((e=>{const t=e[0],i=r*a;if(i){let r=bT(e,4);if(0===t)r-=i,r=Math.max(r,0),AT(e,4,r);else{r*=Math.pow(2,32),r+=bT(e,8),r-=i,r=Math.max(r,0);const t=Math.floor(r/(_T+1)),n=Math.floor(r%(_T+1));AT(e,4,t),AT(e,8,n)}}}))}))}))}(f,u,l.baseTime/l.timescale),p>0?this.lastEndTime=_:(RS.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const v=!!f.audio,E=!!f.video;let S="";v&&(S+="audio"),E&&(S+="video");const T={data1:u,startPTS:y,startDTS:y,endPTS:_,endDTS:_,type:S,hasAudio:v,hasVideo:E,nb:1,dropped:0};return d.audio="audio"===T.type?T:void 0,d.video="audio"!==T.type?T:void 0,d.initSegment=h,d.id3=pA(r,n,l,l),i.samples.length&&(d.text=mA(i,n,l)),d}}},{demux:Xw,remux:hA},{demux:class extends Tw{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=rT(e,0);let r=(null==t?void 0:t.length)||0;if(jw(e,r))return!1;for(let i=e.length;r<i;r++)if(Cw(e,r))return RS.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&Rw(e,t)&&Aw(e,t)<=e.length-t}(e,t)}appendFrame(e,t,r){Iw(e,this.observer,t,r,e.manifestCodec);const i=Dw(e,t,r,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}},remux:hA},{demux:class extends Tw{resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=rT(e,0);let r=(null==t?void 0:t.length)||0;if(t&&11===e[r]&&119===e[r+1]&&void 0!==sT(t)&&Gw(e,r)<=16)return!1;for(let i=e.length;r<i;r++)if(jw(e,r))return RS.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return Bw(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,r){if(null!==this.basePTS)return Fw(e,t,r,this.basePTS,this.frameIndex)}},remux:hA}];_A.splice(2,0,{demux:zw,remux:hA});class vA{constructor(e,t,r,i,n){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i,this.id=n}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,i){const n=r.transmuxing;n.executeStart=cA();let s=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:o}=this;i&&(this.currentTransmuxState=i);const{contiguous:l,discontinuity:c,trackSwitch:d,accurateTimeOffset:u,timeOffset:h,initSegmentChange:f}=i||a,{audioCodec:p,videoCodec:m,defaultInitPts:g,duration:y,initSegmentData:_}=o,v=function(e,t){let r=null;e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(r=t);return r}(s,t);if(v&&"AES-128"===v.method){const e=this.getDecrypter();if(!e.isSync())return this.decryptionPromise=e.webCryptoDecrypt(s,v.key.buffer,v.iv.buffer).then((e=>{const t=this.push(e,null,r);return this.decryptionPromise=null,t})),this.decryptionPromise;{let t=e.softwareDecrypt(s,v.key.buffer,v.iv.buffer);if(r.part>-1&&(t=e.flush()),!t)return n.executeEnd=cA(),EA(r);s=new Uint8Array(t)}}const E=this.needsProbing(c,d);if(E){const e=this.configureTransmuxer(s);if(e)return RS.warn(`[transmuxer] ${e.message}`),this.observer.emit(yS.ERROR,yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),n.executeEnd=cA(),EA(r)}(c||d||f||E)&&this.resetInitSegment(_,p,m,y,t),(c||f||E)&&this.resetInitialTimestamp(g),l||this.resetContiguity();const S=this.transmux(s,v,h,u,r),T=this.currentTransmuxState;return T.contiguous=!0,T.discontinuity=!1,T.trackSwitch=!1,n.executeEnd=cA(),S}flush(e){const t=e.transmuxing;t.executeStart=cA();const{decrypter:r,currentTransmuxState:i,decryptionPromise:n}=this;if(n)return n.then((()=>this.flush(e)));const s=[],{timeOffset:a}=i;if(r){const t=r.flush();t&&s.push(this.push(t,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l)return t.executeEnd=cA(),[EA(e)];const c=o.flush(a);return SA(c)?c.then((t=>(this.flushRemux(s,t,e),s))):(this.flushRemux(s,c,e),s)}flushRemux(e,t,r){const{audioTrack:i,videoTrack:n,id3Track:s,textTrack:a}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;RS.log(`[transmuxer.ts]: Flushed fragment ${r.sn}${r.part>-1?" p: "+r.part:""} of level ${r.level}`);const c=this.remuxer.remux(i,n,s,a,l,o,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=cA()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,i,n){const{demuxer:s,remuxer:a}=this;s&&a&&(s.resetInitSegment(e,t,r,i),a.resetInitSegment(e,t,r,n))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,i,n){let s;return s=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,i,n):this.transmuxUnencrypted(e,r,i,n),s}transmuxUnencrypted(e,t,r,i){const{audioTrack:n,videoTrack:s,id3Track:a,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(n,s,a,o,t,r,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,r,i,n){return this.demuxer.demuxSampleAes(e,t,r).then((e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,r,i,!1,this.id),chunkMeta:n})))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:i,vendor:n}=this;let s;for(let u=0,h=_A.length;u<h;u++){var a;if(null!=(a=_A[u].demux)&&a.probe(e)){s=_A[u];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,c=s.remux,d=s.demux;l&&l instanceof c||(this.remuxer=new c(r,t,i,n)),o&&o instanceof d||(this.demuxer=new d(r,t,i),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new sw(this.config)),e}}const EA=e=>({remuxResult:{},chunkMeta:e});function SA(e){return"then"in e&&e.then instanceof Function}class TA{constructor(e,t,r,i,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=i,this.defaultInitPts=n||null}}class bA{constructor(e,t,r,i,n,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=n,this.initSegmentChange=s}}var RA={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function i(){}function n(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,i,s,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new n(i,s||e,a),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),o.prototype.eventNames=function(){var e,i,n=[];if(0===this._eventsCount)return n;for(i in e=this._events)t.call(e,i)&&n.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},o.prototype.listeners=function(e){var t=r?r+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,s=i.length,a=new Array(s);n<s;n++)a[n]=i[n].fn;return a},o.prototype.listenerCount=function(e){var t=r?r+e:e,i=this._events[t];return i?i.fn?1:i.length:0},o.prototype.emit=function(e,t,i,n,s,a){var o=r?r+e:e;if(!this._events[o])return!1;var l,c,d=this._events[o],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,i),!0;case 4:return d.fn.call(d.context,t,i,n),!0;case 5:return d.fn.call(d.context,t,i,n,s),!0;case 6:return d.fn.call(d.context,t,i,n,s,a),!0}for(c=1,l=new Array(u-1);c<u;c++)l[c-1]=arguments[c];d.fn.apply(d.context,l)}else{var h,f=d.length;for(c=0;c<f;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),u){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,i);break;case 4:d[c].fn.call(d[c].context,t,i,n);break;default:if(!l)for(h=1,l=new Array(u-1);h<u;h++)l[h-1]=arguments[h];d[c].fn.apply(d[c].context,l)}}return!0},o.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,i,n){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||n&&!o.once||i&&o.context!==i||a(this,s);else{for(var l=0,c=[],d=o.length;l<d;l++)(o[l].fn!==t||n&&!o[l].once||i&&o[l].context!==i)&&c.push(o[l]);c.length?this._events[s]=1===c.length?c[0]:c:a(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o}(RA);var wA=aS(RA.exports);class AA{constructor(e,t,r,i){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const n=e.config;this.hls=e,this.id=t,this.useWorker=!!n.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;const s=(e,t)=>{(t=t||{}).frag=this.frag,t.id=this.id,e===yS.ERROR&&(this.error=t.error),this.hls.trigger(e,t)};this.observer=new wA,this.observer.on(yS.FRAG_DECRYPTED,s),this.observer.on(yS.ERROR,s);const a=ZT(n.preferManagedMediaSource)||{isTypeSupported:()=>!1},o={mpeg:a.isTypeSupported("audio/mpeg"),mp3:a.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:a.isTypeSupported('audio/mp4; codecs="ac-3"')},l=navigator.vendor;if(this.useWorker&&"undefined"!=typeof Worker){if(n.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{n.workerPath?(RS.log(`loading Web Worker ${n.workerPath} for "${t}"`),this.workerContext=function(e){const t=new self.URL(e,self.location.href).href;return{worker:new self.Worker(t),scriptURL:t}}(n.workerPath)):(RS.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e);return{worker:new self.Worker(t),objectURL:t}}()),this.onwmsg=e=>this.onWorkerMessage(e);const{worker:e}=this.workerContext;e.addEventListener("message",this.onwmsg),e.onerror=e=>{const r=new Error(`${e.message}  (${e.filename}:${e.lineno})`);n.enableWorker=!1,RS.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(yS.ERROR,{type:_S.OTHER_ERROR,details:vS.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:r})},e.postMessage({cmd:"init",typeSupported:o,vendor:l,id:t,config:JSON.stringify(n)})}catch(ZO){RS.warn(`Error setting up "${t}" Web Worker, fallback to inline`,ZO),this.resetWorker(),this.error=null,this.transmuxer=new vA(this.observer,o,n,l,t)}return}}this.transmuxer=new vA(this.observer,o,n,l,t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,r,i,n,s,a,o,l,c){var d,u;l.transmuxing.start=self.performance.now();const{transmuxer:h}=this,f=s?s.start:n.start,p=n.decryptdata,m=this.frag,g=!(m&&n.cc===m.cc),y=!(m&&l.level===m.level),_=m?l.sn-m.sn:-1,v=this.part?l.part-this.part.index:-1,E=0===_&&l.id>1&&l.id===(null==m?void 0:m.stats.chunkCount),S=!y&&(1===_||0===_&&(1===v||E&&v<=0)),T=self.performance.now();(y||_||0===n.stats.parsing.start)&&(n.stats.parsing.start=T),!s||!v&&S||(s.stats.parsing.start=T);const b=!(m&&(null==(d=n.initSegment)?void 0:d.url)===(null==(u=m.initSegment)?void 0:u.url)),R=new bA(g,S,o,y,f,b);if(!S||g||b){RS.log(`[transmuxer-interface, ${n.type}]: Starting new transmux session for sn: ${l.sn} p: ${l.part} level: ${l.level} id: ${l.id}\n        discontinuity: ${g}\n        trackSwitch: ${y}\n        contiguous: ${S}\n        accurateTimeOffset: ${o}\n        timeOffset: ${f}\n        initSegmentChange: ${b}`);const e=new TA(r,i,t,a,c);this.configureTransmuxer(e)}if(this.frag=n,this.part=s,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:p,chunkMeta:l,state:R},e instanceof ArrayBuffer?[e]:[]);else if(h){const t=h.push(e,p,l,R);SA(t)?(h.async=!0,t.then((e=>{this.handleTransmuxComplete(e)})).catch((e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}))):(h.async=!1,this.handleTransmuxComplete(t))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let r=t.flush(e);SA(r)||t.async?(SA(r)||(r=Promise.resolve(r)),r.then((t=>{this.handleFlushResult(t,e)})).catch((t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}))):this.handleFlushResult(r,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach((e=>{this.handleTransmuxComplete(e)})),this.onFlush(t)}onWorkerMessage(e){const t=e.data,r=this.hls;switch(t.event){case"init":{var i;const e=null==(i=this.workerContext)?void 0:i.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":RS[t.data.logType]&&RS[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}function LA(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!CA(e[r].attrs,t[r].attrs))return!1;return!0}function CA(e,t,r){const i=e["STABLE-RENDITION-ID"];return i&&!r?i===t["STABLE-RENDITION-ID"]:!(r||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some((r=>e[r]!==t[r]))}function IA(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class kA{constructor(e){this.buffered=void 0;const t=(t,r,i)=>{if((r>>>=0)>i-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${i})`);return e[r][t]};this.buffered={get length(){return e.length},end:r=>t("end",r,e.length),start:r=>t("start",r,e.length)}}}class DA{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t,r){const i=this.queues[t];i.push(e),1!==i.length||r||this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const r=new Promise((e=>{t=e})),i={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(i,e),r}executeNext(e){const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(IU){RS.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${IU}`),r.onError(IU);const i=this.buffers[e];null!=i&&i.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const PA=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;function OA(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach((t=>{e.removeChild(t)}))}const xA={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},MA=function(e){let t=e;return xA.hasOwnProperty(e)&&(t=xA[e]),String.fromCharCode(t)},NA=15,FA=100,UA={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},BA={17:2,18:4,21:6,22:8,23:10,19:13,20:15},HA={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},jA={25:2,26:4,29:6,30:8,31:10,27:13,28:15},VA=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class GA{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r="function"==typeof t?t():t;RS.log(`${this.time} [${e}] ${r}`)}}}const zA=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class KA{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class WA{constructor(){this.uchar=" ",this.penState=new KA}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class $A{constructor(e){this.chars=[],this.pos=0,this.currPenState=new KA,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<FA;t++)this.chars.push(new WA);this.logger=e}equals(e){for(let t=0;t<FA;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<FA;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<FA;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>FA&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=FA)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=MA(e);this.pos>=FA?this.logger.log(0,(()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!")):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<FA;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<FA;r++){const i=this.chars[r].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class YA{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<NA;t++)this.rows.push(new $A(e));this.logger=e}reset(){for(let e=0;e<NA;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let r=0;r<NA;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<NA;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<NA;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,(()=>"pacData = "+JSON.stringify(e)));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let t=0;t<NA;t++)this.rows[t].clear();const e=this.currRow+1-this.nrRollUpRows,r=this.lastOutputScreen;if(r){const i=r.rows[e].cueStartTime,n=this.logger.time;if(null!==i&&null!==n&&i<n)for(let s=0;s<this.nrRollUpRows;s++)this.rows[t-this.nrRollUpRows+s+1].copy(r.rows[e+s])}}this.currRow=t;const r=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,i=Math.max(t-1,0);r.setCursor(e.indent),e.color=r.chars[i].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,(()=>"bkgData = "+JSON.stringify(e))),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,(()=>this.getDisplayText()));const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",i=-1;for(let n=0;n<NA;n++){const r=this.rows[n].getTextString();r&&(i=n+1,e?t.push("Row "+i+": '"+r+"'"):t.push(r.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r}getTextAndFormat(){return this.rows}}class qA{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new YA(r),this.nonDisplayedMemory=new YA(r),this.lastOutputScreen=new YA(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,(()=>"MODE="+e)),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(()=>t+": "+this.writeScreen.getDisplayText(!0))),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0))),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(()=>"DISP: "+this.displayedMemory.getDisplayText()))}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class ZA{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const i=this.logger=new GA;this.channels=[null,new qA(e,t,i),new qA(e+1,r,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let r,i,n,s=!1;this.logger.time=e;for(let a=0;a<t.length;a+=2)if(i=127&t[a],n=127&t[a+1],0!==i||0!==n){if(this.logger.log(3,"["+zA([t[a],t[a+1]])+"] -> ("+zA([i,n])+")"),r=this.parseCmd(i,n),r||(r=this.parseMidrow(i,n)),r||(r=this.parsePAC(i,n)),r||(r=this.parseBackgroundAttributes(i,n)),!r&&(s=this.parseChars(i,n),s)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(s)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||s||this.logger.log(2,"Couldn't parse cleaned data "+zA([i,n])+" orig: "+zA([t[a],t[a+1]]))}}parseCmd(e,t){const{cmdHistory:r}=this;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;if(JA(e,t,r))return XA(null,null,r),this.logger.log(3,"Repeated command ("+zA([e,t])+") is dropped"),!0;const i=20===e||21===e||23===e?1:2,n=this.channels[i];return 20===e||21===e||28===e||29===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),XA(e,t,r),this.currentChannel=i,!0}parseMidrow(e,t){let r=0;if((17===e||25===e)&&t>=32&&t<=47){if(r=17===e?1:2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[r];return!!i&&(i.ccMIDROW(t),this.logger.log(3,"MIDROW ("+zA([e,t])+")"),!0)}return!1}parsePAC(e,t){let r;const i=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;if(JA(e,t,i))return XA(null,null,i),!0;const n=e<=23?1:2;r=t>=64&&t<=95?1===n?UA[e]:HA[e]:1===n?BA[e]:jA[e];const s=this.channels[n];return!!s&&(s.setPAC(this.interpretPAC(r,t)),XA(e,t,i),this.currentChannel=n,!0)}interpretPAC(e,t){let r;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,i.underline=!(1&~r),r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i}parseChars(e,t){let r,i=null,n=null;if(e>=25?(r=2,n=e-8):(r=1,n=e),n>=17&&n<=19){let e;e=17===n?t+80:18===n?t+112:t+144,this.logger.log(2,"Special char '"+MA(e)+"' in channel "+r),i=[e]}else e>=32&&e<=127&&(i=0===t?[e]:[e,t]);if(i){const r=zA(i);this.logger.log(3,"Char codes =  "+r.join(",")),XA(e,t,this.cmdHistory)}return i}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let r;const i={};16===e||24===e?(r=Math.floor((t-32)/2),i.background=VA[r],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0));const n=e<=23?1:2;return this.channels[n].setBkgData(i),XA(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function XA(e,t,r){r.a=e,r.b=t}function JA(e,t,r){return r.a===e&&r.b===t}class QA{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var eL=function(){if(null!=jS&&jS.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function r(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;const r=t.toLowerCase();return!!~e.indexOf(r)&&r}function i(e){return r(t,e)}function n(e,...t){let r=1;for(;r<arguments.length;r++){const t=arguments[r];for(const r in t)e[r]=t[r]}return e}function s(t,s,a){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let c="",d=!1,u=t,h=s,f=a,p=null,m="",g=!0,y="auto",_="start",v=50,E="middle",S=50,T="middle";Object.defineProperty(o,"id",n({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",n({},l,{get:function(){return d},set:function(e){d=!!e}})),Object.defineProperty(o,"startTime",n({},l,{get:function(){return u},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",n({},l,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",n({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",n({},l,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",n({},l,{get:function(){return m},set:function(t){const i=function(t){return r(e,t)}(t);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");m=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",n({},l,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",n({},l,{get:function(){return y},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",n({},l,{get:function(){return _},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",n({},l,{get:function(){return v},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",n({},l,{get:function(){return E},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",n({},l,{get:function(){return S},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",n({},l,{get:function(){return T},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),o.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}();class tL{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function rL(e){function t(e,t,r,i){return 3600*(0|e)+60*(0|t)+(0|r)+parseFloat(i||0)}const r=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?t(r[2],r[3],0,r[4]):t(r[1],r[2],r[3],r[4]):null}class iL{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function nL(e,t,r,i){const n=i?e.split(i):[e];for(const s in n){if("string"!=typeof n[s])continue;const e=n[s].split(r);if(2!==e.length)continue;t(e[0],e[1])}}const sL=new eL(0,0,""),aL="middle"===sL.align?"middle":"center";function oL(e,t,r){const i=e;function n(){const t=rL(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function s(){e=e.replace(/^\s+/,"")}if(s(),t.startTime=n(),s(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.slice(3),s(),t.endTime=n(),s(),function(e,t){const i=new iL;nL(e,(function(e,t){let n;switch(e){case"region":for(let n=r.length-1;n>=0;n--)if(r[n].id===t){i.set(e,r[n].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":n=t.split(","),i.integer(e,n[0]),i.percent(e,n[0])&&i.set("snapToLines",!1),i.alt(e,n[0],["auto"]),2===n.length&&i.alt("lineAlign",n[1],["start",aL,"end"]);break;case"position":n=t.split(","),i.percent(e,n[0]),2===n.length&&i.alt("positionAlign",n[1],["start",aL,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",aL,"end","left","right"])}}),/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");let n=i.get("line","auto");"auto"===n&&-1===sL.line&&(n=-1),t.line=n,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",aL);let s=i.get("position","auto");"auto"===s&&50===sL.position&&(s="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=s}(e,t)}function lL(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class cL{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new tL,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function r(){let e=t.buffer,r=0;for(e=lL(e);r<e.length&&"\r"!==e[r]&&"\n"!==e[r];)++r;const i=e.slice(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.slice(r),i}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=r();const i=e.match(/^(Ã¯Â»Â¿)?WEBVTT([ \t].*)?$/);if(null==i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let n=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(n?n=!1:e=r(),t.state){case"HEADER":/:/.test(e)?nL(e,(function(e,t){}),/:/):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new eL(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{oL(e,t.cue,t.regionList)}catch(i){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const r=-1!==e.indexOf("--\x3e");if(!e||r&&(n=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(i){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const dL=/\r\n|\n\r|\n|\r/g,uL=function(e,t,r=0){return e.slice(r,r+t.length)===t},hL=function(e){let t=5381,r=e.length;for(;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()};function fL(e,t,r){return hL(e.toString())+hL(t.toString())+hL(r)}function pL(e,t,r,i,n,s,a){const o=new cL,l=pT(new Uint8Array(e)).trim().replace(dL,"\n").split("\n"),c=[],d=t?function(e,t=1){return oA(e,aA,1/t)}(t.baseTime,t.timescale):0;let u,h="00:00.000",f=0,p=0,m=!0;o.oncue=function(e){const s=r[i];let a=r.ccOffset;const o=(f-d)/9e4;if(null!=s&&s.new&&(void 0!==p?a=r.ccOffset=s.start:function(e,t,r){let i=e[t],n=e[i.prevCC];if(!n||!n.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);for(;null!=(s=n)&&s.new;){var s;e.ccOffset+=i.start-n.start,i.new=!1,i=n,n=e[i.prevCC]}e.presentationOffset=r}(r,i,o)),o){if(!t)return void(u=new Error("Missing initPTS for VTT MPEGTS"));a=o-r.presentationOffset}const l=e.endTime-e.startTime,h=fA(9e4*(e.startTime+a-p),9e4*n)/9e4;e.startTime=Math.max(h,0),e.endTime=Math.max(h+l,0);const m=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(m)),e.id||(e.id=fL(e.startTime,e.endTime,m)),e.endTime>0&&c.push(e)},o.onparsingerror=function(e){u=e},o.onflush=function(){u?a(u):s(c)},l.forEach((e=>{if(m){if(uL(e,"X-TIMESTAMP-MAP=")){m=!1,e.slice(16).split(",").forEach((e=>{uL(e,"LOCAL:")?h=e.slice(6):uL(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))}));try{p=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),n=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(pS(t)&&pS(r)&&pS(i)&&pS(n)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=6e4*i,t+=36e5*n,t}(h)/1e3}catch(IU){u=IU}return}""===e&&(m=!1)}o.parse(e+"\n")})),o.flush()}const mL="stpp.ttml.im1t",gL=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,yL=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,_L={left:"start",center:"center",right:"end",start:"start",end:"end"};function vL(e,t,r,i){const n=LT(new Uint8Array(e),["mdat"]);if(0===n.length)return void i(new Error("Could not parse IMSC1 mdat"));const s=n.map((e=>pT(e))),a=function(e,t,r=1,i=!1){return oA(e,t,1/r,i)}(t.baseTime,1,t.timescale);try{s.forEach((e=>r(function(e,t){const r=new DOMParser,i=r.parseFromString(e,"text/xml"),n=i.getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce(((e,t)=>(e[t]=n.getAttribute(`ttp:${t}`)||s[t],e)),{}),o="preserve"!==n.getAttribute("xml:space"),l=SL(EL(n,"styling","style")),c=SL(EL(n,"layout","region")),d=EL(n,"body","[begin]");return[].map.call(d,(e=>{const r=TL(e,o);if(!r||!e.hasAttribute("begin"))return null;const i=wL(e.getAttribute("begin"),a),n=wL(e.getAttribute("dur"),a);let s=wL(e.getAttribute("end"),a);if(null===i)throw RL(e);if(null===s){if(null===n)throw RL(e);s=i+n}const d=new eL(i-t,s-t,r);d.id=fL(d.startTime,d.endTime,d.text);const u=function(e,t,r){const i="http://www.w3.org/ns/ttml#styling";let n=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;a&&r.hasOwnProperty(a)&&(n=r[a]);return s.reduce(((r,s)=>{const a=bL(t,i,s)||bL(e,i,s)||bL(n,i,s);return a&&(r[s]=a),r}),{})}(c[e.getAttribute("region")],l[e.getAttribute("style")],l),{textAlign:h}=u;if(h){const e=_L[h];e&&(d.lineAlign=e),d.align=h}return fS(d,u),d})).filter((e=>null!==e))}(e,a))))}catch(IU){i(IU)}}function EL(e,t,r){const i=e.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(r)):[]}function SL(e){return e.reduce(((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e}),{})}function TL(e,t){return[].slice.call(e.childNodes).reduce(((e,r,i)=>{var n;return"br"===r.nodeName&&i?e+"\n":null!=(n=r.childNodes)&&n.length?TL(r,t):t?e+r.textContent.trim().replace(/\s+/g," "):e+r.textContent}),"")}function bL(e,t,r){return e&&e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null}function RL(e){return new Error(`Could not parse ttml timestamp ${e}`)}function wL(e,t){if(!e)return null;let r=rL(e);return null===r&&(gL.test(e)?r=function(e,t){const r=gL.exec(e),i=(0|r[4])+(0|r[5])/t.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+i/t.frameRate}(e,t):yL.test(e)&&(r=function(e,t){const r=yL.exec(e),i=Number(r[1]);switch(r[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}(e,t))),r}function AL(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function LL(e,t){return!!e&&e.kind===AL(t)&&IA(t,e)}class CL{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(yS.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(yS.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(yS.MANIFEST_PARSED,this.onManifestParsed,this),e.on(yS.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(yS.BUFFER_CODECS,this.onBufferCodecs,this),e.on(yS.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(yS.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(yS.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(yS.MANIFEST_PARSED,this.onManifestParsed,this),e.off(yS.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(yS.BUFFER_CODECS,this.onBufferCodecs,this),e.off(yS.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&pS(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&RS.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter(((t,r)=>this.isLevelAllowed(t)&&r<=e));return this.clientRect=null,CL.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return e}isLevelAllowed(e){return!this.restrictedLevels.some((t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height))}static getMaxLevelByMediaSize(e,t,r){if(null==e||!e.length)return-1;let i=e.length-1;const n=Math.max(t,r);for(let o=0;o<e.length;o+=1){const t=e[o];if((t.width>=n||t.height>=n)&&(s=t,!(a=e[o+1])||s.width!==a.width||s.height!==a.height)){i=o;break}}var s,a;return i}}const IL="[eme]";class kL{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=kL.CDMCleanupPromise?[kL.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=RS.debug.bind(RS,IL),this.log=RS.log.bind(RS,IL),this.warn=RS.warn.bind(RS,IL),this.error=RS.error.bind(RS,IL),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(yS.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(yS.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(yS.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(yS.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(yS.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(yS.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(yS.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(yS.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,i=t[e];if(i)return i.licenseUrl;if(e===VS.WIDEVINE&&r)return r;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(e,t,r)=>!!e&&r.indexOf(e)===t,i=t.map((e=>e.audioCodec)).filter(r),n=t.map((e=>e.videoCodec)).filter(r);return i.length+n.length===0&&n.push("avc1.42e01e"),new Promise(((t,r)=>{const s=e=>{const a=e.shift();this.getMediaKeysPromise(a,i,n).then((e=>t({keySystem:a,mediaKeys:e}))).catch((t=>{e.length?s(e):r(t instanceof DL?t:new DL({type:_S.KEY_SYSTEM_ERROR,details:vS.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))};s(e)}))}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if("function"!=typeof r){let e=`Configured requestMediaKeySystemAccess is not a function ${r}`;return null===XS&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return r(e,t)}getMediaKeysPromise(e,t,r){const i=function(e,t,r,i){let n;switch(e){case VS.FAIRPLAY:n=["cenc","sinf"];break;case VS.WIDEVINE:case VS.PLAYREADY:n=["cenc"];break;case VS.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return function(e,t,r,i){return[{initDataTypes:e,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map((e=>({contentType:`audio/mp4; codecs="${e}"`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null}))),videoCapabilities:r.map((e=>({contentType:`video/mp4; codecs="${e}"`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null})))}]}(n,t,r,i)}(e,t,r,this.config.drmSystemOptions),n=this.keySystemAccessPromises[e];let s=null==n?void 0:n.keySystemAccess;if(!s){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(i)}`),s=this.requestMediaKeySystemAccess(e,i);const t=this.keySystemAccessPromises[e]={keySystemAccess:s};return s.catch((t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)})),s.then((r=>{this.log(`Access for key-system "${r.keySystem}" obtained`);const i=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),t.mediaKeys=r.createMediaKeys().then((t=>(this.log(`Media-keys created for "${e}"`),i.then((r=>r?this.setMediaKeysServerCertificate(t,e,r):t))))),t.mediaKeys.catch((t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)})),t.mediaKeys}))}return s.then((()=>n.mediaKeys))}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${yT(e.keyId||[])}`);const i=r.createSession(),n={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(n),n}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),n="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,n,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return yT(e.keyId)}updateKeySession(e,t){var r;const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${yT((null==(r=e.decryptdata)?void 0:r.keyId)||[])}\n      } (data length: ${t?t.byteLength:t})`),i.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise(((t,r)=>{const i=ZS(this.config),n=e.map($S).filter((e=>!!e&&-1!==i.indexOf(e)));return this.getKeySystemSelectionPromise(n).then((({keySystem:e})=>{const i=qS(e);i?t(i):r(new Error(`Unable to find format for key-system "${e}"`))})).catch(r)}))}loadKey(e){const t=e.keyInfo.decryptdata,r=this.getKeyIdString(t),i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let n=this.keyIdToKeySessionPromise[r];return n||(n=this.keyIdToKeySessionPromise[r]=this.getKeySystemForKeyPromise(t).then((({keySystem:r,mediaKeys:n})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(r,n).then((()=>{this.throwIfDestroyed();const e=this.createMediaKeySessionContext({keySystem:r,mediaKeys:n,decryptdata:t});return this.generateRequestWithPreferredKeySession(e,"cenc",t.pssh,"playlist-key")}))))),n.catch((e=>this.handleError(e)))),n}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof DL?this.hls.trigger(yS.ERROR,e.data):this.hls.trigger(yS.ERROR,{type:_S.KEY_SYSTEM_ERROR,details:vS.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){const t=$S(e.keyFormat),r=t?[t]:ZS(this.config);return this.attemptKeySystemAccess(r)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=ZS(this.config)),0===e.length)throw new DL({type:_S.KEY_SYSTEM_ERROR,details:vS.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:r}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),null===r)return;let i,n;if("sinf"===t&&this.config.drmSystems[VS.FAIRPLAY]){const e=ST(new Uint8Array(r));try{const t=US(JSON.parse(e).sinf),r=xT(new Uint8Array(t));if(!r)return;i=r.subarray(8,24),n=VS.FAIRPLAY}catch(IU){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{const e=function(e){if(!(e instanceof ArrayBuffer)||e.byteLength<32)return null;const t={version:0,systemId:"",kids:null,data:null},r=new DataView(e),i=r.getUint32(0);if(e.byteLength!==i&&i>44)return null;if(1886614376!==r.getUint32(4))return null;if(t.version=r.getUint32(8)>>>24,t.version>1)return null;t.systemId=yT(new Uint8Array(e,12,16));const n=r.getUint32(28);if(0===t.version){if(i-32<n)return null;t.data=new Uint8Array(e,32,n)}else if(1===t.version){t.kids=[];for(let r=0;r<n;r++)t.kids.push(new Uint8Array(e,32+16*r,16))}return t}(r);if(null===e)return;0===e.version&&e.systemId===YS&&e.data&&(i=e.data.subarray(8,24)),n=function(e){if(e===YS)return VS.WIDEVINE}(e.systemId)}if(!n||!i)return;const s=yT(i),{keyIdToKeySessionPromise:a,mediaKeySessions:o}=this;let l=a[s];for(let c=0;c<o.length;c++){const e=o[c],n=e.decryptdata;if(n.pssh||!n.keyId)continue;const d=yT(n.keyId);if(s===d||-1!==n.uri.replace(/-/g,"").indexOf(s)){l=a[d],delete a[d],n.pssh=new Uint8Array(r),n.keyId=i,l=a[s]=l.then((()=>this.generateRequestWithPreferredKeySession(e,t,r,"encrypted-event-key-match")));break}}l||(l=a[s]=this.getKeySystemSelectionPromise([n]).then((({keySystem:e,mediaKeys:n})=>{var a;this.throwIfDestroyed();const o=new GT("ISO-23001-7",s,null!=(a=qS(e))?a:"");return o.pssh=new Uint8Array(r),o.keyId=i,this.attemptSetMediaKeys(e,n).then((()=>{this.throwIfDestroyed();const i=this.createMediaKeySessionContext({decryptdata:o,keySystem:e,mediaKeys:n});return this.generateRequestWithPreferredKeySession(i,t,r,"encrypted-event-no-match")}))}))),l.catch((e=>this.handleError(e)))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(r).then((()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(i),i.then((()=>{this.log(`Media-keys set for "${e}"`),r.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter((e=>-1===r.indexOf(e)))}))}generateRequestWithPreferredKeySession(e,t,r,i){var n,s;const a=null==(n=this.config.drmSystems)||null==(s=n[e.keySystem])?void 0:s.generateRequest;if(a)try{const i=a.call(this.hls,t,r,e);if(!i)throw new Error("Invalid response from configured generateRequest filter");t=i.initDataType,r=e.decryptdata.pssh=i.initData?new Uint8Array(i.initData):null}catch(IU){var o;if(this.warn(IU.message),null!=(o=this.hls)&&o.config.debug)throw IU}if(null===r)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${l} (init data type: ${t} length: ${r?r.byteLength:null})`);const c=new wA,d=e._onmessage=t=>{const r=e.mediaKeysSession;if(!r)return void c.emit("error",new Error("invalid state"));const{messageType:i,message:n}=t;this.log(`"${i}" message event for session "${r.sessionId}" message size: ${n.byteLength}`),"license-request"===i||"license-renewal"===i?this.renewLicense(e,n).catch((e=>{this.handleError(e),c.emit("error",e)})):"license-release"===i?e.keySystem===VS.FAIRPLAY&&(this.updateKeySession(e,HS("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${i}"`)},u=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void c.emit("error",new Error("invalid state"));this.onKeyStatusChange(e);const r=e.keyStatus;c.emit("keyStatus",r),"expired"===r&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",d),e.mediaKeysSession.addEventListener("keystatuseschange",u);const h=new Promise(((e,t)=>{c.on("error",t),c.on("keyStatus",(r=>{r.startsWith("usable")?e():"output-restricted"===r?t(new DL({type:_S.KEY_SYSTEM_ERROR,details:vS.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===r?t(new DL({type:_S.KEY_SYSTEM_ERROR,details:vS.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${r}"`)):"expired"===r?t(new Error("key expired while generating request")):this.warn(`unhandled key status change "${r}"`)}))}));return e.mediaKeysSession.generateRequest(t,r).then((()=>{var t;this.log(`Request generated for key-session "${null==(t=e.mediaKeysSession)?void 0:t.sessionId}" keyId: ${l}`)})).catch((e=>{throw new DL({type:_S.KEY_SYSTEM_ERROR,details:vS.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},`Error generating key-session request: ${e}`)})).then((()=>h)).catch((t=>{throw c.removeAllListeners(),this.removeSession(e),t})).then((()=>(c.removeAllListeners(),e)))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach(((t,r)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${yT("buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r))} session keyId: ${yT(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t}))}fetchServerCertificate(e){const t=this.config,r=new(0,t.loader)(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise(((n,s)=>{const a={responseType:"arraybuffer",url:i},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,r,i)=>{n(e.data)},onError:(t,r,n,o)=>{s(new DL({type:_S.KEY_SYSTEM_ERROR,details:vS.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:n,response:dS({url:a.url,data:void 0},t)},`"${e}" certificate request failed (${i}). Status: ${t.code} (${t.text})`))},onTimeout:(t,r,n)=>{s(new DL({type:_S.KEY_SYSTEM_ERROR,details:vS.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:n,response:{url:a.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(e,t,r)=>{s(new Error("aborted"))}};r.load(a,l,c)}))):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise(((i,n)=>{e.setServerCertificate(r).then((n=>{this.log(`setServerCertificate ${n?"success":"not supported by CDM"} (${null==r?void 0:r.byteLength}) on "${t}"`),i(e)})).catch((e=>{n(new DL({type:_S.KEY_SYSTEM_ERROR,details:vS.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then((t=>this.updateKeySession(e,new Uint8Array(t)).catch((e=>{throw new DL({type:_S.KEY_SYSTEM_ERROR,details:vS.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=(new DOMParser).parseFromString(r,"application/xml"),n=i.querySelectorAll("HttpHeader");if(n.length>0){let t;for(let r=0,i=n.length;r<i;r++){var s,a;t=n[r];const i=null==(s=t.querySelector("name"))?void 0:s.textContent,o=null==(a=t.querySelector("value"))?void 0:a.textContent;i&&o&&e.setRequestHeader(i,o)}}const o=i.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return HS(atob(l))}setupLicenseXHR(e,t,r,i){const n=this.config.licenseXhrSetup;return n?Promise.resolve().then((()=>{if(!r.decryptdata)throw new Error("Key removed");return n.call(this.hls,e,t,r,i)})).catch((s=>{if(!r.decryptdata)throw s;return e.open("POST",t,!0),n.call(this.hls,e,t,r,i)})).then((r=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:r||i}})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise(((i,n)=>{const s=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${s}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return n(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let t=a.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const r=this.config.licenseResponseCallback;if(r)try{t=r.call(this.hls,a,s,e)}catch(IU){this.error(IU)}i(t)}else{const o=r.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)n(new DL({type:_S.KEY_SYSTEM_ERROR,details:vS.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:s,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${s}). Status: ${a.status} (${a.statusText})`));else{const r=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${r} attempts left`),this.requestLicense(e,t).then(i,n)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,s,e,t).then((({xhr:t,licenseChallenge:r})=>{e.keySystem==VS.PLAYREADY&&(r=this.unpackPlayReadyKeyMessage(t,r)),t.send(r)}))}))}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},GT.clearKeyUriToKeyIdMap();const r=t.length;kL.CDMCleanupPromise=Promise.all(t.map((e=>this.removeSession(e))).concat(null==e?void 0:e.setMediaKeys(null).catch((e=>{this.log(`Could not clear media keys: ${e}`)})))).then((()=>{r&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)})).catch((e=>{this.log(`Could not close sessions and clear media keys: ${e}`)}))}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce(((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e)),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);return i>-1&&this.mediaKeySessions.splice(i,1),t.remove().catch((e=>{this.log(`Could not remove session: ${e}`)})).then((()=>t.close())).catch((e=>{this.log(`Could not close session: ${e}`)}))}}}kL.CDMCleanupPromise=void 0;class DL extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var PL,OL,xL;!function(e){e.MANIFEST="m",e.AUDIO="a",e.VIDEO="v",e.MUXED="av",e.INIT="i",e.CAPTION="c",e.TIMED_TEXT="tt",e.KEY="k",e.OTHER="o"}(PL||(PL={})),function(e){e.DASH="d",e.HLS="h",e.SMOOTH="s",e.OTHER="o"}(OL||(OL={})),function(e){e.OBJECT="CMCD-Object",e.REQUEST="CMCD-Request",e.SESSION="CMCD-Session",e.STATUS="CMCD-Status"}(xL||(xL={}));const ML={[xL.OBJECT]:["br","d","ot","tb"],[xL.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[xL.SESSION]:["cid","pr","sf","sid","st","v"],[xL.STATUS]:["bs","rtp"]};class NL{constructor(e,t){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map((e=>e instanceof NL?e:new NL(e)))),this.value=e,this.params=t}}class FL{constructor(e){this.description=void 0,this.description=e}}const UL="Dict";function BL(e,t,r,i){return new Error(`failed to ${e} "${n=t,Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":"object"==typeof n?JSON.stringify(n):String(n)}" as ${r}`,{cause:i});var n}const HL="Bare Item",jL="Boolean",VL="Byte Sequence",GL="Decimal",zL="Integer";const KL=/[\x00-\x1f\x7f]+/,WL="Token",$L="Key";function YL(e,t,r){return BL("serialize",e,t,r)}function qL(e){if(!1===ArrayBuffer.isView(e))throw YL(e,VL);return`:${t=e,btoa(String.fromCharCode(...t))}:`;var t}function ZL(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw YL(e,zL);return e.toString()}function XL(e,t){if(e<0)return-XL(-e,t);const r=Math.pow(10,t);if(Math.abs(e*r%1-.5)<Number.EPSILON){const t=Math.floor(e*r);return(t%2==0?t:t+1)/r}return Math.round(e*r)/r}function JL(e){const t=XL(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw YL(e,GL);const r=t.toString();return r.includes(".")?r:`${r}.0`}const QL="String";function eC(e){const t=(r=e).description||r.toString().slice(7,-1);var r;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw YL(t,WL);return t}function tC(e){switch(typeof e){case"number":if(!pS(e))throw YL(e,HL);return Number.isInteger(e)?ZL(e):JL(e);case"string":return function(e){if(KL.test(e))throw YL(e,QL);return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(e);case"symbol":return eC(e);case"boolean":return function(e){if("boolean"!=typeof e)throw YL(e,jL);return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return`@${ZL(e.getTime()/1e3)}`}(e);if(e instanceof Uint8Array)return qL(e);if(e instanceof FL)return eC(e);default:throw YL(e,HL)}}function rC(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw YL(e,$L);return e}function iC(e){return null==e?"":Object.entries(e).map((([e,t])=>!0===t?`;${rC(e)}`:`;${rC(e)}=${tC(t)}`)).join("")}function nC(e){return e instanceof NL?`${tC(e.value)}${iC(e.params)}`:tC(e)}function sC(e,t={whitespace:!0}){if("object"!=typeof e)throw YL(e,UL);const r=e instanceof Map?e.entries():Object.entries(e),i=null!=t&&t.whitespace?" ":"";return Array.from(r).map((([e,t])=>{t instanceof NL==!1&&(t=new NL(t));let r=rC(e);var i;return!0===t.value?r+=iC(t.params):(r+="=",Array.isArray(t.value)?r+=`(${(i=t).value.map(nC).join(" ")})${iC(i.params)}`:r+=nC(t)),r})).join(`,${i}`)}const aC=e=>"ot"===e||"sf"===e||"st"===e,oC=e=>"number"==typeof e?pS(e):null!=e&&""!==e&&!1!==e;const lC=e=>Math.round(e),cC=e=>100*lC(e/100),dC={br:lC,d:lC,bl:cC,dl:cC,mtp:cC,nor:(e,t)=>(null!=t&&t.baseUrl&&(e=function(e,t){const r=new URL(e),i=new URL(t);if(r.origin!==i.origin)return e;const n=r.pathname.split("/").slice(1),s=i.pathname.split("/").slice(1,-1);for(;n[0]===s[0];)n.shift(),s.shift();for(;s.length;)s.shift(),n.unshift("..");return n.join("/")}(e,t.baseUrl)),encodeURIComponent(e)),rtp:cC,tb:lC};function uC(e,t={}){return e?function(e,t){return sC(e,t)}(function(e,t){const r={};if(null==e||"object"!=typeof e)return r;const i=Object.keys(e).sort(),n=fS({},dC,null==t?void 0:t.formatters),s=null==t?void 0:t.filter;return i.forEach((i=>{if(null!=s&&s(i))return;let a=e[i];const o=n[i];o&&(a=o(a,t)),"v"===i&&1===a||"pr"==i&&1===a||oC(a)&&(aC(i)&&"string"==typeof a&&(a=new FL(a)),r[i]=a)})),r}(e,t),fS({whitespace:!1},t)):""}function hC(e,t,r){return fS(e,function(e,t={}){if(!e)return{};const r=Object.entries(e),i=Object.entries(ML).concat(Object.entries((null==t?void 0:t.customHeaderMap)||{})),n=r.reduce(((e,t)=>{var r;const[n,s]=t,a=(null==(r=i.find((e=>e[1].includes(n))))?void 0:r[0])||xL.REQUEST;return null!=e[a]||(e[a]={}),e[a][n]=s,e}),{});return Object.entries(n).reduce(((e,[r,i])=>(e[r]=uC(i,t),e)),{})}(t,r))}const fC="CMCD";const pC=/CMCD=[^&#]+/;function mC(e,t,r){const i=function(e,t={}){if(!e)return"";const r=uC(e,t);return`${fC}=${encodeURIComponent(r)}`}(t,r);if(!i)return e;if(pC.test(e))return e.replace(pC,i);const n=e.includes("?")?"&":"?";return`${e}${n}${i}`}function gC(e,t,r,i){e&&Object.keys(t).forEach((n=>{const s=e.filter((e=>e.groupId===n)).map((e=>{const s=fS({},e);return s.details=void 0,s.attrs=new LS(s.attrs),s.url=s.attrs.URI=yC(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",r),s.groupId=s.attrs["GROUP-ID"]=t[n],s.attrs["PATHWAY-ID"]=i,s}));e.push(...s)}))}function yC(e,t,r,i){const{HOST:n,PARAMS:s,[r]:a}=i;let o;t&&(o=null==a?void 0:a[t],o&&(e=o));const l=new self.URL(e);return n&&!o&&(l.host=n),s&&Object.keys(s).sort().forEach((e=>{e&&l.searchParams.set(e,s[e])})),l.href}const _C=/^age:\s*[\d.]+\s*$/im;class vC{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new kS,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null,this.stats=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const n=this.xhrSetup;n?Promise.resolve().then((()=>{if(!this.stats.aborted)return n(r,t.url)})).catch((e=>(r.open("GET",t.url,!0),n(r,t.url)))).then((()=>{this.stats.aborted||this.openAndSendXhr(r,t,e)})).catch((e=>{this.callbacks.onError({code:r.status,text:e.message},t,r,i)})):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:n,maxLoadTimeMs:s}=r.loadPolicy;if(i)for(const a in i)e.setRequestHeader(a,i[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=n&&pS(n)?n:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const i=t.readyState,n=this.config;if(!r.aborted&&i>=2&&(0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const i=t.status,s="text"!==t.responseType;if(i>=200&&i<300&&(s&&t.response||null!==t.responseText)){r.loading.end=Math.max(self.performance.now(),r.loading.first);const n=s?t.response:t.responseText,a="arraybuffer"===t.responseType?n.byteLength:n.length;if(r.loaded=r.total=a,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;const o=this.callbacks.onProgress;if(o&&o(r,e,n,t),!this.callbacks)return;const l={url:t.responseURL,data:n,code:i};this.callbacks.onSuccess(l,r,e,t)}else{const s=n.loadPolicy.errorRetry;dR(s,r.retry,!1,{url:e.url,data:void 0,code:i})?this.retry(s):(RS.error(`${i} while loading ${e.url}`),this.callbacks.onError({code:i,text:t.statusText},e,t,r))}}}loadtimeout(){var e;const t=null==(e=this.config)?void 0:e.loadPolicy.timeoutRetry;if(dR(t,this.stats.retry,!0))this.retry(t);else{var r;RS.warn(`timeout while loading ${null==(r=this.context)?void 0:r.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=lR(e,r.retry),r.retry++,RS.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==t?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&_C.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const EC=/(\d+)-(\d+)\/(\d+)/;class SC{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||TC,this.controller=new self.AbortController,this.stats=new kS}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const n=function(e,t){const r={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(fS({},e.headers))};e.rangeEnd&&r.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return r}(e,this.controller.signal),s=r.onProgress,a="arraybuffer"===e.responseType,o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,n),self.clearTimeout(this.requestTimeout),t.timeout=l&&pS(l)?l:c,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),r.onTimeout(i,e,this.response)}),t.timeout),self.fetch(this.request).then((n=>{this.response=this.loader=n;const o=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),r.onTimeout(i,e,this.response)}),c-(o-i.loading.start)),!n.ok){const{status:e,statusText:t}=n;throw new bC(t||"fetch, bad network response",e,n)}return i.loading.first=o,i.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=EC.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(pS(e))return e}const r=e.get("Content-Length");if(r)return parseInt(r)}(n.headers)||i.total,s&&pS(t.highWaterMark)?this.loadProgressively(n,i,e,t.highWaterMark,s):a?n.arrayBuffer():"json"===e.responseType?n.json():n.text()})).then((n=>{const a=this.response;if(!a)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const l=n[o];l&&(i.loaded=i.total=l);const c={url:a.url,data:n,code:a.status};s&&!pS(t.highWaterMark)&&s(i,e,n,a),r.onSuccess(c,i,e,a)})).catch((t=>{if(self.clearTimeout(this.requestTimeout),i.aborted)return;const n=t&&t.code||0,s=t?t.message:null;r.onError({code:n,text:s},e,t?t.details:null,i)}))}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,i=0,n){const s=new Ew,a=e.body.getReader(),o=()=>a.read().then((a=>{if(a.done)return s.dataLength&&n(t,r,s.flush(),e),Promise.resolve(new ArrayBuffer(0));const l=a.value,c=l.length;return t.loaded+=c,c<i||s.dataLength?(s.push(l),s.dataLength>=i&&n(t,r,s.flush(),e)):n(t,r,l,e),o()})).catch((()=>Promise.reject()));return o()}}function TC(e,t){return new self.Request(e.url,t)}class bC extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const RC=/\s/,wC={newCue(e,t,r,i){const n=[];let s,a,o,l,c;const d=self.VTTCue||self.TextTrackCue;for(let h=0;h<i.rows.length;h++)if(s=i.rows[h],o=!0,l=0,c="",!s.isEmpty()){var u;for(let e=0;e<s.chars.length;e++)RC.test(s.chars[e].uchar)&&o?l++:(c+=s.chars[e].uchar,o=!1);s.cueStartTime=t,t===r&&(r+=1e-4),l>=16?l--:l++;const i=lL(c.trim()),f=fL(t,r,i);null!=e&&null!=(u=e.cues)&&u.getCueById(f)||(a=new d(t,r,i),a.id=f,a.line=h+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),n.push(a))}return e&&n.length&&(n.sort(((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line)),n.forEach((t=>Db(e,t)))),n}},AC=dS(dS({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:vC,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:e,partCurrent:t,hls:r}=this,{autoLevelEnabled:i,media:n}=r;if(!e||!n)return;const s=performance.now(),a=t?t.stats:e.stats,o=t?t.duration:e.duration,l=s-a.loading.start,c=r.minAutoLevel;if(a.aborted||a.loaded&&a.loaded===a.total||e.level<=c)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!i||n.paused||!n.playbackRate||!n.readyState)return;const d=r.mainForwardBufferInfo;if(null===d)return;const u=this.bwEstimator.getEstimateTTFB(),h=Math.abs(n.playbackRate);if(l<=Math.max(u,o/(2*h)*1e3))return;const f=d.len/h,p=a.loading.first?a.loading.first-a.loading.start:-1,m=a.loaded&&p>-1,g=this.getBwEstimate(),y=r.levels,_=y[e.level],v=a.total||Math.max(a.loaded,Math.round(o*_.averageBitrate/8));let E=m?l-p:l;E<1&&m&&(E=Math.min(l,8*a.loaded/g));const S=m?1e3*a.loaded/E:0,T=S?(v-a.loaded)/S:8*v/g+u/1e3;if(T<=f)return;const b=S?8*S:g;let R,w=Number.POSITIVE_INFINITY;for(R=e.level-1;R>c;R--){const e=y[R].maxBitrate;if(w=this.getTimeToLoadFrag(u/1e3,b,o*e,!y[R].details),w<f)break}if(w>=T)return;if(w>10*o)return;r.nextLoadLevel=r.nextAutoLevel=R,m?this.bwEstimator.sample(l-Math.min(u,p),a.loaded):this.bwEstimator.sampleTTFB(l);const A=y[R].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>A&&this.resetEstimator(A),this.clearTimer(),RS.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;\n      Time to underbuffer: ${f.toFixed(3)} s\n      Estimated load time for current fragment: ${T.toFixed(3)} s\n      Estimated load time for down switch fragment: ${w.toFixed(3)} s\n      TTFB estimate: ${0|p} ms\n      Current BW estimate: ${pS(g)?0|g:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${R} @ ${0|A} bps`),r.trigger(yS.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:a})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(RS.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new RR(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.on(yS.FRAG_LOADING,this.onFragLoading,this),e.on(yS.FRAG_LOADED,this.onFragLoaded,this),e.on(yS.FRAG_BUFFERED,this.onFragBuffered,this),e.on(yS.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(yS.LEVEL_LOADED,this.onLevelLoaded,this),e.on(yS.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(yS.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(yS.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.off(yS.FRAG_LOADING,this.onFragLoading,this),e.off(yS.FRAG_LOADED,this.onFragLoaded,this),e.off(yS.FRAG_BUFFERED,this.onFragBuffered,this),e.off(yS.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(yS.LEVEL_LOADED,this.onLevelLoaded,this),e.off(yS.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(yS.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(yS.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){var i;if(!r.bitrateTest)this.fragCurrent=r,this.partCurrent=null!=(i=t.part)?i:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case vS.BUFFER_ADD_CODEC_ERROR:case vS.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case vS.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:r,partCurrent:i}=this;if(e&&r&&e.sn===r.sn&&e.level===r.level){const t=performance.now(),r=i?i.stats:e.stats,n=t-r.loading.start,s=r.loading.first?r.loading.first-r.loading.start:-1;if(r.loaded&&s>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(n-Math.min(e,s),r.loaded)}else this.bwEstimator.sampleTTFB(n)}break}}}getTimeToLoadFrag(e,t,r,i){return e+r/t+(i?this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const r=this.hls.config,{loading:i}=t.stats,n=i.end-i.start;pS(n)&&(this.lastLevelLoadSec=n/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}onFragLoaded(e,{frag:t,part:r}){const i=r?r.stats:t.stats;if(t.type===Rb&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=r?r.duration:t.duration,n=this.hls.levels[t.level],s=(n.loaded?n.loaded.bytes:0)+i.loaded,a=(n.loaded?n.loaded.duration:0)+e;n.loaded={bytes:s,duration:a},n.realBitrate=Math.round(8*s/a)}if(t.bitrateTest){const e={stats:i,frag:t,part:r,id:t.type};this.onFragBuffered(yS.FRAG_BUFFERED,e),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:i}=t,n=null!=i&&i.stats.loaded?i.stats:r.stats;if(n.aborted)return;if(this.ignoreFragment(r))return;const s=n.parsing.end-n.loading.start-Math.min(n.loading.first-n.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(s,n.loaded),n.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Rb||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,n=this.findBestLevel(r,t,e,0,i,1,1);if(n>-1)return n;const s=this.hls.firstLevel,a=Math.min(Math.max(s,t),e);return RS.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${s} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(!(-1===e||t&&r&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return e;const i=t&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,i)&&t[e].loadError<=t[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this,{maxAutoLevel:i,config:n,minAutoLevel:s}=r,a=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let c=n.abrBandWidthFactor,d=n.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,s,i,l,0,c,d);if(e>=0)return e}let u=a?Math.min(a,n.maxStarvationDelay):n.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){u=(a?Math.min(a,n.maxLoadingDelay):n.maxLoadingDelay)-e,RS.info(`[abr] bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*u)} ms`),c=d=1}}const h=this.findBestLevel(o,s,i,l,u,c,d);if(RS.info(`[abr] ${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`),h>-1)return h;const f=r.levels[s],p=r.levels[r.loadLevel];return(null==f?void 0:f.bitrate)<(null==p?void 0:p.bitrate)?s:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,i,n,s,a){var o;const l=i+n,c=this.lastLoadedFragLevel,d=-1===c?this.hls.firstLevel:c,{fragCurrent:u,partCurrent:h}=this,{levels:f,allAudioTracks:p,loadLevel:m,config:g}=this.hls;if(1===f.length)return 0;const y=f[d],_=!(null==y||null==(o=y.details)||!o.live),v=-1===m||-1===c;let E,S="SDR",T=(null==y?void 0:y.frameRate)||0;const{audioPreference:b,videoPreference:R}=g,w=this.audioTracksByGroup||(this.audioTracksByGroup=function(e){return e.reduce(((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const i=t.channels||"2";return r.channels[i]=(r.channels[i]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e}),{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}(p));if(v){if(-1!==this.firstSelection)return this.firstSelection;const i=this.codecTiers||(this.codecTiers=function(e,t,r,i){return e.slice(r,i+1).reduce(((e,r)=>{if(!r.codecSet)return e;const i=r.audioGroups;let n=e[r.codecSet];n||(e[r.codecSet]=n={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!i,fragmentError:0}),n.minBitrate=Math.min(n.minBitrate,r.bitrate);const s=Math.min(r.height,r.width);return n.minHeight=Math.min(n.minHeight,s),n.minFramerate=Math.min(n.minFramerate,r.frameRate),n.maxScore=Math.max(n.maxScore,r.score),n.fragmentError+=r.fragmentError,n.videoRanges[r.videoRange]=(n.videoRanges[r.videoRange]||0)+1,i&&i.forEach((e=>{if(!e)return;const r=t.groups[e];n.hasDefaultAudio=n.hasDefaultAudio||t.hasDefaultAudio?r.hasDefault:r.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(r.channels).forEach((e=>{n.channels[e]=(n.channels[e]||0)+r.channels[e]}))})),e}),{})}(f,w,t,r)),n=function(e,t,r,i,n){const s=Object.keys(e),a=null==i?void 0:i.channels,o=null==i?void 0:i.audioCodec,l=a&&2===parseInt(a);let c=!0,d=!1,u=1/0,h=1/0,f=1/0,p=0,m=[];const{preferHDR:g,allowedVideoRanges:y}=IR(t,n);for(let E=s.length;E--;){const t=e[s[E]];c=t.channels[2]>0,u=Math.min(u,t.minHeight),h=Math.min(h,t.minFramerate),f=Math.min(f,t.minBitrate);const r=y.filter((e=>t.videoRanges[e]>0));r.length>0&&(d=!0,m=r)}u=pS(u)?u:0,h=pS(h)?h:0;const _=Math.max(1080,u),v=Math.max(30,h);return f=pS(f)?f:r,r=Math.max(f,r),d||(t=void 0,m=[]),{codecSet:s.reduce(((t,i)=>{const n=e[i];if(i===t)return t;if(n.minBitrate>r)return kR(i,`min bitrate of ${n.minBitrate} > current estimate of ${r}`),t;if(!n.hasDefaultAudio)return kR(i,"no renditions with default or auto-select sound found"),t;if(o&&i.indexOf(o.substring(0,4))%5!=0)return kR(i,`audio codec preference "${o}" not found`),t;if(a&&!l){if(!n.channels[a])return kR(i,`no renditions with ${a} channel sound found (channels options: ${Object.keys(n.channels)})`),t}else if((!o||l)&&c&&0===n.channels[2])return kR(i,"no renditions with stereo sound found"),t;return n.minHeight>_?(kR(i,`min resolution of ${n.minHeight} > maximum of ${_}`),t):n.minFramerate>v?(kR(i,`min framerate of ${n.minFramerate} > maximum of ${v}`),t):m.some((e=>n.videoRanges[e]>0))?n.maxScore<p?(kR(i,`max score of ${n.maxScore} < selected max of ${p}`),t):t&&(rb(i)>=rb(t)||n.fragmentError>e[t].fragmentError)?t:(p=n.maxScore,i):(kR(i,`no variants with VIDEO-RANGE of ${JSON.stringify(m)} found`),t)}),void 0),videoRanges:m,preferHDR:g,minFramerate:h,minBitrate:f}}(i,S,e,b,R),{codecSet:s,videoRanges:a,minFramerate:o,minBitrate:l,preferHDR:c}=n;E=s,S=c?a[a.length-1]:a[0],T=o,e=Math.max(e,l),RS.log(`[abr] picked start tier ${JSON.stringify(n)}`)}else E=null==y?void 0:y.codecSet,S=null==y?void 0:y.videoRange;const A=h?h.duration:u?u.duration:0,L=this.bwEstimator.getEstimateTTFB()/1e3,C=[];for(let k=r;k>=t;k--){var I;const t=f[k],o=k>d;if(!t)continue;if(g.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const r=navigator.mediaCapabilities;"function"==typeof(null==r?void 0:r.decodingInfo)&&LR(t,w,S,T,e,b)?(t.supportedPromise=CR(t,w,r),t.supportedPromise.then((e=>{if(!this.hls)return;t.supportedResult=e;const r=this.hls.levels,i=r.indexOf(t);e.error?RS.warn(`[abr] MediaCapabilities decodingInfo error: "${e.error}" for level ${i} ${JSON.stringify(e)}`):e.supported||(RS.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${i} ${JSON.stringify(e)}`),i>-1&&r.length>1&&(RS.log(`[abr] Removing unsupported level ${i}`),this.hls.removeLevel(i)))}))):t.supportedResult=wR}if(E&&t.codecSet!==E||S&&t.videoRange!==S||o&&T>t.frameRate||!o&&T>0&&T<t.frameRate||t.supportedResult&&(null==(I=t.supportedResult.decodingInfoResults)||!I[0].smooth)){C.push(k);continue}const u=t.details,p=(h?null==u?void 0:u.partTarget:null==u?void 0:u.averagetargetduration)||A;let R;R=o?a*e:s*e;const D=A&&i>=2*A&&0===n?f[k].averageBitrate:f[k].maxBitrate,P=this.getTimeToLoadFrag(L,R,D*p,void 0===u);if(R>=D&&(k===c||0===t.loadError&&0===t.fragmentError)&&(P<=L||!pS(P)||_&&!this.bitrateTestDelay||P<l)){const e=this.forcedAutoLevel;return k===m||-1!==e&&e===m||(C.length&&RS.trace(`[abr] Skipped level(s) ${C.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${f[C[0]].codecs}" ${f[C[0]].videoRange}; not compatible with "${y.codecs}" ${S}`),RS.info(`[abr] switch candidate:${d}->${k} adjustedbw(${Math.round(R)})-bitrate=${Math.round(R-D)} ttfb:${L.toFixed(1)} avgDuration:${p.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${P.toFixed(1)} firstSelection:${v} codecSet:${E} videoRange:${S} hls.loadLevel:${m}`)),v&&(this.firstSelection=k),k}}return-1}set nextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls,i=Math.min(Math.max(e,r),t);this._nextAutoLevel!==i&&(this.nextAutoLevelKey="",this._nextAutoLevel=i)}},bufferController:class{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=e=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:e,mediaSource:t}=this;this.log("Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(yS.MEDIA_ATTACHED,{media:e,mediaSource:t})),t&&t.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&RS.error(`Media element src was set while attaching MediaSource (${t} > ${e})`)},this.hls=e;const t="[buffer-controller]";this.appendSource=e.config.preferManagedMediaSource,this.log=RS.log.bind(RS,t),this.warn=RS.warn.bind(RS,t),this.error=RS.error.bind(RS,t),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:e}=this;e.on(yS.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(yS.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.on(yS.MANIFEST_PARSED,this.onManifestParsed,this),e.on(yS.BUFFER_RESET,this.onBufferReset,this),e.on(yS.BUFFER_APPENDING,this.onBufferAppending,this),e.on(yS.BUFFER_CODECS,this.onBufferCodecs,this),e.on(yS.BUFFER_EOS,this.onBufferEos,this),e.on(yS.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(yS.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(yS.FRAG_PARSED,this.onFragParsed,this),e.on(yS.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(yS.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(yS.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.off(yS.MANIFEST_PARSED,this.onManifestParsed,this),e.off(yS.BUFFER_RESET,this.onBufferReset,this),e.off(yS.BUFFER_APPENDING,this.onBufferAppending,this),e.off(yS.BUFFER_CODECS,this.onBufferCodecs,this),e.off(yS.BUFFER_EOS,this.onBufferEos,this),e.off(yS.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(yS.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(yS.FRAG_PARSED,this.onFragParsed,this),e.off(yS.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new DA(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const r=this.media=t.media,i=ZT(this.appendSource);if(r&&i){var n;const e=this.mediaSource=new i;this.log(`created media source: ${null==(n=e.constructor)?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming);const t=this._objectUrl=self.URL.createObjectURL(e);if(this.appendSource)try{r.removeAttribute("src");const i=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||i&&e instanceof i,OA(r),function(e,t){const r=self.document.createElement("source");r.type="video/mp4",r.src=t,e.appendChild(r)}(r,t),r.load()}catch(IU){r.src=t}else r.src=t;r.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:r}=this;if(t){if(this.log("media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(ZO){this.warn(`onMediaDetaching: ${ZO.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),this.mediaSrc===r?(e.removeAttribute("src"),this.appendSource&&OA(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(yS.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach((e=>{this.resetBuffer(e)})),this._initSourceBuffer()}resetBuffer(e){const t=this.sourceBuffer[e];try{var r;if(t)this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,null!=(r=this.mediaSource)&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}catch(ZO){this.warn(`onBufferReset ${e}`,ZO)}}onBufferCodecs(e,t){const r=this.getSourceBufferTypes().length,i=Object.keys(t);if(i.forEach((e=>{if(r){const r=this.tracks[e];if(r&&"function"==typeof r.buffer.changeType){var i;const{id:n,codec:s,levelCodec:a,container:o,metadata:l}=t[e],c=ab(r.codec,r.levelCodec),d=null==c?void 0:c.replace(PA,"$1");let u=ab(s,a);const h=null==(i=u)?void 0:i.replace(PA,"$1");if(u&&d!==h){"audio"===e.slice(0,5)&&(u=sb(u,this.hls.config.preferManagedMediaSource));const t=`${o};codecs=${u}`;this.appendChangeType(e,t),this.log(`switching codec ${c} to ${u}`),this.tracks[e]={buffer:r.buffer,codec:s,container:o,levelCodec:a,metadata:l,id:n}}}}else this.pendingTracks[e]=t[e]})),r)return;const n=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==n&&(this.log(`${n} bufferCodec event(s) expected ${i.join(",")}`),this.bufferCodecEventsExpected=n),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks()}appendChangeType(e,t){const{operationQueue:r}=this,i={execute:()=>{const i=this.sourceBuffer[e];i&&(this.log(`changing ${e} sourceBuffer type to ${t}`),i.changeType(t)),r.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn(`Failed to change ${e} SourceBuffer type`,t)}};r.append(i,e,!!this.pendingTracks[e])}onBufferAppending(e,t){const{hls:r,operationQueue:i,tracks:n}=this,{data:s,type:a,frag:o,part:l,chunkMeta:c}=t,d=c.buffering[a],u=self.performance.now();d.start=u;const h=o.stats.buffering,f=l?l.stats.buffering:null;0===h.start&&(h.start=u),f&&0===f.start&&(f.start=u);const p=n.audio;let m=!1;"audio"===a&&"audio/mpeg"===(null==p?void 0:p.container)&&(m=!this.lastMpegAudioChunk||1===c.id||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const g=o.start,y={execute:()=>{if(d.executeStart=self.performance.now(),m){const e=this.sourceBuffer[a];if(e){const t=g-e.timestampOffset;Math.abs(t)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${g} (delta: ${t}) sn: ${o.sn})`),e.timestampOffset=g)}}this.appendExecutor(s,a)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();d.executeEnd=d.end=e,0===h.first&&(h.first=e),f&&0===f.first&&(f.first=e);const{sourceBuffer:t}=this,r={};for(const i in t)r[i]=zR.getBuffered(t[i]);this.appendErrors[a]=0,"audio"===a||"video"===a?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(yS.BUFFER_APPENDED,{type:a,frag:o,part:l,chunkMeta:c,parent:o.type,timeRanges:r})},onError:e=>{const t={type:_S.MEDIA_ERROR,parent:o.type,details:vS.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:o,part:l,chunkMeta:c,error:e,err:e,fatal:!1};if(e.code===DOMException.QUOTA_EXCEEDED_ERR)t.details=vS.BUFFER_FULL_ERROR;else{const e=++this.appendErrors[a];t.details=vS.BUFFER_APPEND_ERROR,this.warn(`Failed ${e}/${r.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer`),e>=r.config.appendErrorMaxRetry&&(t.fatal=!0)}r.trigger(yS.ERROR,t)}};i.append(y,a,!!this.pendingTracks[a])}onBufferFlushing(e,t){const{operationQueue:r}=this,i=e=>({execute:this.removeExecutor.bind(this,e,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(yS.BUFFER_FLUSHED,{type:e})},onError:t=>{this.warn(`Failed to remove from ${e} SourceBuffer`,t)}});t.type?r.append(i(t.type),t.type):this.getSourceBufferTypes().forEach((e=>{r.append(i(e),e)}))}onFragParsed(e,t){const{frag:r,part:i}=t,n=[],s=i?i.elementaryStreams:r.elementaryStreams;s[OS]?n.push("audiovideo"):(s[DS]&&n.push("audio"),s[PS]&&n.push("video"));0===n.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers((()=>{const e=self.performance.now();r.stats.buffering.end=e,i&&(i.stats.buffering.end=e);const t=i?i.stats:r.stats;this.hls.trigger(yS.FRAG_BUFFERED,{frag:r,part:i,stats:t,id:r.type})}),n)}onFragChanged(e,t){this.trimBuffers()}onBufferEos(e,t){this.getSourceBufferTypes().reduce(((e,r)=>{const i=this.sourceBuffer[r];return!i||t.type&&t.type!==r||(i.ending=!0,i.ended||(i.ended=!0,this.log(`${r} sourceBuffer now EOS`))),e&&!(i&&!i.ended)}),!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers((()=>{this.getSourceBufferTypes().forEach((e=>{const t=this.sourceBuffer[e];t&&(t.ending=!1)}));const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream()):e&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)})))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||null===t)return;if(!this.getSourceBufferTypes().length)return;const i=e.config,n=r.currentTime,s=t.levelTargetDuration,a=t.live&&null!==i.liveBackBufferLength?i.liveBackBufferLength:i.backBufferLength;if(pS(a)&&a>0){const e=Math.max(a,s),t=Math.floor(n/s)*s-e;this.flushBackBuffer(n,s,t)}if(pS(i.frontBufferFlushThreshold)&&i.frontBufferFlushThreshold>0){const e=Math.max(i.maxBufferLength,i.frontBufferFlushThreshold),t=Math.max(e,s),r=Math.floor(n/s)*s+t;this.flushFrontBuffer(n,s,r)}}flushBackBuffer(e,t,r){const{details:i,sourceBuffer:n}=this;this.getSourceBufferTypes().forEach((s=>{const a=n[s];if(a){const n=zR.getBuffered(a);if(n.length>0&&r>n.start(0)){if(this.hls.trigger(yS.BACK_BUFFER_REACHED,{bufferEnd:r}),null!=i&&i.live)this.hls.trigger(yS.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(a.ended&&n.end(n.length-1)-e<2*t)return void this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);this.hls.trigger(yS.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:s})}}}))}flushFrontBuffer(e,t,r){const{sourceBuffer:i}=this;this.getSourceBufferTypes().forEach((n=>{const s=i[n];if(s){const i=zR.getBuffered(s),a=i.length;if(a<2)return;const o=i.start(a-1),l=i.end(a-1);if(r>o||e>=o&&e<=l)return;if(s.ended&&e-l<2*t)return void this.log(`Cannot flush ${n} front buffer while SourceBuffer is in ended state`);this.hls.trigger(yS.BUFFER_FLUSHING,{startOffset:o,endOffset:1/0,type:n})}}))}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;const{details:e,hls:t,media:r,mediaSource:i}=this,n=e.fragments[0].start+e.totalduration,s=r.duration,a=pS(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(i.duration=1/0,this.updateSeekableRange(e)):(n>a&&n>s||!pS(s))&&(this.log(`Updating Media Source duration to ${n.toFixed(3)}`),i.duration=n)}updateSeekableRange(e){const t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&null!=t&&t.setLiveSeekableRange){const i=Math.max(0,r[0].start),n=Math.max(i,i+e.totalduration);this.log(`Media Source duration is set to ${t.duration}. Setting seekable range to ${i}-${n}.`),t.setLiveSeekableRange(i,n)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:r}=this,i=Object.keys(r).length;if(i&&(!e||2===i||"audiovideo"in r)){this.createSourceBuffers(r),this.pendingTracks={};const e=this.getSourceBufferTypes();if(e.length)this.hls.trigger(yS.BUFFER_CREATED,{tracks:this.tracks}),e.forEach((e=>{t.executeNext(e)}));else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:r}=this;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(const i in e)if(!t[i]){const n=e[i];if(!n)throw Error(`source buffer exists for track ${i}, however track does not`);let s=n.levelCodec||n.codec;s&&"audio"===i.slice(0,5)&&(s=sb(s,this.hls.config.preferManagedMediaSource));const a=`${n.container};codecs=${s}`;this.log(`creating sourceBuffer(${a})`);try{const e=t[i]=r.addSourceBuffer(a),o=i;this.addBufferListener(o,"updatestart",this._onSBUpdateStart),this.addBufferListener(o,"updateend",this._onSBUpdateEnd),this.addBufferListener(o,"error",this._onSBUpdateError),this.addBufferListener(o,"bufferedchange",((e,t)=>{const r=t.removedRanges;null!=r&&r.length&&this.hls.trigger(yS.BUFFER_FLUSHED,{type:i})})),this.tracks[i]={buffer:e,codec:s,container:n.container,levelCodec:n.levelCodec,metadata:n.metadata,id:n.id}}catch(ZO){this.error(`error while trying to add sourceBuffer: ${ZO.message}`),this.hls.trigger(yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:ZO,sourceBufferName:i,mimeType:a})}}}get mediaSrc(){var e;const t=(null==(e=this.media)?void 0:e.firstChild)||this.media;return null==t?void 0:t.src}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const{operationQueue:r}=this;r.current(e).onComplete(),r.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){var r;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${null==(r=this.mediaSource)?void 0:r.readyState}`);this.error(`${i}`,t),this.hls.trigger(yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const n=this.operationQueue.current(e);n&&n.onError(i)}removeExecutor(e,t,r){const{media:i,mediaSource:n,operationQueue:s,sourceBuffer:a}=this,o=a[e];if(!i||!n||!o)return this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void s.shiftAndExecuteNext(e);const l=pS(i.duration)?i.duration:1/0,c=pS(n.duration)?n.duration:1/0,d=Math.max(0,t),u=Math.min(r,l,c);u>d&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${d},${u}] from the ${e} SourceBuffer`),o.remove(d,u)):s.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.sourceBuffer[t];if(r)r.ended=!1,r.appendBuffer(e);else if(!this.pendingTracks[t])throw new Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);const{operationQueue:r}=this,i=t.map((e=>r.appendBlocker(e)));Promise.all(i).then((()=>{e(),t.forEach((e=>{const t=this.sourceBuffer[e];null!=t&&t.updating||r.shiftAndExecuteNext(e)}))}))}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,r){const i=this.sourceBuffer[e];if(!i)return;const n=r.bind(this,e);this.listeners[e].push({event:t,listener:n}),i.addEventListener(t,n)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach((e=>{t.removeEventListener(e.event,e.listener)}))}},capLevelController:CL,errorController:class{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=RS.log.bind(RS,"[info]:"),this.warn=RS.warn.bind(RS,"[warning]:"),this.error=RS.error.bind(RS,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(yS.ERROR,this.onError,this),e.on(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.on(yS.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(yS.ERROR,this.onError,this),e.off(yS.ERROR,this.onErrorOut,this),e.off(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.off(yS.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===Rb?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r,i;if(t.fatal)return;const n=this.hls,s=t.context;switch(t.details){case vS.FRAG_LOAD_ERROR:case vS.FRAG_LOAD_TIMEOUT:case vS.KEY_LOAD_ERROR:case vS.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case vS.FRAG_PARSING_ERROR:if(null!=(r=t.frag)&&r.gap)return void(t.errorAction={action:mR,flags:vR});case vS.FRAG_GAP:case vS.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=gR);case vS.LEVEL_EMPTY_ERROR:case vS.LEVEL_PARSING_ERROR:{var a,o;const e=t.parent===Rb?t.level:n.loadLevel;t.details===vS.LEVEL_EMPTY_ERROR&&null!=(a=t.context)&&null!=(o=a.levelDetails)&&o.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case vS.LEVEL_LOAD_ERROR:case vS.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==s?void 0:s.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level)));case vS.AUDIO_TRACK_LOAD_ERROR:case vS.AUDIO_TRACK_LOAD_TIMEOUT:case vS.SUBTITLE_LOAD_ERROR:case vS.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const e=n.levels[n.loadLevel];if(e&&(s.type===Tb&&e.hasAudioGroup(s.groupId)||s.type===bb&&e.hasSubtitleGroup(s.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=gR,void(t.errorAction.flags=ER)}return;case vS.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const e=n.levels[n.loadLevel],r=null==e?void 0:e.attrs["HDCP-LEVEL"];r?t.errorAction={action:gR,flags:SR,hdcpLevel:r}:this.keySystemError(t)}return;case vS.BUFFER_ADD_CODEC_ERROR:case vS.REMUX_ALLOC_ERROR:case vS.BUFFER_APPEND_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(i=t.level)?i:n.loadLevel));case vS.INTERNAL_EXCEPTION:case vS.BUFFER_APPENDING_ERROR:case vS.BUFFER_FULL_ERROR:case vS.LEVEL_SWITCH_ERROR:case vS.BUFFER_STALLED_ERROR:case vS.BUFFER_SEEK_OVER_HOLE:case vS.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:mR,flags:vR})}t.type===_S.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const r=oR(this.hls.config.playlistLoadPolicy,e),i=this.playlistError++;if(dR(r,i,aR(e),e.response))return{action:_R,flags:vR,retryConfig:r,retryCount:i};const n=this.getLevelSwitchAction(e,t);return r&&(n.retryConfig=r,n.retryCount=i),n}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],{fragLoadPolicy:n,keyLoadPolicy:s}=t.config,a=oR(e.details.startsWith("key")?s:n,e),o=t.levels.reduce(((e,t)=>e+t.fragmentError),0);if(i){e.details!==vS.FRAG_GAP&&i.fragmentError++;if(dR(a,o,aR(e),e.response))return{action:_R,flags:vR,retryConfig:a,retryCount:o}}const l=this.getLevelSwitchAction(e,r);return a&&(l.retryConfig=a,l.retryCount=o),l}getLevelSwitchAction(e,t){const r=this.hls;null==t&&(t=r.loadLevel);const i=this.hls.levels[t];if(i){var n,s;const t=e.details;i.loadError++,t===vS.BUFFER_APPEND_ERROR&&i.fragmentError++;let l=-1;const{levels:c,loadLevel:d,minAutoLevel:u,maxAutoLevel:h}=r;r.autoLevelEnabled||(r.loadLevel=-1);const f=null==(n=e.frag)?void 0:n.type,p=(f===wb&&t===vS.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===vS.BUFFER_ADD_CODEC_ERROR||t===vS.BUFFER_APPEND_ERROR))&&c.some((({audioCodec:e})=>i.audioCodec!==e)),m="video"===e.sourceBufferName&&(t===vS.BUFFER_ADD_CODEC_ERROR||t===vS.BUFFER_APPEND_ERROR)&&c.some((({codecSet:e,audioCodec:t})=>i.codecSet!==e&&i.audioCodec===t)),{type:g,groupId:y}=null!=(s=e.context)?s:{};for(let r=c.length;r--;){const n=(r+d)%c.length;if(n!==d&&n>=u&&n<=h&&0===c[n].loadError){var a,o;const r=c[n];if(t===vS.FRAG_GAP&&e.frag){const t=c[n].details;if(t){const r=hR(e.frag,t.fragments,e.frag.start);if(null!=r&&r.gap)continue}}else{if(g===Tb&&r.hasAudioGroup(y)||g===bb&&r.hasSubtitleGroup(y))continue;if(f===wb&&null!=(a=i.audioGroups)&&a.some((e=>r.hasAudioGroup(e)))||f===Ab&&null!=(o=i.subtitleGroups)&&o.some((e=>r.hasSubtitleGroup(e)))||p&&i.audioCodec===r.audioCodec||!p&&i.audioCodec!==r.audioCodec||m&&i.codecSet===r.codecSet)continue}l=n;break}}if(l>-1&&r.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:gR,flags:vR,nextAutoLevel:l}}return{action:gR,flags:ER}}onErrorOut(e,t){var r;switch(null==(r=t.errorAction)?void 0:r.action){case mR:break;case gR:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===vS.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:i,hdcpLevel:n,nextAutoLevel:s}=r;switch(i){case vR:this.switchLevel(e,s);break;case SR:n&&(t.maxHdcpLevel=zb[zb.indexOf(n)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}r.resolved||this.switchLevel(e,s)}switchLevel(e,t){void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(yS.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(yS.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,r){const i=performance.now();if(t){if(this.lastTime){const e=i-this.lastTime,n=r-this.lastDroppedFrames,s=t-this.lastDecodedFrames,a=1e3*n/e,o=this.hls;if(o.trigger(yS.FPS_DROP,{currentDropped:n,currentDecoded:s,totalDroppedFrames:r}),a>0&&n>o.config.fpsDroppedMonitoringThreshold*s){let e=o.currentLevel;RS.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(yS.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:XS,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:wC,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends vw{constructor(e,t,r){super(e,t,r,"[subtitle-stream-controller]",Ab),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(yS.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(yS.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.on(yS.LEVEL_LOADED,this.onLevelLoaded,this),e.on(yS.ERROR,this.onError,this),e.on(yS.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(yS.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(yS.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(yS.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(yS.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(yS.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(yS.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(yS.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.off(yS.LEVEL_LOADED,this.onLevelLoaded,this),e.off(yS.ERROR,this.onError,this),e.off(yS.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(yS.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(yS.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(yS.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(yS.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(yS.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=lw,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:i}=t;if(this.fragPrevious=r,this.state=lw,!i)return;const n=this.tracksBuffered[this.currentTrackId];if(!n)return;let s;const a=r.start;for(let l=0;l<n.length;l++)if(a>=n[l].start&&a<=n[l].end){s=n[l];break}const o=r.start+r.duration;s?s.end=o:(s={start:a,end:o},n.push(s)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null)}onBufferFlushing(e,t){const{startOffset:r,endOffset:i}=t;if(0===r&&i!==Number.POSITIVE_INFINITY){const e=i-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach((t=>{for(let r=0;r<t.length;)if(t[r].end<=e)t.shift();else{if(!(t[r].start<e))break;t[r].start=e,r++}})),this.fragmentTracker.removeFragmentsInRange(r,e,Ab)}}onFragBuffered(e,t){var r;this.loadedmetadata||t.frag.type!==Rb||null!=(r=this.media)&&r.buffered.length&&(this.loadedmetadata=!0)}onError(e,t){const r=t.frag;(null==r?void 0:r.type)===Ab&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ow&&(this.state=lw))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){this.levels&&LA(this.levels,t)?this.levels=t.map((e=>new Zb(e))):(this.tracksBuffered=[],this.levels=t.map((e=>{const t=new Zb(e);return this.tracksBuffered[t.id]=[],t})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Ab),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,null==(r=this.levels)||!r.length||-1===this.currentTrackId)return void this.clearInterval();const i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:i,levels:n}=this,{details:s,id:a}=t;if(!n)return void this.warn(`Subtitle tracks were reset while loading level ${a}`);const o=n[i];if(a>=n.length||a!==i||!o)return;this.log(`Subtitle track ${a} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(s.live||null!=(r=o.details)&&r.live){const e=this.mainDetails;if(s.deltaUpdateFailed||!e)return;const t=e.fragments[0];var c;if(o.details)l=this.alignPlaylists(s,o.details,null==(c=this.levelLastLoaded)?void 0:c.details),0===l&&t&&(l=t.start,rR(s,l));else s.hasProgramDateTime&&e.hasProgramDateTime?(ZR(s,e),l=s.fragments[0].start):t&&(l=t.start,rR(s,l))}if(o.details=s,this.levelLastLoaded=o,this.startFragRequested||!this.mainDetails&&s.live||this.setStartPosition(this.mainDetails||s,l),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===lw){hR(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,i=t.decryptdata,n=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&null!=i&&i.key&&i.iv&&"AES-128"===i.method){const e=performance.now();this.decrypter.decrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer).catch((e=>{throw n.trigger(yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e})).then((r=>{const i=performance.now();n.trigger(yS.FRAG_DECRYPTED,{frag:t,payload:r,stats:{tstart:e,tdecrypt:i}})})).catch((e=>{this.warn(`${e.name}: ${e.message}`),this.state=lw}))}}doTick(){if(this.media){if(this.state===lw){const{currentTrackId:e,levels:t}=this,r=null==t?void 0:t[e];if(!r||!t.length||!r.details)return;const{config:i}=this,n=this.getLoadPosition(),s=zR.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],n,i.maxBufferHole),{end:a,len:o}=s,l=this.getFwdBufferInfo(this.media,Rb),c=r.details;if(o>this.getMaxBufferLength(null==l?void 0:l.len)+c.levelTargetDuration)return;const d=c.fragments,u=d.length,h=c.edge;let f=null;const p=this.fragPrevious;if(a<h){const e=i.maxFragLookUpTolerance,t=a>h-e?0:e;f=hR(p,d,Math.max(d[0].start,a),t),!f&&p&&p.start<d[0].start&&(f=d[0])}else f=d[u-1];if(!f)return;if(f=this.mapToInitFragWhenRequired(f),"initSegment"!==f.sn){const e=d[f.sn-c.startSN-1];e&&e.cc===f.cc&&this.fragmentTracker.getState(e)===NR&&(f=e)}this.fragmentTracker.getState(f)===NR&&this.loadFragment(f,r,a)}}else this.state=lw}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,r){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,r))}get mediaBufferTimeRanges(){return new kA(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends TR{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=xb(this.media.textTracks);for(let i=0;i<t.length;i++)if("hidden"===t[i].mode)e=t[i];else if("showing"===t[i].mode){e=t[i];break}const r=this.findTrackForTextTrack(e);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(yS.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(yS.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.on(yS.MANIFEST_PARSED,this.onManifestParsed,this),e.on(yS.LEVEL_LOADING,this.onLevelLoading,this),e.on(yS.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(yS.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(yS.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(yS.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(yS.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.off(yS.MANIFEST_PARSED,this.onManifestParsed,this),e.off(yS.LEVEL_LOADING,this.onLevelLoading,this),e.off(yS.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(yS.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(yS.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);xb(this.media.textTracks).forEach((e=>{Pb(e)})),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:i,details:n}=t,s=this.tracksInGroup[r];if(!s||s.groupId!==i)return void this.warn(`Subtitle track with id:${r} and group:${i} not found in active group ${null==s?void 0:s.groupId}`);const a=s.details;s.details=t.details,this.log(`Subtitle track ${r} "${s.name}" lang:${s.lang} group:${i} loaded [${n.startSN}-${n.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,i=this.groupIds;let n=this.currentTrack;if(!r||(null==i?void 0:i.length)!==(null==r?void 0:r.length)||null!=r&&r.some((e=>-1===(null==i?void 0:i.indexOf(e))))){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter((e=>!r||-1!==r.indexOf(e.groupId)));if(e.length)this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),e.forEach(((e,t)=>{e.id=t}));else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!n&&t){this.selectDefaultTrack=!1;const r=DR(t,e);if(r>-1)n=e[r];else{const e=DR(t,this.tracks);n=this.tracks[e]}}let i=this.findTrackId(n);-1===i&&n&&(i=this.findTrackId(null));const s={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${null==r?void 0:r.join(",")}" group-id`),this.hls.trigger(yS.SUBTITLE_TRACKS_UPDATED,s),-1!==i&&-1===this.trackId&&this.setSubtitleTrack(i)}else this.shouldReloadPlaylist(n)&&this.setSubtitleTrack(this.trackId)}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const n=t[i];if((!r||n.default)&&(r||e)&&(!e||PR(n,e)))return i}if(e){for(let r=0;r<t.length;r++){const i=t[r];if(CA(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const i=t[r];if(CA(e.attrs,i.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){if(IA(t[r],e))return r}}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==bb||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&PR(e,r))return r;const i=DR(e,this.tracksInGroup);if(i>-1){const e=this.tracksInGroup[i];return this.setSubtitleTrack(i),e}if(r)return null;{const r=DR(e,t);if(r>-1)return t[r]}}}return null}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){const r=t.id,i=t.groupId;let n=t.url;if(e)try{n=e.addDirectives(n)}catch(IU){this.warn(`Could not construct new URL with HLS Delivery Directives: ${IU}`)}this.log(`Loading subtitle playlist for id ${r}`),this.hls.trigger(yS.SUBTITLE_TRACK_LOADING,{url:n,id:r,groupId:i,deliveryDirectives:e||null})}}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=xb(e.textTracks),r=this.currentTrack;let i;if(r&&(i=t.filter((e=>IA(r,e)))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach((e=>{"disabled"!==e.mode&&e!==i&&(e.mode="disabled")})),i){const e=this.subtitleDisplay?"showing":"hidden";i.mode!==e&&(i.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!pS(e))return void this.warn(`Invalid subtitle track id: ${e}`);this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i)return void this.hls.trigger(yS.SUBTITLE_TRACK_SWITCH,{id:e});const n=!!i.details&&!i.details.live;if(e===this.trackId&&i===r&&n)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:s,groupId:a="",name:o,type:l,url:c}=i;this.hls.trigger(yS.SUBTITLE_TRACK_SWITCH,{id:s,groupId:a,name:o,type:l,url:c});const d=this.switchParams(i.url,null==r?void 0:r.details);this.loadPlaylist(d)}},timelineController:class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(yS.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(yS.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.on(yS.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(yS.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(yS.FRAG_LOADING,this.onFragLoading,this),e.on(yS.FRAG_LOADED,this.onFragLoaded,this),e.on(yS.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(yS.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(yS.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(yS.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(yS.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(yS.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(yS.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.off(yS.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(yS.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(yS.FRAG_LOADING,this.onFragLoading,this),e.off(yS.FRAG_LOADED,this.onFragLoaded,this),e.off(yS.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(yS.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(yS.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(yS.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(yS.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const e=new QA(this,"textTrack1"),t=new QA(this,"textTrack2"),r=new QA(this,"textTrack3"),i=new QA(this,"textTrack4");this.cea608Parser1=new ZA(1,e,t),this.cea608Parser2=new ZA(3,r,i)}}addCues(e,t,r,i,n){let s=!1;for(let d=n.length;d--;){const e=n[d],i=(a=e[0],o=e[1],l=t,c=r,Math.min(o,c)-Math.max(a,l));if(i>=0&&(e[0]=Math.min(e[0],t),e[1]=Math.max(e[1],r),s=!0,i/(r-t)>.5))return}var a,o,l,c;if(s||n.push([t,r]),this.config.renderTextTracksNatively){const n=this.captionsTracks[e];this.Cues.newCue(n,t,r,i)}else{const n=this.Cues.newCue(null,t,r,i);this.hls.trigger(yS.CUES_PARSED,{type:"captions",cues:n,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:n}){const{unparsedVttFrags:s}=this;"main"===r&&(this.initPTS[t.cc]={baseTime:i,timescale:n}),s.length&&(this.unparsedVttFrags=[],s.forEach((e=>{this.onFragLoaded(yS.FRAG_LOADED,e)})))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let i=0;i<r.textTracks.length;i++){const n=r.textTracks[i];if(LL(n,{name:e,lang:t,attrs:{}}))return n}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:i}=this,{label:n,languageCode:s}=t[e],a=this.getExistingTrack(n,s);if(a)r[e]=a,Pb(r[e]),kb(r[e],i);else{const t=this.createTextTrack("captions",n,s);t&&(t[e]=!0,r[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(yS.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,r){const i=this.media;if(i)return i.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach((t=>{Pb(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Pb(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],i=r.some((e=>e.textCodec===mL));if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(LA(this.tracks,r))return void(this.tracks=r);if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const e=this.media,t=e?xb(e.textTracks):null;if(this.tracks.forEach(((e,r)=>{let i;if(t){let r=null;for(let i=0;i<t.length;i++)if(t[i]&&LL(t[i],e)){r=t[i],t[i]=null;break}r&&(i=r)}if(i)Pb(i);else{const t=AL(e);i=this.createTextTrack(t,e.name,e.lang),i&&(i.mode="disabled")}i&&this.textTracks.push(i)})),null!=t&&t.length){const e=t.filter((e=>null!==e)).map((e=>e.label));e.length&&RS.warn(`Media element contains unused subtitle tracks: ${e.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const e=this.tracks.map((e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e})));this.hls.trigger(yS.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const r=`textTrack${t[1]}`,i=this.captionsProperties[r];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)}))}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){this.initCea608Parsers();const{cea608Parser1:r,cea608Parser2:i,lastCc:n,lastSn:s,lastPartIndex:a}=this;if(this.enabled&&r&&i&&t.frag.type===Rb){var o,l;const{cc:e,sn:c}=t.frag,d=null!=(o=null==t||null==(l=t.part)?void 0:l.index)?o:-1;c===s+1||c===s&&d===a+1||e===n||(r.reset(),i.reset()),this.lastCc=e,this.lastSn=c,this.lastPartIndex=d}}onFragLoaded(e,t){const{frag:r,payload:i}=t;if(r.type===Ab)if(i.byteLength){const e=r.decryptdata,n="stats"in t;if(null==e||!e.encrypted||n){const e=this.tracks[r.level],n=this.vttCCs;n[r.cc]||(n[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),e&&e.textCodec===mL?this._parseIMSC1(r,i):this._parseVTTs(t)}}else this.hls.trigger(yS.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;vL(t,this.initPTS[e.cc],(t=>{this._appendCues(t,e.level),r.trigger(yS.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(t=>{RS.log(`Failed to parse IMSC1: ${t}`),r.trigger(yS.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))}_parseVTTs(e){var t;const{frag:r,payload:i}=e,{initPTS:n,unparsedVttFrags:s}=this,a=n.length-1;if(!n[r.cc]&&-1===a)return void s.push(e);const o=this.hls;pL(null!=(t=r.initSegment)&&t.data?NT(r.initSegment.data,new Uint8Array(i)):i,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,(e=>{this._appendCues(e,r.level),o.trigger(yS.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})}),(t=>{const n="Missing initPTS for VTT MPEGTS"===t.message;n?s.push(e):this._fallbackToIMSC1(r,i),RS.log(`Failed to parse VTT cue: ${t}`),n&&a>r.cc||o.trigger(yS.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:t})}))}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||vL(t,this.initPTS[e.cc],(()=>{r.textCodec=mL,this._parseIMSC1(e,t)}),(()=>{r.textCodec="wvtt"}))}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||"disabled"===r.mode)return;e.forEach((e=>Db(r,e)))}else{const i=this.tracks[t];if(!i)return;const n=i.default?"default":"subtitles"+t;r.trigger(yS.CUES_PARSED,{type:"subtitles",cues:e,track:n})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===Ab&&this.onFragLoaded(yS.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){this.initCea608Parsers();const{cea608Parser1:r,cea608Parser2:i}=this;if(!this.enabled||!r||!i)return;const{frag:n,samples:s}=t;if(n.type!==Rb||"NONE"!==this.closedCaptionsForLevel(n))for(let a=0;a<s.length;a++){const e=s[a].bytes;if(e){const t=this.extractCea608Data(e);r.addData(s[a].pts,t[0]),i.addData(s[a].pts,t[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:i,type:n}){const{media:s}=this;if(s&&!(s.currentTime<r)){if(!n||"video"===n){const{captionsTracks:e}=this;Object.keys(e).forEach((i=>Ob(e[i],t,r)))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==i){const{textTracks:e}=this;Object.keys(e).forEach((r=>Ob(e[r],t,i)))}}}extractCea608Data(e){const t=[[],[]],r=31&e[0];let i=2;for(let n=0;n<r;n++){const r=e[i++],n=127&e[i++],s=127&e[i++];if(0===n&&0===s)continue;if(!!(4&r)){const e=3&r;0!==e&&1!==e||(t[e].push(n),t[e].push(s))}}return t}},audioStreamController:class extends vw{constructor(e,t,r){super(e,t,r,"[audio-stream-controller]",wb),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(yS.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(yS.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.on(yS.LEVEL_LOADED,this.onLevelLoaded,this),e.on(yS.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(yS.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(yS.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(yS.ERROR,this.onError,this),e.on(yS.BUFFER_RESET,this.onBufferReset,this),e.on(yS.BUFFER_CREATED,this.onBufferCreated,this),e.on(yS.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(yS.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(yS.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(yS.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(yS.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(yS.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.off(yS.LEVEL_LOADED,this.onLevelLoaded,this),e.off(yS.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(yS.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(yS.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(yS.ERROR,this.onError,this),e.off(yS.BUFFER_RESET,this.onBufferReset,this),e.off(yS.BUFFER_CREATED,this.onBufferCreated,this),e.off(yS.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(yS.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(yS.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(yS.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:n}){if("main"===r){const e=t.cc;this.initPTS[t.cc]={baseTime:i,timescale:n},this.log(`InitPTS for cc: ${e} found from main: ${i}`),this.videoTrackCC=e,this.state===yw&&this.tick()}}startLoad(e){if(!this.levels)return this.startPosition=e,void(this.state=ow);const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=lw):(this.loadedmetadata=!1,this.state=hw),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case lw:this.doTickIdle();break;case hw:{var e;const{levels:t,trackId:r}=this,i=null==t||null==(e=t[r])?void 0:e.details;if(i){if(this.waitForCdnTuneIn(i))break;this.state=yw}break}case uw:{var t;const e=performance.now(),r=this.retryDate;if(!r||e>=r||null!=(t=this.media)&&t.seeking){const{levels:e,trackId:t}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==e?void 0:e[t])||null),this.state=lw}break}case yw:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:i,complete:n}=e;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=dw;const e={frag:t,part:r,payload:i.flush(),networkDetails:null};this._handleFragmentLoadProgress(e),n&&super._handleFragmentLoadComplete(e)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${t.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const e=this.getLoadPosition(),r=zR.bufferInfo(this.mediaBuffer,e,this.config.maxBufferHole);fR(r.end,this.config.maxFragLookUpTolerance,t)<0&&(this.log(`Waiting fragment cc (${t.cc}) @ ${t.start} cancelled because another fragment at ${r.end} is needed`),this.clearWaitingFragment())}}else this.state=lw}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=lw)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:r,trackId:i}=this,n=e.config;if(!r&&(this.startFragRequested||!n.startFragPrefetch)||null==t||!t[i])return;const s=t[i],a=s.details;if(!a||a.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(a))return void(this.state=hw);const o=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&o&&(this.bufferFlushed=!1,this.afterBufferFlushed(o,DS,wb));const l=this.getFwdBufferInfo(o,wb);if(null===l)return;const{bufferedTrack:c,switchingTrack:d}=this;if(!d&&this._streamEnded(l,a))return e.trigger(yS.BUFFER_EOS,{type:"audio"}),void(this.state=mw);const u=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Rb),h=l.len,f=this.getMaxBufferLength(null==u?void 0:u.len),p=a.fragments,m=p[0].start;let g=this.flushing?this.getLoadPosition():l.end;if(d&&r){const e=this.getLoadPosition();c&&!CA(d.attrs,c.attrs)&&(g=e),a.PTSKnown&&e<m&&(l.end>m||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=m+.05)}if(h>=f&&!d&&g<p[p.length-1].start)return;let y=this.getNextFragment(g,a),_=!1;if(y&&this.isLoopLoading(y,g)&&(_=!!y.gap,y=this.getNextFragmentLoopLoading(y,a,l,Rb,f)),!y)return void(this.bufferFlushed=!0);const v=u&&y.start>u.end+a.targetduration;if(v||(null==u||!u.len)&&l.len){const e=this.getAppendedFrag(y.start,Rb);if(null===e)return;if(_||(_=!!e.gap||!!v&&0===u.len),v&&!_||_&&l.nextStart&&l.nextStart<e.end)return}this.loadFragment(y,s,g)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map((e=>new Zb(e)))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state=lw,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=ow),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(yS.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var r;if(null==this.mainDetails)return void(this.cachedTrackLoadedData=t);const{levels:i}=this,{details:n,id:s}=t;if(!i)return void this.warn(`Audio tracks were reset while loading level ${s}`);this.log(`Audio track ${s} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`);const a=i[s];let o=0;if(n.live||null!=(r=a.details)&&r.live){this.checkLiveUpdate(n);const e=this.mainDetails;if(n.deltaUpdateFailed||!e)return;var l;if(!a.details&&n.hasProgramDateTime&&e.hasProgramDateTime)ZR(n,e),o=n.fragments[0].start;else o=this.alignPlaylists(n,a.details,null==(l=this.levelLastLoaded)?void 0:l.details)}a.details=n,this.levelLastLoaded=a,this.startFragRequested||!this.mainDetails&&n.live||this.setStartPosition(this.mainDetails||n,o),this.state!==hw||this.waitForCdnTuneIn(n)||(this.state=lw),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:i,payload:n}=e,{config:s,trackId:a,levels:o}=this;if(!o)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const c=l.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(r.start);const d=s.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let u=this.transmuxer;u||(u=this.transmuxer=new AA(this.hls,wb,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[r.cc],f=null==(t=r.initSegment)?void 0:t.data;if(void 0!==h){const e=!1,t=i?i.index:-1,s=-1!==t,a=new KR(r.level,r.sn,r.stats.chunkCount,n.byteLength,t,s);u.push(n,f,d,"",r,i,c.totalduration,e,a,h)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${c.startSN} ,${c.endSN}],track ${a}`);const{cache:e}=this.waitingData=this.waitingData||{frag:r,part:i,cache:new Ew,complete:!1};e.push(new Uint8Array(n)),this.waitingVideoCC=this.videoTrackCC,this.state=yw}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:r,part:i}=t;if(r.type===wb)if(this.fragContextChanged(r))this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if("initSegment"!==r.sn){this.fragPrevious=r;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(yS.AUDIO_TRACK_SWITCHED,dS({},e)))}this.fragBufferedComplete(r,i)}else if(!this.loadedmetadata&&r.type===Rb){const e=this.videoBuffer||this.media;if(e){zR.getBuffered(e).length&&(this.loadedmetadata=!0)}}}onError(e,t){var r;if(t.fatal)this.state=gw;else switch(t.details){case vS.FRAG_GAP:case vS.FRAG_PARSING_ERROR:case vS.FRAG_DECRYPT_ERROR:case vS.FRAG_LOAD_ERROR:case vS.FRAG_LOAD_TIMEOUT:case vS.KEY_LOAD_ERROR:case vS.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(wb,t);break;case vS.AUDIO_TRACK_LOAD_ERROR:case vS.AUDIO_TRACK_LOAD_TIMEOUT:case vS.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==hw||(null==(r=t.context)?void 0:r.type)!==Tb||(this.state=lw);break;case vS.BUFFER_APPEND_ERROR:case vS.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;if(t.details===vS.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case vS.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,{type:t}){t!==PS&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==PS){this.flushing=!1,this.bufferFlushed=!0,this.state===mw&&(this.state=lw);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,t,wb),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:i}=this,{remuxResult:n,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a)return void this.resetWhenMissingContext(s);const{frag:o,part:l,level:c}=a,{details:d}=c,{audio:u,text:h,id3:f,initSegment:p}=n;if(!this.fragContextChanged(o)&&d){if(this.state=fw,this.switchingTrack&&u&&this.completeAudioSwitch(this.switchingTrack),null!=p&&p.tracks){const e=o.initSegment||o;this._bufferInitSegment(c,p.tracks,e,s),i.trigger(yS.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:r,tracks:p.tracks})}if(u){const{startPTS:e,endPTS:t,startDTS:r,endDTS:i}=u;l&&(l.elementaryStreams[DS]={startPTS:e,endPTS:t,startDTS:r,endDTS:i}),o.setElementaryStreamInfo(DS,e,t,r,i),this.bufferFragmentData(u,o,l,s)}if(null!=f&&null!=(t=f.samples)&&t.length){const e=fS({id:r,frag:o,details:d},f);i.trigger(yS.FRAG_PARSING_METADATA,e)}if(h){const e=fS({id:r,frag:o,details:d},h);i.trigger(yS.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,r,i){if(this.state!==fw)return;t.video&&delete t.video;const n=t.audio;if(!n)return;n.id="audio";const s=e.audioCodec;this.log(`Init audio buffer, container:${n.container}, codecs[level/parsed]=[${s}/${n.codec}]`),s&&1===s.split(",").length&&(n.levelCodec=s),this.hls.trigger(yS.BUFFER_CODECS,t);const a=n.initSegment;if(null!=a&&a.byteLength){const e={type:"audio",frag:r,part:null,chunkMeta:i,parent:r.type,data:a};this.hls.trigger(yS.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);var n;if(this.fragCurrent=e,this.switchingTrack||i===NR||i===UR)if("initSegment"===e.sn)this._loadInitSegment(e,t);else if(null!=(n=t.details)&&n.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=yw;const r=this.mainDetails;r&&r.fragments[0].start!==t.details.fragments[0].start&&ZR(t.details,r)}else this.startFragRequested=!0,super.loadFragment(e,t,r);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){const{media:t,bufferedTrack:r}=this,i=null==r?void 0:r.attrs,n=e.attrs;t&&i&&(i.CHANNELS!==n.CHANNELS||r.name!==e.name||r.lang!==e.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(yS.AUDIO_TRACK_SWITCHED,dS({},e))}},audioTrackController:class extends TR{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.on(yS.MANIFEST_PARSED,this.onManifestParsed,this),e.on(yS.LEVEL_LOADING,this.onLevelLoading,this),e.on(yS.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(yS.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(yS.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.off(yS.MANIFEST_PARSED,this.onManifestParsed,this),e.off(yS.LEVEL_LOADING,this.onLevelLoading,this),e.off(yS.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(yS.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(yS.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:i,details:n}=t,s=this.tracksInGroup[r];if(!s||s.groupId!==i)return void this.warn(`Audio track with id:${r} and group:${i} not found in active group ${null==s?void 0:s.groupId}`);const a=s.details;s.details=t.details,this.log(`Audio track ${r} "${s.name}" lang:${s.lang} group:${i} loaded [${n.startSN}-${n.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,i=this.groupIds;let n=this.currentTrack;if(!r||(null==i?void 0:i.length)!==(null==r?void 0:r.length)||null!=r&&r.some((e=>-1===(null==i?void 0:i.indexOf(e))))){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter((e=>!r||-1!==r.indexOf(e.groupId)));if(e.length)this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),e.forEach(((e,t)=>{e.id=t}));else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!n&&t){const r=DR(t,e,OR);if(r>-1)n=e[r];else{const e=DR(t,this.tracks);n=this.tracks[e]}}let i=this.findTrackId(n);-1===i&&n&&(i=this.findTrackId(null));const a={audioTracks:e};this.log(`Updating audio tracks, ${e.length} track(s) found in group(s): ${null==r?void 0:r.join(",")}`),this.hls.trigger(yS.AUDIO_TRACKS_UPDATED,a);const o=this.trackId;if(-1!==i&&-1===o)this.setAudioTrack(i);else if(e.length&&-1===o){var s;const t=new Error(`No audio track selected for current audio group-ID(s): ${null==(s=this.groupIds)?void 0:s.join(",")} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}else this.shouldReloadPlaylist(n)&&this.setAudioTrack(this.trackId)}onError(e,t){!t.fatal&&t.context&&(t.context.type!==Tb||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||(this.requestScheduled=-1,this.checkRetry(t)))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const i=this.currentTrack;if(i&&PR(e,i,OR))return i;const n=DR(e,this.tracksInGroup,OR);if(n>-1){const e=this.tracksInGroup[n];return this.setAudioTrack(n),e}if(i){let i=t.loadLevel;-1===i&&(i=t.firstAutoLevel);const n=function(e,t,r,i,n){const s=t[i],a=t.reduce(((e,t,r)=>{const i=t.uri;return(e[i]||(e[i]=[])).push(r),e}),{}),o=a[s.uri];o.length>1&&(i=Math.max.apply(Math,o));const l=s.videoRange,c=s.frameRate,d=s.codecSet.substring(0,4),u=xR(t,i,(t=>{if(t.videoRange!==l||t.frameRate!==c||t.codecSet.substring(0,4)!==d)return!1;const i=t.audioGroups,s=r.filter((e=>!i||-1!==i.indexOf(e.groupId)));return DR(e,s,n)>-1}));return u>-1?u:xR(t,i,(t=>{const i=t.audioGroups,s=r.filter((e=>!i||-1!==i.indexOf(e.groupId)));return DR(e,s,n)>-1}))}(e,t.levels,r,i,OR);if(-1===n)return null;t.nextLoadLevel=n}if(e.channels||e.audioCodec){const t=DR(e,r);if(t>-1)return r[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn(`Invalid audio track id: ${e}`);this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e],n=i.details&&!i.details.live;if(e===this.trackId&&i===r&&n)return;if(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(yS.AUDIO_TRACK_SWITCHING,dS({},i)),n)return;const s=this.switchParams(i.url,null==r?void 0:r.details);this.loadPlaylist(s)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if((!this.selectDefaultTrack||i.default)&&(!e||PR(e,i,OR)))return r}if(e){const{name:r,lang:i,assocLang:n,characteristics:s,audioCodec:a,channels:o}=e;for(let e=0;e<t.length;e++){if(PR({name:r,lang:i,assocLang:n,characteristics:s,audioCodec:a,channels:o},t[e],OR))return e}for(let l=0;l<t.length;l++){const r=t[l];if(CA(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const r=t[l];if(CA(e.attrs,r.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){super.loadPlaylist();const r=t.id,i=t.groupId;let n=t.url;if(e)try{n=e.addDirectives(n)}catch(IU){this.warn(`Could not construct new URL with HLS Delivery Directives: ${IU}`)}this.log(`loading audio-track playlist ${r} "${t.name}" lang:${t.lang} group:${i}`),this.clearTimer(),this.hls.trigger(yS.AUDIO_TRACK_LOADING,{url:n,id:r,groupId:i,deliveryDirectives:e||null})}}},emeController:kL,cmcdController:class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:PL.MANIFEST,su:!this.initialized})}catch(IU){RS.warn("Could not generate manifest CMCD data.",IU)}},this.applyFragmentData=e=>{try{const t=e.frag,r=this.hls.levels[t.level],i=this.getObjectType(t),n={d:1e3*t.duration,ot:i};i!==PL.VIDEO&&i!==PL.AUDIO&&i!=PL.MUXED||(n.br=r.bitrate/1e3,n.tb=this.getTopBandwidth(i)/1e3,n.bl=this.getBufferLength(i)),this.apply(e,n)}catch(IU){RS.warn("Could not generate segment CMCD data.",IU)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;null!=r&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||function(){try{return crypto.randomUUID()}catch(IU){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(IU){let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(16)}))}}}(),this.cid=r.contentId,this.useHeaders=!0===r.useHeaders,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(yS.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(yS.MEDIA_DETACHED,this.onMediaDetached,this),e.on(yS.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(yS.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(yS.MEDIA_DETACHED,this.onMediaDetached,this),e.off(yS.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,i;this.audioBuffer=null==(r=t.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer}createData(){var e;return{v:1,sf:OL.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){fS(t,this.createData());const r=t.ot===PL.INIT||t.ot===PL.VIDEO||t.ot===PL.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce(((e,r)=>(i.includes(r)&&(e[r]=t[r]),e)),{})),this.useHeaders?(e.headers||(e.headers={}),hC(e.headers,t)):e.url=mC(e.url,t)}getObjectType(e){const{type:t}=e;return"subtitle"===t?PL.TIMED_TEXT:"initSegment"===e.sn?PL.INIT:"audio"===t?PL.AUDIO:"main"===t?this.hls.audioTracks.length?PL.VIDEO:PL.MUXED:void 0}getTopBandwidth(e){let t,r=0;const i=this.hls;if(e===PL.AUDIO)t=i.audioTracks;else{const e=i.maxAutoLevel,r=e>-1?e+1:i.levels.length;t=i.levels.slice(0,r)}for(const n of t)n.bitrate>r&&(r=n.bitrate);return r>0?r:NaN}getBufferLength(e){const t=this.hls.media,r=e===PL.AUDIO?this.audioBuffer:this.videoBuffer;if(!r||!t)return NaN;return 1e3*zR.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new r(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,r,i){t(e),this.loader.load(e,r,i)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new r(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,r,i){t(e),this.loader.load(e,r,i)}}}},contentSteeringController:class{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=RS.log.bind(RS,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.on(yS.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(yS.MANIFEST_PARSED,this.onManifestParsed,this),e.on(yS.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.off(yS.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(yS.MANIFEST_PARSED,this.onManifestParsed,this),e.off(yS.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter((t=>t!==e)))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;null!==r&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((null==r?void 0:r.action)===gR&&r.flags===ER){const e=this.levels;let i=this.pathwayPriority,n=this.pathwayId;if(t.context){const{groupId:r,pathwayId:i,type:s}=t.context;r&&e?n=this.getPathwayForGroupId(r,s,n):i&&(n=i)}n in this.penalizedPathways||(this.penalizedPathways[n]=performance.now()),!i&&e&&(i=e.reduce(((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e)),[])),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==n),r.resolved||RS.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${n} levels: ${e?e.length:e} priorities: ${JSON.stringify(i)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter((t=>e===t.pathwayId))}updatePathwayPriority(e){let t;this.pathwayPriority=e;const r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach((e=>{i-r[e]>3e5&&delete r[e]}));for(let n=0;n<e.length;n++){const i=e[n];if(i in r)continue;if(i===this.pathwayId)return;const s=this.hls.nextLoadLevel,a=this.hls.levels[s];if(t=this.getLevelsForPathway(i),t.length>0){this.log(`Setting Pathway to "${i}"`),this.pathwayId=i,sR(t),this.hls.trigger(yS.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[s];a&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==a.bitrate&&this.log(`Unstable Pathways change from bitrate ${a.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=s);break}}}getPathwayForGroupId(e,t,r){const i=this.getLevelsForPathway(r).concat(this.levels||[]);for(let n=0;n<i.length;n++)if(t===Tb&&i[n].hasAudioGroup(e)||t===bb&&i[n].hasSubtitleGroup(e))return i[n].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},i={};e.forEach((e=>{const{ID:n,"BASE-ID":s,"URI-REPLACEMENT":a}=e;if(t.some((e=>e.pathwayId===n)))return;const o=this.getLevelsForPathway(s).map((e=>{const t=new LS(e.attrs);t["PATHWAY-ID"]=n;const s=t.AUDIO&&`${t.AUDIO}_clone_${n}`,o=t.SUBTITLES&&`${t.SUBTITLES}_clone_${n}`;s&&(r[t.AUDIO]=s,t.AUDIO=s),o&&(i[t.SUBTITLES]=o,t.SUBTITLES=o);const l=yC(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),c=new Zb({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let r=1;r<e.audioGroups.length;r++)c.addGroupId("audio",`${e.audioGroups[r]}_clone_${n}`);if(e.subtitleGroups)for(let r=1;r<e.subtitleGroups.length;r++)c.addGroupId("text",`${e.subtitleGroups[r]}_clone_${n}`);return c}));t.push(...o),gC(this.audioTracks,r,a,n),gC(this.subtitleTracks,i,a,n)}))}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;let i;this.loader&&this.loader.destroy(),this.loader=new r(t);try{i=new self.URL(e)}catch(IU){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==i.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+e)}const n={responseType:"json",url:i.href},s=t.steeringManifestLoadPolicy.default,a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(e,t,r,n)=>{this.log(`Loaded steering manifest: "${i}"`);const s=e.data;if(1!==s.VERSION)return void this.log(`Steering VERSION ${s.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=s.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=s;if(a)try{this.uri=new self.URL(a,i).href}catch(IU){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${a}`)}this.scheduleRefresh(this.uri||r.url),o&&this.clonePathways(o);const c={steeringManifest:s,url:i.toString()};this.hls.trigger(yS.STEERING_MANIFEST_LOADED,c),l&&this.updatePathwayPriority(l)},onError:(e,t,r,i)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let n=1e3*this.timeToLoad;if(429!==e.code)this.scheduleRefresh(this.uri||t.url,n);else{const e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(n=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`)}},onTimeout:(e,t,r)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(n,o,l)}scheduleRefresh(e,t=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout((()=>{var t;const r=null==(t=this.hls)?void 0:t.media;!r||r.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)}),t)}}});function LC(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(LC):Object.keys(e).reduce(((t,r)=>(t[r]=LC(e[r]),t)),{}):e}function CC(e){const t=e.loader;if(t!==SC&&t!==vC)RS.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1})()&&(e.loader=SC,e.progressive=!0,e.enableSoftwareAES=!0,RS.log("[config]: Progressive streaming enabled, using FetchLoader"))}}let IC;class kC extends TR{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.on(yS.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(yS.LEVEL_LOADED,this.onLevelLoaded,this),e.on(yS.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(yS.FRAG_BUFFERED,this.onFragBuffered,this),e.on(yS.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.off(yS.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(yS.LEVEL_LOADED,this.onLevelLoaded,this),e.off(yS.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(yS.FRAG_BUFFERED,this.onFragBuffered,this),e.off(yS.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach((e=>{e.loadError=0,e.fragmentError=0})),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,i=[],n={},s={};let a=!1,o=!1,l=!1;t.levels.forEach((e=>{var t,c;const d=e.attrs;let{audioCodec:u,videoCodec:h}=e;-1!==(null==(t=u)?void 0:t.indexOf("mp4a.40.34"))&&(IC||(IC=/chrome|firefox/i.test(navigator.userAgent)),IC&&(e.audioCodec=u=void 0)),u&&(e.audioCodec=u=sb(u,r)),0===(null==(c=h)?void 0:c.indexOf("avc1"))&&(h=e.videoCodec=function(e){const t=e.split(".");if(t.length>2){let e=t.shift()+".";return e+=parseInt(t.shift()).toString(16),e+=("000"+parseInt(t.shift()).toString(16)).slice(-4),e}return e}(h));const{width:f,height:p,unknownCodecs:m}=e;if(a||(a=!(!f||!p)),o||(o=!!h),l||(l=!!u),null!=m&&m.length||u&&!JT(u,"audio",r)||h&&!JT(h,"video",r))return;const{CODECS:g,"FRAME-RATE":y,"HDCP-LEVEL":_,"PATHWAY-ID":v,RESOLUTION:E,"VIDEO-RANGE":S}=d,T=`${`${v||"."}-`}${e.bitrate}-${E}-${y}-${g}-${S}-${_}`;if(n[T])if(n[T].uri===e.url||e.attrs["PATHWAY-ID"])n[T].addGroupId("audio",d.AUDIO),n[T].addGroupId("text",d.SUBTITLES);else{const t=s[T]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const r=new Zb(e);n[T]=r,i.push(r)}else{const t=new Zb(e);n[T]=t,s[T]=1,i.push(t)}})),this.filterAndSortMediaOptions(i,t,a,o,l)}filterAndSortMediaOptions(e,t,r,i,n){let s=[],a=[],o=e;if((r||i)&&n&&(o=o.filter((({videoCodec:e,videoRange:t,width:r,height:i})=>{return(!!e||!(!r||!i))&&(!!(n=t)&&Kb.indexOf(n)>-1);var n}))),0===o.length)return void Promise.resolve().then((()=>{if(this.hls){t.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(t.levels[0].attrs)}`);const e=new Error("no level with compatible codecs found in manifest");this.hls.trigger(yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}}));if(t.audioTracks){const{preferManagedMediaSource:e}=this.hls.config;s=t.audioTracks.filter((t=>!t.audioCodec||JT(t.audioCodec,"audio",e))),DC(s)}t.subtitles&&(a=t.subtitles,DC(a));const l=o.slice(0);o.sort(((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return Kb.indexOf(e.videoRange)-Kb.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const r=tb(e.videoCodec),i=tb(t.videoCodec);if(r!==i)return i-r}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const r=rb(e.codecSet),i=rb(t.codecSet);if(r!==i)return i-r}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0}));let c=l[0];if(this.steering&&(o=this.steering.filterParsedLevels(o),o.length!==l.length))for(let f=0;f<l.length;f++)if(l[f].pathwayId===o[0].pathwayId){c=l[f];break}this._levels=o;for(let f=0;f<o.length;f++)if(o[f]===c){var d;this._firstLevel=f;const e=c.bitrate,t=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${o.length} level(s) found, first bitrate: ${e}`),void 0===(null==(d=this.hls.userConfig)?void 0:d.abrEwmaDefaultEstimate)){const r=Math.min(e,this.hls.config.abrEwmaDefaultEstimateMax);r>t&&t===AC.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=r)}break}const u=n&&!i,h={levels:o,audioTracks:s,subtitleTracks:a,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:n,video:i,altAudio:!u&&s.some((e=>!!e.url))};this.hls.trigger(yS.MANIFEST_PARSED,h),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const r=new Error("invalid level idx"),i=e<0;if(this.hls.trigger(yS.ERROR,{type:_S.OTHER_ERROR,details:vS.LEVEL_SWITCH_ERROR,level:e,fatal:i,error:r,reason:r.message}),i)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,i=this.currentLevel,n=i?i.attrs["PATHWAY-ID"]:void 0,s=t[e],a=s.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=s,r===e&&s.details&&i&&n===a)return;this.log(`Switching to level ${e} (${s.height?s.height+"p ":""}${s.videoRange?s.videoRange+" ":""}${s.codecSet?s.codecSet+" ":""}@${s.bitrate})${a?" with Pathway "+a:""} from level ${r}${n?" with Pathway "+n:""}`);const o={level:e,attrs:s.attrs,details:s.details,bitrate:s.bitrate,averageBitrate:s.averageBitrate,maxBitrate:s.maxBitrate,realBitrate:s.realBitrate,width:s.width,height:s.height,codecSet:s.codecSet,audioCodec:s.audioCodec,videoCodec:s.videoCodec,audioGroups:s.audioGroups,subtitleGroups:s.subtitleGroups,loaded:s.loaded,loadError:s.loadError,fragmentError:s.fragmentError,name:s.name,id:s.id,uri:s.uri,url:s.url,urlId:0,audioGroupIds:s.audioGroupIds,textGroupIds:s.textGroupIds};this.hls.trigger(yS.LEVEL_SWITCHING,o);const l=s.details;if(!l||l.live){const e=this.switchParams(s.uri,null==i?void 0:i.details);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){!t.fatal&&t.context&&t.context.type===Sb&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(void 0!==t&&t.type===Rb){const e=t.elementaryStreams;if(!Object.keys(e).some((t=>!!e[t])))return;const r=this._levels[t.level];null!=r&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var r;const{level:i,details:n}=t,s=this._levels[i];var a;if(!s)return this.warn(`Invalid level index ${i}`),void(null!=(a=t.deliveryDirectives)&&a.skip&&(n.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===s.fragmentError&&(s.loadError=0),this.playlistLoaded(i,t,s.details)):null!=(r=t.deliveryDirectives)&&r.skip&&(n.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,r=this.currentLevel;if(r&&this.shouldLoadPlaylist(r)){let i=r.uri;if(e)try{i=e.addDirectives(i)}catch(IU){this.warn(`Could not construct new URL with HLS Delivery Directives: ${IU}`)}const n=r.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""} with${n?" Pathway "+n:""} ${i}`),this.clearTimer(),this.hls.trigger(yS.LEVEL_LOADING,{url:i,level:t,pathwayId:r.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;const r=this._levels.filter(((t,r)=>r!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach((e=>e.level=-1))),!1)));sR(r),this._levels=r,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(yS.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(yS.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function DC(e){const t={};e.forEach((e=>{const r=e.groupId||"";e.id=t[r]=t[r]||0,t[r]++}))}class PC{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[r].loader;if(i){var t;if(e&&e!==(null==(t=i.context)?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=vS.KEY_LOAD_ERROR,r,i,n){return new tw({type:_S.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:r,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:r,cc:i}=e;for(let e=0;e<t.length;e++){const n=t[e];if(i<=n.cc&&("initSegment"===r||"initSegment"===n.sn||r<n.sn)){this.emeController.selectKeySystemFormat(n).then((e=>{n.setKeyFormat(e)}));break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then((t=>this.loadInternal(e,t))):this.loadInternal(e)}loadInternal(e,t){var r,i;t&&e.setKeyFormat(t);const n=e.decryptdata;if(!n){const r=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,vS.KEY_LOAD_ERROR,r))}const s=n.uri;if(!s)return Promise.reject(this.createKeyLoadError(e,vS.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${s}"`)));let a=this.keyUriToKeyInfo[s];if(null!=(r=a)&&r.decryptdata.key)return n.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});var o;if(null!=(i=a)&&i.keyLoadPromise)switch(null==(o=a.mediaKeySessionContext)?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then((t=>(n.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:a})))}switch(a=this.keyUriToKeyInfo[s]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===n.keyFormat?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,vS.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${n.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const t=this.emeController.loadKey(r);if(t)return(e.keyLoadPromise=t.then((t=>(e.mediaKeySessionContext=t,r)))).catch((t=>{throw e.keyLoadPromise=null,t}))}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,i=new(0,r.loader)(r);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise(((n,s)=>{const a={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=r.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,r,i)=>{const{frag:a,keyInfo:o,url:l}=r;if(!a.decryptdata||o!==this.keyUriToKeyInfo[l])return s(this.createKeyLoadError(a,vS.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),i));o.decryptdata.key=a.decryptdata.key=new Uint8Array(e.data),a.keyLoader=null,o.loader=null,n({frag:a,keyInfo:o})},onError:(e,r,i,n)=>{this.resetLoader(r),s(this.createKeyLoadError(t,vS.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),i,dS({url:a.url,data:void 0},e)))},onTimeout:(e,r,i)=>{this.resetLoader(r),s(this.createKeyLoadError(t,vS.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),i))},onAbort:(e,r,i)=>{this.resetLoader(r),s(this.createKeyLoadError(t,vS.INTERNAL_ABORTED,new Error("key loading aborted"),i))}};i.load(a,l,c)}))}resetLoader(e){const{frag:t,keyInfo:r,url:i}=e,n=r.loader;t.keyLoader===n&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],n&&n.destroy()}}function OC(){return self.SourceBuffer||self.WebKitSourceBuffer}function xC(){if(!ZT())return!1;const e=OC();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}class MC{constructor(e,t,r,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:r,media:i,stalled:n}=this;if(null===i)return;const{currentTime:s,seeking:a}=i,o=this.seeking&&!a,l=!this.seeking&&a;if(this.seeking=a,s!==e){if(this.moved=!0,a||(this.nudgeRetry=0),null!==n){if(this.stallReported){const e=self.performance.now()-n;RS.warn(`playback not stuck anymore @${s}, after ${Math.round(e)}ms`),this.stallReported=!1}this.stalled=null}return}if(l||o)return void(this.stalled=null);if(i.paused&&!a||i.ended||0===i.playbackRate||!zR.getBuffered(i).length)return void(this.nudgeRetry=0);const c=zR.bufferInfo(i,s,0),d=c.nextStart||0;if(a){const e=c.len>2,r=!d||t&&t.start<=s||d-s>2&&!this.fragmentTracker.getPartialFragment(s);if(e||r)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var u;if(!(c.len>0)&&!d)return;const e=Math.max(d,c.start||0)-s,t=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,r=(null==t||null==(u=t.details)?void 0:u.live)?2*t.details.targetduration:2,n=this.fragmentTracker.getPartialFragment(s);if(e>0&&(e<=r||n))return void(i.paused||this._trySkipBufferHole(n))}const h=self.performance.now();if(null===n)return void(this.stalled=h);const f=h-n;if(!a&&f>=250&&(this._reportStall(c),!this.media))return;const p=zR.bufferInfo(i,s,r.maxBufferHole);this._tryFixBufferStall(p,f)}_tryFixBufferStall(e,t){const{config:r,fragmentTracker:i,media:n}=this;if(null===n)return;const s=n.currentTime,a=i.getPartialFragment(s);if(a){if(this._trySkipBufferHole(a)||!this.media)return}(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-s<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(RS.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:r,stallReported:i}=this;if(!i&&r){this.stallReported=!0;const i=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${JSON.stringify(e)})`);RS.warn(i.message),t.trigger(yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:r,media:i}=this;if(null===i)return 0;const n=i.currentTime,s=zR.bufferInfo(i,n,0),a=n<s.start?s.start:s.nextStart;if(a){const o=s.len<=t.maxBufferHole,l=s.len>0&&s.len<1&&i.readyState<3,c=a-n;if(c>0&&(o||l)){if(c>t.maxBufferHole){const{fragmentTracker:t}=this;let r=!1;if(0===n){const e=t.getAppendedFrag(0,Rb);e&&a<e.end&&(r=!0)}if(!r){const r=e||t.getAppendedFrag(n,Rb);if(r){let e=!1,i=r.end;for(;i<a;){const r=t.getPartialFragment(i);if(!r){e=!0;break}i+=r.duration}if(e)return 0}}}const s=Math.max(a+.05,n+.1);if(RS.warn(`skipping hole, adjusting currentTime from ${n} to ${s}`),this.moved=!0,this.stalled=null,i.currentTime=s,e&&!e.gap){const t=new Error(`fragment loaded with buffer holes, seeking from ${n} to ${s}`);r.trigger(yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:t,reason:t.message,frag:e})}return s}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:r,nudgeRetry:i}=this;if(null===r)return;const n=r.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){const s=n+(i+1)*e.nudgeOffset,a=new Error(`Nudging 'currentTime' from ${n} to ${s}`);RS.warn(a.message),r.currentTime=s,t.trigger(yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})}else{const r=new Error(`Playhead still not moving while enough data buffered @${n} after ${e.nudgeMaxRetry} nudges`);RS.error(r.message),t.trigger(yS.ERROR,{type:_S.MEDIA_ERROR,details:vS.BUFFER_STALLED_ERROR,error:r,fatal:!0})}}}class NC extends vw{constructor(e,t,r){super(e,t,r,"[stream-controller]",Rb),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(yS.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(yS.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.on(yS.MANIFEST_PARSED,this.onManifestParsed,this),e.on(yS.LEVEL_LOADING,this.onLevelLoading,this),e.on(yS.LEVEL_LOADED,this.onLevelLoaded,this),e.on(yS.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(yS.ERROR,this.onError,this),e.on(yS.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(yS.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(yS.BUFFER_CREATED,this.onBufferCreated,this),e.on(yS.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(yS.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(yS.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(yS.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(yS.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(yS.MANIFEST_LOADING,this.onManifestLoading,this),e.off(yS.MANIFEST_PARSED,this.onManifestParsed,this),e.off(yS.LEVEL_LOADED,this.onLevelLoaded,this),e.off(yS.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(yS.ERROR,this.onError,this),e.off(yS.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(yS.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(yS.BUFFER_CREATED,this.onBufferCreated,this),e.off(yS.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(yS.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(yS.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:r}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=r.startLevel;-1===e&&(r.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=r.firstAutoLevel),r.nextLoadLevel=e,this.level=r.loadLevel,this.loadedmetadata=!1}t>0&&-1===e&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=lw,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=ow}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case _w:{const{levels:e,level:t}=this,r=null==e?void 0:e[t],i=null==r?void 0:r.details;if(i&&(!i.live||this.levelLastLoaded===r)){if(this.waitForCdnTuneIn(i))break;this.state=lw;break}if(this.hls.nextLoadLevel!==this.level){this.state=lw;break}break}case uw:{var e;const t=self.performance.now(),r=this.retryDate;if(!r||t>=r||null!=(e=this.media)&&e.seeking){const{levels:e,level:t}=this,r=null==e?void 0:e[t];this.resetStartWhenNotLoaded(r||null),this.state=lw}}}this.state===lw&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:i}=this;if(null===t||!i&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const n=e.nextLoadLevel;if(null==r||!r[n])return;const s=r[n],a=this.getMainFwdBufferInfo();if(null===a)return;const o=this.getLevelDetails();if(o&&this._streamEnded(a,o)){const e={};return this.altAudio&&(e.type="video"),this.hls.trigger(yS.BUFFER_EOS,e),void(this.state=mw)}e.loadLevel!==n&&-1===e.manualLevel&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=e.nextLoadLevel=n;const l=s.details;if(!l||this.state===_w||l.live&&this.levelLastLoaded!==s)return this.level=n,void(this.state=_w);const c=a.len,d=this.getMaxBufferLength(s.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const u=this.backtrackFragment?this.backtrackFragment.start:a.end;let h=this.getNextFragment(u,l);if(this.couldBacktrack&&!this.fragPrevious&&h&&"initSegment"!==h.sn&&this.fragmentTracker.getState(h)!==BR){var f;const e=(null!=(f=this.backtrackFragment)?f:h).sn-l.startSN,t=l.fragments[e-1];t&&h.cc===t.cc&&(h=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,u)){if(!h.gap){const e=this.audioOnly&&!this.altAudio?DS:PS,t=(e===PS?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,Rb)}h=this.getNextFragmentLoopLoading(h,l,a,Rb,d)}h&&(!h.initSegment||h.initSegment.data||this.bitrateTest||(h=h.initSegment),this.loadFragment(h,s,u))}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);this.fragCurrent=e,i===NR||i===UR?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Rb)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let r;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const n=this.getLevelDetails();if(null!=n&&n.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*n.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],i=this.fragLastKbps;r=i&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*i)+1:0}else r=0;const s=this.getBufferedFrag(t.currentTime+r);if(s){const e=this.followingBufferedFrag(s);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,r=e.duration,i=Math.max(s.end,t+Math.min(Math.max(r-this.config.maxFragLookUpTolerance,r*(this.couldBacktrack?.5:.125)),r*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(i,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case cw:case dw:case uw:case fw:case pw:this.state=lw}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new MC(this.config,r,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;pS(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const r=this.getMainFwdBufferInfo();null!==r&&0!==r.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${r?r.len:"empty"})`)}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(yS.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(e,t){let r=!1,i=!1;t.levels.forEach((e=>{const t=e.audioCodec;t&&(r=r||-1!==t.indexOf("mp4a.40.2"),i=i||-1!==t.indexOf("mp4a.40.5"))})),this.audioCodecSwitch=r&&i&&!function(){var e;const t=OC();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==lw)return;const i=r[t.level];(!i.details||i.details.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(i.details))&&(this.state=_w)}onLevelLoaded(e,t){var r;const{levels:i}=this,n=t.level,s=t.details,a=s.totalduration;if(!i)return void this.warn(`Levels were reset while loading level ${n}`);this.log(`Level ${n} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""}, cc [${s.startCC}, ${s.endCC}] duration:${a}`);const o=i[n],l=this.fragCurrent;!l||this.state!==dw&&this.state!==uw||l.level!==t.level&&l.loader&&this.abortCurrentFrag();let c=0;if(s.live||null!=(r=o.details)&&r.live){var d;if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;c=this.alignPlaylists(s,o.details,null==(d=this.levelLastLoaded)?void 0:d.details)}if(o.details=s,this.levelLastLoaded=o,this.hls.trigger(yS.LEVEL_UPDATED,{details:s,level:n}),this.state===_w){if(this.waitForCdnTuneIn(s))return;this.state=lw}this.startFragRequested?s.live&&this.synchronizeToLiveEdge(s):this.setStartPosition(s,c),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:i,payload:n}=e,{levels:s}=this;if(!s)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const a=s[r.level],o=a.details;if(!o)return this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),void this.fragmentTracker.removeFragment(r);const l=a.videoCodec,c=o.PTSKnown||!o.live,d=null==(t=r.initSegment)?void 0:t.data,u=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new AA(this.hls,Rb,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=i?i.index:-1,p=-1!==f,m=new KR(r.level,r.sn,r.stats.chunkCount,n.byteLength,f,p),g=this.initPTS[r.cc];h.push(n,d,u,l,r,i,o.totalduration,c,m,g)}onAudioTrackSwitching(e,t){const r=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const e=this.hls;r&&(e.trigger(yS.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),e.trigger(yS.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=t.id,i=!!this.hls.audioTracks[r].url;if(i){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=i,this.tick()}onBufferCreated(e,t){const r=t.tracks;let i,n,s=!1;for(const a in r){const e=r[a];if("main"===e.id){if(n=a,i=e,"video"===a){const e=r[a];e&&(this.videoBuffer=e.buffer)}}else s=!0}s&&i?(this.log(`Alternate track found, use ${n}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:i}=t;if(r&&r.type!==Rb)return;if(this.fragContextChanged(r))return this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===pw&&(this.state=lw));const n=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*n.total/(n.buffering.end-n.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}onError(e,t){var r;if(t.fatal)this.state=gw;else switch(t.details){case vS.FRAG_GAP:case vS.FRAG_PARSING_ERROR:case vS.FRAG_DECRYPT_ERROR:case vS.FRAG_LOAD_ERROR:case vS.FRAG_LOAD_TIMEOUT:case vS.KEY_LOAD_ERROR:case vS.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Rb,t);break;case vS.LEVEL_LOAD_ERROR:case vS.LEVEL_LOAD_TIMEOUT:case vS.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==_w||(null==(r=t.context)?void 0:r.type)!==Sb||(this.state=lw);break;case vS.BUFFER_APPEND_ERROR:case vS.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;if(t.details===vS.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case vS.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}checkBuffer(){const{media:e,gapController:t}=this;if(e&&t&&e.readyState){if(this.loadedmetadata||!zR.getBuffered(e).length){const e=this.state!==lw?this.fragCurrent:null;t.poll(this.lastCurrentTime,e)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=lw,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==DS||this.audioOnly&&!this.altAudio){const e=(t===PS?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(e,t,Rb),this.tick()}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking)return void this.log(`could not seek to ${r}, already seeking at ${t}`);const i=zR.getBuffered(e),n=(i.length?i.start(0):0)-r;n>0&&(n<this.config.maxBufferHole||n<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${n} to match buffer start`),r+=n,this.startPosition=r),this.log(`seek to target start position ${r} from current time ${t}`),e.currentTime=r}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then((r=>{const{hls:i}=this;if(!r||this.fragContextChanged(e))return;t.fragmentError=0,this.state=lw,this.startFragRequested=!1,this.bitrateTest=!1;const n=e.stats;n.parsing.start=n.parsing.end=n.buffering.start=n.buffering.end=self.performance.now(),i.trigger(yS.FRAG_LOADED,r),e.bitrateTest=!1}))}_handleTransmuxComplete(e){var t;const r="main",{hls:i}=this,{remuxResult:n,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a)return void this.resetWhenMissingContext(s);const{frag:o,part:l,level:c}=a,{video:d,text:u,id3:h,initSegment:f}=n,{details:p}=c,m=this.altAudio?void 0:n.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=fw,f){if(null!=f&&f.tracks){const e=o.initSegment||o;this._bufferInitSegment(c,f.tracks,e,s),i.trigger(yS.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:r,tracks:f.tracks})}const e=f.initPTS,t=f.timescale;pS(e)&&(this.initPTS[o.cc]={baseTime:e,timescale:t},i.trigger(yS.INIT_PTS_FOUND,{frag:o,id:r,initPTS:e,timescale:t}))}if(d&&p&&"initSegment"!==o.sn){const e=p.fragments[o.sn-1-p.startSN],t=o.sn===p.startSN,r=!e||o.cc>e.cc;if(!1!==n.independent){const{startPTS:e,endPTS:i,startDTS:n,endDTS:a}=d;if(l)l.elementaryStreams[d.type]={startPTS:e,endPTS:i,startDTS:n,endDTS:a};else if(d.firstKeyFrame&&d.independent&&1===s.id&&!r&&(this.couldBacktrack=!0),d.dropped&&d.independent){const n=this.getMainFwdBufferInfo(),s=(n?n.end:this.getLoadPosition())+this.config.maxBufferHole,l=d.firstKeyFramePTS?d.firstKeyFramePTS:e;if(!t&&s<l-this.config.maxBufferHole&&!r)return void this.backtrack(o);r&&(o.gap=!0),o.setElementaryStreamInfo(d.type,o.start,i,o.start,a,!0)}else t&&e>2&&(o.gap=!0);o.setElementaryStreamInfo(d.type,e,i,n,a),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(d,o,l,s,t||r)}else{if(!t&&!r)return void this.backtrack(o);o.gap=!0}}if(m){const{startPTS:e,endPTS:t,startDTS:r,endDTS:i}=m;l&&(l.elementaryStreams[DS]={startPTS:e,endPTS:t,startDTS:r,endDTS:i}),o.setElementaryStreamInfo(DS,e,t,r,i),this.bufferFragmentData(m,o,l,s)}if(p&&null!=h&&null!=(t=h.samples)&&t.length){const e={id:r,frag:o,details:p,samples:h.samples};i.trigger(yS.FRAG_PARSING_METADATA,e)}if(p&&u){const e={id:r,frag:o,details:p,samples:u.samples};i.trigger(yS.FRAG_PARSING_USERDATA,e)}}}_bufferInitSegment(e,t,r,i){if(this.state!==fw)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:n,video:s,audiovideo:a}=t;if(n){let t=e.audioCodec;const r=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==n.metadata.channelCount&&-1===r.indexOf("firefox")&&(t="mp4a.40.5")),t&&-1!==t.indexOf("mp4a.40.5")&&-1!==r.indexOf("android")&&"audio/mpeg"!==n.container&&(t="mp4a.40.2",this.log(`Android: force audio codec to ${t}`)),e.audioCodec&&e.audioCodec!==t&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${t}"`),n.levelCodec=t,n.id="main",this.log(`Init audio buffer, container:${n.container}, codecs[selected/level/parsed]=[${t||""}/${e.audioCodec||""}/${n.codec}]`)}s&&(s.levelCodec=e.videoCodec,s.id="main",this.log(`Init video buffer, container:${s.container}, codecs[level/parsed]=[${e.videoCodec||""}/${s.codec}]`)),a&&this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),this.hls.trigger(yS.BUFFER_CODECS,t),Object.keys(t).forEach((e=>{const n=t[e].initSegment;null!=n&&n.byteLength&&this.hls.trigger(yS.BUFFER_APPENDING,{type:e,data:n,frag:r,part:null,chunkMeta:i,parent:r.type})})),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Rb)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=lw}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const r=e.currentTime;if(zR.isBuffered(e,r)?t=this.getAppendedFrag(r):zR.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,r=t.level;e&&t.sn===e.sn&&e.level===r||(this.fragPlaying=t,this.hls.trigger(yS.FRAG_CHANGED,{frag:t}),e&&e.level===r||this.hls.trigger(yS.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,r=this.currentFrag;if(r&&pS(t)&&pS(r.programDateTime)){const e=r.programDateTime+1e3*(t-r.start);return new Date(e)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class FC{static get version(){return"1.5.6"}static isMSESupported(){return xC()}static isSupported(){return function(){if(!xC())return!1;const e=ZT();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some((t=>e.isTypeSupported(eb(t,"video"))))||["mp4a.40.2","fLaC"].some((t=>e.isTypeSupported(eb(t,"audio")))))}()}static getMediaSource(){return ZT()}static get Events(){return yS}static get ErrorTypes(){return _S}static get ErrorDetails(){return vS}static get DefaultConfig(){return FC.defaultConfig?FC.defaultConfig:AC}static set DefaultConfig(e){FC.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new wA,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,function(e,t){if("object"==typeof console&&!0===e||"object"==typeof e){bS(e,"debug","log","info","warn","error");try{TS.log(`Debug logs enabled for "${t}" in hls.js version 1.5.6`)}catch(r){TS=SS}}else TS=SS}(e.debug||!1,"Hls instance");const t=this.config=function(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=LC(e),i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((e=>{const n=`${"level"===e?"playlist":e}LoadPolicy`,s=void 0===t[n],a=[];i.forEach((i=>{const o=`${e}Loading${i}`,l=t[o];if(void 0!==l&&s){a.push(o);const e=r[n].default;switch(t[n]={default:e},i){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}})),a.length&&RS.warn(`hls.js config: "${a.join('", "')}" setting(s) are deprecated, use "${n}": ${JSON.stringify(t[n])}`)})),dS(dS({},r),t)}(FC.DefaultConfig,e);this.userConfig=e,t.progressive&&CC(t);const{abrController:r,bufferController:i,capLevelController:n,errorController:s,fpsController:a}=t,o=new s(this),l=this.abrController=new r(this),c=this.bufferController=new i(this),d=this.capLevelController=new n(this),u=new a(this),h=new Ib(this),f=new Vb(this),p=t.contentSteeringController,m=p?new p(this):null,g=this.levelController=new kC(this,m),y=new HR(this),_=new PC(this.config),v=this.streamController=new NC(this,y,_);d.setStreamController(v),u.setStreamController(v);const E=[h,g,v];m&&E.splice(1,0,m),this.networkControllers=E;const S=[l,c,d,u,f,y];this.audioTrackController=this.createController(t.audioTrackController,E);const T=t.audioStreamController;T&&E.push(new T(this,y,_)),this.subtitleTrackController=this.createController(t.subtitleTrackController,E);const b=t.subtitleStreamController;b&&E.push(new b(this,y,_)),this.createController(t.timelineController,S),_.emeController=this.emeController=this.createController(t.emeController,S),this.cmcdController=this.createController(t.cmcdController,S),this.latencyController=this.createController(Gb,S),this.coreComponents=S,E.push(o);const R=o.onErrorOut;"function"==typeof R&&this.on(yS.ERROR,R,o)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,i){this._emitter.off(e,t,r,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(IU){if(RS.error("An internal error happened while handling event "+e+'. Error message: "'+IU.message+'". Here is a stacktrace:',IU),!this.triggeringException){this.triggeringException=!0;const r=e===yS.ERROR;this.trigger(yS.ERROR,{type:_S.OTHER_ERROR,details:vS.INTERNAL_EXCEPTION,fatal:r,event:e,error:IU}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){RS.log("destroy"),this.trigger(yS.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((e=>e.destroy())),this.networkControllers.length=0,this.coreComponents.forEach((e=>e.destroy())),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){RS.log("attachMedia"),this._media=e,this.trigger(yS.MEDIA_ATTACHING,{media:e})}detachMedia(){RS.log("detachMedia"),this.trigger(yS.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,r=this.url,i=this.url=lS.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,RS.log(`loadSource:${i}`),t&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(yS.MANIFEST_LOADING,{url:e})}startLoad(e=-1){RS.log(`startLoad(${e})`),this.started=!0,this.networkControllers.forEach((t=>{t.startLoad(e)}))}stopLoad(){RS.log("stopLoad"),this.started=!1,this.networkControllers.forEach((e=>{e.stopLoad()}))}resumeBuffering(){this.started&&this.networkControllers.forEach((e=>{"fragmentLoader"in e&&e.startLoad(-1)}))}pauseBuffering(){this.networkControllers.forEach((e=>{"fragmentLoader"in e&&e.stopLoad()}))}swapAudioCodec(){RS.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){RS.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e){this.levelController.removeLevel(e)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){RS.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){RS.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){RS.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){RS.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){RS.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(RS.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function(e){return zb.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let i;if(i=-1===t&&null!=e&&e.length?e.length-1:t,r)for(let n=i;n--;){const t=e[n].attrs["HDCP-LEVEL"];if(t&&t<=r)return n}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(e){var t;return null==(t=this.audioTrackController)?void 0:t.setAudioOption(e)}setSubtitleOption(e){var t;return null==(t=this.subtitleTrackController)||t.setSubtitleOption(e),null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}FC.defaultConfig=void 0;const UC=[/.*chrome\/([1-6]\d|7[0-1])\..*MiuiBrowser.*/gi,/.*chrome\/([1-6]\d|70)\..*HeyTapBrowser.*/gi,/.*chrome\/([1-5]\d|6[0-2])\..*VivoBrowser.*/gi];window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;class BC{static async checkSystemRequirements(){return await this.webRTCCapabilityCheck()}static isChrome(){return"chrome"===iS.browserDetails.browser}static isSafari(){return"safari"===iS.browserDetails.browser}static isFirefox(){return"firefox"===iS.browserDetails.browser}static isOnlySupportUnfiedPlan(){let e=!0;if("chrome"===iS.browserDetails.browser){e=BC.getBrowserVersion()>90}else"safari"===iS.browserDetails.browser&&(e=iS.browserDetails.supportsUnifiedPlan);return e}static hlsCapabilityCheck(){let e=FC.isSupported();if(!e){const t=document.createElement("video");e=Boolean(t.canPlayType("application/vnd.apple.mpegurl"))}if(!e)throw new xh(Ph.HWLLS_ERROR_LIVE_UNSUPPORTED,"hls format unsupport.");return!0}static flvCapabilityCheck(){let e=sS.isSupported();if(e){const t=sS.getFeatureList();e=t.mseLiveFlvPlayback||t.nativeMP4H264Playback}if(!e)throw new xh(Ph.HWLLS_ERROR_LIVE_UNSUPPORTED,"flv format unsupport.");return!0}static async webRTCCapabilityCheck(){if(!window||!navigator)throw new xh(Ph.HWLLS_ERROR_WEBRTC_UNSUPPORTED,"window or navigator error");if(!window.RTCPeerConnection)throw new xh(Ph.HWLLS_ERROR_WEBRTC_UNSUPPORTED,"RTCPeerConnection Object not exist");let e=null;try{let t=new RTCPeerConnection;e=await t.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0}),BC.isChrome()&&!/H264/i.test(e.sdp)&&(t.close(),t=new RTCPeerConnection,e=await t.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!0})),t.close()}catch(IU){throw new xh(Ph.HWLLS_ERROR_WEBRTC_UNSUPPORTED,"RTCPeerConnection construct error: ".concat(IU.message))}if(!/H264/i.test(e.sdp))throw new xh(Ph.HWLLS_ERROR_WEBRTC_UNSUPPORTED,"RTCPeerConnection unsupport AVC codec.");if("chrome"===iS.browserDetails.browser&&!BC.browserSupportCheckByPolicy())throw new xh(Ph.HWLLS_ERROR_WEBRTC_UNSUPPORTED,"browser version not support: ".concat(navigator.userAgent));return!0}static browserSupportCheckByPolicy(){let e=!1;const t=UC;for(const r of t)if(r.test(navigator.userAgent)){e=!0;break}return!e}static getBrowserVersion(){if("safari"===iS.browserDetails.browser){const e=/.*Version\/(\d+).*/gi.exec(navigator.userAgent);if(e&&2===e.length)return parseInt(e[1])}return"chrome"===iS.browserDetails.browser?iS.browserDetails.version||91:iS.browserDetails.version}}var HC=p,jC=ye,VC=Dt,GC=function(){for(var e,t=VC(this),r=jC(t.delete),i=!0,n=0,s=arguments.length;n<s;n++)e=HC(r,t,arguments[n]),i=i&&e;return!!i};Ji({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:GC});var zC=p,KC=function(e){return zC(Map.prototype.entries,e)},WC=Dt,$C=ls,YC=KC,qC=dl;Ji({target:"Map",proto:!0,real:!0,forced:!0},{every:function(e){var t=WC(this),r=YC(t),i=$C(e,arguments.length>1?arguments[1]:void 0);return!qC(r,(function(e,r,n){if(!i(r,e,t))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var ZC=$,XC=ls,JC=p,QC=ye,eI=Dt,tI=Qn,rI=KC,iI=dl;Ji({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(e){var t=eI(this),r=rI(t),i=XC(e,arguments.length>1?arguments[1]:void 0),n=new(tI(t,ZC("Map"))),s=QC(n.set);return iI(r,(function(e,r){i(r,e,t)&&JC(s,n,e,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n}});var nI=Dt,sI=ls,aI=KC,oI=dl;Ji({target:"Map",proto:!0,real:!0,forced:!0},{find:function(e){var t=nI(this),r=aI(t),i=sI(e,arguments.length>1?arguments[1]:void 0);return oI(r,(function(e,r,n){if(i(r,e,t))return n(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var lI=Dt,cI=ls,dI=KC,uI=dl;Ji({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(e){var t=lI(this),r=dI(t),i=cI(e,arguments.length>1?arguments[1]:void 0);return uI(r,(function(e,r,n){if(i(r,e,t))return n(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var hI=Dt,fI=KC,pI=function(e,t){return e===t||e!=e&&t!=t},mI=dl;Ji({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(e){return mI(fI(hI(this)),(function(t,r,i){if(pI(r,e))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var gI=Dt,yI=KC,_I=dl;Ji({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(e){return _I(yI(gI(this)),(function(t,r,i){if(r===e)return i(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var vI=$,EI=ls,SI=p,TI=ye,bI=Dt,RI=Qn,wI=KC,AI=dl;Ji({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(e){var t=bI(this),r=wI(t),i=EI(e,arguments.length>1?arguments[1]:void 0),n=new(RI(t,vI("Map"))),s=TI(n.set);return AI(r,(function(e,r){SI(s,n,i(r,e,t),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n}});var LI=$,CI=ls,II=p,kI=ye,DI=Dt,PI=Qn,OI=KC,xI=dl;Ji({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(e){var t=DI(this),r=OI(t),i=CI(e,arguments.length>1?arguments[1]:void 0),n=new(PI(t,LI("Map"))),s=kI(n.set);return xI(r,(function(e,r){II(s,n,e,i(r,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n}});var MI=ye,NI=Dt,FI=dl;Ji({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function(e){for(var t=NI(this),r=MI(t.set),i=arguments.length,n=0;n<i;)FI(arguments[n++],r,{that:t,AS_ENTRIES:!0});return t}});var UI=Dt,BI=ye,HI=KC,jI=dl,VI=TypeError;Ji({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=UI(this),r=HI(t),i=arguments.length<2,n=i?void 0:arguments[1];if(BI(e),jI(r,(function(r,s){i?(i=!1,n=s):n=e(n,s,r,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i)throw VI("Reduce of empty map with no initial value");return n}});var GI=Dt,zI=ls,KI=KC,WI=dl;Ji({target:"Map",proto:!0,real:!0,forced:!0},{some:function(e){var t=GI(this),r=KI(t),i=zI(e,arguments.length>1?arguments[1]:void 0);return WI(r,(function(e,r,n){if(i(r,e,t))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var $I=p,YI=Dt,qI=ye,ZI=TypeError;Ji({target:"Map",proto:!0,real:!0,forced:!0},{update:function(e,t){var r=YI(this),i=qI(r.get),n=qI(r.has),s=qI(r.set),a=arguments.length;qI(t);var o=$I(n,r,e);if(!o&&a<3)throw ZI("Updating absent value");var l=o?$I(i,r,e):qI(a>2?arguments[2]:void 0)(e,r);return $I(s,r,e,t(l,e,r)),r}});const XI="OPS_STATISC_ENABLE",JI="LOADING_CONFIG",QI="ACCESS_DOMAIN",ek="DNS_QUERY_ENABLE",tk="GLSB_DOMAIN",rk="ParametersUtil";const ik=new class{constructor(){this.parameters=new Map}setParameter(e,t){if(!e)return Qv.error(rk,"setParameter, parameterKey is null"),!1;try{return Qv.debug(rk,"setParameter, parameterKey: ".concat(e,", parameterValue: ").concat(t)),this.parameters.set(e.toLowerCase(),t),!0}catch(IU){return Qv.error(rk,"setParameter occur error: ".concat(IU)),!1}}getParameter(e){try{return e&&this.parameters.has(e.toLowerCase())?this.parameters.get(e.toLowerCase()):null}catch(IU){return Qv.error(rk,"getParameter occur error: ".concat(IU)),null}}};var nk=pi.includes,sk=Jp;function ak(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function ok(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ak(Object(r),!0).forEach((function(t){$l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ak(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function lk(e){try{return e.map((e=>["object","function"].includes(typeof e)&&e.getInfo?e.getInfo():e))}catch(t){return e}}function ck(e){return(t,r,i)=>{const n=i.value,s=e.substr(0,e.indexOf("$"));return ok(ok({},i),{},{async value(){let t,r;const i=Zv.getCurrentLocalTimestamp();for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];const c=o||[],d=lk(c);try{Qv.info(s,"".concat(n.name," begin : parameters are ").concat(JSON.stringify(d))),t=await n.apply(this,c);const e=null!=t?lk([t]):[];return Qv.info(s,"".concat(n.name," end success : result is ").concat(JSON.stringify(e))),t}catch(IU){throw Qv.error(s,"".concat(n.name," end error : ").concat(IU)),"startPlay"===n.name&&Qv.uploadLog(),r=IU,IU}finally{var u;const n=Zv.getCurrentLocalTimestamp(),s=lk([t,...c]);null===(u=this.stats_)||void 0===u||u.reportApiCallInfo(e,i,n,r,...s)}}})}}function dk(e){return(t,r,i)=>{const n=i.value,s=e.substr(0,e.indexOf("$"));return ok(ok({},i),{},{value(){let t,r;const i=Zv.getCurrentLocalTimestamp();for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];const c=o||[],d=lk(c);try{Qv.info(s,"".concat(n.name," begin : parameters are ").concat(JSON.stringify(d))),r=n.apply(this,c);const e=null!=r?lk([r]):[];return Qv.info(s,"".concat(n.name," end success : result is ").concat(JSON.stringify(e))),r}catch(IU){throw Qv.error(s,"".concat(n.name," end error : ").concat(IU)),t=IU,IU}finally{var u;const s=Zv.getCurrentLocalTimestamp(),a=lk([r,...c]);(function(e,t,r,i){return!(e===t&&r&&r.length>1)||r[0]===i})(n.name,"setParameter",c,JI)&&(null===(u=this.stats_)||void 0===u||u.reportApiCallInfo(e,i,s,t,...a))}}})}}Ji({target:"Array",proto:!0,forced:c((function(){return!Array(1).includes()}))},{includes:function(e){return nk(this,e,arguments.length>1?arguments[1]:void 0)}}),sk("includes");var uk=ye,hk=xe,fk=N,pk=ci,mk=TypeError,gk=function(e){return function(t,r,i,n){uk(r);var s=hk(t),a=fk(s),o=pk(s),l=e?o-1:0,c=e?-1:1;if(i<2)for(;;){if(l in a){n=a[l],l+=c;break}if(l+=c,e?l<0:o<=l)throw mk("Reduce of empty array with no initial value")}for(;e?l>=0:o>l;l+=c)l in a&&(n=r(n,a[l],l,s));return n}},yk={left:gk(!1),right:gk(!0)},_k=c,vk=yk.left,Ek=function(e,t){var r=[][e];return!!r&&_k((function(){r.call(null,t||function(){return 1},1)}))},Sk=re,Tk=Qi;Ji({target:"Array",proto:!0,forced:!Ek("reduce")||!Tk&&Sk>79&&Sk<83},{reduce:function(e){var t=arguments.length;return vk(this,e,t,t>1?arguments[1]:void 0)}});class bk{static callWithTimeout(e,t){let r;const i=new Promise(((e,t)=>{r=t}));let n=null;return t&&(n=setTimeout((()=>{clearTimeout(n),r(new xh(Ph.HWLLS_INTERNAL_ERROR))}),t)),Promise.race([e,i]).finally((()=>{clearTimeout(n)}))}static async callWithRetryTimes(e,t,r,i,n){let s=r>=0?r+1:-1,a=1,o=!1;for(;-1===s||s;){let l,c;try{c=await e(a)}catch(IU){l=IU,o=n&&n(l),Qv.warn("FunctionUtil","callWithRetryTimes, func:".concat(e.name,", isInterrupted:").concat(o,",")+"retryTimes:".concat(r,", left times:").concat(-1===s?-1:s-1,", tryNumber:").concat(a,", err: ").concat(l))}finally{if(!((l||!l&&t)&&!o&&(-1===s||--s>0))){if(!l)return c;throw l}{const e="number"==typeof i?i:i(l);await Zv.sleep(e),a++}}}}}function Rk(){}function wk(){wk.init.call(this)}function Ak(e){return void 0===e._maxListeners?wk.defaultMaxListeners:e._maxListeners}function Lk(e,t,r,i){var n,s,a,o;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),a=s[t]):(s=e._events=new Rk,e._eventsCount=0),a){if("function"==typeof a?a=s[t]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),!a.warned&&(n=Ak(e))&&n>0&&a.length>n){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,o=l,"function"==typeof console.warn?console.warn(o):console.log(o)}}else a=s[t]=r,++e._eventsCount;return e}function Ck(e,t,r){var i=!1;function n(){e.removeListener(t,n),i||(i=!0,r.apply(e,arguments))}return n.listener=r,n}function Ik(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function kk(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}Rk.prototype=Object.create(null),wk.EventEmitter=wk,wk.usingDomains=!1,wk.prototype.domain=void 0,wk.prototype._events=void 0,wk.prototype._maxListeners=void 0,wk.defaultMaxListeners=10,wk.init=function(){this.domain=null,wk.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Rk,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},wk.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},wk.prototype.getMaxListeners=function(){return Ak(this)},wk.prototype.emit=function(e){var t,r,i,n,s,a,o,l="error"===e;if(a=this._events)l=l&&null==a.error;else if(!l)return!1;if(o=this.domain,l){if(t=arguments[1],!o){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=o,t.domainThrown=!1,o.emit("error",t),!1}if(!(r=a[e]))return!1;var d="function"==typeof r;switch(i=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var i=e.length,n=kk(e,i),s=0;s<i;++s)n[s].call(r)}(r,d,this);break;case 2:!function(e,t,r,i){if(t)e.call(r,i);else for(var n=e.length,s=kk(e,n),a=0;a<n;++a)s[a].call(r,i)}(r,d,this,arguments[1]);break;case 3:!function(e,t,r,i,n){if(t)e.call(r,i,n);else for(var s=e.length,a=kk(e,s),o=0;o<s;++o)a[o].call(r,i,n)}(r,d,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,i,n,s){if(t)e.call(r,i,n,s);else for(var a=e.length,o=kk(e,a),l=0;l<a;++l)o[l].call(r,i,n,s)}(r,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(i-1),s=1;s<i;s++)n[s-1]=arguments[s];!function(e,t,r,i){if(t)e.apply(r,i);else for(var n=e.length,s=kk(e,n),a=0;a<n;++a)s[a].apply(r,i)}(r,d,this,n)}return!0},wk.prototype.addListener=function(e,t){return Lk(this,e,t,!1)},wk.prototype.on=wk.prototype.addListener,wk.prototype.prependListener=function(e,t){return Lk(this,e,t,!0)},wk.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Ck(this,e,t)),this},wk.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Ck(this,e,t)),this},wk.prototype.removeListener=function(e,t){var r,i,n,s,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(r=i[e]))return this;if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new Rk:(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){a=r[s].listener,n=s;break}if(n<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new Rk,this;delete i[e]}else!function(e,t){for(var r=t,i=r+1,n=e.length;i<n;r+=1,i+=1)e[r]=e[i];e.pop()}(r,n);i.removeListener&&this.emit("removeListener",e,a||t)}return this},wk.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new Rk,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new Rk:delete r[e]),this;if(0===arguments.length){for(var i,n=Object.keys(r),s=0;s<n.length;++s)"removeListener"!==(i=n[s])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new Rk,this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},wk.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[]},wk.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Ik.call(e,t)},wk.prototype.listenerCount=Ik,wk.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};let Dk=function(e){return e[e.CUSTOMIZE_STANDARD=0]="CUSTOMIZE_STANDARD",e[e.COMMON_STANDARD=1]="COMMON_STANDARD",e}({}),Pk=function(e){return e.TRACK_TYPE_AUDIO="audio",e.TRACK_TYPE_VIDEO="video",e}({}),Ok=function(e){return e.CROP="crop",e.FILL="fill",e}({}),xk=function(e){return e[e.SUCC=0]="SUCC",e[e.FAIL=1]="FAIL",e[e.INTERRUPT=2]="INTERRUPT",e[e.CONNECTION_UNCOMPLETE=3]="CONNECTION_UNCOMPLETE",e[e.SUCC_AFTER_TIMEOUT=4]="SUCC_AFTER_TIMEOUT",e}({}),Mk=function(e){return e[e.CLOSED=0]="CLOSED",e[e.CONNECTED=1]="CONNECTED",e}({}),Nk=function(e){return e[e.EVENT_START_PULL_STREAM_REQ=201]="EVENT_START_PULL_STREAM_REQ",e[e.EVENT_STOP_PULL_STREAM_REQ=202]="EVENT_STOP_PULL_STREAM_REQ",e[e.EVENT_PULL_MEDIA_STREAM=203]="EVENT_PULL_MEDIA_STREAM",e[e.EVENT_CONNECTION_CHANNEL_STATUS=204]="EVENT_CONNECTION_CHANNEL_STATUS",e}({}),Fk=function(e){return e[e.EVENT_VIDEO_QOS=1100]="EVENT_VIDEO_QOS",e[e.EVENT_AUDIO_QOS=1101]="EVENT_AUDIO_QOS",e}({}),Uk=function(e){return e[e.API_CALL=501]="API_CALL",e[e.CALLBACK_API=502]="CALLBACK_API",e}({});const Bk="player-state-trace",Hk={MEDIA_STATISTIC:"media-statistic",NET_QUALITY:"network-quality",VIDEO_INTERRUPTED:"video-broken",AUDIO_INTERRUPTED:"audio-broken",VIDEO_RECOVERY:"video-recovery",AUDIO_RECOVERY:"audio-recovery",AUDIO_START:"audio-start",VIDEO_START:"video-start",VIDEO_STUCK:"video_stuck",FULLSCREEN_STATUS_CHANGED:"fullscreen-status-changed",PLAYER_CHANGE:"player-changed"};let jk=function(e){return e[e.NETWORK_QUALITY_INIT=-1]="NETWORK_QUALITY_INIT",e[e.NETWORK_QUALITY_UNKNOW=0]="NETWORK_QUALITY_UNKNOW",e[e.NETWORK_QUALITY_GREAT=1]="NETWORK_QUALITY_GREAT",e[e.NETWORK_QUALITY_GOOD=2]="NETWORK_QUALITY_GOOD",e[e.NETWORK_QUALITY_DEFECTS=3]="NETWORK_QUALITY_DEFECTS",e[e.NETWORK_QUALITY_WEAK=4]="NETWORK_QUALITY_WEAK",e[e.NETWORK_QUALITY_BAD=5]="NETWORK_QUALITY_BAD",e[e.NETWORK_QUALITY_DISCONNECT=6]="NETWORK_QUALITY_DISCONNECT",e}({}),Vk=function(e){return e[e.DNS=0]="DNS",e[e.GSLB=1]="GSLB",e}({}),Gk=function(e){return e.CONTAIN="contain",e.FILL="fill",e.COVER="cover",e}({}),zk=function(e){return e.WEBRTC="webrtc",e.HLS="hls",e.FLV="flv",e}({}),Kk=function(e){return e[e.USER_DOMIAN=0]="USER_DOMIAN",e[e.SHARE_DOMAIN=1]="SHARE_DOMAIN",e}({}),Wk=function(e){return e.DNS="DNS",e.HTTPDNS="HTTPDNS",e}({}),$k=function(e){return e[e.SHARE_DOMAIN_RETRY_TIMES=2]="SHARE_DOMAIN_RETRY_TIMES",e[e.USER_DOMAIN_RETRY_TIMES=3]="USER_DOMAIN_RETRY_TIMES",e}({});const Yk="downgrade";var qk=Ji,Zk=d,Xk=o,Jk=L,Qk=Fe,eD=V,tD=Y,rD=Zl,iD=At.f,nD=Mi,sD=Xk.Symbol,aD=sD&&sD.prototype;if(Zk&&eD(sD)&&(!("description"in aD)||void 0!==sD().description)){var oD={},lD=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:rD(arguments[0]),t=tD(aD,this)?new sD(e):void 0===e?sD():sD(e);return""===e&&(oD[t]=!0),t};nD(lD,sD),lD.prototype=aD,aD.constructor=lD;var cD="Symbol(test)"==String(sD("test")),dD=Jk(aD.toString),uD=Jk(aD.valueOf),hD=/^Symbol\((.*)\)[^)]+$/,fD=Jk("".replace),pD=Jk("".slice);iD(aD,"description",{configurable:!0,get:function(){var e=uD(this),t=dD(e);if(Qk(oD,e))return"";var r=cD?pD(t,7,-1):fD(t,hD,"$1");return""===r?void 0:r}}),qk({global:!0,constructor:!0,forced:!0},{Symbol:lD})}function mD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function gD(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mD(Object(r),!0).forEach((function(t){$l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mD(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class yD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;this.elements=new Array,this._size=e}push(e){return null!==e&&(null==this._size||isNaN(this._size)||this.elements.length===this._size&&this.elements.pop(),this.elements.unshift(e),!0)}size(){return this.elements.length}clear(){delete this.elements,this.elements=new Array}getElement(e){if(e<0||e>=this.size())return null;return this.elements[e]}}const _D="HWLLSInterval";const vD=new class{constructor(){$l(this,"isFireFox",BC.isFirefox()),this.reportSymbol=Symbol("HWLLSInterval_".concat(Zv.getCurrentLocalTimestamp())),this.sampleArray=new Map,this.connectionsManagers=[],this.event=new wk,this.preMediaStats=new Map,this.executeInterval((()=>{this.execHandler()}),Dh.STATISTIC_INTERVAL),this.isVideoBroken=!1,this.videoBrokenTimestamp=0}on(e,t){this.event.on(e,t)}off(e){e?this.event.removeAllListeners(e):this.event.removeAllListeners()}getSymbol(){return this.reportSymbol}reset(e){if(e){this.sampleArray.delete(e),this.preMediaStats.delete(e),this.off("video_stuck_".concat(e)),this.off("video_start_".concat(e)),this.off("audio_start_".concat(e));for(let t=0;t<this.connectionsManagers.length;t++)if(this.connectionsManagers[t].getConnectionId()===e){this.connectionsManagers.splice(t,1);break}}else this.sampleArray.clear(),this.preMediaStats.clear(),this.off(),this.connectionsManagers.length=0}connectionRegister(e){this.connectionsManagers.push(e)}getleastestStats(e,t){if(!e)return null;var r;if(!t)return null===(r=this.sampleArray.get(e))||void 0===r?void 0:r.getElement(0);let i=this.getElementStats(e,t,0);return i||(i=this.getElementStats(e,t,1)),i}getHistoryDatas(e){return this.sampleArray.get(e)}getleastestStatsByPropertyName(e,t,r){let i=this.getElementStats(e,t,0);return i||(i=this.getElementStats(e,t,1)),i?i[r]:null}getElementStats(e,t,r){var i;const n=null===(i=this.sampleArray.get(e))||void 0===i?void 0:i.getElement(r);if(!n)return null;if(this.isFireFox){let e=null;const r=t.split("_"),i=r[0],s=r[1],a=parseInt(r[2]);return n.data.forEach((t=>{t.type===i&&t.mediaType===s&&t.ssrc===a&&(e=t)})),e}return n.data.get(t)}executeInterval(e,t){const r=()=>{this.gatherTimer=setTimeout((async()=>{clearTimeout(this.gatherTimer),await e(),r()}),t)};r()}async getStats(e,t){const r=e.getConnection();if(!r||"function"!=typeof r.getStats)return;const i=await r.getStats(),n=e.getConnectionId();i&&i.forEach(((e,r)=>{if("candidate-pair"!==e.type||!0===e.selected||!0===e["nominated "]||"succeeded"===e.state){const i=e.mediaType||e.kind;["candidate-pair","local-candidate","inbound-rtp"].includes(e.type)&&(t.set("local-candidate"!==e.type?"".concat(e.type).concat(i?"_":"").concat(i||"").concat(e.ssrc?"_":"").concat(e.ssrc||""):r,e),this.streamHandler(n,e,i))}})),this.sampleArray.has(n)||this.sampleArray.set(n,new yD),this.sampleArray.get(n).push({data:t,processed:0})}streamHandler(e,t,r){let i={};this.preMediaStats.has(e)&&(i=this.preMediaStats.get(e)),"audio"!==r?"video"===r&&this.judgeVideoStreamStuck(e,t,i):!Object.prototype.hasOwnProperty.call(i,"preAudioPackets")&&t.packetsReceived>0&&(this.event.emit("audio_start_".concat(e)),this.preMediaStats.set(e,{preAudioPackets:t.packetsReceived}))}judgeVideoStreamBroken(e,t,r){const i=r>0&&r==t;if(i)if(this.isVideoBroken){Zv.getCurrentLocalTimestamp()-this.videoBrokenTimestamp>=5e3&&(this.videoBrokenTimestamp=Zv.getCurrentLocalTimestamp(),Qv.info(_D,"video stream broken, start auto recovery , current timestamp : ".concat(this.videoBrokenTimestamp)),this.event.emit("video_broken_".concat(e)))}else this.isVideoBroken=!0,this.videoBrokenTimestamp=Zv.getCurrentLocalTimestamp(),Qv.info(_D,"video stream broken, start timestamp : ".concat(this.videoBrokenTimestamp,", preReceiveFrames:").concat(r,", framesReceived:").concat(t));else!i&&this.isVideoBroken&&(this.isVideoBroken=!1,this.videoBrokenTimestamp=0,Qv.info(_D,"video stream recovery, timestamp : ".concat(Zv.getCurrentLocalTimestamp())),this.event.emit("video_recover_".concat(e)))}judgeVideoStreamStuck(e,t,r){const i=t.framesDecoded||0;if(r&&Object.prototype.hasOwnProperty.call(r,"preReceiveFrames")){if(this.judgeVideoStreamBroken(e,i,r.preReceiveFrames),!r.frameStuckCheck&&r.frameFirstComing)return void(r.preReceiveFrames=i);i===r.preReceiveFrames?r.noChangeCount++:(0===r.preReceiveFrames||r.noChangeCount>1)&&(r.noChangeCount=1,this.event.emit("video_stuck_".concat(e),!1),0===r.preReceiveFrames&&this.event.emit("video_start_".concat(e)),r.frameFirstComing=!0),r.preReceiveFrames=i,r.noChangeCount%r.stuckThreshold==0&&this.event.emit("video_stuck_".concat(e),!0)}else{const t=gD(gD({},{frameStuckLoading:!1,frameStuckThreshold:10}),ik.getParameter(JI)||{}),n={noChangeCount:1,preReceiveFrames:i,stuckThreshold:t.frameStuckThreshold,frameStuckCheck:t.frameStuckLoading,frameFirstComing:!1};i&&(n.frameFirstComing=!0,this.event.emit("video_stuck_".concat(e),!1),this.event.emit("video_start_".concat(e))),this.preMediaStats.set(e,Object.prototype.hasOwnProperty.call(r,"preAudioPackets")?gD(gD({},n),r):n)}}async execHandler(){for(const e of this.connectionsManagers){const t=new Map;await this.getStats(e,t)}}};const ED={audio200:200,video200:200,video600:600};class SD{static startUpMediaStats(e){vD.connectionRegister(e)}static shutDownMediaStats(e){vD.reset(e)}static getLeastestVideoInfo(e,t){return t?vD.getleastestStats(e,"inbound-rtp_video_".concat(t)):null}static getLeastestAudioInfo(e,t){return t?vD.getleastestStats(e,"inbound-rtp_audio_".concat(t)):null}static getConnectionNetType(e){var t;if(BC.isFirefox()&&!e)return null;const r=null===(t=vD.getleastestStats(e))||void 0===t?void 0:t.data;if(!r)return null;let i=null;for(const n of r.values())if("local-candidate"===n.type){i=n.networkType;break}return"unknown"!==i?i:"other"}static async getCandidatePairProtocol(e){var t,r,i;await Zv.sleep(800);const n=null===(t=vD.getleastestStats(e))||void 0===t?void 0:t.data;return n&&(null===(r=n.get(null===(i=n.get("candidate-pair"))||void 0===i?void 0:i.localCandidateId))||void 0===r?void 0:r.protocol)||"udp"}static getMediaStatistic(e,t,r){const i=vD.getHistoryDatas(e);if(!i||i.size()<1)return null;const n=r===Pk.TRACK_TYPE_AUDIO?1:2,s=[];let a=0;for(let P=0;P<i.size();P++){if((i.getElement(P).processed&n)>0)continue;i.getElement(P).processed=i.getElement(P).processed|n;const e=i.getElement(P).data;if(!e)continue;const o=e.get("inbound-rtp_".concat(r,"_").concat(t));if(o){s.push(o);const t=e.get("candidate-pair");if(!t)continue;Object.prototype.hasOwnProperty.call(t,"currentRoundTripTime")?a+=1e3*Zv.getValue(t.currentRoundTripTime,0):a+=Math.abs(Zv.getValue(t.lastPacketReceivedTimestamp,0)-Zv.getValue(t.lastPacketSentTimestamp,0))}}const o=s.length;if(0===o)return null;const l=s[0],c=o>1?s[o-1]:{},d=function(e,t){if(e==Pk.TRACK_TYPE_VIDEO){if(Object.prototype.hasOwnProperty.call(t,"framesDecoded"))return"framesDecoded";if(Object.prototype.hasOwnProperty.call(t,"framesReceived"))return"framesReceived"}return"packetsReceived"}(r,l),u=Zv.getValue(l.bytesReceived,0),h=Zv.getValue(l.packetsReceived,0),f=Math.max(u-Zv.getValue(c.bytesReceived,0),0),p=Zv.getValue(l.framesReceived,0),m=Zv.getValue(l.framesDecoded,0),g=Zv.getValue(l.framesDropped,0),y=Math.max(l.packetsLost-Zv.getValue(c.packetsLost,0),0),{total200FreezeTime:_,total200FreezeCnt:v,total600VFreezeTime:E,total600VFreezeCnt:S,totalJetter:T,totalStatisticTime:b,validSampleCount:R}=SD.calcFreezeStatistic(s,d,r),w={rtt:Math.ceil(a/o),total200FreezeTime:_,total200FreezeCnt:v,totalStatisticTime:b,totalPacketsReceived:h,totalByteReceived:u,bitRate:Math.round(8*f/(b||1)),lostPktCnt:y,jitter:Math.round(1e3*T/R),nackCnt:Zv.getValue(l.nackCount,0)};if(r===Pk.TRACK_TYPE_AUDIO)return w;const A=Math.max(m-Zv.getValue(c.framesDecoded,0),0),L=Math.max(l.keyFramesDecoded-Zv.getValue(c.keyFramesDecoded,0),0),C=1e3*A/(b||1),I=(Zv.getValue(l.jitterBufferDelay,0)-Zv.getValue(c.jitterBufferDelay,0))/Math.max(Zv.getValue(l.jitterBufferEmittedCount,0)-Zv.getValue(c.jitterBufferEmittedCount,0),1)*1e3,k={rtt:w.rtt,jitterBufferDelay:Zv.getValue(l.jitterBufferDelay,0),jitterBufferEmittedCount:Zv.getValue(l.jitterBufferEmittedCount,0),framesPerSecond:l.framesPerSecond||Math.ceil(C),jbDelay:Math.ceil(Math.max(I,0)),frameDelay:1e3*Math.max((p-m-g)/Zv.getValue(C,1),0)},D=Math.ceil(k.rtt+k.jbDelay+k.frameDelay);return Object.assign(w,{width:Zv.getValue(l.frameWidth,0),height:Zv.getValue(l.frameHeight,0),totalDecodeFrames:A,frameRate:Math.ceil(C),keyFrames:L,delayInfo:k,downloadDelay:D,framesReceived:p,framesDecoded:m,framesDropped:g,total600VFreezeTime:E,total600VFreezeCnt:S,pliCnt:Zv.getValue(l.pliCount,0),firCnt:Zv.getValue(l.firCount,0)}),w}static calcFreezeStatistic(e,t,r){let i=0,n=0,s=0,a=0,o=0,l=0,c=0,d=0,u=0;const h=r!==Pk.TRACK_TYPE_AUDIO,f=Object.prototype.hasOwnProperty.call(e[0],"timestamp");if(e.length<2)return{total200FreezeTime:a,total200FreezeCnt:o,total600VFreezeTime:c,total600VFreezeCnt:d,totalJetter:Zv.getValue(e[0].jitter,0),totalStatisticTime:Dh.STATISTIC_INTERVAL,validSampleCount:1};for(let p=0;p<e.length;p++){if(!e[p]||0===e[p].bytesReceived&&0===e[p].packetsReceived){Qv.error("MediaStats","Has no data at start, ignore sample: ".concat(e[p].timestamp));continue}if(0===p){i++,u+=Zv.getValue(e[p].jitter,0);continue}const m=f?Math.round(Zv.getValue(e[p-1].timestamp,0)-Zv.getValue(e[p].timestamp,0)):Dh.STATISTIC_INTERVAL;if(m>2e3){Qv.error("MediaStats","Has huge gap between ".concat(e[p].timestamp," - ").concat(e[p-1].timestamp,", ignore sample: ").concat(e[p].timestamp,", deltaTimeStamp: ").concat(m));continue}i++,u+=Zv.getValue(e[p].jitter,0),n+=m;if(0!==e[p][t])if(e[p-1][t]===e[p][t]){s+=m,h&&(l+=m)}else s>=ED["".concat(r,"200")]&&(a+=s,o++),s=0,h&&l>=ED["".concat(r,"600")]&&(c+=l,d++),l=0;else Qv.error("MediaStats","first frame has not received yet, ignore stuck statistic")}return s>=ED["".concat(r,"200")]&&(a+=s,o++),h&&l>=ED["".concat(r,"600")]&&(c+=l,d++),{total200FreezeTime:a,total200FreezeCnt:o,total600VFreezeTime:c,total600VFreezeCnt:d,totalJetter:u,totalStatisticTime:n,validSampleCount:i}}}function TD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function bD(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?TD(Object(r),!0).forEach((function(t){$l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TD(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class RD{constructor(){this.audioStatisticCache=[],this.videoStatisticCache=[],this.playTrackKpi={startPlayTime:0,iceCandidateStart:0,iceCandidateComplete:0,icePairStart:0,iceChecking:0,iceComplete:0,dtlsComplete:0,glsbRequest:0,glsbRespone:0,negotiateSDPRequest:0,negotiateSDPRespone:0,audioPlaySucc:0,videoPlaySucc:0,endPlayTime:0,videoTimeOut:0,audioTimeOut:0},this.pullMediaParams={}}updatePlayTrackKpi(e){if(this.playTrackKpi[e]=Zv.getCurrentLocalTimestamp(),/^(ice|dtls).*/gi.test(e)&&this.addKeyInfoMsg(e,this.playTrackKpi[e]),["endPlayTime","videoTimeOut","audioTimeOut"].includes(e))return;let t=!0;for(const r in this.playTrackKpi)if(!["videoTimeOut","audioTimeOut","endPlayTime","glsbRespone","glsbRequest"].includes(r)&&!this.playTrackKpi[r])if(["videoPlaySucc","audioPlaySucc"].includes(r)){if(!this.sfuInfo.aSsrc&&!this.sfuInfo.vSsrc){t=!1;break}if("audioPlaySucc"===r&&this.sfuInfo.aSsrc&&!this.playTrackKpi[r]){t=!1;break}if("videoPlaySucc"===r&&this.sfuInfo.vSsrc&&!this.playTrackKpi[r]){t=!1;break}}else if(!this.playTrackKpi[r]){t=!1;break}t&&Qv.info("KPI","startPlay time spent analysis( gslbDispatch cost: ".concat(this.playTrackKpi.glsbRespone-this.playTrackKpi.glsbRequest,"ms; negotiateSDP cost: ").concat(this.playTrackKpi.negotiateSDPRespone-this.playTrackKpi.negotiateSDPRequest,"ms; localICE candidate collect cost: ").concat(this.playTrackKpi.iceCandidateComplete-this.playTrackKpi.iceCandidateStart,"ms; Connection establish total cost: ").concat(this.playTrackKpi.dtlsComplete-this.playTrackKpi.icePairStart,"ms; ICE Connectivity check: ").concat(this.playTrackKpi.iceComplete-this.playTrackKpi.iceChecking,"ms; DTLS negotiate cost: ").concat(this.playTrackKpi.dtlsComplete-this.playTrackKpi.iceComplete,"ms; first frame cost: ").concat(Math.max(this.playTrackKpi.videoPlaySucc,this.playTrackKpi.audioPlaySucc)-this.playTrackKpi.startPlayTime,"ms"))}getPlayTrackKpi(){return this.playTrackKpi}getSfuInfo(){return this.sfuInfo}setSfuInfo(e){e.ipAddress&&(e.ipAddress=Zv.isIpv6(e.ipAddress)?"[".concat(e.ipAddress,"]"):e.ipAddress),this.sfuInfo=e}setStreamParams(e){this.streamParams?this.streamParams=bD(bD({},this.streamParams),e):this.streamParams=e}getStreamParams(){return this.streamParams}updateAccessAddr(e){this.streamParams?this.streamParams.accessAddr=this.ipDesensitization(e):this.streamParams={accessAddr:this.ipDesensitization(e)}}ipDesensitization(e){if(!e)return e;let t;if(Zv.isIpv6(e)){const r=e.split(":");if(r.length>2){t="[***:***";for(let e=2;e<r.length;e++)t="".concat(t,":").concat(r[e]);t="".concat(t,"]")}else t="[".concat(e,"]")}else{const r=e.split(".");t=4==r.length?"***.***.".concat(r[2],".").concat(r[3]):e}return t}setPullMediaParams(e){this.pullMediaParams.clientAddr?delete e.clientAddr:e.clientAddr=this.ipDesensitization(e.clientAddr),this.pullMediaParams=bD(bD({},this.pullMediaParams),e)}updateClientAddr(e){e&&(this.pullMediaParams.clientAddr||(this.pullMediaParams.clientAddr=this.ipDesensitization(e)))}getPullMediaParams(){return this.pullMediaParams}addVideoStatisticCache(e){this.videoStatisticCache.push(e)}addAudioStatisticCache(e){this.audioStatisticCache.push(e)}calcPlayDuration(){return Math.round((this.playTrackKpi.endPlayTime-this.playTrackKpi.startPlayTime)/1e3)}getMediaFreezeStatistic(e){const t=this[e===Pk.TRACK_TYPE_AUDIO?"audioStatisticCache":"videoStatisticCache"];let r=0,i=0,n=0,s=0;for(const a of t)i+=a.total200FreezeCnt,r+=a.total200FreezeTime,e===Pk.TRACK_TYPE_VIDEO&&(s+=a.total600VFreezeCnt,n+=a.total600VFreezeTime);return e===Pk.TRACK_TYPE_VIDEO?{freeze200Count:i,freeze200Duration:r,freeze600Count:s,freeze600Duration:n}:{freeze200Count:i,freeze200Duration:r}}calcAverageStatistic(){const e={afreeze200Cnt:0,vfreeze200Cnt:0,vfreeze600Cnt:0};let t=0,r=this.audioStatisticCache.length>0?this.audioStatisticCache[this.audioStatisticCache.length-1].totalPacketsReceived:0,i=0,n=0,s=0,a=0,o=0,l=0;for(const c of this.audioStatisticCache)e.afreeze200Cnt+=c.total200FreezeCnt,s+=c.total200FreezeTime,o+=c.totalStatisticTime,t+=c.lostPktCnt,i+=c.bitRate,n+=c.jitter,l+=c.rtt;e.afreeze200Rate=Math.round(100*s/Math.max(o,1)),e.aRecvBandwidthMean=Math.round(i/Math.max(this.audioStatisticCache.length,1)),e.aRecvLostMean=Math.round(100*t/Math.max(r+t,1)),e.aRecvJitter=Math.round(n/Math.max(this.audioStatisticCache.length,1)),e.aRecvRttMean=Math.round(l/Math.max(this.audioStatisticCache.length,1)),t=0,r=this.videoStatisticCache.length>0?this.videoStatisticCache[this.videoStatisticCache.length-1].totalPacketsReceived:0,i=0,n=0,s=0,o=0,l=0;for(const c of this.videoStatisticCache)e.vfreeze200Cnt+=c.total200FreezeCnt,e.vfreeze600Cnt+=c.total600VFreezeCnt,s+=c.total200FreezeTime,a+=c.total600VFreezeTime,o+=c.totalStatisticTime,t+=c.lostPktCnt,i+=c.bitRate,n+=c.jitter,l+=c.rtt;return e.vfreeze200Rate=Math.round(100*s/Math.max(o,1)),e.vfreeze600Rate=Math.round(100*a/Math.max(o,1)),e.vRecvBandwidthMean=Math.round(i/Math.max(this.videoStatisticCache.length,1)),e.vRecvLostMean=Math.round(100*t/Math.max(r+t,1)),e.vRecvJitter=Math.round(n/Math.max(this.videoStatisticCache.length,1)),e.vRecvRttMean=Math.round(l/Math.max(this.videoStatisticCache.length,1)),e}addKeyInfoMsg(e,t){this.pullMediaParams.keyInfoMsg||(this.pullMediaParams.keyInfoMsg={}),"iceCandidateComplete"===e&&this.pullMediaParams.keyInfoMsg.iceCandidateStart?this.pullMediaParams.keyInfoMsg[e]=t-this.pullMediaParams.keyInfoMsg.iceCandidateStart:"iceChecking"===e&&this.pullMediaParams.keyInfoMsg.icePairStart?this.pullMediaParams.keyInfoMsg[e]=t-this.pullMediaParams.keyInfoMsg.icePairStart:"iceComplete"===e&&this.pullMediaParams.keyInfoMsg.icePairStart?this.pullMediaParams.keyInfoMsg[e]=t-this.pullMediaParams.keyInfoMsg.icePairStart-(this.pullMediaParams.keyInfoMsg.iceChecking||0):"dtlsComplete"===e&&this.pullMediaParams.keyInfoMsg.icePairStart?this.pullMediaParams.keyInfoMsg[e]=t-this.pullMediaParams.keyInfoMsg.icePairStart-((this.pullMediaParams.keyInfoMsg.iceChecking||0)+(this.pullMediaParams.keyInfoMsg.iceComplete||0)):this.pullMediaParams.keyInfoMsg[e]=t}}class wD{static addInstance(e){wD.globalVariableMap.set(e,new RD)}static getInstance(e){return wD.globalVariableMap.get(e)}static delInstance(e){e?wD.globalVariableMap.delete(e):wD.globalVariableMap.clear()}}$l(wD,"globalVariableMap",new Map);const AD=new class{constructor(){const e=navigator.connection;e&&(this.networkType=e.type,this.networkRTT=e.rtt,this.downlink=e.downlink||-1,Object.prototype.hasOwnProperty.call(navigator.connection,"onchange")&&(navigator.connection.onchange=()=>{const e=navigator.connection;this.networkType=e.type,this.networkRTT=e.rtt,this.downlink=e.downlink||-1}))}getNetworkType(){return this.networkType}getNetworkRTT(){return this.networkRTT}getNetworkInfo(){return{networkType:this.networkType,networkRTT:this.networkRTT}}};function LD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function CD(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?LD(Object(r),!0).forEach((function(t){$l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):LD(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class ID{constructor(e){this.identifiedId=e,this.module_="HWLLSStat",this.commInfo={},this.commInfo.deviceId=Zv.getDeviceID(),this.commInfo.v="web-".concat(Dh.SDK_VERSION,"-").concat(Dh.COMMIT_ID),this.commInfo.userAgent=navigator.userAgent}reportStartPullStreamReqEvent(e){var t,r,i;if(!this.isStatiscEnable())return;const n=null===(t=wD.getInstance(this.identifiedId))||void 0===t?void 0:t.getSfuInfo(),s=null===(r=wD.getInstance(this.identifiedId))||void 0===r?void 0:r.getStreamParams(),a=null===(i=wD.getInstance(this.identifiedId))||void 0===i?void 0:i.getPlayTrackKpi(),o=this.generateCommonReportInfo({accessAddr:(null==s?void 0:s.accessAddr)||"",routeType:s.routeType,SFUAddr:(null==n?void 0:n.ipAddress)||"",aPort:(null==n?void 0:n.audioPort)||0,vPort:(null==n?void 0:n.videoPort)||0,httpCode:e.httpCode,resultCode:e.retCode,resultMessage:e.retMsg,startTime:a.negotiateSDPRequest,endTime:a.negotiateSDPRespone,playQos:JSON.stringify(e.joinQos||{}),appUrl:Zv.getAppUrl(),gslbCostTime:a.glsbRespone-a.glsbRequest,sigCostTime:a.negotiateSDPRespone-a.negotiateSDPRequest,platform:Zv.getPlatform(),bv:Zv.getBrowserVersion(),timeDiff:Zv.getTimeDiff(),autoRetry:e.autoRetry},Nk.EVENT_START_PULL_STREAM_REQ,"event^startPlay^SDK^ACS");zv.addRecord(o),zv.immediateReportRecords()}reportStopPullStreamReqEvent(e){var t,r;if(!this.isStatiscEnable())return;const i=null===(t=wD.getInstance(this.identifiedId))||void 0===t?void 0:t.calcAverageStatistic(),n=wD.getInstance(this.identifiedId).getStreamParams(),s=wD.getInstance(this.identifiedId).getSfuInfo(),a=this.generateCommonReportInfo({reason:"stopPlay",elapsed:null===(r=wD.getInstance(this.identifiedId))||void 0===r?void 0:r.calcPlayDuration(),aRecvRttMean:i.aRecvRttMean,vRecvRttMean:i.vRecvRttMean,aRecvLostMean:i.aRecvLostMean,vRecvLostMean:i.vRecvLostMean,aRecvBandwidthMean:i.aRecvBandwidthMean,vRecvBandwidthMean:i.vRecvBandwidthMean,aRecvJitter:i.aRecvJitter,vRecvJitter:i.vRecvJitter,afreeze200Cnt:i.afreeze200Cnt,vfreeze200Cnt:i.vfreeze200Cnt,vfreeze600Cnt:i.vfreeze600Cnt,afreeze200Rate:i.afreeze200Rate,vfreeze200Rate:i.vfreeze200Rate,vfreeze600Rate:i.vfreeze600Rate,resultCode:0,startTime:e,endTime:Zv.getCurrentLocalTimestamp(),accessAddr:(null==n?void 0:n.accessAddr)||"",SFUAddr:(null==s?void 0:s.ipAddress)||""},Nk.EVENT_STOP_PULL_STREAM_REQ,"event^stopPlay^SDK^ACS");zv.addRecord(a),zv.immediateReportRecords()}reportConnectionStatus(e,t){var r;if(!this.isStatiscEnable())return;const i=null===(r=wD.getInstance(this.identifiedId))||void 0===r?void 0:r.getSfuInfo();let n={SFUAddr:null==i?void 0:i.ipAddress,ssrc:(null==i?void 0:i.vSsrc)||(null==i?void 0:i.aSsrc),on:e,protocol:t||""};n=this.generateCommonReportInfo(n,Nk.EVENT_CONNECTION_CHANNEL_STATUS,"event^connectionState^SDK^ACS"),zv.addRecord(n),zv.immediateReportRecords()}reportPullMediaStreamResult(e,t,r){var i,n,s,a;if(!this.isStatiscEnable())return;const o=(null==r?void 0:r.sfuInfo)||(null===(i=wD.getInstance(this.identifiedId))||void 0===i?void 0:i.getSfuInfo()),l=(null==r?void 0:r.streamParams)||(null===(n=wD.getInstance(this.identifiedId))||void 0===n?void 0:n.getStreamParams()),c=(null==r?void 0:r.mediaParams)||(null===(s=wD.getInstance(this.identifiedId))||void 0===s?void 0:s.getPullMediaParams()),d=(null==r?void 0:r.playTrackKpi)||(null===(a=wD.getInstance(this.identifiedId))||void 0===a?void 0:a.getPlayTrackKpi()),u=e===Pk.TRACK_TYPE_AUDIO;let h={accessAddr:(null==l?void 0:l.accessAddr)||"",SFUAddr:(null==o?void 0:o.ipAddress)||"",streamType:u?0:1,ssrc:u?(null==o?void 0:o.aSsrc)||0:(null==o?void 0:o.vSsrc)||0,result:t,startTime:d.icePairStart,endTime:Zv.getCurrentLocalTimestamp(),playQoS:JSON.stringify((null==c?void 0:c.keyInfoMsg)||[]),mediaCostTime:(d.iceComplete||Zv.getCurrentLocalTimestamp())-d.icePairStart,totalTime:(d[u?"audioPlaySucc":"videoPlaySucc"]||Zv.getCurrentLocalTimestamp())-d.startPlayTime};h=this.generateCommonReportInfo(h,Nk.EVENT_PULL_MEDIA_STREAM,"event^pullstreamResult^SDK^ACS"),zv.addRecord(h),zv.immediateReportRecords()}reportApiCallInfo(e,t,r,i,n){if(!this.isStatiscEnable())return;const s="API^web#".concat(e,"^APP^SDK");for(var a=arguments.length,o=new Array(a>5?a-5:0),l=5;l<a;l++)o[l-5]=arguments[l];let c={apiCallId:Zv.generateUuid(),apiName:s,params:JSON.stringify(o),startTime:t,endTime:r};i?c.exception="".concat(i.code," - ").concat(i.message):c.ret=n?JSON.stringify(n):"",c=this.generateCommonReportInfo(c,Uk.API_CALL,s),/checkSystemRequirements/.test(e)?(zv.addRecord(c),zv.immediateReportRecords()):zv.addRecord(c)}reportCallbackInfo(e,t,r,i,n,s){if(!this.isStatiscEnable())return;const a=s((null==n?void 0:n.stream)||n);let o={callbackId:Zv.generateUuid(),callbackName:"CALLBACK^web#".concat(t,"$#").concat(e,"#^SDK^APP"),callbackType:e,params:a,startTime:r,endTime:i};o=this.generateCommonReportInfo(o,Uk.CALLBACK_API,"CALLBACK^web#".concat(t,"$#").concat(e,"#^SDK^APP")),zv.addRecord(o)}reportVideoQos(e){var t;if(!this.isStatiscEnable()||!e)return;const r=null===(t=wD.getInstance(this.identifiedId))||void 0===t?void 0:t.getSfuInfo(),i=wD.getInstance(this.identifiedId).getStreamParams();let n={ssrc:r.vSsrc||0,accessAddr:(null==i?void 0:i.accessAddr)||"",SFUAddr:r.ipAddress||"",codec:"h264",picW:e.width,picH:e.height,bitrate:e.bitRate,frameRate:e.frameRate,lostPktCnt:e.lostPktCnt,finalLostPktCnt:e.lostPktCnt,maxContLostPkts:e.lostPktCnt,rtt:e.rtt,jitter:e.jitter,bytes:e.totalByteReceived,packets:e.totalPacketsReceived,JBDepth:0,playTotalTime:e.totalStatisticTime,decFrameCnt:e.totalDecodeFrames,freeze200Cnt:e.total200FreezeCnt,freeze200Duration:e.total200FreezeTime,freeze600Cnt:e.total600VFreezeCnt,freeze600Duration:e.total600VFreezeTime,iFrameCnt:e.keyFrames,pFrameCnt:e.totalDecodeFrames,bFrameCnt:0,downloadDelay:e.downloadDelay,delayInfo:e.delayInfo,framesReceived:e.framesReceived,framesDropped:e.framesDropped,framesDecoded:e.framesDecoded,nackCnt:e.nackCnt,pliCnt:e.pliCnt,firCnt:e.firCnt};n=this.generateCommonReportInfo(n,Fk.EVENT_VIDEO_QOS,"qos^video_downstreams_qos^SDK^APP"),zv.addRecord(n)}reportAudioQos(e){var t;if(!this.isStatiscEnable()||!e)return;const r=null===(t=wD.getInstance(this.identifiedId))||void 0===t?void 0:t.getSfuInfo(),i=wD.getInstance(this.identifiedId).getStreamParams();let n={ssrc:r.aSsrc,accessAddr:(null==i?void 0:i.accessAddr)||"",SFUAddr:r.ipAddress||"",codec:"opus",bitrate:e.bitRate,lostPktCnt:e.lostPktCnt,finalLostPktCnt:e.lostPktCnt,maxContLostPkts:e.lostPktCnt,rtt:e.rtt,jitter:e.jitter,bytes:e.totalByteReceived,packets:e.totalPacketsReceived,JBDepth:0,playTotalTime:e.totalStatisticTime,freeze200Cnt:e.total200FreezeCnt,freeze200Duration:e.total200FreezeTime,nackCnt:e.nackCnt};n=this.generateCommonReportInfo(n,Fk.EVENT_AUDIO_QOS,"qos^audio_downstreams_qos^SDK^APP"),zv.addRecord(n)}startMediaStatistic(){this.mediaStatisticTimer||(this.mediaStatisticTimer=setTimeout((()=>{try{this.mediaStatisticHandler()}catch(IU){Qv.error(this.module_,"Media Statistic occur error: ".concat(IU))}finally{clearTimeout(this.mediaStatisticTimer),this.mediaStatisticTimer=null,this.startMediaStatistic()}}),5e3))}cancelMediaStatistic(){this.mediaStatisticHandler(),clearTimeout(this.mediaStatisticTimer),this.mediaStatisticTimer=null}mediaStatisticHandler(){var e;const t=null===(e=wD.getInstance(this.identifiedId))||void 0===e?void 0:e.getSfuInfo();if(t){if(t.aSsrc){const e=SD.getMediaStatistic(t.connectionId,t.aSsrc,Pk.TRACK_TYPE_AUDIO);var r;if(e)this.reportAudioQos(e),null===(r=wD.getInstance(this.identifiedId))||void 0===r||r.addAudioStatisticCache(e)}if(t.vSsrc){const e=SD.getMediaStatistic(t.connectionId,t.vSsrc,Pk.TRACK_TYPE_VIDEO);e&&(this.reportVideoQos(e),wD.getInstance(this.identifiedId).addVideoStatisticCache(e))}}}generateCommonReportInfo(e,t,r){var i,n,s;const a=null===(i=wD.getInstance(this.identifiedId))||void 0===i?void 0:i.getStreamParams(),o=null===(n=wD.getInstance(this.identifiedId))||void 0===n?void 0:n.getPullMediaParams(),l=null===(s=wD.getInstance(this.identifiedId))||void 0===s?void 0:s.getSfuInfo();return a&&(this.commInfo=CD(CD({},this.commInfo),{session:null==a?void 0:a.sessionId,domain:null==a?void 0:a.streamDomain,appName:null==a?void 0:a.appName,streamName:null==a?void 0:a.streamName,svrSid:null==o?void 0:o.svrSid,clientAddr:null==o?void 0:o.clientAddr})),CD(CD(CD({},e),this.commInfo),{ctime:Zv.getCurrentSyncTimestamp(),event:t,eventName:r,netType:AD.getNetworkType()||SD.getConnectionNetType(null==l?void 0:l.connectionId)})}isStatiscEnable(){return!1!==ik.getParameter(XI)}}class kD{constructor(e,t,r){$l(this,"callbackMap_",new Map),$l(this,"onCallbackMap_",new Map),this.identifiedId_=Zv.generateStandardUuid(),this.eventEmitter_=r||new wk,this.stats_=t||new ID(this.identifiedId_),this.moudle_=e||""}on(e,t,r){r?this.onWithTimeout(e,t):this.eventEmitter_.on(e,t)}once(e,t){this.eventEmitter_.once(e,t)}off(e,t,r){t?r?this.offWithTimeout(e,t):this.eventEmitter_.removeListener(e,t):this.eventEmitter_.removeAllListeners(e)}offAllEvents(){this.eventEmitter_.removeAllListeners(),this.callbackMap_.clear(),this.onCallbackMap_.clear()}emit(e,t){this.eventEmitter_.emit(e,t)}onWithTimeout(e,t){const r=this.getOnCallback(e,t);this.eventEmitter_.on(e,r)}offWithTimeout(e,t){const r=this.getOffCallback(e,t);var i;r&&(null===(i=this.eventEmitter_)||void 0===i||i.removeListener(e,r))}getOnCallback(e,t){const r="".concat(e,"_").concat(null==t?void 0:t.name),i=async t=>{if(this.callbackMap_.get(r)){const n=Zv.getCurrentLocalTimestamp();let s;try{await bk.callWithTimeout(this.callbackMap_.get(r)(t),1e4),s=Zv.getCurrentLocalTimestamp()}catch(IU){s=n+5e3}finally{var i;null===(i=this.stats_)||void 0===i||i.reportCallbackInfo(e.toString(),this.moudle_,n,s,t,(e=>["object","function"].includes(typeof e)&&e.getInfo?JSON.stringify(e.getInfo()):JSON.stringify(e||{})))}}};return this.callbackMap_.set(r,t),this.onCallbackMap_.set(r,i),i}getOffCallback(e,t){const r="".concat(e,"_").concat(null==t?void 0:t.name),i=this.onCallbackMap_.get(r);return this.onCallbackMap_.get(r)&&this.onCallbackMap_.delete(r),this.callbackMap_.get(r)&&this.callbackMap_.delete(r),i}get eventEmitter(){return this.eventEmitter_}get identifiedId(){return this.identifiedId_}get stats(){return this.stats_}}var DD={},PD={exports:{}},OD=PD.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(OD).forEach((function(e){OD[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),function(e){var t=function(e){return String(Number(e))===e?Number(e):e},r=function(e,r,i){var n=e.name&&e.names;e.push&&!r[e.push]?r[e.push]=[]:n&&!r[e.name]&&(r[e.name]={});var s=e.push?{}:n?r[e.name]:r;!function(e,r,i,n){if(n&&!i)r[n]=t(e[1]);else for(var s=0;s<i.length;s+=1)null!=e[s+1]&&(r[i[s]]=t(e[s+1]))}(i.match(e.reg),s,e.names,e.name),e.push&&r[e.push].push(s)},i=PD.exports,n=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},s=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(n).forEach((function(e){var t=e[0],n=e.slice(2);"m"===t&&(s.push({rtp:[],fmtp:[]}),a=s[s.length-1]);for(var o=0;o<(i[t]||[]).length;o+=1){var l=i[t][o];if(l.reg.test(n))return r(l,a,n)}})),t.media=s,t};var s=function(e,r){var i=r.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&r.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(s,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var r=[],i=e.split(" ").map(t),n=0;n<i.length;n+=3)r.push({component:i[n],ip:i[n+1],port:i[n+2]});return r},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var r,i=!1;return"~"!==e[0]?r=t(e):(r=t(e.substring(1,e.length)),i=!0),{scid:r,paused:i}}))}))}}(DD);var xD=PD.exports,MD=/%[sdv%]/g,ND=function(e){var t=1,r=arguments,i=r.length;return e.replace(MD,(function(e){if(t>=i)return e;var n=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(n);case"%d":return Number(n);case"%v":return""}}))},FD=function(e,t,r){var i=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var n=0;n<t.names.length;n+=1){var s=t.names[n];t.name?i.push(r[t.name][s]):i.push(r[t.names[n]])}else i.push(r[t.name]);return ND.apply(null,i)},UD=["v","o","s","i","u","e","p","c","b","t","r","z","a"],BD=["i","c","b","a"],HD=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||UD,i=t.innerOrder||BD,n=[];return r.forEach((function(t){xD[t].forEach((function(r){r.name in e&&null!=e[r.name]?n.push(FD(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){n.push(FD(t,r,e))}))}))})),e.media.forEach((function(e){n.push(FD("m",xD.m[0],e)),i.forEach((function(t){xD[t].forEach((function(r){r.name in e&&null!=e[r.name]?n.push(FD(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){n.push(FD(t,r,e))}))}))}))})),n.join("\r\n")+"\r\n"},jD=HD,VD=DD.parse,GD=DD.parseParams;let zD=function(e){return e.SEND_RECV="sendrecv",e.SEND_ONLY="sendonly",e.RECV_ONLY="recvonly",e.INACTIVE="inactive",e}({});const KD=116,WD=107,$D=109,YD=110,qD=112;let ZD=function(e){return e.H264="H264",e.OPUS="opus",e}({});const XD="packetization-mode",JD="profile-level-id",QD=["groups","media"],eP=["candidates","connection","direction","mid","payloads","port","protocol","rtp","type","fmtp","ssrcs"];class tP{constructor(){$l(this,"module_","sdp")}printSdpInfo(e){const t=this.parseSdp(e);if(!t)return;for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(QD.includes(i)||delete t[i],"media"===i&&t[i].forEach((e=>{for(const t in e)eP.includes(t)||delete e[t]})));const r=Qv.shieldIpAddress(jD(t));return Qv.shieldIcePassword(r)}containsValidVideoPayload(e){Qv.debug(this.module_,"containsValidVideoPayload, offerSdp: ".concat(this.printSdpInfo(e)));const t=this.parseSdp(e);if(!t)return Qv.error(this.module_,"containsValidVideoPayload failed,the sdp is invalid"),!1;return this.getMedias(t,Pk.TRACK_TYPE_VIDEO).some((e=>{var t;return null===(t=e.rtp)||void 0===t?void 0:t.some((e=>e.codec.toUpperCase()===ZD.H264))}))}transformOfferSdp(e){Qv.info(this.module_,"transformOfferSdp begin");const t=this.parseSdp(e);if(!t)return void Qv.error(this.module_,"transformOfferSdp failed,the sdp is invalid");const r=this.getMedias(t,Pk.TRACK_TYPE_VIDEO),i=this.getMedias(t,Pk.TRACK_TYPE_AUDIO);r.forEach((e=>{this.transformVideoPayload(e),this.deleteRetransmissionSsrc(e),this.modifyTccValue(e),e.direction=zD.RECV_ONLY})),i.forEach((e=>{this.transformAudioPayload(e),this.deleteRetransmissionSsrc(e),this.modifyTccValue(e),e.direction=zD.RECV_ONLY}));const n=jD(t);return Qv.debug(this.module_,"transformOfferSdp success, sdp: ".concat(this.printSdpInfo(n))),n}modifySdpCandidates(e,t){const r=this.parseSdp(e);if(!r)return void Qv.error(this.module_,"modifySdpCandidates failed, the sdp is invalid : ".concat(e));const i=this.getMedias(r,Pk.TRACK_TYPE_VIDEO),n=this.getMedias(r,Pk.TRACK_TYPE_AUDIO);if(i&&i.length>0&&(this.modifyCandidate(i[0],t),i[0].mid,i.length>1))for(let a=0;a<r.media.length;a++)r.media[a].type!==Pk.TRACK_TYPE_AUDIO&&r.media[a].mid!==i[0].mid&&delete r.media[a];n&&n.length>0&&(this.modifyCandidate(n[0],t),n[0].mid);for(const a of r.media||[])a.type!==Pk.TRACK_TYPE_AUDIO&&this.processGCCType(a);const s=jD(r);return Qv.debug(this.module_,"modifySdpCandidates success, sdp: ".concat(this.printSdpInfo(s))),s}getSfuInfo(e){const t=this.parseSdp(e),r={};let i;const n=this.getMedias(t,Pk.TRACK_TYPE_AUDIO);var s,a,o;n&&n.length>0&&(r.audioPort=(null===(s=n[0].candidates)||void 0===s||null===(a=s.find((e=>9!==e.port)))||void 0===a?void 0:a.port)||n[0].port,i=n[0].connection,r.aSsrc=parseInt(String(null===(o=n[0].ssrcs.find((e=>!!e.id)))||void 0===o?void 0:o.id)));i&&(r.ipAddress=i.ip);const l=this.getMedias(t,Pk.TRACK_TYPE_VIDEO);var c,d,u;l&&l.length>0&&(r.videoPort=(null===(c=l[0].candidates)||void 0===c||null===(d=c.find((e=>9!==e.port)))||void 0===d?void 0:d.port)||r.audioPort||l[0].port,i=l[0].connection,r.vSsrc=parseInt(String(null===(u=l[0].ssrcs.find((e=>!!e.id)))||void 0===u?void 0:u.id)));return!r.ipAddress&&i&&(r.ipAddress=i.ip),r}parseSdp(e){if(!e)return void Qv.error(this.module_,"parseSdp failed : sdp  is null ");const t=VD(e);if(0!==t.media.length)return t;Qv.error(this.module_,"parseSdp failed : the media of sdp is null ")}getMedias(e,t){return e.media.filter((e=>{let{type:r}=e;return r===t}))}deleteUnexpectedMedia(e){e.media&&(e.media=e.media.filter((e=>{let{type:t}=e;return t===Pk.TRACK_TYPE_VIDEO||t===Pk.TRACK_TYPE_AUDIO})))}transformVideoPayload(e){if(!e.rtp)return void Qv.warn(this.module_,"transformVideoPayload failed ,rtp is null");let t=null,r=null,i=0;for(const n of e.rtp){if(n.codec.toUpperCase()!==ZD.H264)continue;r||(r=n.payload,Qv.info(this.module_,"record firstPayload, firstPayload: ".concat(r)));const s=this.getPacketizationMode(e.fmtp,n.payload),a=this.getProfileLevelId(e.fmtp,n.payload);if(1===s&&(0===i&&(r=n.payload,i=1),"42e01f"===a)){t=n.payload,Qv.info(this.module_,"set retainPayload in transformVideoPayload, retainPayload: ".concat(t));break}}t||(t=r,Qv.info(this.module_,"no expected payload, use firstPayload as retainPayload, retainPayload: ".concat(t))),t?(this.deletePayload(e,t),this.modifyPayload(e,$D),this.addVideoFec(e),this.addFmtpAttr(e,$D,"max-br","5000000"),this.addFmtpAttr(e,$D,"sps-pps-idr-in-keyframe","1"),this.addFmtpAttr(e,WD,"apt","".concat($D)),this.addFmtpAttr(e,WD,"sps-pps-idr-in-keyframe","1")):Qv.error(this.module_,"transformVideoPayload failed,can not find expected payload.")}transformAudioPayload(e){if(!e.rtp)return void Qv.warn(this.module_,"transformAudioPayload failed, rtp is null");let t;for(const r of e.rtp)if(r.codec.toLowerCase()===ZD.OPUS){t=r.payload;break}t?(this.deletePayload(e,t),this.modifyPayload(e,KD),this.addNack(e)):Qv.error(this.module_,"transformAudioPayload failed,can not find expected payload.")}deleteRetransmissionSsrc(e){if(!e.ssrcGroups||!e.ssrcs)return;const t=[];e.ssrcGroups.forEach((e=>{let{ssrcs:r}=e;const i=this.getRetransmissionSsrc(r);null!==i&&t.push(i)})),0!==t.length&&(e.ssrcGroups=void 0,e.ssrcs=e.ssrcs.filter((e=>{let{id:r}=e;return!t.includes(r.toString())})))}modifyTccValue(e){if(Qv.info(this.module_,"modifyTccValue begin."),!e.ext||0==e.ext.length)return void Qv.warn(this.module_,"modifyTccValue media is invalid.");const t=e.ext.findIndex((e=>/transport-wide-cc/i.test(e.uri)));if(t<0)return void Qv.warn(this.module_,"modifyTccValue not find target.");const r=e.ext[t];if(3==r.value)return void Qv.warn(this.module_,"modifyTccValue target ext value is tccValue:".concat(3));const i=e.ext.findIndex((e=>3==e.value));if(i<0)return r.value=3,void Qv.info(this.module_,"modifyTccValue not find replace, modify target ext value:".concat(r.value));const n=e.ext[i],s=r.value;r.value=3,n.value=s,Qv.info(this.module_,"modifyTccValue success, target ext value:".concat(r.value,", replace ext value:").concat(n.value))}getPacketizationMode(e,t){if(!e)return 1;for(const r of e){if(r.payload!==t)continue;if(!r.config.includes(XD))return 1;const e=GD(r.config);return null===e[XD]?1:parseInt(String(e[XD]),10)}return 1}getProfileLevelId(e,t){if(!e)return"";for(const r of e){if(r.payload!==t)continue;if(!r.config.includes(JD))return"";const e=GD(r.config);return e[JD]?String(e[JD]):""}return""}deletePayload(e,t){e.rtp&&(e.rtp=e.rtp.filter((e=>{let{payload:r}=e;return r===t}))),e.rtcpFb&&(e.rtcpFb=e.rtcpFb.filter((e=>{let{payload:r}=e;return r===t}))),e.fmtp&&(e.fmtp=e.fmtp.filter((e=>{let{payload:r}=e;return r===t}))),e.payloads=t.toString()}modifyPayload(e,t){e.rtp&&e.rtp.forEach((e=>{e.payload=t})),e.rtcpFb&&e.rtcpFb.forEach((e=>{e.payload=t})),e.fmtp&&e.fmtp.forEach((e=>{e.payload=t})),e.payloads=t.toString()}addVideoFec(e){e.rtp||(e.rtp=[]),e.rtp.push({payload:WD,codec:"rtx",rate:9e4}),e.rtp.push({payload:YD,codec:"red",rate:9e4}),e.rtp.push({payload:qD,codec:"ulpfec",rate:9e4}),e.payloads="".concat(WD," ").concat(e.payloads," ").concat(YD," ").concat(qD)}addFmtpAttr(e,t,r,i){if(!e.fmtp||0===e.fmtp.length)return e.fmtp=[],void e.fmtp.push({payload:t,config:r+"="+i});const n=e.fmtp.find((e=>e.payload===t));if(n){if(GD(n.config)[r])return;n.config=n.config+";"+r+"="+i}else e.fmtp.push({payload:t,config:r+"="+i})}addNack(e){const t=e.rtp[0].payload;e.rtcpFb||(e.rtcpFb=[]),e.rtcpFb.push({payload:t,type:"ccm",subtype:"fir"}),e.rtcpFb.push({payload:t,type:"nack"}),e.rtcpFb.push({payload:t,type:"nack",subtype:"pli"})}modifyCandidate(e,t){if(!e.candidates){const r=null==t?void 0:t.find((t=>"".concat(e.mid)==="".concat(t.sdpMid)));if(r){const t=/.*generation\s(\d+).*/.exec(r.candidate)||[],i=/.*network\-id\s(\d+).*/.exec(r.candidate)||[],n=/.*network\-cost\s(\d+).*/.exec(r.candidate)||[];e.candidates=e.candidates||[],e.candidates.push({foundation:r.foundation,component:"rtp"===r.component?1:2,transport:r.protocol,priority:r.priority,ip:r.address,port:r.port,type:r.type,raddr:r.relatedAddress,rport:r.relatedPort,tcptype:r.tcpType,generation:2===t.length?parseInt(t[1]):void 0,"network-id":2===i.length?parseInt(i[1]):void 0,"network-cost":2===n.length?parseInt(n[1]):void 0})}}}getRetransmissionSsrc(e){if(!e)return void Qv.warn(this.module_,"getRetransmissionSsrc failed, ssrcs is null");const t=e.split(" ");if(2===t.length)return t[1];Qv.warn(this.module_,"getRetransmissionSsrc failed, ssrcs(".concat(e,") is invalid"))}processGCCType(e){if(BC.isFirefox()&&BC.getBrowserVersion()<100){let t=e.rtcpFb.findIndex((e=>"transport-cc"===e.type));t>=0&&e.rtcpFb.splice(t,1),t=e.ext.findIndex((e=>/transport-wide-cc/i.test(e.uri))),t>=0&&e.ext.splice(t,1)}}}class rP extends tP{transformAnswerSdp(e){Qv.debug(this.module_,"transformAnswerSdp, answerSdp: ".concat(this.printSdpInfo(e)));const t=this.parseSdp(e);if(!t)return void Qv.error(this.module_,"transformAnswerSdp failed,the sdp is invalid");const r=this.getMedias(t,Pk.TRACK_TYPE_VIDEO),i=this.getMedias(t,Pk.TRACK_TYPE_AUDIO);r&&r.length>0&&r.forEach((e=>{e.direction=zD.SEND_ONLY})),i&&i.length>0&&i.forEach((e=>{e.direction=zD.SEND_ONLY}));const n=jD(t);return Qv.debug(this.module_,"transformAnswerSdp success,answerSdp: ".concat(this.printSdpInfo(n))),n}}class iP extends tP{static modifyBundle(e,t){for(const r of e.groups||[])if("BUNDLE"===r.type){r.mids="".concat(r.mids," ").concat(t);break}}transformAnswerSdp(e,t){Qv.debug(this.module_,"transformAnswerSdp, answerSdp: ".concat(this.printSdpInfo(e)));const r=this.parseSdp(e),i=this.parseSdp(t);if(!r||!i)return void Qv.error(this.module_,"transformAnswerSdp failed,the sdp is invalid");this.getMedias(r,Pk.TRACK_TYPE_AUDIO).forEach((e=>{e.direction=zD.SEND_ONLY}));let n=this.getMedias(r,Pk.TRACK_TYPE_VIDEO);const s=this.getMedias(i,Pk.TRACK_TYPE_VIDEO);if(s.length!==n.length){const e=n.map((e=>"".concat(e.mid)));s.forEach((t=>{if(!e.includes("".concat(t.mid))){const e=JSON.parse(JSON.stringify(n[0]));e.mid=t.mid,r.media.push(e),iP.modifyBundle(r,t.mid)}}))}n=this.getMedias(r,Pk.TRACK_TYPE_VIDEO),n.forEach((e=>{e.direction=zD.SEND_ONLY}));const a=jD(r);return Qv.debug(this.module_,"transformAnswerSdp success,answerSdp: ".concat(this.printSdpInfo(a))),a}}var nP={exports:{}};!function(e,t){e.exports=function(){var e=Math.imul,t=Math.clz32;function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r,i=0;i<t.length;i++)(r=t[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function s(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function d(){return d=c()?Reflect.construct:function(e,t,r){var i=[null];i.push.apply(i,t);var n=new(Function.bind.apply(e,i));return r&&l(n,r.prototype),n},d.apply(null,arguments)}function u(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function h(e){var t="function"==typeof Map?new Map:void 0;return h=function(e){function r(){return d(e,arguments,o(this).constructor)}if(null===e||!u(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),l(r,e)},h(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}function m(e){var t=c();return function(){var r,i=o(e);if(t){var n=o(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return p(this,r)}}function g(e,t){return y(e)||_(e,t)||v(e,t)||S()}function y(e){if(Array.isArray(e))return e}function _(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,n,s=[],a=!0,o=!1;try{for(r=r.call(e);!(a=(i=r.next()).done)&&(s.push(i.value),!t||s.length!==t);a=!0);}catch(e){o=!0,n=e}finally{try{a||null==r.return||r.return()}finally{if(o)throw n}}return s}}function v(e,t){if(e){if("string"==typeof e)return E(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(e,t):void 0}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function S(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=v(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw s}}}}var b=function(e){var t=Math.abs,n=Math.max,o=Math.floor;function l(e,t){var r;if(i(this,l),(r=c.call(this,e)).sign=t,Object.setPrototypeOf(f(r),l.prototype),e>l.__kMaxLength)throw new RangeError("Maximum BigInt size exceeded");return r}a(l,e);var c=m(l);return s(l,[{key:"toDebugString",value:function(){var e,t=["BigInt["],r=T(this);try{for(r.s();!(e=r.n()).done;){var i=e.value;t.push((i?(i>>>0).toString(16):i)+", ")}}catch(e){r.e(e)}finally{r.f()}return t.push("]"),t.join("")}},{key:"toString",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10;if(2>e||36<e)throw new RangeError("toString() radix argument must be between 2 and 36");return 0===this.length?"0":e&e-1?l.__toStringGeneric(this,e,!1):l.__toStringBasePowerOfTwo(this,e)}},{key:"valueOf",value:function(){throw new Error("Convert JSBI instances to native numbers using `toNumber`.")}},{key:"__copy",value:function(){for(var e=new l(this.length,this.sign),t=0;t<this.length;t++)e[t]=this[t];return e}},{key:"__trim",value:function(){for(var e=this.length,t=this[e-1];0===t;)t=this[--e-1],this.pop();return 0===e&&(this.sign=!1),this}},{key:"__initializeDigits",value:function(){for(var e=0;e<this.length;e++)this[e]=0}},{key:"__clzmsd",value:function(){return l.__clz30(this.__digit(this.length-1))}},{key:"__inplaceMultiplyAdd",value:function(e,t,r){r>this.length&&(r=this.length);for(var i=32767&e,n=e>>>15,s=0,a=t,o=0;o<r;o++){var c=this.__digit(o),d=32767&c,u=c>>>15,h=l.__imul(d,i),f=l.__imul(d,n),p=l.__imul(u,i),m=a+h+s;s=m>>>30,m&=1073741823,s+=(m+=((32767&f)<<15)+((32767&p)<<15))>>>30,a=l.__imul(u,n)+(f>>>15)+(p>>>15),this.__setDigit(o,1073741823&m)}if(0!==s||0!==a)throw new Error("implementation bug")}},{key:"__inplaceAdd",value:function(e,t,r){for(var i,n=0,s=0;s<r;s++)n=(i=this.__halfDigit(t+s)+e.__halfDigit(s)+n)>>>15,this.__setHalfDigit(t+s,32767&i);return n}},{key:"__inplaceSub",value:function(e,t,r){var i=0;if(1&t){t>>=1;for(var n=this.__digit(t),s=32767&n,a=0;a<r-1>>>1;a++){var o=e.__digit(a),l=(n>>>15)-(32767&o)-i;i=1&l>>>15,this.__setDigit(t+a,(32767&l)<<15|32767&s),i=1&(s=(32767&(n=this.__digit(t+a+1)))-(o>>>15)-i)>>>15}var c=e.__digit(a),d=(n>>>15)-(32767&c)-i;if(i=1&d>>>15,this.__setDigit(t+a,(32767&d)<<15|32767&s),t+a+1>=this.length)throw new RangeError("out of bounds");!(1&r)&&(i=1&(s=(32767&(n=this.__digit(t+a+1)))-(c>>>15)-i)>>>15,this.__setDigit(t+e.length,1073709056&n|32767&s))}else{t>>=1;for(var u=0;u<e.length-1;u++){var h=this.__digit(t+u),f=e.__digit(u),p=(32767&h)-(32767&f)-i,m=(h>>>15)-(f>>>15)-(i=1&p>>>15);i=1&m>>>15,this.__setDigit(t+u,(32767&m)<<15|32767&p)}var g=this.__digit(t+u),y=e.__digit(u),_=(32767&g)-(32767&y)-i;i=1&_>>>15;var v=0;!(1&r)&&(i=1&(v=(g>>>15)-(y>>>15)-i)>>>15),this.__setDigit(t+u,(32767&v)<<15|32767&_)}return i}},{key:"__inplaceRightShift",value:function(e){if(0!==e){for(var t,r=this.__digit(0)>>>e,i=this.length-1,n=0;n<i;n++)t=this.__digit(n+1),this.__setDigit(n,1073741823&t<<30-e|r),r=t>>>e;this.__setDigit(i,r)}}},{key:"__digit",value:function(e){return this[e]}},{key:"__unsignedDigit",value:function(e){return this[e]>>>0}},{key:"__setDigit",value:function(e,t){this[e]=0|t}},{key:"__setDigitGrow",value:function(e,t){this[e]=0|t}},{key:"__halfDigitLength",value:function(){var e=this.length;return 32767>=this.__unsignedDigit(e-1)?2*e-1:2*e}},{key:"__halfDigit",value:function(e){return 32767&this[e>>>1]>>>15*(1&e)}},{key:"__setHalfDigit",value:function(e,t){var r=e>>>1,i=this.__digit(r),n=1&e?32767&i|t<<15:1073709056&i|32767&t;this.__setDigit(r,n)}}],[{key:"BigInt",value:function(e){var t=Number.isFinite;if("number"==typeof e){if(0===e)return l.__zero();if(l.__isOneDigitInt(e))return 0>e?l.__oneDigit(-e,!0):l.__oneDigit(e,!1);if(!t(e)||o(e)!==e)throw new RangeError("The number "+e+" cannot be converted to BigInt because it is not an integer");return l.__fromDouble(e)}if("string"==typeof e){var i=l.__fromString(e);if(null===i)throw new SyntaxError("Cannot convert "+e+" to a BigInt");return i}if("boolean"==typeof e)return!0===e?l.__oneDigit(1,!1):l.__zero();if("object"===r(e)){if(e.constructor===l)return e;var n=l.__toPrimitive(e);return l.BigInt(n)}throw new TypeError("Cannot convert "+e+" to a BigInt")}},{key:"toNumber",value:function(e){var t=e.length;if(0===t)return 0;if(1===t){var r=e.__unsignedDigit(0);return e.sign?-r:r}var i=e.__digit(t-1),n=l.__clz30(i),s=30*t-n;if(1024<s)return e.sign?-1/0:1/0;var a=s-1,o=i,c=t-1,d=n+3,u=32===d?0:o<<d;u>>>=12;var h=d-12,f=12<=d?0:o<<20+d,p=20+d;for(0<h&&0<c&&(c--,u|=(o=e.__digit(c))>>>30-h,f=o<<h+2,p=h+2);0<p&&0<c;)c--,o=e.__digit(c),f|=30<=p?o<<p-30:o>>>30-p,p-=30;var m=l.__decideRounding(e,p,c,o);if((1===m||0===m&&!(1&~f))&&0==(f=f+1>>>0)&&0!=++u>>>20&&(u=0,1023<++a))return e.sign?-1/0:1/0;var g=e.sign?-2147483648:0;return a=a+1023<<20,l.__kBitConversionInts[1]=g|a|u,l.__kBitConversionInts[0]=f,l.__kBitConversionDouble[0]}},{key:"unaryMinus",value:function(e){if(0===e.length)return e;var t=e.__copy();return t.sign=!e.sign,t}},{key:"bitwiseNot",value:function(e){return e.sign?l.__absoluteSubOne(e).__trim():l.__absoluteAddOne(e,!0)}},{key:"exponentiate",value:function(e,t){if(t.sign)throw new RangeError("Exponent must be positive");if(0===t.length)return l.__oneDigit(1,!1);if(0===e.length)return e;if(1===e.length&&1===e.__digit(0))return!e.sign||1&t.__digit(0)?e:l.unaryMinus(e);if(1<t.length)throw new RangeError("BigInt too big");var r=t.__unsignedDigit(0);if(1===r)return e;if(r>=l.__kMaxLengthBits)throw new RangeError("BigInt too big");if(1===e.length&&2===e.__digit(0)){var i=1+(0|r/30),n=new l(i,e.sign&&!!(1&r));n.__initializeDigits();var s=1<<r%30;return n.__setDigit(i-1,s),n}var a=null,o=e;for(!!(1&r)&&(a=e),r>>=1;0!==r;r>>=1)o=l.multiply(o,o),1&r&&(a=null===a?o:l.multiply(a,o));return a}},{key:"multiply",value:function(e,t){if(0===e.length)return e;if(0===t.length)return t;var r=e.length+t.length;30<=e.__clzmsd()+t.__clzmsd()&&r--;var i=new l(r,e.sign!==t.sign);i.__initializeDigits();for(var n=0;n<e.length;n++)l.__multiplyAccumulate(t,e.__digit(n),i,n);return i.__trim()}},{key:"divide",value:function(e,t){if(0===t.length)throw new RangeError("Division by zero");if(0>l.__absoluteCompare(e,t))return l.__zero();var r,i=e.sign!==t.sign,n=t.__unsignedDigit(0);if(1===t.length&&32767>=n){if(1===n)return i===e.sign?e:l.unaryMinus(e);r=l.__absoluteDivSmall(e,n,null)}else r=l.__absoluteDivLarge(e,t,!0,!1);return r.sign=i,r.__trim()}},{key:"remainder",value:function(e,t){if(0===t.length)throw new RangeError("Division by zero");if(0>l.__absoluteCompare(e,t))return e;var r=t.__unsignedDigit(0);if(1===t.length&&32767>=r){if(1===r)return l.__zero();var i=l.__absoluteModSmall(e,r);return 0===i?l.__zero():l.__oneDigit(i,e.sign)}var n=l.__absoluteDivLarge(e,t,!1,!0);return n.sign=e.sign,n.__trim()}},{key:"add",value:function(e,t){var r=e.sign;return r===t.sign?l.__absoluteAdd(e,t,r):0<=l.__absoluteCompare(e,t)?l.__absoluteSub(e,t,r):l.__absoluteSub(t,e,!r)}},{key:"subtract",value:function(e,t){var r=e.sign;return r===t.sign?0<=l.__absoluteCompare(e,t)?l.__absoluteSub(e,t,r):l.__absoluteSub(t,e,!r):l.__absoluteAdd(e,t,r)}},{key:"leftShift",value:function(e,t){return 0===t.length||0===e.length?e:t.sign?l.__rightShiftByAbsolute(e,t):l.__leftShiftByAbsolute(e,t)}},{key:"signedRightShift",value:function(e,t){return 0===t.length||0===e.length?e:t.sign?l.__leftShiftByAbsolute(e,t):l.__rightShiftByAbsolute(e,t)}},{key:"unsignedRightShift",value:function(){throw new TypeError("BigInts have no unsigned right shift; use >> instead")}},{key:"lessThan",value:function(e,t){return 0>l.__compareToBigInt(e,t)}},{key:"lessThanOrEqual",value:function(e,t){return 0>=l.__compareToBigInt(e,t)}},{key:"greaterThan",value:function(e,t){return 0<l.__compareToBigInt(e,t)}},{key:"greaterThanOrEqual",value:function(e,t){return 0<=l.__compareToBigInt(e,t)}},{key:"equal",value:function(e,t){if(e.sign!==t.sign)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e.__digit(r)!==t.__digit(r))return!1;return!0}},{key:"notEqual",value:function(e,t){return!l.equal(e,t)}},{key:"bitwiseAnd",value:function(e,t){if(!e.sign&&!t.sign)return l.__absoluteAnd(e,t).__trim();if(e.sign&&t.sign){var r=n(e.length,t.length)+1,i=l.__absoluteSubOne(e,r),s=l.__absoluteSubOne(t);return i=l.__absoluteOr(i,s,i),l.__absoluteAddOne(i,!0,i).__trim()}if(e.sign){var a=[t,e];e=a[0],t=a[1]}return l.__absoluteAndNot(e,l.__absoluteSubOne(t)).__trim()}},{key:"bitwiseXor",value:function(e,t){if(!e.sign&&!t.sign)return l.__absoluteXor(e,t).__trim();if(e.sign&&t.sign){var r=n(e.length,t.length),i=l.__absoluteSubOne(e,r),s=l.__absoluteSubOne(t);return l.__absoluteXor(i,s,i).__trim()}var a=n(e.length,t.length)+1;if(e.sign){var o=[t,e];e=o[0],t=o[1]}var c=l.__absoluteSubOne(t,a);return c=l.__absoluteXor(c,e,c),l.__absoluteAddOne(c,!0,c).__trim()}},{key:"bitwiseOr",value:function(e,t){var r=n(e.length,t.length);if(!e.sign&&!t.sign)return l.__absoluteOr(e,t).__trim();if(e.sign&&t.sign){var i=l.__absoluteSubOne(e,r),s=l.__absoluteSubOne(t);return i=l.__absoluteAnd(i,s,i),l.__absoluteAddOne(i,!0,i).__trim()}if(e.sign){var a=[t,e];e=a[0],t=a[1]}var o=l.__absoluteSubOne(t,r);return o=l.__absoluteAndNot(o,e,o),l.__absoluteAddOne(o,!0,o).__trim()}},{key:"asIntN",value:function(e,t){if(0===t.length)return t;if(0>(e=o(e)))throw new RangeError("Invalid value: not (convertible to) a safe integer");if(0===e)return l.__zero();if(e>=l.__kMaxLengthBits)return t;var r=0|(e+29)/30;if(t.length<r)return t;var i=t.__unsignedDigit(r-1),n=1<<(e-1)%30;if(t.length===r&&i<n)return t;if((i&n)!==n)return l.__truncateToNBits(e,t);if(!t.sign)return l.__truncateAndSubFromPowerOfTwo(e,t,!0);if(!(i&n-1)){for(var s=r-2;0<=s;s--)if(0!==t.__digit(s))return l.__truncateAndSubFromPowerOfTwo(e,t,!1);return t.length===r&&i===n?t:l.__truncateToNBits(e,t)}return l.__truncateAndSubFromPowerOfTwo(e,t,!1)}},{key:"asUintN",value:function(e,t){if(0===t.length)return t;if(0>(e=o(e)))throw new RangeError("Invalid value: not (convertible to) a safe integer");if(0===e)return l.__zero();if(t.sign){if(e>l.__kMaxLengthBits)throw new RangeError("BigInt too big");return l.__truncateAndSubFromPowerOfTwo(e,t,!1)}if(e>=l.__kMaxLengthBits)return t;var r=0|(e+29)/30;if(t.length<r)return t;var i=e%30;if(t.length==r){if(0===i)return t;if(0==t.__digit(r-1)>>>i)return t}return l.__truncateToNBits(e,t)}},{key:"ADD",value:function(e,t){if(e=l.__toPrimitive(e),t=l.__toPrimitive(t),"string"==typeof e)return"string"!=typeof t&&(t=t.toString()),e+t;if("string"==typeof t)return e.toString()+t;if(e=l.__toNumeric(e),t=l.__toNumeric(t),l.__isBigInt(e)&&l.__isBigInt(t))return l.add(e,t);if("number"==typeof e&&"number"==typeof t)return e+t;throw new TypeError("Cannot mix BigInt and other types, use explicit conversions")}},{key:"LT",value:function(e,t){return l.__compare(e,t,0)}},{key:"LE",value:function(e,t){return l.__compare(e,t,1)}},{key:"GT",value:function(e,t){return l.__compare(e,t,2)}},{key:"GE",value:function(e,t){return l.__compare(e,t,3)}},{key:"EQ",value:function(e,t){for(;;){if(l.__isBigInt(e))return l.__isBigInt(t)?l.equal(e,t):l.EQ(t,e);if("number"==typeof e){if(l.__isBigInt(t))return l.__equalToNumber(t,e);if("object"!==r(t))return e==t;t=l.__toPrimitive(t)}else if("string"==typeof e){if(l.__isBigInt(t))return null!==(e=l.__fromString(e))&&l.equal(e,t);if("object"!==r(t))return e==t;t=l.__toPrimitive(t)}else if("boolean"==typeof e){if(l.__isBigInt(t))return l.__equalToNumber(t,+e);if("object"!==r(t))return e==t;t=l.__toPrimitive(t)}else if("symbol"===r(e)){if(l.__isBigInt(t))return!1;if("object"!==r(t))return e==t;t=l.__toPrimitive(t)}else{if("object"!==r(e))return e==t;if("object"===r(t)&&t.constructor!==l)return e==t;e=l.__toPrimitive(e)}}}},{key:"NE",value:function(e,t){return!l.EQ(e,t)}},{key:"DataViewGetBigInt64",value:function(e,t){var r=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];return l.asIntN(64,l.DataViewGetBigUint64(e,t,r))}},{key:"DataViewGetBigUint64",value:function(e,t){var r=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],i=g(r?[4,0]:[0,4],2),n=i[0],s=i[1],a=e.getUint32(t+n,r),o=e.getUint32(t+s,r),c=new l(3,!1);return c.__setDigit(0,1073741823&o),c.__setDigit(1,(268435455&a)<<2|o>>>30),c.__setDigit(2,a>>>28),c.__trim()}},{key:"DataViewSetBigInt64",value:function(e,t,r){var i=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3];l.DataViewSetBigUint64(e,t,r,i)}},{key:"DataViewSetBigUint64",value:function(e,t,r){var i=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3],n=0,s=0;if(0<(r=l.asUintN(64,r)).length&&(s=r.__digit(0),1<r.length)){var a=r.__digit(1);s|=a<<30,n=a>>>2,2<r.length&&(n|=r.__digit(2)<<28)}var o=g(i?[4,0]:[0,4],2),c=o[0],d=o[1];e.setUint32(t+c,n,i),e.setUint32(t+d,s,i)}},{key:"__zero",value:function(){return new l(0,!1)}},{key:"__oneDigit",value:function(e,t){var r=new l(1,t);return r.__setDigit(0,e),r}},{key:"__decideRounding",value:function(e,t,r,i){if(0<t)return-1;var n;if(0>t)n=-t-1;else{if(0===r)return-1;r--,i=e.__digit(r),n=29}var s=1<<n;if(!(i&s))return-1;if(i&(s-=1))return 1;for(;0<r;)if(r--,0!==e.__digit(r))return 1;return 0}},{key:"__fromDouble",value:function(e){l.__kBitConversionDouble[0]=e;var t,r=(2047&l.__kBitConversionInts[1]>>>20)-1023,i=1+(0|r/30),n=new l(i,0>e),s=1048575&l.__kBitConversionInts[1]|1048576,a=l.__kBitConversionInts[0],o=20,c=r%30,d=0;if(c<o){var u=o-c;d=u+32,t=s>>>u,s=s<<32-u|a>>>u,a<<=32-u}else if(c===o)d=32,t=s,s=a,a=0;else{var h=c-o;d=32-h,t=s<<h|a>>>32-h,s=a<<h,a=0}n.__setDigit(i-1,t);for(var f=i-2;0<=f;f--)0<d?(d-=30,t=s>>>2,s=s<<30|a>>>2,a<<=30):t=0,n.__setDigit(f,t);return n.__trim()}},{key:"__isWhitespace",value:function(e){return!!(13>=e&&9<=e)||(159>=e?32==e:131071>=e?160==e||5760==e:196607>=e?10>=(e&=131071)||40==e||41==e||47==e||95==e||4096==e:65279==e)}},{key:"__fromString",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=0,i=e.length,n=0;if(n===i)return l.__zero();for(var s=e.charCodeAt(n);l.__isWhitespace(s);){if(++n===i)return l.__zero();s=e.charCodeAt(n)}if(43===s){if(++n===i)return null;s=e.charCodeAt(n),r=1}else if(45===s){if(++n===i)return null;s=e.charCodeAt(n),r=-1}if(0===t){if(t=10,48===s){if(++n===i)return l.__zero();if(88===(s=e.charCodeAt(n))||120===s){if(t=16,++n===i)return null;s=e.charCodeAt(n)}else if(79===s||111===s){if(t=8,++n===i)return null;s=e.charCodeAt(n)}else if(66===s||98===s){if(t=2,++n===i)return null;s=e.charCodeAt(n)}}}else if(16===t&&48===s){if(++n===i)return l.__zero();if(88===(s=e.charCodeAt(n))||120===s){if(++n===i)return null;s=e.charCodeAt(n)}}if(0!==r&&10!==t)return null;for(;48===s;){if(++n===i)return l.__zero();s=e.charCodeAt(n)}var a=i-n,o=l.__kMaxBitsPerChar[t],c=l.__kBitsPerCharTableMultiplier-1;if(a>1073741824/o)return null;var d=new l(0|(29+(o*a+c>>>l.__kBitsPerCharTableShift))/30,!1),u=10>t?t:10,h=10<t?t-10:0;if(t&t-1){d.__initializeDigits();var f=!1,p=0;do{for(var m,g=0,y=1;;){if(m=void 0,s-48>>>0<u)m=s-48;else{if(!((32|s)-97>>>0<h)){f=!0;break}m=(32|s)-87}var _=y*t;if(1073741823<_)break;if(y=_,g=g*t+m,p++,++n===i){f=!0;break}s=e.charCodeAt(n)}var v=0|(o*p+(c=30*l.__kBitsPerCharTableMultiplier-1)>>>l.__kBitsPerCharTableShift)/30;d.__inplaceMultiplyAdd(y,g,v)}while(!f)}else{o>>=l.__kBitsPerCharTableShift;var E=[],S=[],T=!1;do{for(var b,R=0,w=0;;){if(b=void 0,s-48>>>0<u)b=s-48;else{if(!((32|s)-97>>>0<h)){T=!0;break}b=(32|s)-87}if(w+=o,R=R<<o|b,++n===i){T=!0;break}if(s=e.charCodeAt(n),30<w+o)break}E.push(R),S.push(w)}while(!T);l.__fillFromParts(d,E,S)}if(n!==i){if(!l.__isWhitespace(s))return null;for(n++;n<i;n++)if(s=e.charCodeAt(n),!l.__isWhitespace(s))return null}return d.sign=-1===r,d.__trim()}},{key:"__fillFromParts",value:function(e,t,r){for(var i=0,n=0,s=0,a=t.length-1;0<=a;a--){var o=t[a],l=r[a];n|=o<<s,30===(s+=l)?(e.__setDigit(i++,n),s=0,n=0):30<s&&(e.__setDigit(i++,1073741823&n),n=o>>>l-(s-=30))}if(0!==n){if(i>=e.length)throw new Error("implementation bug");e.__setDigit(i++,n)}for(;i<e.length;i++)e.__setDigit(i,0)}},{key:"__toStringBasePowerOfTwo",value:function(e,t){var r=e.length,i=t-1,n=i=(15&(i=(51&(i=(85&i>>>1)+(85&i))>>>2)+(51&i))>>>4)+(15&i),s=t-1,a=e.__digit(r-1),o=0|(30*r-l.__clz30(a)+n-1)/n;if(e.sign&&o++,268435456<o)throw new Error("string too long");for(var c=Array(o),d=o-1,u=0,h=0,f=0;f<r-1;f++){var p=e.__digit(f),m=(u|p<<h)&s;c[d--]=l.__kConversionChars[m];var g=n-h;for(u=p>>>g,h=30-g;h>=n;)c[d--]=l.__kConversionChars[u&s],u>>>=n,h-=n}var y=(u|a<<h)&s;for(c[d--]=l.__kConversionChars[y],u=a>>>n-h;0!==u;)c[d--]=l.__kConversionChars[u&s],u>>>=n;if(e.sign&&(c[d--]="-"),-1!==d)throw new Error("implementation bug");return c.join("")}},{key:"__toStringGeneric",value:function(e,t,r){var i=e.length;if(0===i)return"";if(1===i){var n=e.__unsignedDigit(0).toString(t);return!1===r&&e.sign&&(n="-"+n),n}var s,a,o=30*i-l.__clz30(e.__digit(i-1)),c=l.__kMaxBitsPerChar[t]-1,d=o*l.__kBitsPerCharTableMultiplier,u=1+(d=0|(d+=c-1)/c)>>1,h=l.exponentiate(l.__oneDigit(t,!1),l.__oneDigit(u,!1)),f=h.__unsignedDigit(0);if(1===h.length&&32767>=f){(s=new l(e.length,!1)).__initializeDigits();for(var p,m=0,g=2*e.length-1;0<=g;g--)p=m<<15|e.__halfDigit(g),s.__setHalfDigit(g,0|p/f),m=0|p%f;a=m.toString(t)}else{var y=l.__absoluteDivLarge(e,h,!0,!0);s=y.quotient;var _=y.remainder.__trim();a=l.__toStringGeneric(_,t,!0)}s.__trim();for(var v=l.__toStringGeneric(s,t,!0);a.length<u;)a="0"+a;return!1===r&&e.sign&&(v="-"+v),v+a}},{key:"__unequalSign",value:function(e){return e?-1:1}},{key:"__absoluteGreater",value:function(e){return e?-1:1}},{key:"__absoluteLess",value:function(e){return e?1:-1}},{key:"__compareToBigInt",value:function(e,t){var r=e.sign;if(r!==t.sign)return l.__unequalSign(r);var i=l.__absoluteCompare(e,t);return 0<i?l.__absoluteGreater(r):0>i?l.__absoluteLess(r):0}},{key:"__compareToNumber",value:function(e,r){if(l.__isOneDigitInt(r)){var i=e.sign,n=0>r;if(i!==n)return l.__unequalSign(i);if(0===e.length){if(n)throw new Error("implementation bug");return 0===r?0:-1}if(1<e.length)return l.__absoluteGreater(i);var s=t(r),a=e.__unsignedDigit(0);return a>s?l.__absoluteGreater(i):a<s?l.__absoluteLess(i):0}return l.__compareToDouble(e,r)}},{key:"__compareToDouble",value:function(e,t){if(t!=t)return t;if(t===1/0)return-1;if(t===-1/0)return 1;var r=e.sign;if(r!==0>t)return l.__unequalSign(r);if(0===t)throw new Error("implementation bug: should be handled elsewhere");if(0===e.length)return-1;l.__kBitConversionDouble[0]=t;var i=2047&l.__kBitConversionInts[1]>>>20;if(2047==i)throw new Error("implementation bug: handled elsewhere");var n=i-1023;if(0>n)return l.__absoluteGreater(r);var s=e.length,a=e.__digit(s-1),o=l.__clz30(a),c=30*s-o,d=n+1;if(c<d)return l.__absoluteLess(r);if(c>d)return l.__absoluteGreater(r);var u=1048576|1048575&l.__kBitConversionInts[1],h=l.__kBitConversionInts[0],f=20,p=29-o;if(p!==(0|(c-1)%30))throw new Error("implementation bug");var m,g=0;if(p<f){var y=f-p;g=y+32,m=u>>>y,u=u<<32-y|h>>>y,h<<=32-y}else if(p===f)g=32,m=u,u=h,h=0;else{var _=p-f;g=32-_,m=u<<_|h>>>32-_,u=h<<_,h=0}if((a>>>=0)>(m>>>=0))return l.__absoluteGreater(r);if(a<m)return l.__absoluteLess(r);for(var v=s-2;0<=v;v--){0<g?(g-=30,m=u>>>2,u=u<<30|h>>>2,h<<=30):m=0;var E=e.__unsignedDigit(v);if(E>m)return l.__absoluteGreater(r);if(E<m)return l.__absoluteLess(r)}if(0!==u||0!==h){if(0===g)throw new Error("implementation bug");return l.__absoluteLess(r)}return 0}},{key:"__equalToNumber",value:function(e,r){return l.__isOneDigitInt(r)?0===r?0===e.length:1===e.length&&e.sign===0>r&&e.__unsignedDigit(0)===t(r):0===l.__compareToDouble(e,r)}},{key:"__comparisonResultToBool",value:function(e,t){return 0===t?0>e:1===t?0>=e:2===t?0<e:3===t?0<=e:void 0}},{key:"__compare",value:function(e,t,r){if(e=l.__toPrimitive(e),t=l.__toPrimitive(t),"string"==typeof e&&"string"==typeof t)switch(r){case 0:return e<t;case 1:return e<=t;case 2:return e>t;case 3:return e>=t}if(l.__isBigInt(e)&&"string"==typeof t)return null!==(t=l.__fromString(t))&&l.__comparisonResultToBool(l.__compareToBigInt(e,t),r);if("string"==typeof e&&l.__isBigInt(t))return null!==(e=l.__fromString(e))&&l.__comparisonResultToBool(l.__compareToBigInt(e,t),r);if(e=l.__toNumeric(e),t=l.__toNumeric(t),l.__isBigInt(e)){if(l.__isBigInt(t))return l.__comparisonResultToBool(l.__compareToBigInt(e,t),r);if("number"!=typeof t)throw new Error("implementation bug");return l.__comparisonResultToBool(l.__compareToNumber(e,t),r)}if("number"!=typeof e)throw new Error("implementation bug");if(l.__isBigInt(t))return l.__comparisonResultToBool(l.__compareToNumber(t,e),2^r);if("number"!=typeof t)throw new Error("implementation bug");return 0===r?e<t:1===r?e<=t:2===r?e>t:3===r?e>=t:void 0}},{key:"__absoluteAdd",value:function(e,t,r){if(e.length<t.length)return l.__absoluteAdd(t,e,r);if(0===e.length)return e;if(0===t.length)return e.sign===r?e:l.unaryMinus(e);var i=e.length;(0===e.__clzmsd()||t.length===e.length&&0===t.__clzmsd())&&i++;for(var n,s=new l(i,r),a=0,o=0;o<t.length;o++)a=(n=e.__digit(o)+t.__digit(o)+a)>>>30,s.__setDigit(o,1073741823&n);for(;o<e.length;o++){var c=e.__digit(o)+a;a=c>>>30,s.__setDigit(o,1073741823&c)}return o<s.length&&s.__setDigit(o,a),s.__trim()}},{key:"__absoluteSub",value:function(e,t,r){if(0===e.length)return e;if(0===t.length)return e.sign===r?e:l.unaryMinus(e);for(var i,n=new l(e.length,r),s=0,a=0;a<t.length;a++)s=1&(i=e.__digit(a)-t.__digit(a)-s)>>>30,n.__setDigit(a,1073741823&i);for(;a<e.length;a++){var o=e.__digit(a)-s;s=1&o>>>30,n.__setDigit(a,1073741823&o)}return n.__trim()}},{key:"__absoluteAddOne",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=e.length;null===r?r=new l(i,t):r.sign=t;for(var n,s=1,a=0;a<i;a++)s=(n=e.__digit(a)+s)>>>30,r.__setDigit(a,1073741823&n);return 0!==s&&r.__setDigitGrow(i,1),r}},{key:"__absoluteSubOne",value:function(e,t){for(var r,i=e.length,n=new l(t=t||i,!1),s=1,a=0;a<i;a++)s=1&(r=e.__digit(a)-s)>>>30,n.__setDigit(a,1073741823&r);if(0!==s)throw new Error("implementation bug");for(var o=i;o<t;o++)n.__setDigit(o,0);return n}},{key:"__absoluteAnd",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=e.length,n=t.length,s=n;if(i<n){s=i;var a=e,o=i;e=t,i=n,t=a,n=o}var c=s;null===r?r=new l(c,!1):c=r.length;for(var d=0;d<s;d++)r.__setDigit(d,e.__digit(d)&t.__digit(d));for(;d<c;d++)r.__setDigit(d,0);return r}},{key:"__absoluteAndNot",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=e.length,n=t.length,s=n;i<n&&(s=i);var a=i;null===r?r=new l(a,!1):a=r.length;for(var o=0;o<s;o++)r.__setDigit(o,e.__digit(o)&~t.__digit(o));for(;o<i;o++)r.__setDigit(o,e.__digit(o));for(;o<a;o++)r.__setDigit(o,0);return r}},{key:"__absoluteOr",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=e.length,n=t.length,s=n;if(i<n){s=i;var a=e,o=i;e=t,i=n,t=a,n=o}var c=i;null===r?r=new l(c,!1):c=r.length;for(var d=0;d<s;d++)r.__setDigit(d,e.__digit(d)|t.__digit(d));for(;d<i;d++)r.__setDigit(d,e.__digit(d));for(;d<c;d++)r.__setDigit(d,0);return r}},{key:"__absoluteXor",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=e.length,n=t.length,s=n;if(i<n){s=i;var a=e,o=i;e=t,i=n,t=a,n=o}var c=i;null===r?r=new l(c,!1):c=r.length;for(var d=0;d<s;d++)r.__setDigit(d,e.__digit(d)^t.__digit(d));for(;d<i;d++)r.__setDigit(d,e.__digit(d));for(;d<c;d++)r.__setDigit(d,0);return r}},{key:"__absoluteCompare",value:function(e,t){var r=e.length-t.length;if(0!=r)return r;for(var i=e.length-1;0<=i&&e.__digit(i)===t.__digit(i);)i--;return 0>i?0:e.__unsignedDigit(i)>t.__unsignedDigit(i)?1:-1}},{key:"__multiplyAccumulate",value:function(e,t,r,i){if(0!==t){for(var n=32767&t,s=t>>>15,a=0,o=0,c=0;c<e.length;c++,i++){var d=r.__digit(i),u=e.__digit(c),h=32767&u,f=u>>>15,p=l.__imul(h,n),m=l.__imul(h,s),g=l.__imul(f,n);a=(d+=o+p+a)>>>30,d&=1073741823,a+=(d+=((32767&m)<<15)+((32767&g)<<15))>>>30,o=l.__imul(f,s)+(m>>>15)+(g>>>15),r.__setDigit(i,1073741823&d)}for(;0!==a||0!==o;i++){var y=r.__digit(i);y+=a+o,o=0,a=y>>>30,r.__setDigit(i,1073741823&y)}}}},{key:"__internalMultiplyAdd",value:function(e,t,r,i,n){for(var s=r,a=0,o=0;o<i;o++){var c=e.__digit(o),d=l.__imul(32767&c,t),u=l.__imul(c>>>15,t),h=d+((32767&u)<<15)+a+s;s=h>>>30,a=u>>>15,n.__setDigit(o,1073741823&h)}if(n.length>i)for(n.__setDigit(i++,s+a);i<n.length;)n.__setDigit(i++,0);else if(0!==s+a)throw new Error("implementation bug")}},{key:"__absoluteDivSmall",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;null===r&&(r=new l(e.length,!1));for(var i=0,n=2*e.length-1;0<=n;n-=2){var s=(i<<15|e.__halfDigit(n))>>>0,a=0|s/t,o=0|(s=((i=0|s%t)<<15|e.__halfDigit(n-1))>>>0)/t;i=0|s%t,r.__setDigit(n>>>1,a<<15|o)}return r}},{key:"__absoluteModSmall",value:function(e,t){for(var r=0,i=2*e.length-1;0<=i;i--)r=0|((r<<15|e.__halfDigit(i))>>>0)%t;return r}},{key:"__absoluteDivLarge",value:function(e,t,r,i){var n=t.__halfDigitLength(),s=t.length,a=e.__halfDigitLength()-n,o=null;r&&(o=new l(a+2>>>1,!1)).__initializeDigits();var c=new l(n+2>>>1,!1);c.__initializeDigits();var d=l.__clz15(t.__halfDigit(n-1));0<d&&(t=l.__specialLeftShift(t,d,0));for(var u=l.__specialLeftShift(e,d,1),h=t.__halfDigit(n-1),f=0,p=a;0<=p;p--){var m=32767,g=u.__halfDigit(p+n);if(g!==h){var y=(g<<15|u.__halfDigit(p+n-1))>>>0;m=0|y/h;for(var _=0|y%h,v=t.__halfDigit(n-2),E=u.__halfDigit(p+n-2);l.__imul(m,v)>>>0>(_<<16|E)>>>0&&(m--,!(32767<(_+=h))););}l.__internalMultiplyAdd(t,m,0,s,c);var S=u.__inplaceSub(c,p,n+1);0!==S&&(S=u.__inplaceAdd(t,p,n),u.__setHalfDigit(p+n,32767&u.__halfDigit(p+n)+S),m--),r&&(1&p?f=m<<15:o.__setDigit(p>>>1,f|m))}if(i)return u.__inplaceRightShift(d),r?{quotient:o,remainder:u}:u;if(r)return o;throw new Error("unreachable")}},{key:"__clz15",value:function(e){return l.__clz30(e)-15}},{key:"__specialLeftShift",value:function(e,t,r){var i=e.length,n=new l(i+r,!1);if(0===t){for(var s=0;s<i;s++)n.__setDigit(s,e.__digit(s));return 0<r&&n.__setDigit(i,0),n}for(var a,o=0,c=0;c<i;c++)a=e.__digit(c),n.__setDigit(c,1073741823&a<<t|o),o=a>>>30-t;return 0<r&&n.__setDigit(i,o),n}},{key:"__leftShiftByAbsolute",value:function(e,t){var r=l.__toShiftAmount(t);if(0>r)throw new RangeError("BigInt too big");var i=0|r/30,n=r%30,s=e.length,a=0!==n&&0!=e.__digit(s-1)>>>30-n,o=s+i+(a?1:0),c=new l(o,e.sign);if(0===n){for(var d=0;d<i;d++)c.__setDigit(d,0);for(;d<o;d++)c.__setDigit(d,e.__digit(d-i))}else{for(var u=0,h=0;h<i;h++)c.__setDigit(h,0);for(var f,p=0;p<s;p++)f=e.__digit(p),c.__setDigit(p+i,1073741823&f<<n|u),u=f>>>30-n;if(a)c.__setDigit(s+i,u);else if(0!==u)throw new Error("implementation bug")}return c.__trim()}},{key:"__rightShiftByAbsolute",value:function(e,t){var r=e.length,i=e.sign,n=l.__toShiftAmount(t);if(0>n)return l.__rightShiftByMaximum(i);var s=0|n/30,a=n%30,o=r-s;if(0>=o)return l.__rightShiftByMaximum(i);var c=!1;if(i)if(e.__digit(s)&(1<<a)-1)c=!0;else for(var d=0;d<s;d++)if(0!==e.__digit(d)){c=!0;break}c&&0===a&&0==~e.__digit(r-1)&&o++;var u=new l(o,i);if(0===a){u.__setDigit(o-1,0);for(var h=s;h<r;h++)u.__setDigit(h-s,e.__digit(h))}else{for(var f,p=e.__digit(s)>>>a,m=r-s-1,g=0;g<m;g++)f=e.__digit(g+s+1),u.__setDigit(g,1073741823&f<<30-a|p),p=f>>>a;u.__setDigit(m,p)}return c&&(u=l.__absoluteAddOne(u,!0,u)),u.__trim()}},{key:"__rightShiftByMaximum",value:function(e){return e?l.__oneDigit(1,!0):l.__zero()}},{key:"__toShiftAmount",value:function(e){if(1<e.length)return-1;var t=e.__unsignedDigit(0);return t>l.__kMaxLengthBits?-1:t}},{key:"__toPrimitive",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"default";if("object"!==r(e))return e;if(e.constructor===l)return e;if("undefined"!=typeof Symbol&&"symbol"===r(Symbol.toPrimitive)){var i=e[Symbol.toPrimitive];if(i){var n=i(t);if("object"!==r(n))return n;throw new TypeError("Cannot convert object to primitive value")}}var s=e.valueOf;if(s){var a=s.call(e);if("object"!==r(a))return a}var o=e.toString;if(o){var c=o.call(e);if("object"!==r(c))return c}throw new TypeError("Cannot convert object to primitive value")}},{key:"__toNumeric",value:function(e){return l.__isBigInt(e)?e:+e}},{key:"__isBigInt",value:function(e){return"object"===r(e)&&null!==e&&e.constructor===l}},{key:"__truncateToNBits",value:function(e,t){for(var r=0|(e+29)/30,i=new l(r,t.sign),n=r-1,s=0;s<n;s++)i.__setDigit(s,t.__digit(s));var a=t.__digit(n);if(0!=e%30){var o=32-e%30;a=a<<o>>>o}return i.__setDigit(n,a),i.__trim()}},{key:"__truncateAndSubFromPowerOfTwo",value:function(e,t,r){for(var i,n=Math.min,s=0|(e+29)/30,a=new l(s,r),o=0,c=s-1,d=0,u=n(c,t.length);o<u;o++)d=1&(i=0-t.__digit(o)-d)>>>30,a.__setDigit(o,1073741823&i);for(;o<c;o++)a.__setDigit(o,1073741823&-d);var h,f=c<t.length?t.__digit(c):0,p=e%30;if(0===p)h=0-f-d,h&=1073741823;else{var m=32-p,g=1<<32-m;h=g-(f=f<<m>>>m)-d,h&=g-1}return a.__setDigit(c,h),a.__trim()}},{key:"__digitPow",value:function(e,t){for(var r=1;0<t;)1&t&&(r*=e),t>>>=1,e*=e;return r}},{key:"__isOneDigitInt",value:function(e){return(1073741823&e)===e}}]),l}(h(Array));return b.__kMaxLength=33554432,b.__kMaxLengthBits=b.__kMaxLength<<5,b.__kMaxBitsPerChar=[0,0,32,51,64,75,83,90,96,102,107,111,115,119,122,126,128,131,134,136,139,141,143,145,147,149,151,153,154,156,158,159,160,162,163,165,166],b.__kBitsPerCharTableShift=5,b.__kBitsPerCharTableMultiplier=1<<b.__kBitsPerCharTableShift,b.__kConversionChars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],b.__kBitConversionBuffer=new ArrayBuffer(8),b.__kBitConversionDouble=new Float64Array(b.__kBitConversionBuffer),b.__kBitConversionInts=new Int32Array(b.__kBitConversionBuffer),b.__clz30=t?function(e){return t(e)-2}:function(e){var t=Math.LN2,r=Math.log;return 0===e?30:0|29-(0|r(e>>>0)/t)},b.__imul=e||function(e,t){return 0|e*t},b}()}(nP);var sP=nP.exports;const aP="CmdMessageBuilder";let oP=function(e){return e[e.ARRAY_BUFFER=0]="ARRAY_BUFFER",e[e.STRING=1]="STRING",e}({});class lP{constructor(e,t,r,i){$l(this,"RTP_HEADER_V_P_X_CC",144),$l(this,"RTP_HEADER_V_P_X_CC_BRODACAST",128),this.cmdMsgPacketSeqNum=0,this.selfUserUid=e,this.cmdSendSsrc=t,this.cmdReceiveSsrc=r,this.msgFormat=i,this.RTP_HEADER_M_PT=99}parseCmdMessage(e){const t=new DataView(e),r=t.getUint16(2),i=t.getUint32(4);Qv.debug(aP,"receive ".concat(r," msg of timeStamp ").concat(i));const n=t.getUint32(8);if(Qv.info(aP,"receiveSsrc:".concat(n,", cmdReceiveSsrc:").concat(this.cmdReceiveSsrc)),n!==this.cmdReceiveSsrc)return Qv.error(aP,"receive msg ssrc not matched, ".concat(this.cmdReceiveSsrc," - ").concat(n)),null;let s=0;if(!(16&t.getUint8(0)))s=12;else{s=16+4*t.getUint16(14)}const a=sP.toNumber(sP.DataViewGetBigUint64(t,s)),o=t.buffer.slice(s+16);let l=null;return l=this.msgFormat===oP.STRING?cP.ArrayBufferToMsg(o):o,{msg:l,srcUserId:a}}buildCmdMessage(e){const t=!e.userUid,r=new DataView(new ArrayBuffer(t?28:44));t?r.setUint8(0,this.RTP_HEADER_V_P_X_CC_BRODACAST):r.setUint8(0,this.RTP_HEADER_V_P_X_CC),r.setUint8(1,this.RTP_HEADER_M_PT),r.setUint16(2,this.cmdMsgPacketSeqNum++),r.setUint32(4,Math.floor((new Date).getTime()/1e3)),r.setUint32(8,this.cmdSendSsrc);const{userUid:i=0,msg:n}=e;let s=0;return t?s=12:(r.setUint16(12,4096),r.setUint16(14,3),r.setUint8(16,21),r.setUint8(17,8),sP.DataViewSetBigUint64(r,18,sP.BigInt(i)),r.setUint16(26,0),s=28),sP.DataViewSetBigUint64(r,s,sP.BigInt(this.selfUserUid)),sP.DataViewSetBigUint64(r,s+8,sP.BigInt(0)),cP.concatArrayBuffer(r.buffer,cP.msgBodyToArrayBuffer(n))}}class cP{static msgBodyToArrayBuffer(e){if("string"==typeof e){return(new TextEncoder).encode(e).buffer}return e}static ArrayBufferToMsg(e){return new TextDecoder("utf-8").decode(e)}static concatArrayBuffer(){let e=0;for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(const a of r)e+=a.byteLength;const n=new Uint8Array(e);let s=0;for(const a of r){const e=new Uint8Array(a);n.set(e,s),s+=a.byteLength}return n.buffer}static arrayBufferToNumberArray(e){const t=[];for(let r=0;r<e.byteLength;r+=4)t.push(e.getUint32(r));return t}static numberArrayToArrayBuffer(e){const t=new DataView(new ArrayBuffer(4*e.length));for(let r=0;r<e.length;r++)t.setUint32(4*r,e[r]);return t.buffer}}const dP="DataChannelMsgManager";class uP{constructor(e){this.event_=new wk,this.dataChannel=e.createDataChannel("command",{ordered:!0}),this.dataChannel.binaryType="arraybuffer",this.dataChannel.onopen=this.onopen.bind(this),this.dataChannel.onerror=this.onerror.bind(this),this.dataChannel.onmessage=this.onmessage.bind(this),this.dataChannel.onclose=this.onclose.bind(this)}on(e,t){this.event_.on(e,t)}off(e,t){t?this.event_.removeListener(e,t):this.event_.removeAllListeners(e)}sendMessage(e){var t;if(!this.dataChannel||"open"!==this.dataChannel.readyState)return Qv.error(dP,"send message with dataChannel failed for dataChannel unavaliable: ".concat(null===(t=this.dataChannel)||void 0===t?void 0:t.readyState,".")),!1;try{return this.dataChannel.bufferedAmount>=1024e6&&Qv.warn(dP,"buffer over high threshold of 1M: ".concat(this.dataChannel.bufferedAmount,", send message may blocked and delay.")),this.dataChannel.send(e),!0}catch(IU){return Qv.error(dP,"send message with dataChannel occur error: ".concat(IU,".")),!1}}close(){this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onerror=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel.close(),this.dataChannel=null)}onopen(){Qv.info(dP,"onopen, RTCDataChannel connection status: ".concat(this.dataChannel.readyState)),clearTimeout(this.dataChannelDisConnectTimer),this.event_.emit("CMD_CHANNEL_ESTABLISHED")}onmessage(e){e.data?this.event_.emit("CMD_MSG_REVEIVED",e.data):Qv.error(dP,"onerror, RTCDataChannel message is null.")}onerror(e){Qv.error(dP,"onerror, RTCDataChannel occur error: ".concat(e)),this.dataChannelDisConnectTimer||(this.dataChannelDisConnectTimer=setTimeout((()=>{clearTimeout(this.dataChannelDisConnectTimer),this.event_.emit("CMD_CHANNEL_DISCONNECT")}),3e4))}onclose(e){Qv.info(dP,"onclose, RTCDataChannel closed: ".concat(e)),this.dataChannelDisConnectTimer||(this.dataChannelDisConnectTimer=setTimeout((()=>{clearTimeout(this.dataChannelDisConnectTimer),this.event_.emit("CMD_CHANNEL_DISCONNECT")}),3e4))}}let hP=function(e){return e.CmdChannelEstablished="data-channel-established",e.CmdChannelDisconnect="data-channel-disconnect",e.CmdMsgReceived="data-msg-received",e}({}),fP=function(e){return e.WEBSOCKET="WebSocket",e.DATA_CHANNEL="DataChannel",e}({});class pP{constructor(e){this.event=e}initChannel(e){this.connection=e.connection,this.isCmd=e.isCmd||!1,this.dataChannel||(this.dataChannel=new uP(this.connection),this.cmdBuilder=new lP(e.uid||0,e.sendSsrc||0,e.receiveSsrc||0,e.msgFormat||oP.ARRAY_BUFFER)),this.dataChannel.on("CMD_MSG_REVEIVED",(e=>{if(this.isCmd){const t=this.cmdBuilder.parseCmdMessage(e);this.event.emit(hP.CmdMsgReceived,t)}else this.event.emit(hP.CmdMsgReceived,{msg:e})})),this.dataChannel.on("CMD_CHANNEL_ESTABLISHED",(()=>{Qv.info(dP,"cmd dataChannel connection established."),this.event.emit(hP.CmdChannelEstablished,fP.DATA_CHANNEL)})),this.dataChannel.on("CMD_CHANNEL_DISCONNECT",(()=>{Qv.info(dP,"cmd dataChannel connection disconnect."),this.event.emit(hP.CmdChannelDisconnect,fP.DATA_CHANNEL)}))}sendMessage(e,t){if(this.isCmd){const r=this.cmdBuilder.buildCmdMessage({msg:t,userUid:e});return this.dataChannel.sendMessage(r)}{const e=cP.msgBodyToArrayBuffer(t);return this.dataChannel.sendMessage(e)}}reset(){this.dataChannel&&(this.dataChannel.off("CMD_MSG_REVEIVED"),this.dataChannel.off("CMD_CHANNEL_ESTABLISHED"),this.dataChannel.close(),this.dataChannel=null)}}const mP="PeerConnectionsManager";class gP{constructor(e,t,r){$l(this,"isFireFox",BC.isFirefox()),this.connectionId=r,this.eventEmitter=t,this.stats=e,BC.isOnlySupportUnfiedPlan()?(this.sdpDescMode="unified-plan",this.rtcSdp=new iP):(this.sdpDescMode="plan-b",this.rtcSdp=new rP),Qv.debug(mP,"ConnectionsManager, SDP mode: ".concat(this.sdpDescMode))}getConnectionId(){return this.connectionId}isConnectionsExist(){return!!this.peerConnection}isConnectionEstablished(){var e;return!(!this.peerConnection||"connected"!==(null===(e=this.peerConnection.connection)||void 0===e?void 0:e.connectionState))}async initConnectionAndSdp(e,t,r,i){const n=this.createPeerConnection();if(this.dataChanel&&this.dataChanel.reset(),i){Qv.info(mP,"init data channel..."),this.dataChanel=new pP(this.eventEmitter);const e={uid:i.uid||0,isCmd:i.isCmd||!1,connection:this.getConnection(),sendSsrc:i.sendSsrc||0,receiveSsrc:i.receiveSsrc||0,msgFormat:oP.ARRAY_BUFFER};this.dataChanel.initChannel(e)}Qv.info(mP,"initConnectionAndSdp, receiveAudio : "+e.receiveAudio+", receiveVideo : "+e.receiveVideo);const s=await this.createOffer({offerToReceiveAudio:e.receiveAudio,offerToReceiveVideo:e.receiveVideo}),a=this.rtcSdp.transformOfferSdp(s.sdp);if(await n.connection.setLocalDescription({type:"offer",sdp:a}),this.onConnection(n,t.onTrackHandler),this.iceAddressCollect(n.connection),!this.isFireFox){const e=n.connection.localDescription.sdp;Qv.debug(mP,"setLocalDescription, sdp offer: ".concat(this.rtcSdp.printSdpInfo(e))),await n.connection.setLocalDescription({type:"offer",sdp:this.rtcSdp.transformOfferSdp(e)})}e.receiveVideo&&BC.isChrome()&&!this.rtcSdp.containsValidVideoPayload(s.sdp)&&!r&&(this.destroyPeerConnection(),Qv.error(mP,"initConnectionAndSdp, no H264 payload and try createOffer again"),await this.initConnectionAndSdp(e,t,r,i))}modifySdpCandidates(){const e=this.peerConnection;let t=null;return e&&(t=this.rtcSdp.modifySdpCandidates(e.connection.localDescription.sdp,e.candidate)),t}destroyPeerConnection(e){this.peerConnection&&(clearTimeout(this.peerConnection.disConnectDelayHandleTimer),clearTimeout(this.peerConnection.connectionStatisticTimeOut),"closed"!==this.peerConnection.connection.signalingState&&(null==e||e.forEach((e=>this.peerConnection.connection.removeTrack(e))),this.peerConnection.connection.close(),this.peerConnection.connectFailedTimes=0),this.eventEmitter.removeAllListeners("STARTUP_MEDIA_STATS"),SD.shutDownMediaStats(this.connectionId),this.peerConnection=null),this.dataChanel&&(this.dataChanel.reset(),this.dataChanel=null)}async handleAnswerSdpFromServer(e){wD.getInstance(this.connectionId).updatePlayTrackKpi("icePairStart");const t=this.peerConnection.connection,r=this.rtcSdp.transformAnswerSdp(e,t.localDescription.sdp);Qv.debug(mP,"handleAnswerSdpFromServer, sdp answer: ".concat(this.rtcSdp.printSdpInfo(r)));try{await t.setRemoteDescription({type:"answer",sdp:r}),this.isFireFox&&(await t.setLocalDescription({type:"offer",sdp:(await t.createOffer()).sdp}),await t.setRemoteDescription({type:"answer",sdp:r}))}catch(IU){throw Qv.error(mP,"setRemoteDescription error, answer sdp invalid or offer sdp invalid: ".concat(IU)),new xh(Ph.HWLLS_INTERNAL_ERROR,(null==IU?void 0:IU.message)||"setRemoteDescription error, answer sdp invalid or offer sdp invalid")}}getSfuInfoFromSdp(e){const t=this.rtcSdp.getSfuInfo(e);return t.connectionId=this.getConnectionId(),t}getConnection(){var e;return this.isConnectionsExist()&&(null===(e=this.peerConnection)||void 0===e?void 0:e.connection)||null}sendMessage(e,t){return!!this.dataChanel&&this.dataChanel.sendMessage(e,t)}async createOffer(e){const t=this.peerConnection.connection;return await t.createOffer(e)}iceCandidateListener(e){Qv.info(mP,"iceCandidate add listener"),e.connection.onicecandidate=t=>{var r;Qv.info(mP,"###onicecandidate: ".concat(Qv.shieldIpAddress(null===(r=t.candidate)||void 0===r?void 0:r.candidate))),t.candidate&&(e.candidate||(e.candidate=[]),e.candidate.push(t.candidate))}}iceRestart(e,t){this.stats.reportConnectionStatus(Mk.CLOSED),e.connection.createOffer({iceRestart:!0}).then((t=>{e.connection.setLocalDescription({type:"offer",sdp:this.rtcSdp.transformOfferSdp(t.sdp)}),e.connection.setRemoteDescription({sdp:e.connection.remoteDescription.sdp,type:"answer"})})).finally((()=>{t&&t()})),e.connectFailedTimes++,e.connectFailedTimes>=1&&(Qv.error(mP,"onconnectionstatechange, emit media error event."),this.eventEmitter.emit("Error",{errCode:Ph.HWLLS_MEDIA_NETWORK_ERROR,errDesc:Oh[Ph.HWLLS_MEDIA_NETWORK_ERROR]}),e.connectFailedTimes=0)}onConnection(e,t){e.connection.ontrack=e=>{t(e)},e.connection.onconnectionstatechange=()=>{Qv.info(mP,"onconnectionstatechange, connect state is: ".concat(e.connection.connectionState)),"connected"===e.connection.connectionState&&(wD.getInstance(this.connectionId).updatePlayTrackKpi("dtlsComplete"),clearTimeout(e.connectionStatisticTimeOut),this.eventEmitter.emit("STARTUP_MEDIA_STATS"))},e.connection.oniceconnectionstatechange=async()=>{if(Qv.info(mP,"oniceconnectionstatechange, iceConnectionState: ".concat(e.connection.iceConnectionState)),"disconnected"!==e.connection.iceConnectionState)if(clearTimeout(e.disConnectDelayHandleTimer),e.disConnectDelayHandleTimer=null,"failed"===e.connection.iceConnectionState||"closed"===e.connection.iceConnectionState)Qv.info(mP,"[KPI] oniceconnectionstatechange, iceconnect failed, go iceRestart: ".concat(e.connection.iceConnectionState)),this.iceRestart(e);else if(["connected","completed"].includes(e.connection.iceConnectionState)){Qv.info(mP,"[KPI] oniceconnectionstatechange, iceconnect state: ".concat(e.connection.iceConnectionState)),wD.getInstance(this.connectionId).updatePlayTrackKpi("iceComplete"),e.connectFailedTimes=0;const t=await SD.getCandidatePairProtocol(this.connectionId);this.stats.reportConnectionStatus(Mk.CONNECTED,t)}else"checking"===e.connection.iceConnectionState&&(Qv.info(mP,"[KPI] oniceconnectionstatechange, iceconnect state: ".concat(e.connection.iceConnectionState)),wD.getInstance(this.connectionId).updatePlayTrackKpi("iceChecking"));else{if(e.disConnectDelayHandleTimer)return;e.disConnectDelayHandleTimer=setTimeout((()=>{Qv.info(mP,"oniceconnectionstatechange, disConnect state delay handler, go iceRestart: ".concat(e.connection.iceConnectionState)),this.iceRestart(e,(()=>{clearTimeout(e.disConnectDelayHandleTimer),e.disConnectDelayHandleTimer=null}))}),5e3)}}}async iceAddressCollect(e){Qv.info(mP,"[KPI] begin to do ice candidate"),wD.getInstance(this.connectionId).updatePlayTrackKpi("iceCandidateStart"),await new Promise((t=>{let r=null;const i=()=>{Qv.info(mP,"[KPI] ICE collect status: ".concat(e.iceGatheringState)),"complete"===e.iceGatheringState&&(clearTimeout(r),Qv.info(mP,"[KPI] ICE collect complete"),wD.getInstance(this.connectionId).updatePlayTrackKpi("iceCandidateComplete"),e.removeEventListener("icegatheringstatechange",i),t())};e.addEventListener("icegatheringstatechange",i),r=setTimeout((()=>{Qv.error(mP,"[KPI] ICE collect fail"),clearTimeout(r),e.removeEventListener("icegatheringstatechange",i),t()}),6e3)}))}createPeerConnection(){const e={rtcpMuxPolicy:"require",bundlePolicy:"max-bundle"};var t;(e.sdpSemantics=this.sdpDescMode,this.peerConnection)&&(null===(t=this.peerConnection.connection)||void 0===t||t.close());const r={connection:new RTCPeerConnection(e),connectFailedTimes:0};return this.peerConnection=r,this.iceCandidateListener(this.peerConnection),this.eventEmitter.removeAllListeners("STARTUP_MEDIA_STATS"),this.eventEmitter.once("STARTUP_MEDIA_STATS",(()=>{Qv.info(mP,"startUp Media Stats"),SD.startUpMediaStats(this)})),r.connectionStatisticTimeOut=setTimeout((()=>{clearTimeout(r.connectionStatisticTimeOut),this.eventEmitter.emit("STARTUP_MEDIA_STATS")}),6e3),this.peerConnection}}const yP=new class{constructor(){$l(this,"eventHandlers",{visibilitychange:()=>{let e="FOREGROUND";document.hidden&&(e="BACKGROUND");for(const t of this.eventBus.values())t.emit(e)}}),this.eventBus=new Map,Zv.isMobileDevice()&&document.addEventListener("visibilitychange",this.eventHandlers.visibilitychange)}register(e){const t=Zv.generateRandomId(32);return this.eventBus.set(t,e),t}unregister(e){e&&this.eventBus.delete(e)}},_P="PlayerUtils";class vP{static async multiPlatformAdapter(){return new Promise((e=>{if(Zv.isWKWebview()){const t=window.WeixinJSBridge;t?(Qv.info(_P,"multiPlatformAdapter handle begin"),t.invoke("getNetworkType",{},(()=>{e()}),!1)):document.addEventListener("WeixinJSBridgeReady",(()=>{Qv.info(_P,"multiPlatformAdapter WeixinJSBridgeReady,  handle begin"),t.invoke("getNetworkType",{},(()=>{e()}),!1)}))}else e()}))}}class EP{constructor(e){$l(this,"loadingTimer",{timer:null,lastLoadingStatus:""}),this.loadingParentDiv=e}loadingMask(e){let t=this.loadingParentDiv.querySelector("#loadingMask");if(!t&&e&&(t=Zv.createLoadingMask(),this.loadingParentDiv.appendChild(t)),t){const r=e?"block":"none";if(this.loadingTimer.timer)return void(this.loadingTimer.lastLoadingStatus=r);if(t.style.display!==r&&(t.style.display=r),!e)return;this.loadingTimer.timer=setTimeout((()=>{clearTimeout(this.loadingTimer.timer),this.loadingTimer.timer=null,"none"===this.loadingTimer.lastLoadingStatus&&(t.style.display="none"),this.loadingTimer.lastLoadingStatus=""}),300)}}stopLoadingMask(){clearTimeout(this.loadingTimer.timer),this.loadingTimer.timer=null,this.loadingTimer.lastLoadingStatus="";const e=this.loadingParentDiv.querySelector("#loadingMask");var t;e&&(null===(t=this.loadingParentDiv)||void 0===t||t.removeChild(e))}}class SP{static preLoadPoster(e){if(SP.preLoadImages.has(e))return;const t=document.createElement("div");t.setAttribute("id","poster_div"),t.style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.display="none",t.style["z-index"]=98,t.style["justify-content"]="center",t.style["align-items"]="center",t.style.overflow="hidden";const r=new Image;if(r.src=e,t.appendChild(r),SP.preLoadImages.set(e,t),SP.preLoadImages.size>5)for(const i of SP.preLoadImages.keys()){SP.preLoadImages.delete(i);break}r.onload=()=>{t.style["background-color"]="#000",Qv.info(_P,"preLoadPoster success")},r.onerror=()=>{Qv.error(_P,"preLoadPoster failed"),SP.disPlayPoster(!1,e),SP.preLoadImages.delete(e)}}static attachPoster(e,t,r){const i=SP.preLoadImages.get(t);if(!i)return;const n=i.querySelector("img");r===Ok.FILL?(n.style.width="100%",n.style.height="100%"):(n.style.width="auto",n.style.height="auto"),e.querySelector("#poster_div img")||e.appendChild(i)}static detachPoster(e,t){const r=SP.preLoadImages.get(t);r&&(e.removeChild(r),r.style.display="none")}static disPlayPoster(e,t){const r=SP.preLoadImages.get(t);r&&(r.style.display=e?"flex":"none")}}$l(SP,"preLoadImages",new Map);const TP=new class{constructor(){$l(this,"supportFullScreenApi",{}),$l(this,"fullScreenApiMap",[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]]),this.isFullScreen=!1;for(const e of this.fullScreenApiMap)if(e[1]in document){for(let t=0;t<this.fullScreenApiMap[0].length;t++)this.supportFullScreenApi[this.fullScreenApiMap[0][t]]=e[t];break}Object.keys(this.supportFullScreenApi).length<1&&(this.supportFullScreenApi={requestFullscreen:"webkitRequestFullscreen",exitFullscreen:"webkitExitFullscreen",fullscreenElement:"webkitFullscreenElement",fullscreenEnabled:"webkitFullscreenEnabled",fullscreenchange:"webkitfullscreenchange",fullscreenerror:"webkitfullscreenerror"}),this.addFullScreenEventsListener()}enterFullScreen(e,t,r){this.videoElement=t,this.event=r;try{if(this.supportFullScreenApi.requestFullscreen){if(BC.isSafari()&&t.webkitEnterFullscreen)return void t.webkitEnterFullscreen();const r=this.supportFullScreenApi.requestFullscreen;let i=r?e[r].bind(e):null;if("function"==typeof i)return Qv.info(_P,"enter fullScreen with ".concat(r," on player element.")),void i();i=r?t[r].bind(t):null,"function"==typeof i&&(Qv.info(_P,"enter fullScreen with ".concat(r," on video element.")),i())}}catch(ZO){Qv.error(_P,"enterFullScreen occur error: ".concat(ZO,"."))}}exitFullScreen(){try{const e=this.supportFullScreenApi.exitFullscreen,t=e?document[e].bind(document):null;"function"==typeof t&&(Qv.info(_P,"exit fullScreen with ".concat(e,".")),t())}catch(ZO){Qv.error(_P,"exitFullScreen occur error: ".concat(ZO,"."))}}getFullScreenStatus(){return this.isFullScreen}addFullScreenEventsListener(){if(Object.keys(this.supportFullScreenApi).length<1)return void Qv.error(_P,"addFullScreenEventsListener failed.");const e=()=>{var e,t;BC.isSafari()?this.isFullScreen!==!(null===(e=this.videoElement)||void 0===e||!e.webkitDisplayingFullscreen)&&(null!==(t=this.videoElement)&&void 0!==t&&t.webkitDisplayingFullscreen?(Qv.info(_P,"trigger enter-full-screen event."),this.isFullScreen=!0,this.event.emit(Hk.FULLSCREEN_STATUS_CHANGED,{isFullScreen:!0,isPause:this.videoElement.paused})):(Qv.info(_P,"trigger exit-full-screen event."),this.isFullScreen=!1,this.event.emit(Hk.FULLSCREEN_STATUS_CHANGED,{isFullScreen:!1,isPause:this.videoElement.paused}))):document[this.supportFullScreenApi.fullscreenElement]?(Qv.info(_P,"trigger enter-full-screen event."),this.isFullScreen=!0,this.event.emit(Hk.FULLSCREEN_STATUS_CHANGED,{isFullScreen:!0,isPause:this.videoElement.paused})):(Qv.info(_P,"trigger exit-full-screen event."),this.isFullScreen=!1,this.event.emit(Hk.FULLSCREEN_STATUS_CHANGED,{isFullScreen:!1,isPause:this.videoElement.paused}))};BC.isSafari()?setInterval(e,100):document.addEventListener(this.supportFullScreenApi.fullscreenchange,e)}};class bP{constructor(){this.context_=new AudioContext,this.script_=this.context_.createScriptProcessor(2048,1,1),this.script_.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0);let r=0,i=0;for(let n=0;n<t.length;n++)r+=t[n]*t[n],Math.abs(t[n])>.99&&(i+=1);this.instant_=Math.sqrt(r/t.length),this.slow_=.95*this.slow_+.05*this.instant_,this.clip_=i/t.length},this.instant_=0,this.slow_=0,this.clip_=0}connectToSource(e){return new Promise(((t,r)=>{try{const r=new MediaStream;r.addTrack(e),this.mic_=this.context_.createMediaStreamSource(r),this.mic_.connect(this.script_),this.script_.connect(this.context_.destination),t()}catch(i){r(i)}}))}stop(){this.mic_.disconnect(),this.script_.disconnect(),this.context_.close()}getVolume(){return parseFloat(this.instant_.toFixed(2))}}class RP{constructor(e){this.module_="RTCPlayer",this.mediaStream_=new MediaStream,this.track_=e.track,this.playerDiv_=e.playerDiv,this.playerId_=e.playerId,this.playerElement_=null,this.state_="NONE",this.manualPauseFlag_=!1,this.event_=new wk,this.pauseCount=0,this.customEvent=document.createEvent("CustomEvent"),this.customEvent.initEvent("appPause"),this.listenHandlers={canPlayHandler:this.canPlayHandler.bind(this),playingHandler:this.playingHandler.bind(this),playerEndedHandler:this.playerEndedHandler.bind(this),playerPausedHandler:this.playerPausedHandler.bind(this),trackEndedHandler:this.trackEndedHandler.bind(this),trackMutedHandler:this.trackMutedHandler.bind(this),trackUnmutedHandler:this.trackUnmutedHandler.bind(this),playHandler:null,backgroundHandler:this.backgroundHandler.bind(this),foregroundHandler:this.foregroundHandler.bind(this),appPauseHandler:this.appPauseHandler.bind(this),playInterruptHandler:null},this.deBounceHandlers={videoHandler:Zv.debounce((()=>{Qv.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, player is paused"),this.event_.emit(Bk,{event:"playerPause",type:"".concat(this.module_),streamId:this.playerId_}),this.state_="PAUSED",Qv.debug("".concat(this.module_,"#").concat(this.playerId_),"try to play again"),this.event_.emit("videoCanPlay")}),800,!1),audioHandler:Zv.debounce((()=>{Qv.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, player is paused"),this.event_.emit(Bk,{event:"playerPause",type:"".concat(this.module_),streamId:this.playerId_}),this.state_="PAUSED",Qv.debug("".concat(this.module_,"#").concat(this.playerId_),"try to play again"),this.event_.emit("audioCanPlay")}),800,!1)}}on(e,t){this.event_.on(e,t)}off(e,t){this.event_.removeListener(e,t)}stop(){this.closeAllEvents(),clearTimeout(this.playTimeOutTimer),this.playerElement_&&(this.playerElement_.srcObject=null),this.playerElement_=null,this.mediaStream_=new MediaStream,this.manualPauseFlag_=!1,this.event_.emit("playInterrupt"),Qv.info(this.module_,"stop success")}replaceTrack(e){Qv.info(this.module_,"replaceTrack start");const t=this.module_.indexOf("Audio")>0?this.mediaStream_.getAudioTracks():this.mediaStream_.getVideoTracks(),r=t.length?t[0]:null;r!==e&&(r&&this.mediaStream_.removeTrack(r),this.mediaStream_.addTrack(e),this.track_=e,this.manualPauseFlag_=!1)}async resume(e){return this.manualPauseFlag_=!1,new Promise(((t,r)=>{this.playerElement_?this.playerElement_.play().then((()=>{Qv.info(this.module_,"audio player resume success, streamId:".concat(this.playerId_,", playParameters: ").concat(JSON.stringify(e))),t(null)})).catch((t=>{Qv.error(this.module_,"player resume failed, errmsg=".concat(t," , playParameters: ").concat(JSON.stringify(e))),"NotAllowedError"===t.name?r(new xh(Ph.HWLLS_PLAY_NOT_ALLOW)):r(new xh(Ph.HWLLS_INTERNAL_ERROR,t.message))})):r(new xh(Ph.HWLLS_INTERNAL_ERROR,"resume failed, element is null"))}))}pause(){this.playerElement_&&(this.playerElement_.pause(),"STOPPED"!==this.state_&&(this.manualPauseFlag_=!0))}async doPlay(e,t,r){let i;return this.manualPauseFlag_=!1,await vP.multiPlatformAdapter(),i=this.module_.indexOf("Video")>0?", screenFit:".concat(r.objectFit):", volume:".concat(r.volume,", muted:").concat(r.muted),this.playerElement_.play().then((()=>{var t,r;Qv.info(this.module_,"play success, parentDiv id:".concat(null===(t=this.playerDiv_)||void 0===t?void 0:t.id,", resolutionId or streamId:").concat(this.playerId_,", physical track id:").concat(null===(r=this.track_)||void 0===r?void 0:r.id).concat(i)),this.afterPlayStrategy(),e(null)})).catch((e=>{var r,n;Qv.error(this.module_,"play failed, errmsg=".concat(e,",parentDiv id:").concat(null===(r=this.playerDiv_)||void 0===r?void 0:r.id,", resolutionId or streamId:").concat(this.playerId_,", physical track id:").concat(null===(n=this.track_)||void 0===n?void 0:n.id).concat(i)),"NotAllowedError"===e.name?t(new xh(Ph.HWLLS_PLAY_NOT_ALLOW)):t(new xh(Ph.HWLLS_INTERNAL_ERROR,e.message))})).finally((()=>{clearTimeout(this.playTimeOutTimer),this.listenHandlers.playInterruptHandler&&this.event_.removeListener("playInterrupt",this.listenHandlers.playInterruptHandler)}))}closeAllEvents(){var e,t,r,i,n,s,a,o,l,c;null===(e=this.playerElement_)||void 0===e||e.removeEventListener("canplay",this.listenHandlers.canPlayHandler),null===(t=this.playerElement_)||void 0===t||t.removeEventListener("playing",this.listenHandlers.playingHandler),null===(r=this.playerElement_)||void 0===r||r.removeEventListener("ended",this.listenHandlers.playerEndedHandler),null===(i=this.playerElement_)||void 0===i||i.removeEventListener("pause",this.listenHandlers.playerPausedHandler),null===(n=this.playerElement_)||void 0===n||n.removeEventListener("appPause",this.listenHandlers.appPauseHandler),this.deBounceHandlers.videoHandler.cancel(),this.deBounceHandlers.audioHandler.cancel(),null===(s=this.track_)||void 0===s||s.removeEventListener("ended",this.listenHandlers.trackEndedHandler),null===(a=this.track_)||void 0===a||a.removeEventListener("mute",this.listenHandlers.trackMutedHandler),null===(o=this.track_)||void 0===o||o.removeEventListener("unmute",this.listenHandlers.trackUnmutedHandler),this.listenHandlers.playHandler&&(null===(l=this.event_)||void 0===l||l.removeListener("videoCanPlay",this.listenHandlers.playHandler)),this.listenHandlers.playHandler&&(null===(c=this.event_)||void 0===c||c.removeListener("audioCanPlay",this.listenHandlers.playHandler)),this.event_.removeListener("FOREGROUND",this.listenHandlers.foregroundHandler),this.event_.removeListener("BACKGROUND",this.listenHandlers.backgroundHandler),yP.unregister(this.sysEventRegisterUid)}handleEvents(){this.playerElement_.addEventListener("canplay",this.listenHandlers.canPlayHandler),this.playerElement_.addEventListener("playing",this.listenHandlers.playingHandler),this.playerElement_.addEventListener("ended",this.listenHandlers.playerEndedHandler),this.playerElement_.addEventListener("pause",this.listenHandlers.playerPausedHandler),this.playerElement_.addEventListener("appPause",this.listenHandlers.appPauseHandler),this.track_.addEventListener("ended",this.listenHandlers.trackEndedHandler),this.track_.addEventListener("mute",this.listenHandlers.trackMutedHandler),this.track_.addEventListener("unmute",this.listenHandlers.trackUnmutedHandler),this.event_.on("FOREGROUND",this.listenHandlers.foregroundHandler),this.event_.on("BACKGROUND",this.listenHandlers.backgroundHandler),this.sysEventRegisterUid=yP.register(this.event_)}playInterruptHandler(e){e(new xh(Ph.HWLLS_INTERNAL_ERROR,"AbortError: The play() request was interrupted by a new load request."))}afterPlayStrategy(){if(!this.pauseCount&&Zv.getPlatform().indexOf("Ios 15")>=0){Qv.error(this.module_,Zv.getPlatform());const e=setTimeout((()=>{clearTimeout(e),this.playerElement_.pause(),this.pauseCount++}),100)}}appPauseHandler(){this.manualPauseFlag_=!0}foregroundHandler(){Qv.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, application is foreground"),this.event_.emit(Bk,{event:"foreground",type:this.module_}),this.module_.indexOf("Audio")>0&&this.track_&&this.trackEnable!==this.track_.enabled&&(this.track_.enabled=this.trackEnable),"PAUSED"===this.state_&&(this.module_.indexOf("Video")>0?this.event_.emit("videoCanPlay"):this.event_.emit("audioCanPlay"))}backgroundHandler(){Qv.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, application is background"),this.event_.emit(Bk,{event:"background",type:this.module_}),this.module_.indexOf("Audio")>0&&this.track_&&(this.trackEnable=this.track_.enabled,this.trackEnable&&(this.track_.enabled=!1))}canPlayHandler(){Qv.info("".concat(this.module_,"#").concat(this.playerId_),"[KPI] handleEvents, player is canplay status"),this.event_.emit(this.module_.indexOf("Video")>0?"videoCanPlay":"audioCanPlay"),this.module_.indexOf("Video")&&(this.videoBufferedReday=!0),this.event_.emit(Bk,{event:"playerCanplay",type:"".concat(this.module_),streamId:this.playerId_})}playingHandler(e){if(Qv.info("".concat(this.module_,"#").concat(this.playerId_),"[KPI] handleEvents, player is starting playing"),this.event_.emit(Bk,{event:"playerPlaying",type:"".concat(this.module_),streamId:this.playerId_}),this.state_="PLAYING",this.manualPauseFlag_=!1,TP.getFullScreenStatus()&&(!e.target.offsetParent||/^(<body>|<div\sid="player_container").*/.test(e.target.offsetParent.outerHTML))&&this.module_.indexOf("Video")>0){var t;const e=null===(t=this.playerDiv_)||void 0===t?void 0:t.querySelector("#audio_".concat(this.playerId_));return null==e||e.play(),void this.event_.emit(Hk.FULLSCREEN_STATUS_CHANGED,{isFullScreen:TP.getFullScreenStatus(),isPause:!1})}}playerEndedHandler(){Qv.info("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, player is ended"),this.event_.emit(Bk,{event:"playerEnded",type:"".concat(this.module_),streamId:this.playerId_}),"STOPPED"!==this.state_&&(this.state_="STOPPED")}playerPausedHandler(e){if(!this.manualPauseFlag_)if(TP.getFullScreenStatus()&&(!e.target.offsetParent||/^(<body>|<div\sid="player_container").*/.test(e.target.offsetParent.outerHTML))&&this.playerElement_.paused&&this.module_.indexOf("Video")>0){var t;const e=null===(t=this.playerDiv_)||void 0===t?void 0:t.querySelector("#audio_".concat(this.playerId_));e&&(e.dispatchEvent(this.customEvent),e.pause(),this.event_.emit(Hk.FULLSCREEN_STATUS_CHANGED,{isFullScreen:TP.getFullScreenStatus(),isPause:!0}))}else this.module_.indexOf("Video")>0?this.deBounceHandlers.videoHandler.exec():this.deBounceHandlers.audioHandler.exec()}trackEndedHandler(){Qv.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, player track is ended"),this.event_.emit(Bk,{event:"trackEnded",type:"".concat(this.module_),streamId:this.playerId_}),"STOPPED"!==this.state_&&(this.state_="STOPPED")}trackMutedHandler(){Qv.debug("".concat(this.module_,"#").concat(this.playerId_),"handleEvents, track is muted"),this.event_.emit(Bk,{event:"trackMute",type:"".concat(this.module_),streamId:this.playerId_}),"PAUSED"!==this.state_&&(this.state_="PAUSED")}trackUnmutedHandler(){Qv.debug("".concat(this.module_,"#[").concat(this.playerId_,"]"),"handleEvents, track is unmuted"),this.event_.emit(Bk,{event:"trackUnmute",type:"".concat(this.module_),streamId:this.playerId_}),"PAUSED"===this.state_&&(this.state_="PLAYING")}}class wP extends RP{constructor(e){super({track:e.track,playerDiv:e.playerDiv,playerId:e.playerId}),this.module_="RTCAudioPlayer",this.muted_=e.muted,this.volume_="number"==typeof(null==e?void 0:e.volume)?e.volume:.5,this.soundMeter_=null,this.autoPlay_=e.autoPlay}async play(){return new Promise(((e,t)=>{let r,i=!0;var n;(r=this.playerDiv_?this.playerDiv_.querySelector("#audio_".concat(this.playerId_)):this.playerElement_,r)||(r=document.createElement("audio"),r.muted=this.muted_,r.setAttribute("id","audio_".concat(this.playerId_)),this.autoPlay_&&r.setAttribute("autoplay",""),r.setAttribute("playsinline",""),r.setAttribute("webkit-playsinline",""),null===(n=this.playerDiv_)||void 0===n||n.appendChild(r),i=!1);0===this.mediaStream_.getAudioTracks().length&&this.mediaStream_.addTrack(this.track_),r.srcObject=this.mediaStream_,this.playerElement_=r,this.muted_?this.playerElement_.muted=!0:this.setVolume(this.volume_),this.addFirstFrameCallBackListener(),this.closeAllEvents(),this.handleEvents(),this.autoPlay_&&(clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{Qv.info(this.module_,"trigger audioCanPlay event by Timer"),this.event_.emit("audioCanPlay"),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{Qv.info(this.module_,"audio playing timeout"),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=null,t(new xh(Ph.HWLLS_PLAY_TIMEOUT))}),i?1e4:9e3)}),i?0:1e3),this.listenHandlers.playHandler&&this.event_.removeListener("audioCanPlay",this.listenHandlers.playHandler),this.listenHandlers.playHandler=this.doPlay.bind(this,e,t,{volume:this.volume_,muted:this.muted_}),this.event_.on("audioCanPlay",this.listenHandlers.playHandler))}))}isMuted(){var e;return Boolean(null===(e=this.playerElement_)||void 0===e?void 0:e.muted)}muteAudio(e){this.playerElement_.muted=e}setVolume(e){this.playerElement_.muted=!1,Number.isNaN(e)?this.playerElement_.volume=this.volume_:this.playerElement_.volume=e}getAudioLevel(){return this.soundMeter_||(this.soundMeter_=new bP,this.soundMeter_.connectToSource(this.track_)),this.soundMeter_.getVolume()}stop(){super.stop(),this.soundMeter_&&(this.soundMeter_.stop(),this.soundMeter_=null)}async resume(){return super.resume({streamId:this.playerId_,volume:this.volume_,muted:this.muted_})}replaceTrack(e){super.replaceTrack(e),this.soundMeter_&&(this.soundMeter_.stop(),this.soundMeter_=null)}async addFirstFrameCallBackListener(){if(!window.MediaStreamTrackProcessor)return;const e=new MediaStreamTrackProcessor({track:this.track_}).readable.getReader(),{done:t,value:r}=await e.read();t&&this.playerElement_&&(Qv.debug(this.module_,"first audio frame received."),this.event_.emit(Hk.AUDIO_START),null==r||r.close())}}class AP extends RP{constructor(e){super({track:e.track,playerDiv:e.parentDiv,playerId:e.playerId}),this.module_="RTCVideoPlayer",this.objectFit_=e.objectFit,this.loadingUtils=new EP(e.parentDiv),this.autoPlay_=e.autoPlay,this.videoBufferedReday=!1,this.showLoading=e.showLoading,this.poster_=e.poster,this.poster_&&(SP.attachPoster(e.parentDiv,this.poster_.url,this.poster_.mode||Ok.FILL),!this.autoPlay_&&this.poster_.startEnable&&SP.disPlayPoster(!0,this.poster_.url))}async play(){return new Promise(((e,t)=>{let r=this.playerDiv_.querySelector("#video_".concat(this.playerId_)),i=!0;r||(r=document.createElement("video"),r.muted=!0,r.setAttribute("id","video_".concat(this.playerId_)),r.style.width="100%",r.style.height="100%",r.style.position="absolute",r.style["object-fit"]=this.objectFit_,this.autoPlay_&&r.setAttribute("autoplay",""),r.setAttribute("playsinline",""),r.setAttribute("webkit-playsinline",""),Zv.isTencentX5BrowserKernel()&&r.setAttribute("x5-playsinline",""),r.setAttribute("muted",""),this.playerDiv_.appendChild(r),i=!1),0===this.mediaStream_.getVideoTracks().length&&this.mediaStream_.addTrack(this.track_),r.srcObject=this.mediaStream_,this.playerElement_=r,this.addFirstFrameCallBackListener(),this.closeAllEvents(),this.handleEvents(),this.autoPlay_&&(clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{Qv.info(this.module_,"trigger videoCanPlay event by Timer"),this.event_.emit("videoCanPlay"),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{Qv.info(this.module_,"video playing timeout"),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=null,t(new xh(Ph.HWLLS_PLAY_TIMEOUT)),this.listenHandlers.playInterruptHandler&&this.event_.removeListener("playInterrupt",this.listenHandlers.playInterruptHandler)}),i?1e4:9e3)}),i?0:1e3),this.module_.indexOf("Video")>0&&(this.listenHandlers.playInterruptHandler&&this.event_.removeListener("playInterrupt",this.listenHandlers.playInterruptHandler),this.listenHandlers.playInterruptHandler=this.playInterruptHandler.bind(this,t),this.event_.once("playInterrupt",this.listenHandlers.playInterruptHandler)),this.listenHandlers.playHandler&&this.event_.removeListener("videoCanPlay",this.listenHandlers.playHandler),this.listenHandlers.playHandler=this.doPlay.bind(this,e,t,{objectFit:this.objectFit_}),this.event_.on("videoCanPlay",this.listenHandlers.playHandler))}))}async resume(){return this.poster_&&SP.disPlayPoster(!1,this.poster_.url),this.manualStartedPlay()||(this.listenHandlers.playHandler&&this.event_.removeListener("videoCanPlay",this.listenHandlers.playHandler),this.listenHandlers.playHandler=()=>{this.loadingMask(!1),this.resume()},this.event_.on("videoCanPlay",this.listenHandlers.playHandler),!this.videoBufferedReday&&this.showLoading&&this.loadingMask(!0),await vP.multiPlatformAdapter()),await super.resume({streamId:this.playerId_,screentFit:this.objectFit_})}pause(){var e;super.pause(),null!==(e=this.poster_)&&void 0!==e&&e.pauseEnable&&SP.disPlayPoster(!0,this.poster_.url)}stop(){super.stop(),this.loadingUtils.stopLoadingMask(),this.poster_&&SP.detachPoster(this.playerDiv_,this.poster_.url),this.videoBufferedReday=!1}loadingMask(e){e?(this.autoPlay_||this.manualStartedPlay())&&this.loadingUtils.loadingMask(!0):this.loadingUtils.loadingMask(!1)}addFirstFrameCallBackListener(){this.playerElement_.requestVideoFrameCallback&&this.playerElement_.requestVideoFrameCallback((()=>{Qv.debug(this.module_,"first video frame received."),this.event_.emit(Hk.VIDEO_START)}))}exitFullScreen(){TP.exitFullScreen()}enterFullScreen(){TP.enterFullScreen(this.playerDiv_,this.playerElement_,this.event_)}manualStartedPlay(){return this.event_.eventNames().includes("videoCanPlay")}}var LP=function(e){return e[e.Playing=0]="Playing",e[e.Closed=1]="Closed",e}(LP||{});const CP="HLLSTrack";class IP{constructor(e){this.trackType_=e.trackType,this.track_=e.track,this.playState_=LP.Closed,this.trackMuted_=!1,this.event_=e.event||new wk,this.trackId_=Zv.generateStandardUuid(),this.trackType_===Pk.TRACK_TYPE_AUDIO?this.audioStart=()=>{this.event_.emit(Hk.AUDIO_START)}:(this.videoStart=()=>{this.event_.emit(Hk.VIDEO_START)},this.loadingHandler=e=>{var t,r;this.showLoading&&(e?null===(t=this.player_)||void 0===t||t.loadingMask(!0):null===(r=this.player_)||void 0===r||r.loadingMask(!1))},this.fullScreenStatusHandler=e=>{this.event_.emit(Hk.FULLSCREEN_STATUS_CHANGED,e)}),this.statusTraceReporter_=e=>{this.event_.emit(Bk,e)}}getTrackType(){return this.trackType_}getTrackId(){return this.trackId_}getElementId(){return this.elementId_}getObjectFit(){return this.objectFit_}getTrack(){return this.track_}async replaceTrack(e){var t;e&&(null===(t=this.player_)||void 0===t||t.replaceTrack(e),this.track_=e,this.track_.enabled=!this.trackMuted_)}removeTrack(){this.player_&&this.player_.stop(),this.track_=null}async play(e,t,r){const i=this.getTrackType();if(Qv.info(CP,"".concat(i," track begin play, elementId: ").concat(t,", playerDiv.id: ").concat(e.id,", options: ").concat(JSON.stringify(r)," ")),this.playState_===LP.Playing)return Qv.info(CP,"".concat(i," track is playing, return ")),{trackType:i,error:null};if(!this.track_)return Qv.error(CP,"".concat(i," track is empty")),{trackType:i,error:new xh(Ph.HWLLS_INTERNAL_ERROR,"".concat(i," track is empty"))};switch(this.elementId_=t,this.trackType_){case Pk.TRACK_TYPE_AUDIO:this.player_||(Qv.info(CP,"create AudioPlayer"),this.player_=new wP({playerDiv:e,playerId:"player",track:this.track_,muted:r.muted,volume:this.audioVolume_,autoPlay:r.autoPlay}));break;case Pk.TRACK_TYPE_VIDEO:this.objectFit_=r.objectFit,this.showLoading=r.showLoading,this.player_||(Qv.info(CP,"create VideoPlayer"),this.player_=new AP({parentDiv:e,playerId:"player",track:this.track_,objectFit:r.objectFit,autoPlay:r.autoPlay,showLoading:r.showLoading,poster:r.poster}),r.showLoading&&this.player_.loadingMask(!0))}this.trackType_===Pk.TRACK_TYPE_AUDIO?(this.player_.off(Hk.AUDIO_START,this.audioStart),this.player_.on(Hk.AUDIO_START,this.audioStart)):(this.player_.off(Hk.VIDEO_START,this.videoStart),this.player_.on(Hk.VIDEO_START,this.videoStart),this.player_.off(Hk.FULLSCREEN_STATUS_CHANGED,this.fullScreenStatusHandler),this.player_.on(Hk.FULLSCREEN_STATUS_CHANGED,this.fullScreenStatusHandler),this.event_.removeListener(Hk.VIDEO_STUCK,this.loadingHandler),this.event_.on(Hk.VIDEO_STUCK,this.loadingHandler)),this.player_.off(Bk,this.statusTraceReporter_),this.player_.on(Bk,this.statusTraceReporter_),Qv.info(CP,"play ".concat(i," track start")),this.playState_=LP.Playing;try{return await this.player_.play(),{trackType:i,error:null}}catch(IU){const t=IU instanceof xh&&/.*timeout.*/i.test(IU.getMsg());return Qv[t?"warn":"error"](CP,"play ".concat(i," failed: ").concat(IU," ")),t||(this.playState_=LP.Closed),{trackType:i,error:IU}}}stop(){this.player_?(this.trackType_===Pk.TRACK_TYPE_AUDIO?this.player_.off(Hk.AUDIO_START,this.audioStart):(this.player_.off(Hk.VIDEO_START,this.videoStart),this.event_.removeListener(Hk.VIDEO_STUCK,this.loadingHandler)),this.player_.stop(),this.player_=null,this.trackMuted_=!1,Qv.info(CP,"".concat(this.getTrackType()," stop player success")),this.elementId_="",Qv.info(CP,"".concat(this.getTrackType()," close success")),this.playState_=LP.Closed):Qv.info(CP,"".concat(this.getTrackType()," player is null"))}async resume(){if(!this.player_)throw Qv.info(CP,"".concat(this.getTrackType()," player is null")),new xh(Ph.HWLLS_INTERNAL_ERROR,"".concat(this.getTrackType()," player is null"));try{await this.player_.resume()}catch(IU){throw Qv.error(CP,"".concat(this.getTrackType()," resume failed: ").concat(IU," ")),IU}}pause(){if(!this.player_)throw Qv.info(CP,"".concat(this.getTrackType()," player is null")),new xh(Ph.HWLLS_INTERNAL_ERROR,"".concat(this.getTrackType()," player is null"));this.player_.pause()}getTrackMuted(){return this.track_?!this.track_.enabled:this.trackMuted_}muteTrack(){this.track_&&(this.track_.enabled=!1),this.trackMuted_=!0}unmuteTrack(){this.track_&&(this.track_.enabled=!0),this.player_.isMuted&&this.player_.isMuted()&&this.player_.setVolume(),this.trackMuted_=!1}muteAudio(e){this.player_.muteAudio(e)}setAudioVolume(e){this.trackType_===Pk.TRACK_TYPE_AUDIO&&(this.audioVolume_=e/100,this.player_&&this.player_.setVolume(this.audioVolume_))}getAudioLevel(){return this.trackType_===Pk.TRACK_TYPE_AUDIO&&this.player_?this.player_.getAudioLevel():0}async replay(){if(!this.player_)throw Qv.info(CP,"".concat(this.getTrackType()," player is null")),new xh(Ph.HWLLS_INTERNAL_ERROR,"".concat(this.getTrackType()," player is null"));this.trackType_===Pk.TRACK_TYPE_AUDIO?(this.player_.off(Hk.AUDIO_START,this.audioStart),this.player_.on(Hk.AUDIO_START,this.audioStart)):(this.player_.off(Hk.VIDEO_START,this.videoStart),this.player_.on(Hk.VIDEO_START,this.videoStart),this.player_.off(Hk.FULLSCREEN_STATUS_CHANGED,this.fullScreenStatusHandler),this.player_.on(Hk.FULLSCREEN_STATUS_CHANGED,this.fullScreenStatusHandler),this.event_.removeListener(Hk.VIDEO_STUCK,this.loadingHandler),this.event_.on(Hk.VIDEO_STUCK,this.loadingHandler)),this.player_.off(Bk,this.statusTraceReporter_),this.player_.on(Bk,this.statusTraceReporter_),Qv.info(CP,"rePlay ".concat(this.getTrackType()," track start")),this.playState_=LP.Playing;try{await this.player_.play()}catch(IU){throw Qv.error(CP,"replay".concat(this.getTrackType(),", replay failed: ").concat(IU)),this.playState_=LP.Closed,IU}}exitFullScreen(){var e;this.trackType_!==Pk.TRACK_TYPE_AUDIO&&(null===(e=this.player_)||void 0===e||e.exitFullScreen())}enterFullScreen(){var e;this.trackType_!==Pk.TRACK_TYPE_AUDIO&&(null===(e=this.player_)||void 0===e||e.enterFullScreen())}loadingMask(e){var t;this.trackType_!==Pk.TRACK_TYPE_AUDIO&&this.showLoading&&(null===(t=this.player_)||void 0===t||t.loadingMask(e))}}const kP="RemoteStream";class DP extends kD{constructor(e,t){super(kP,e,t),this.traceHandler=this.playerStatusTrace.bind(this)}async play(e){if(e.objectFit){if(e.objectFit&&!/^cover|contain|fill$/.test(e.objectFit))throw Qv.error(kP,"invalid play options.objectFit: ".concat(e.objectFit)),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER,"invalid play options.objectFit: ".concat(e.objectFit))}else e.objectFit=Gk.CONTAIN;if(e.muted=!!e.muted,Qv.info(kP,"stream start to play with elementId: ".concat(e.elementId,", options.objectFit: ").concat(e.objectFit,", options.muted: ").concat(e.muted)),!e.elementId)throw Qv.error(kP,"elementId:".concat(e.elementId," not a invalid HTMLElement Id")),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER,"elementId:".concat(e.elementId," not a invalid HTMLElement Id"));const t=document.getElementById(e.elementId);if(!t)throw Qv.error(kP,"document.getElementById by elementId:".concat(e.elementId," failed")),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER,"document.getElementById by elementId:".concat(e.elementId," failed"));let r=t.querySelector("#player_container");r?Qv.info(kP,"exist player div"):(this.playDivContainer||(r=document.createElement("div"),r.setAttribute("id","player_container"),r.style.width="100%",r.style.height="100%",r.style.position="relative",r.style.overflow="hidden",r.style["background-color"]="#000",this.playDivContainer=r),t.appendChild(this.playDivContainer),Qv.info(kP,"new player div")),await this.playTracks(r,e)}async resume(){Qv.info(kP,"resume begin"),await Promise.all([this.resumeAudio(),this.resumeVideo()])}pause(){Qv.info(kP,"pause begin"),this.pauseAudio(),this.pauseVideo()}stop(){var e,t;Qv.info(kP,"stop stream begin"),null===(e=this.audioTrack)||void 0===e||e.stop(),null===(t=this.videoTrack)||void 0===t||t.stop(),Qv.info(kP,"stop stream end")}muteAudio(){try{return!!this.audioTrack&&(this.audioTrack.muteTrack(),!0)}catch(IU){return Qv.error(kP,"muteAudio failed: ".concat(IU)),!1}}muteVideo(){try{return!!this.videoTrack&&(this.videoTrack.muteTrack(),!0)}catch(IU){return Qv.error(kP,"muteVideo failed: ".concat(IU)),!1}}unmuteAudio(){try{return!!this.audioTrack&&(this.audioTrack.unmuteTrack(),!0)}catch(IU){return Qv.error(kP,"unmuteAudio failed: ".concat(IU)),!1}}unmuteVideo(){try{return!!this.videoTrack&&(this.videoTrack.unmuteTrack(),!0)}catch(IU){return Qv.error(kP,"unmuteVideo failed: ".concat(IU)),!1}}setAudioVolume(e){this.audioTrack&&this.audioTrack.setAudioVolume(e)}getAudioLevel(){return this.audioTrack?this.audioTrack.getAudioLevel():0}getAudioHRTCTrack(){return this.audioTrack}getVideoHRTCTrack(){return this.videoTrack}hasAudio(){return!!this.getAudioHRTCTrack()}hasVideo(){return!!this.getVideoHRTCTrack()}addRemoteTrack(e){e.kind===Pk.TRACK_TYPE_AUDIO?this.audioTrack?this.audioTrack.replaceTrack(e):this.audioTrack=new IP({trackType:Pk.TRACK_TYPE_AUDIO,track:e,event:this.eventEmitter}):this.videoTrack?this.videoTrack.replaceTrack(e):this.videoTrack=new IP({trackType:Pk.TRACK_TYPE_VIDEO,track:e,event:this.eventEmitter}),Qv.info(kP,"addRemoteTrack for ".concat(e.kind," success"))}destory(){var e;this.off(Bk,this.traceHandler,!0),this.stop(),null===(e=this.playDivContainer)||void 0===e||e.remove(),this.playDivContainer=null}resumeAudio(){var e;return null===(e=this.audioTrack)||void 0===e?void 0:e.resume()}resumeVideo(){var e;return null===(e=this.videoTrack)||void 0===e?void 0:e.resume()}pauseAudio(){var e;null===(e=this.audioTrack)||void 0===e||e.pause()}pauseVideo(){var e;null===(e=this.videoTrack)||void 0===e||e.pause()}exitFullScreen(){var e;null===(e=this.videoTrack)||void 0===e||e.exitFullScreen()}enterFullScreen(){var e;null===(e=this.videoTrack)||void 0===e||e.enterFullScreen()}playerStatusTrace(e){var t;(Qv.debug(kP,"playerStatusTrace, ".concat(JSON.stringify(e))),e&&"playerPlaying"===e.event&&"RTCVideoPlayer"===e.type)&&(null!==(t=this.videoTrack)&&void 0!==t&&t.getTrack()&&this.videoTrack.loadingMask(!1))}async playTracks(e,t){var r,i;const n=[];if(t.video&&null!==(r=this.videoTrack)&&void 0!==r&&r.getTrack()&&n.push(this.videoTrack.play(e,t.elementId,{objectFit:t.objectFit,showLoading:t.showLoading,autoPlay:!1!==t.autoPlay,poster:t.poster})),t.audio&&null!==(i=this.audioTrack)&&void 0!==i&&i.getTrack()&&n.push(this.audioTrack.play(e,t.elementId,{muted:t.muted,autoPlay:!1!==t.autoPlay})),0===n.length)throw Qv.warn(kP,"no available track for play"),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER,"no available track to play.");this.off(Bk,this.traceHandler,!0),this.on(Bk,this.traceHandler,!0),await Promise.all(n).then((e=>{const t=e.filter((e=>null!==e.error));if(t.length>0)throw t[0].error}))}}class PP{static checkUrlFormat(e,t){return(t=t||zk.WEBRTC)===zk.WEBRTC?/webrtc:\/\/[^\/]*\/[^\/]*\/[^\/]+/gi.test(e):t===zk.FLV?/(https?|wss?):\/\/[^\/]*\/[^\/]*\/[^\/]+/gi.test(e):t===zk.HLS&&/https?:\/\/[^\/]*\/[^\/]*\/[^\/]+/gi.test(e)}static checkPlayOpt(e){return!!e.elementId&&(!(Object.prototype.hasOwnProperty.call(e,"objectFit")&&!["cover","contain","fill"].includes(e.objectFit))&&((!e.webrtcConfig||!1!==e.webrtcConfig.receiveAudio||!1!==e.webrtcConfig.receiveVideo)&&!(Object.prototype.hasOwnProperty.call(e,"domainPolicy")&&![Kk.SHARE_DOMAIN,Kk.USER_DOMIAN].includes(e.domainPolicy))))}static getStringBytes(e){if(!e)return 0;let t=0;if(window.TextEncoder){return t=(new TextEncoder).encode(e).length,t}const r=e.length;for(let i=0;i<r;i++)e.charCodeAt(i)>255?t+=2:t++;return t}}
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function OP(e){let t=e.length;for(;--t>=0;)e[t]=0}const xP=256,MP=286,NP=30,FP=15,UP=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),BP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),HP=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),jP=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),VP=new Array(576);OP(VP);const GP=new Array(60);OP(GP);const zP=new Array(512);OP(zP);const KP=new Array(256);OP(KP);const WP=new Array(29);OP(WP);const $P=new Array(NP);function YP(e,t,r,i,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=e&&e.length}let qP,ZP,XP;function JP(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}OP($P);const QP=e=>e<256?zP[e]:zP[256+(e>>>7)],eO=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},tO=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,eO(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},rO=(e,t,r)=>{tO(e,r[2*t],r[2*t+1])},iO=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},nO=(e,t,r)=>{const i=new Array(16);let n,s,a=0;for(n=1;n<=FP;n++)a=a+r[n-1]<<1,i[n]=a;for(s=0;s<=t;s++){let t=e[2*s+1];0!==t&&(e[2*s]=iO(i[t]++,t))}},sO=e=>{let t;for(t=0;t<MP;t++)e.dyn_ltree[2*t]=0;for(t=0;t<NP;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},aO=e=>{e.bi_valid>8?eO(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},oO=(e,t,r,i)=>{const n=2*t,s=2*r;return e[n]<e[s]||e[n]===e[s]&&i[t]<=i[r]},lO=(e,t,r)=>{const i=e.heap[r];let n=r<<1;for(;n<=e.heap_len&&(n<e.heap_len&&oO(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!oO(t,i,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=i},cO=(e,t,r)=>{let i,n,s,a,o=0;if(0!==e.sym_next)do{i=255&e.pending_buf[e.sym_buf+o++],i+=(255&e.pending_buf[e.sym_buf+o++])<<8,n=e.pending_buf[e.sym_buf+o++],0===i?rO(e,n,t):(s=KP[n],rO(e,s+xP+1,t),a=UP[s],0!==a&&(n-=WP[s],tO(e,n,a)),i--,s=QP(i),rO(e,s,r),a=BP[s],0!==a&&(i-=$P[s],tO(e,i,a)))}while(o<e.sym_next);rO(e,256,t)},dO=(e,t)=>{const r=t.dyn_tree,i=t.stat_desc.static_tree,n=t.stat_desc.has_stree,s=t.stat_desc.elems;let a,o,l,c=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<s;a++)0!==r[2*a]?(e.heap[++e.heap_len]=c=a,e.depth[a]=0):r[2*a+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,r[2*l]=1,e.depth[l]=0,e.opt_len--,n&&(e.static_len-=i[2*l+1]);for(t.max_code=c,a=e.heap_len>>1;a>=1;a--)lO(e,r,a);l=s;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],lO(e,r,1),o=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=o,r[2*l]=r[2*a]+r[2*o],e.depth[l]=(e.depth[a]>=e.depth[o]?e.depth[a]:e.depth[o])+1,r[2*a+1]=r[2*o+1]=l,e.heap[1]=l++,lO(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const r=t.dyn_tree,i=t.max_code,n=t.stat_desc.static_tree,s=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,d,u,h,f,p,m=0;for(h=0;h<=FP;h++)e.bl_count[h]=0;for(r[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)d=e.heap[c],h=r[2*r[2*d+1]+1]+1,h>l&&(h=l,m++),r[2*d+1]=h,d>i||(e.bl_count[h]++,f=0,d>=o&&(f=a[d-o]),p=r[2*d],e.opt_len+=p*(h+f),s&&(e.static_len+=p*(n[2*d+1]+f)));if(0!==m){do{for(h=l-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[l]--,m-=2}while(m>0);for(h=l;0!==h;h--)for(d=e.bl_count[h];0!==d;)u=e.heap[--c],u>i||(r[2*u+1]!==h&&(e.opt_len+=(h-r[2*u+1])*r[2*u],r[2*u+1]=h),d--)}})(e,t),nO(r,c,e.bl_count)},uO=(e,t,r)=>{let i,n,s=-1,a=t[1],o=0,l=7,c=4;for(0===a&&(l=138,c=3),t[2*(r+1)+1]=65535,i=0;i<=r;i++)n=a,a=t[2*(i+1)+1],++o<l&&n===a||(o<c?e.bl_tree[2*n]+=o:0!==n?(n!==s&&e.bl_tree[2*n]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,s=n,0===a?(l=138,c=3):n===a?(l=6,c=3):(l=7,c=4))},hO=(e,t,r)=>{let i,n,s=-1,a=t[1],o=0,l=7,c=4;for(0===a&&(l=138,c=3),i=0;i<=r;i++)if(n=a,a=t[2*(i+1)+1],!(++o<l&&n===a)){if(o<c)do{rO(e,n,e.bl_tree)}while(0!=--o);else 0!==n?(n!==s&&(rO(e,n,e.bl_tree),o--),rO(e,16,e.bl_tree),tO(e,o-3,2)):o<=10?(rO(e,17,e.bl_tree),tO(e,o-3,3)):(rO(e,18,e.bl_tree),tO(e,o-11,7));o=0,s=n,0===a?(l=138,c=3):n===a?(l=6,c=3):(l=7,c=4)}};let fO=!1;const pO=(e,t,r,i)=>{tO(e,0+(i?1:0),3),aO(e),eO(e,r),eO(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var mO=(e,t,r,i)=>{let n,s,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<xP;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),dO(e,e.l_desc),dO(e,e.d_desc),a=(e=>{let t;for(uO(e,e.dyn_ltree,e.l_desc.max_code),uO(e,e.dyn_dtree,e.d_desc.max_code),dO(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*jP[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),n=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=n&&(n=s)):n=s=r+5,r+4<=n&&-1!==t?pO(e,t,r,i):4===e.strategy||s===n?(tO(e,2+(i?1:0),3),cO(e,VP,GP)):(tO(e,4+(i?1:0),3),((e,t,r,i)=>{let n;for(tO(e,t-257,5),tO(e,r-1,5),tO(e,i-4,4),n=0;n<i;n++)tO(e,e.bl_tree[2*jP[n]+1],3);hO(e,e.dyn_ltree,t-1),hO(e,e.dyn_dtree,r-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),cO(e,e.dyn_ltree,e.dyn_dtree)),sO(e),i&&aO(e)},gO={_tr_init:e=>{fO||((()=>{let e,t,r,i,n;const s=new Array(16);for(r=0,i=0;i<28;i++)for(WP[i]=r,e=0;e<1<<UP[i];e++)KP[r++]=i;for(KP[r-1]=i,n=0,i=0;i<16;i++)for($P[i]=n,e=0;e<1<<BP[i];e++)zP[n++]=i;for(n>>=7;i<NP;i++)for($P[i]=n<<7,e=0;e<1<<BP[i]-7;e++)zP[256+n++]=i;for(t=0;t<=FP;t++)s[t]=0;for(e=0;e<=143;)VP[2*e+1]=8,e++,s[8]++;for(;e<=255;)VP[2*e+1]=9,e++,s[9]++;for(;e<=279;)VP[2*e+1]=7,e++,s[7]++;for(;e<=287;)VP[2*e+1]=8,e++,s[8]++;for(nO(VP,287,s),e=0;e<NP;e++)GP[2*e+1]=5,GP[2*e]=iO(e,5);qP=new YP(VP,UP,257,MP,FP),ZP=new YP(GP,BP,0,NP,FP),XP=new YP(new Array(0),HP,0,19,7)})(),fO=!0),e.l_desc=new JP(e.dyn_ltree,qP),e.d_desc=new JP(e.dyn_dtree,ZP),e.bl_desc=new JP(e.bl_tree,XP),e.bi_buf=0,e.bi_valid=0,sO(e)},_tr_stored_block:pO,_tr_flush_block:mO,_tr_tally:(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(KP[r]+xP+1)]++,e.dyn_dtree[2*QP(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{tO(e,2,3),rO(e,256,VP),(e=>{16===e.bi_valid?(eO(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var yO=(e,t,r,i)=>{let n=65535&e,s=e>>>16&65535,a=0;for(;0!==r;){a=r>2e3?2e3:r,r-=a;do{n=n+t[i++]|0,s=s+n|0}while(--a);n%=65521,s%=65521}return n|s<<16};const _O=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var vO=(e,t,r,i)=>{const n=_O,s=i+r;e^=-1;for(let a=i;a<s;a++)e=e>>>8^n[255&(e^t[a])];return~e},EO={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},SO={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:TO,_tr_stored_block:bO,_tr_flush_block:RO,_tr_tally:wO,_tr_align:AO}=gO,{Z_NO_FLUSH:LO,Z_PARTIAL_FLUSH:CO,Z_FULL_FLUSH:IO,Z_FINISH:kO,Z_BLOCK:DO,Z_OK:PO,Z_STREAM_END:OO,Z_STREAM_ERROR:xO,Z_DATA_ERROR:MO,Z_BUF_ERROR:NO,Z_DEFAULT_COMPRESSION:FO,Z_FILTERED:UO,Z_HUFFMAN_ONLY:BO,Z_RLE:HO,Z_FIXED:jO,Z_DEFAULT_STRATEGY:VO,Z_UNKNOWN:GO,Z_DEFLATED:zO}=SO,KO=258,WO=262,$O=42,YO=113,qO=666,ZO=(e,t)=>(e.msg=EO[t],t),XO=e=>2*e-(e>4?9:0),JO=e=>{let t=e.length;for(;--t>=0;)e[t]=0},QO=e=>{let t,r,i,n=e.w_size;t=e.hash_size,i=t;do{r=e.head[--i],e.head[i]=r>=n?r-n:0}while(--t);t=n,i=t;do{r=e.prev[--i],e.prev[i]=r>=n?r-n:0}while(--t)};let ex=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const tx=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},rx=(e,t)=>{RO(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,tx(e.strm)},ix=(e,t)=>{e.pending_buf[e.pending++]=t},nx=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},sx=(e,t,r,i)=>{let n=e.avail_in;return n>i&&(n=i),0===n?0:(e.avail_in-=n,t.set(e.input.subarray(e.next_in,e.next_in+n),r),1===e.state.wrap?e.adler=yO(e.adler,t,n,r):2===e.state.wrap&&(e.adler=vO(e.adler,t,n,r)),e.next_in+=n,e.total_in+=n,n)},ax=(e,t)=>{let r,i,n=e.max_chain_length,s=e.strstart,a=e.prev_length,o=e.nice_match;const l=e.strstart>e.w_size-WO?e.strstart-(e.w_size-WO):0,c=e.window,d=e.w_mask,u=e.prev,h=e.strstart+KO;let f=c[s+a-1],p=c[s+a];e.prev_length>=e.good_match&&(n>>=2),o>e.lookahead&&(o=e.lookahead);do{if(r=t,c[r+a]===p&&c[r+a-1]===f&&c[r]===c[s]&&c[++r]===c[s+1]){s+=2,r++;do{}while(c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&s<h);if(i=KO-(h-s),s=h-KO,i>a){if(e.match_start=t,a=i,i>=o)break;f=c[s+a-1],p=c[s+a]}}}while((t=u[t&d])>l&&0!=--n);return a<=e.lookahead?a:e.lookahead},ox=e=>{const t=e.w_size;let r,i,n;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-WO)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),QO(e),i+=t),0===e.strm.avail_in)break;if(r=sx(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=3)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=ex(e,e.ins_h,e.window[n+1]);e.insert&&(e.ins_h=ex(e,e.ins_h,e.window[n+3-1]),e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<WO&&0!==e.strm.avail_in)},lx=(e,t)=>{let r,i,n,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,o=e.strm.avail_in;do{if(r=65535,n=e.bi_valid+42>>3,e.strm.avail_out<n)break;if(n=e.strm.avail_out-n,i=e.strstart-e.block_start,r>i+e.strm.avail_in&&(r=i+e.strm.avail_in),r>n&&(r=n),r<s&&(0===r&&t!==kO||t===LO||r!==i+e.strm.avail_in))break;a=t===kO&&r===i+e.strm.avail_in?1:0,bO(e,0,0,a),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,tx(e.strm),i&&(i>r&&(i=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,r-=i),r&&(sx(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(0===a);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==LO&&t!==kO&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(n=e.window_size-e.strstart,e.strm.avail_in>n&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,n+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),n>e.strm.avail_in&&(n=e.strm.avail_in),n&&(sx(e.strm,e.window,e.strstart,n),e.strstart+=n,e.insert+=n>e.w_size-e.insert?e.w_size-e.insert:n),e.high_water<e.strstart&&(e.high_water=e.strstart),n=e.bi_valid+42>>3,n=e.pending_buf_size-n>65535?65535:e.pending_buf_size-n,s=n>e.w_size?e.w_size:n,i=e.strstart-e.block_start,(i>=s||(i||t===kO)&&t!==LO&&0===e.strm.avail_in&&i<=n)&&(r=i>n?n:i,a=t===kO&&0===e.strm.avail_in&&r===i?1:0,bO(e,e.block_start,r,a),e.block_start+=r,tx(e.strm)),a?3:1)},cx=(e,t)=>{let r,i;for(;;){if(e.lookahead<WO){if(ox(e),e.lookahead<WO&&t===LO)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=ex(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-WO&&(e.match_length=ax(e,r)),e.match_length>=3)if(i=wO(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=ex(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ex(e,e.ins_h,e.window[e.strstart+1]);else i=wO(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(rx(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===kO?(rx(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(rx(e,!1),0===e.strm.avail_out)?1:2},dx=(e,t)=>{let r,i,n;for(;;){if(e.lookahead<WO){if(ox(e),e.lookahead<WO&&t===LO)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=ex(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-WO&&(e.match_length=ax(e,r),e.match_length<=5&&(e.strategy===UO||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,i=wO(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=ex(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(rx(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(i=wO(e,0,e.window[e.strstart-1]),i&&rx(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=wO(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===kO?(rx(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(rx(e,!1),0===e.strm.avail_out)?1:2};function ux(e,t,r,i,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=n}const hx=[new ux(0,0,0,0,lx),new ux(4,4,8,4,cx),new ux(4,5,16,8,cx),new ux(4,6,32,32,cx),new ux(4,4,16,16,dx),new ux(8,16,32,32,dx),new ux(8,16,128,128,dx),new ux(8,32,128,256,dx),new ux(32,128,258,1024,dx),new ux(32,258,258,4096,dx)];function fx(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=zO,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),JO(this.dyn_ltree),JO(this.dyn_dtree),JO(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),JO(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),JO(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const px=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==$O&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==YO&&t.status!==qO?1:0},mx=e=>{if(px(e))return ZO(e,xO);e.total_in=e.total_out=0,e.data_type=GO;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?$O:YO,e.adler=2===t.wrap?0:1,t.last_flush=-2,TO(t),PO},gx=e=>{const t=mx(e);var r;return t===PO&&((r=e.state).window_size=2*r.w_size,JO(r.head),r.max_lazy_match=hx[r.level].max_lazy,r.good_match=hx[r.level].good_length,r.nice_match=hx[r.level].nice_length,r.max_chain_length=hx[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),t},yx=(e,t,r,i,n,s)=>{if(!e)return xO;let a=1;if(t===FO&&(t=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),n<1||n>9||r!==zO||i<8||i>15||t<0||t>9||s<0||s>jO||8===i&&1!==a)return ZO(e,xO);8===i&&(i=9);const o=new fx;return e.state=o,o.strm=e,o.status=$O,o.wrap=a,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=n+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<n+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=s,o.method=r,gx(e)};var _x=(e,t)=>px(e)||2!==e.state.wrap?xO:(e.state.gzhead=t,PO),vx=(e,t)=>{if(px(e)||t>DO||t<0)return e?ZO(e,xO):xO;const r=e.state;if(!e.output||0!==e.avail_in&&!e.input||r.status===qO&&t!==kO)return ZO(e,0===e.avail_out?NO:xO);const i=r.last_flush;if(r.last_flush=t,0!==r.pending){if(tx(e),0===e.avail_out)return r.last_flush=-1,PO}else if(0===e.avail_in&&XO(t)<=XO(i)&&t!==kO)return ZO(e,NO);if(r.status===qO&&0!==e.avail_in)return ZO(e,NO);if(r.status===$O&&0===r.wrap&&(r.status=YO),r.status===$O){let t=zO+(r.w_bits-8<<4)<<8,i=-1;if(i=r.strategy>=BO||r.level<2?0:r.level<6?1:6===r.level?2:3,t|=i<<6,0!==r.strstart&&(t|=32),t+=31-t%31,nx(r,t),0!==r.strstart&&(nx(r,e.adler>>>16),nx(r,65535&e.adler)),e.adler=1,r.status=YO,tx(e),0!==r.pending)return r.last_flush=-1,PO}if(57===r.status)if(e.adler=0,ix(r,31),ix(r,139),ix(r,8),r.gzhead)ix(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),ix(r,255&r.gzhead.time),ix(r,r.gzhead.time>>8&255),ix(r,r.gzhead.time>>16&255),ix(r,r.gzhead.time>>24&255),ix(r,9===r.level?2:r.strategy>=BO||r.level<2?4:0),ix(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(ix(r,255&r.gzhead.extra.length),ix(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=vO(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(ix(r,0),ix(r,0),ix(r,0),ix(r,0),ix(r,0),ix(r,9===r.level?2:r.strategy>=BO||r.level<2?4:0),ix(r,3),r.status=YO,tx(e),0!==r.pending)return r.last_flush=-1,PO;if(69===r.status){if(r.gzhead.extra){let t=r.pending,i=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+i>r.pending_buf_size;){let n=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+n),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>t&&(e.adler=vO(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex+=n,tx(e),0!==r.pending)return r.last_flush=-1,PO;t=0,i-=n}let n=new Uint8Array(r.gzhead.extra);r.pending_buf.set(n.subarray(r.gzindex,r.gzindex+i),r.pending),r.pending+=i,r.gzhead.hcrc&&r.pending>t&&(e.adler=vO(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let t,i=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>i&&(e.adler=vO(e.adler,r.pending_buf,r.pending-i,i)),tx(e),0!==r.pending)return r.last_flush=-1,PO;i=0}t=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,ix(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>i&&(e.adler=vO(e.adler,r.pending_buf,r.pending-i,i)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let t,i=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>i&&(e.adler=vO(e.adler,r.pending_buf,r.pending-i,i)),tx(e),0!==r.pending)return r.last_flush=-1,PO;i=0}t=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,ix(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>i&&(e.adler=vO(e.adler,r.pending_buf,r.pending-i,i))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(tx(e),0!==r.pending))return r.last_flush=-1,PO;ix(r,255&e.adler),ix(r,e.adler>>8&255),e.adler=0}if(r.status=YO,tx(e),0!==r.pending)return r.last_flush=-1,PO}if(0!==e.avail_in||0!==r.lookahead||t!==LO&&r.status!==qO){let i=0===r.level?lx(r,t):r.strategy===BO?((e,t)=>{let r;for(;;){if(0===e.lookahead&&(ox(e),0===e.lookahead)){if(t===LO)return 1;break}if(e.match_length=0,r=wO(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(rx(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===kO?(rx(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(rx(e,!1),0===e.strm.avail_out)?1:2})(r,t):r.strategy===HO?((e,t)=>{let r,i,n,s;const a=e.window;for(;;){if(e.lookahead<=KO){if(ox(e),e.lookahead<=KO&&t===LO)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=e.strstart-1,i=a[n],i===a[++n]&&i===a[++n]&&i===a[++n])){s=e.strstart+KO;do{}while(i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&n<s);e.match_length=KO-(s-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=wO(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=wO(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(rx(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===kO?(rx(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(rx(e,!1),0===e.strm.avail_out)?1:2})(r,t):hx[r.level].func(r,t);if(3!==i&&4!==i||(r.status=qO),1===i||3===i)return 0===e.avail_out&&(r.last_flush=-1),PO;if(2===i&&(t===CO?AO(r):t!==DO&&(bO(r,0,0,!1),t===IO&&(JO(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),tx(e),0===e.avail_out))return r.last_flush=-1,PO}return t!==kO?PO:r.wrap<=0?OO:(2===r.wrap?(ix(r,255&e.adler),ix(r,e.adler>>8&255),ix(r,e.adler>>16&255),ix(r,e.adler>>24&255),ix(r,255&e.total_in),ix(r,e.total_in>>8&255),ix(r,e.total_in>>16&255),ix(r,e.total_in>>24&255)):(nx(r,e.adler>>>16),nx(r,65535&e.adler)),tx(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?PO:OO)},Ex={deflateInit:(e,t)=>yx(e,t,zO,15,8,VO),deflateInit2:yx,deflateReset:gx,deflateResetKeep:mx,deflateSetHeader:_x,deflate:vx,deflateEnd:e=>{if(px(e))return xO;const t=e.state.status;return e.state=null,t===YO?ZO(e,MO):PO},deflateSetDictionary:(e,t)=>{let r=t.length;if(px(e))return xO;const i=e.state,n=i.wrap;if(2===n||1===n&&i.status!==$O||i.lookahead)return xO;if(1===n&&(e.adler=yO(e.adler,t,r,0)),i.wrap=0,r>=i.w_size){0===n&&(JO(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(r-i.w_size,r),0),t=e,r=i.w_size}const s=e.avail_in,a=e.next_in,o=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,ox(i);i.lookahead>=3;){let e=i.strstart,t=i.lookahead-2;do{i.ins_h=ex(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--t);i.strstart=e,i.lookahead=2,ox(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=a,e.input=o,e.avail_in=s,i.wrap=n,PO},deflateInfo:"pako deflate (from Nodeca project)"};const Sx=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Tx={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const t in r)Sx(r,t)&&(e[t]=r[t])}}return e},flattenChunks:e=>{let t=0;for(let i=0,n=e.length;i<n;i++)t+=e[i].length;const r=new Uint8Array(t);for(let i=0,n=0,s=e.length;i<s;i++){let t=e[i];r.set(t,n),n+=t.length}return r}};let bx=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(kU){bx=!1}const Rx=new Uint8Array(256);for(let DU=0;DU<256;DU++)Rx[DU]=DU>=252?6:DU>=248?5:DU>=240?4:DU>=224?3:DU>=192?2:1;Rx[254]=Rx[254]=1;var wx={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,i,n,s,a=e.length,o=0;for(n=0;n<a;n++)r=e.charCodeAt(n),55296==(64512&r)&&n+1<a&&(i=e.charCodeAt(n+1),56320==(64512&i)&&(r=65536+(r-55296<<10)+(i-56320),n++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(o),s=0,n=0;s<o;n++)r=e.charCodeAt(n),55296==(64512&r)&&n+1<a&&(i=e.charCodeAt(n+1),56320==(64512&i)&&(r=65536+(r-55296<<10)+(i-56320),n++)),r<128?t[s++]=r:r<2048?(t[s++]=192|r>>>6,t[s++]=128|63&r):r<65536?(t[s++]=224|r>>>12,t[s++]=128|r>>>6&63,t[s++]=128|63&r):(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63,t[s++]=128|r>>>6&63,t[s++]=128|63&r);return t},buf2string:(e,t)=>{const r=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,n;const s=new Array(2*r);for(n=0,i=0;i<r;){let t=e[i++];if(t<128){s[n++]=t;continue}let a=Rx[t];if(a>4)s[n++]=65533,i+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&i<r;)t=t<<6|63&e[i++],a--;a>1?s[n++]=65533:t<65536?s[n++]=t:(t-=65536,s[n++]=55296|t>>10&1023,s[n++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&bx)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let i=0;i<t;i++)r+=String.fromCharCode(e[i]);return r})(s,n)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+Rx[e[r]]>t?r:t}};var Ax=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Lx=Object.prototype.toString,{Z_NO_FLUSH:Cx,Z_SYNC_FLUSH:Ix,Z_FULL_FLUSH:kx,Z_FINISH:Dx,Z_OK:Px,Z_STREAM_END:Ox,Z_DEFAULT_COMPRESSION:xx,Z_DEFAULT_STRATEGY:Mx,Z_DEFLATED:Nx}=SO;function Fx(e){this.options=Tx.assign({level:xx,method:Nx,chunkSize:16384,windowBits:15,memLevel:8,strategy:Mx},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ax,this.strm.avail_out=0;let r=Ex.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Px)throw new Error(EO[r]);if(t.header&&Ex.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?wx.string2buf(t.dictionary):"[object ArrayBuffer]"===Lx.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=Ex.deflateSetDictionary(this.strm,e),r!==Px)throw new Error(EO[r]);this._dict_set=!0}}function Ux(e,t){const r=new Fx(t);if(r.push(e,!0),r.err)throw r.msg||EO[r.err];return r.result}Fx.prototype.push=function(e,t){const r=this.strm,i=this.options.chunkSize;let n,s;if(this.ended)return!1;for(s=t===~~t?t:!0===t?Dx:Cx,"string"==typeof e?r.input=wx.string2buf(e):"[object ArrayBuffer]"===Lx.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),(s===Ix||s===kx)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(n=Ex.deflate(r,s),n===Ox)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),n=Ex.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Px;if(0!==r.avail_out){if(s>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},Fx.prototype.onData=function(e){this.chunks.push(e)},Fx.prototype.onEnd=function(e){e===Px&&(this.result=Tx.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Bx={Deflate:Fx,deflate:Ux,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Ux(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Ux(e,t)},constants:SO};const Hx=16209;var jx=function(e,t){let r,i,n,s,a,o,l,c,d,u,h,f,p,m,g,y,_,v,E,S,T,b,R,w;const A=e.state;r=e.next_in,R=e.input,i=r+(e.avail_in-5),n=e.next_out,w=e.output,s=n-(t-e.avail_out),a=n+(e.avail_out-257),o=A.dmax,l=A.wsize,c=A.whave,d=A.wnext,u=A.window,h=A.hold,f=A.bits,p=A.lencode,m=A.distcode,g=(1<<A.lenbits)-1,y=(1<<A.distbits)-1;e:do{f<15&&(h+=R[r++]<<f,f+=8,h+=R[r++]<<f,f+=8),_=p[h&g];t:for(;;){if(v=_>>>24,h>>>=v,f-=v,v=_>>>16&255,0===v)w[n++]=65535&_;else{if(!(16&v)){if(64&v){if(32&v){A.mode=16191;break e}e.msg="invalid literal/length code",A.mode=Hx;break e}_=p[(65535&_)+(h&(1<<v)-1)];continue t}for(E=65535&_,v&=15,v&&(f<v&&(h+=R[r++]<<f,f+=8),E+=h&(1<<v)-1,h>>>=v,f-=v),f<15&&(h+=R[r++]<<f,f+=8,h+=R[r++]<<f,f+=8),_=m[h&y];;){if(v=_>>>24,h>>>=v,f-=v,v=_>>>16&255,16&v){if(S=65535&_,v&=15,f<v&&(h+=R[r++]<<f,f+=8,f<v&&(h+=R[r++]<<f,f+=8)),S+=h&(1<<v)-1,S>o){e.msg="invalid distance too far back",A.mode=Hx;break e}if(h>>>=v,f-=v,v=n-s,S>v){if(v=S-v,v>c&&A.sane){e.msg="invalid distance too far back",A.mode=Hx;break e}if(T=0,b=u,0===d){if(T+=l-v,v<E){E-=v;do{w[n++]=u[T++]}while(--v);T=n-S,b=w}}else if(d<v){if(T+=l+d-v,v-=d,v<E){E-=v;do{w[n++]=u[T++]}while(--v);if(T=0,d<E){v=d,E-=v;do{w[n++]=u[T++]}while(--v);T=n-S,b=w}}}else if(T+=d-v,v<E){E-=v;do{w[n++]=u[T++]}while(--v);T=n-S,b=w}for(;E>2;)w[n++]=b[T++],w[n++]=b[T++],w[n++]=b[T++],E-=3;E&&(w[n++]=b[T++],E>1&&(w[n++]=b[T++]))}else{T=n-S;do{w[n++]=w[T++],w[n++]=w[T++],w[n++]=w[T++],E-=3}while(E>2);E&&(w[n++]=w[T++],E>1&&(w[n++]=w[T++]))}break}if(64&v){e.msg="invalid distance code",A.mode=Hx;break e}_=m[(65535&_)+(h&(1<<v)-1)]}}break}}while(r<i&&n<a);E=f>>3,r-=E,f-=E<<3,h&=(1<<f)-1,e.next_in=r,e.next_out=n,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=n<a?a-n+257:257-(n-a),A.hold=h,A.bits=f};const Vx=15,Gx=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),zx=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Kx=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Wx=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var $x=(e,t,r,i,n,s,a,o)=>{const l=o.bits;let c,d,u,h,f,p,m=0,g=0,y=0,_=0,v=0,E=0,S=0,T=0,b=0,R=0,w=null;const A=new Uint16Array(16),L=new Uint16Array(16);let C,I,k,D=null;for(m=0;m<=Vx;m++)A[m]=0;for(g=0;g<i;g++)A[t[r+g]]++;for(v=l,_=Vx;_>=1&&0===A[_];_--);if(v>_&&(v=_),0===_)return n[s++]=20971520,n[s++]=20971520,o.bits=1,0;for(y=1;y<_&&0===A[y];y++);for(v<y&&(v=y),T=1,m=1;m<=Vx;m++)if(T<<=1,T-=A[m],T<0)return-1;if(T>0&&(0===e||1!==_))return-1;for(L[1]=0,m=1;m<Vx;m++)L[m+1]=L[m]+A[m];for(g=0;g<i;g++)0!==t[r+g]&&(a[L[t[r+g]]++]=g);if(0===e?(w=D=a,p=20):1===e?(w=Gx,D=zx,p=257):(w=Kx,D=Wx,p=0),R=0,g=0,m=y,f=s,E=v,S=0,u=-1,b=1<<v,h=b-1,1===e&&b>852||2===e&&b>592)return 1;for(;;){C=m-S,a[g]+1<p?(I=0,k=a[g]):a[g]>=p?(I=D[a[g]-p],k=w[a[g]-p]):(I=96,k=0),c=1<<m-S,d=1<<E,y=d;do{d-=c,n[f+(R>>S)+d]=C<<24|I<<16|k}while(0!==d);for(c=1<<m-1;R&c;)c>>=1;if(0!==c?(R&=c-1,R+=c):R=0,g++,0==--A[m]){if(m===_)break;m=t[r+a[g]]}if(m>v&&(R&h)!==u){for(0===S&&(S=v),f+=y,E=m-S,T=1<<E;E+S<_&&(T-=A[E+S],!(T<=0));)E++,T<<=1;if(b+=1<<E,1===e&&b>852||2===e&&b>592)return 1;u=R&h,n[u]=v<<24|E<<16|f-s}}return 0!==R&&(n[f+R]=m-S<<24|64<<16),o.bits=v,0};const{Z_FINISH:Yx,Z_BLOCK:qx,Z_TREES:Zx,Z_OK:Xx,Z_STREAM_END:Jx,Z_NEED_DICT:Qx,Z_STREAM_ERROR:eM,Z_DATA_ERROR:tM,Z_MEM_ERROR:rM,Z_BUF_ERROR:iM,Z_DEFLATED:nM}=SO,sM=16180,aM=16190,oM=16191,lM=16192,cM=16194,dM=16199,uM=16200,hM=16206,fM=16209,pM=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function mM(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const gM=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<sM||t.mode>16211?1:0},yM=e=>{if(gM(e))return eM;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=sM,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Xx},_M=e=>{if(gM(e))return eM;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,yM(e)},vM=(e,t)=>{let r;if(gM(e))return eM;const i=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?eM:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,_M(e))},EM=(e,t)=>{if(!e)return eM;const r=new mM;e.state=r,r.strm=e,r.window=null,r.mode=sM;const i=vM(e,t);return i!==Xx&&(e.state=null),i};let SM,TM,bM=!0;const RM=e=>{if(bM){SM=new Int32Array(512),TM=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for($x(1,e.lens,0,288,SM,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;$x(2,e.lens,0,32,TM,0,e.work,{bits:5}),bM=!1}e.lencode=SM,e.lenbits=9,e.distcode=TM,e.distbits=5},wM=(e,t,r,i)=>{let n;const s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(t.subarray(r-s.wsize,r),0),s.wnext=0,s.whave=s.wsize):(n=s.wsize-s.wnext,n>i&&(n=i),s.window.set(t.subarray(r-i,r-i+n),s.wnext),(i-=n)?(s.window.set(t.subarray(r-i,r),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=n,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=n))),0};var AM=(e,t)=>{let r,i,n,s,a,o,l,c,d,u,h,f,p,m,g,y,_,v,E,S,T,b,R=0;const w=new Uint8Array(4);let A,L;const C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(gM(e)||!e.output||!e.input&&0!==e.avail_in)return eM;r=e.state,r.mode===oM&&(r.mode=lM),a=e.next_out,n=e.output,l=e.avail_out,s=e.next_in,i=e.input,o=e.avail_in,c=r.hold,d=r.bits,u=o,h=l,b=Xx;e:for(;;)switch(r.mode){case sM:if(0===r.wrap){r.mode=lM;break}for(;d<16;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}if(2&r.wrap&&35615===c){0===r.wbits&&(r.wbits=15),r.check=0,w[0]=255&c,w[1]=c>>>8&255,r.check=vO(r.check,w,2,0),c=0,d=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",r.mode=fM;break}if((15&c)!==nM){e.msg="unknown compression method",r.mode=fM;break}if(c>>>=4,d-=4,T=8+(15&c),0===r.wbits&&(r.wbits=T),T>15||T>r.wbits){e.msg="invalid window size",r.mode=fM;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&c?16189:oM,c=0,d=0;break;case 16181:for(;d<16;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}if(r.flags=c,(255&r.flags)!==nM){e.msg="unknown compression method",r.mode=fM;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=fM;break}r.head&&(r.head.text=c>>8&1),512&r.flags&&4&r.wrap&&(w[0]=255&c,w[1]=c>>>8&255,r.check=vO(r.check,w,2,0)),c=0,d=0,r.mode=16182;case 16182:for(;d<32;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}r.head&&(r.head.time=c),512&r.flags&&4&r.wrap&&(w[0]=255&c,w[1]=c>>>8&255,w[2]=c>>>16&255,w[3]=c>>>24&255,r.check=vO(r.check,w,4,0)),c=0,d=0,r.mode=16183;case 16183:for(;d<16;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}r.head&&(r.head.xflags=255&c,r.head.os=c>>8),512&r.flags&&4&r.wrap&&(w[0]=255&c,w[1]=c>>>8&255,r.check=vO(r.check,w,2,0)),c=0,d=0,r.mode=16184;case 16184:if(1024&r.flags){for(;d<16;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}r.length=c,r.head&&(r.head.extra_len=c),512&r.flags&&4&r.wrap&&(w[0]=255&c,w[1]=c>>>8&255,r.check=vO(r.check,w,2,0)),c=0,d=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(f=r.length,f>o&&(f=o),f&&(r.head&&(T=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(i.subarray(s,s+f),T)),512&r.flags&&4&r.wrap&&(r.check=vO(r.check,i,f,s)),o-=f,s+=f,r.length-=f),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===o)break e;f=0;do{T=i[s+f++],r.head&&T&&r.length<65536&&(r.head.name+=String.fromCharCode(T))}while(T&&f<o);if(512&r.flags&&4&r.wrap&&(r.check=vO(r.check,i,f,s)),o-=f,s+=f,T)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===o)break e;f=0;do{T=i[s+f++],r.head&&T&&r.length<65536&&(r.head.comment+=String.fromCharCode(T))}while(T&&f<o);if(512&r.flags&&4&r.wrap&&(r.check=vO(r.check,i,f,s)),o-=f,s+=f,T)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;d<16;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}if(4&r.wrap&&c!==(65535&r.check)){e.msg="header crc mismatch",r.mode=fM;break}c=0,d=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=oM;break;case 16189:for(;d<32;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}e.adler=r.check=pM(c),c=0,d=0,r.mode=aM;case aM:if(0===r.havedict)return e.next_out=a,e.avail_out=l,e.next_in=s,e.avail_in=o,r.hold=c,r.bits=d,Qx;e.adler=r.check=1,r.mode=oM;case oM:if(t===qx||t===Zx)break e;case lM:if(r.last){c>>>=7&d,d-=7&d,r.mode=hM;break}for(;d<3;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}switch(r.last=1&c,c>>>=1,d-=1,3&c){case 0:r.mode=16193;break;case 1:if(RM(r),r.mode=dM,t===Zx){c>>>=2,d-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=fM}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",r.mode=fM;break}if(r.length=65535&c,c=0,d=0,r.mode=cM,t===Zx)break e;case cM:r.mode=16195;case 16195:if(f=r.length,f){if(f>o&&(f=o),f>l&&(f=l),0===f)break e;n.set(i.subarray(s,s+f),a),o-=f,s+=f,l-=f,a+=f,r.length-=f;break}r.mode=oM;break;case 16196:for(;d<14;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}if(r.nlen=257+(31&c),c>>>=5,d-=5,r.ndist=1+(31&c),c>>>=5,d-=5,r.ncode=4+(15&c),c>>>=4,d-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=fM;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;d<3;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}r.lens[C[r.have++]]=7&c,c>>>=3,d-=3}for(;r.have<19;)r.lens[C[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,A={bits:r.lenbits},b=$x(0,r.lens,0,19,r.lencode,0,r.work,A),r.lenbits=A.bits,b){e.msg="invalid code lengths set",r.mode=fM;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;R=r.lencode[c&(1<<r.lenbits)-1],g=R>>>24,y=R>>>16&255,_=65535&R,!(g<=d);){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}if(_<16)c>>>=g,d-=g,r.lens[r.have++]=_;else{if(16===_){for(L=g+2;d<L;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}if(c>>>=g,d-=g,0===r.have){e.msg="invalid bit length repeat",r.mode=fM;break}T=r.lens[r.have-1],f=3+(3&c),c>>>=2,d-=2}else if(17===_){for(L=g+3;d<L;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}c>>>=g,d-=g,T=0,f=3+(7&c),c>>>=3,d-=3}else{for(L=g+7;d<L;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}c>>>=g,d-=g,T=0,f=11+(127&c),c>>>=7,d-=7}if(r.have+f>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=fM;break}for(;f--;)r.lens[r.have++]=T}}if(r.mode===fM)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=fM;break}if(r.lenbits=9,A={bits:r.lenbits},b=$x(1,r.lens,0,r.nlen,r.lencode,0,r.work,A),r.lenbits=A.bits,b){e.msg="invalid literal/lengths set",r.mode=fM;break}if(r.distbits=6,r.distcode=r.distdyn,A={bits:r.distbits},b=$x(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,A),r.distbits=A.bits,b){e.msg="invalid distances set",r.mode=fM;break}if(r.mode=dM,t===Zx)break e;case dM:r.mode=uM;case uM:if(o>=6&&l>=258){e.next_out=a,e.avail_out=l,e.next_in=s,e.avail_in=o,r.hold=c,r.bits=d,jx(e,h),a=e.next_out,n=e.output,l=e.avail_out,s=e.next_in,i=e.input,o=e.avail_in,c=r.hold,d=r.bits,r.mode===oM&&(r.back=-1);break}for(r.back=0;R=r.lencode[c&(1<<r.lenbits)-1],g=R>>>24,y=R>>>16&255,_=65535&R,!(g<=d);){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}if(y&&!(240&y)){for(v=g,E=y,S=_;R=r.lencode[S+((c&(1<<v+E)-1)>>v)],g=R>>>24,y=R>>>16&255,_=65535&R,!(v+g<=d);){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}c>>>=v,d-=v,r.back+=v}if(c>>>=g,d-=g,r.back+=g,r.length=_,0===y){r.mode=16205;break}if(32&y){r.back=-1,r.mode=oM;break}if(64&y){e.msg="invalid literal/length code",r.mode=fM;break}r.extra=15&y,r.mode=16201;case 16201:if(r.extra){for(L=r.extra;d<L;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}r.length+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;R=r.distcode[c&(1<<r.distbits)-1],g=R>>>24,y=R>>>16&255,_=65535&R,!(g<=d);){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}if(!(240&y)){for(v=g,E=y,S=_;R=r.distcode[S+((c&(1<<v+E)-1)>>v)],g=R>>>24,y=R>>>16&255,_=65535&R,!(v+g<=d);){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}c>>>=v,d-=v,r.back+=v}if(c>>>=g,d-=g,r.back+=g,64&y){e.msg="invalid distance code",r.mode=fM;break}r.offset=_,r.extra=15&y,r.mode=16203;case 16203:if(r.extra){for(L=r.extra;d<L;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}r.offset+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=fM;break}r.mode=16204;case 16204:if(0===l)break e;if(f=h-l,r.offset>f){if(f=r.offset-f,f>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=fM;break}f>r.wnext?(f-=r.wnext,p=r.wsize-f):p=r.wnext-f,f>r.length&&(f=r.length),m=r.window}else m=n,p=a-r.offset,f=r.length;f>l&&(f=l),l-=f,r.length-=f;do{n[a++]=m[p++]}while(--f);0===r.length&&(r.mode=uM);break;case 16205:if(0===l)break e;n[a++]=r.length,l--,r.mode=uM;break;case hM:if(r.wrap){for(;d<32;){if(0===o)break e;o--,c|=i[s++]<<d,d+=8}if(h-=l,e.total_out+=h,r.total+=h,4&r.wrap&&h&&(e.adler=r.check=r.flags?vO(r.check,n,h,a-h):yO(r.check,n,h,a-h)),h=l,4&r.wrap&&(r.flags?c:pM(c))!==r.check){e.msg="incorrect data check",r.mode=fM;break}c=0,d=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;d<32;){if(0===o)break e;o--,c+=i[s++]<<d,d+=8}if(4&r.wrap&&c!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=fM;break}c=0,d=0}r.mode=16208;case 16208:b=Jx;break e;case fM:b=tM;break e;case 16210:return rM;default:return eM}return e.next_out=a,e.avail_out=l,e.next_in=s,e.avail_in=o,r.hold=c,r.bits=d,(r.wsize||h!==e.avail_out&&r.mode<fM&&(r.mode<hM||t!==Yx))&&wM(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,r.total+=h,4&r.wrap&&h&&(e.adler=r.check=r.flags?vO(r.check,n,h,e.next_out-h):yO(r.check,n,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(r.mode===oM?128:0)+(r.mode===dM||r.mode===cM?256:0),(0===u&&0===h||t===Yx)&&b===Xx&&(b=iM),b},LM=(e,t)=>{if(gM(e))return eM;const r=e.state;return 2&r.wrap?(r.head=t,t.done=!1,Xx):eM},CM={inflateReset:_M,inflateReset2:vM,inflateResetKeep:yM,inflateInit:e=>EM(e,15),inflateInit2:EM,inflate:AM,inflateEnd:e=>{if(gM(e))return eM;let t=e.state;return t.window&&(t.window=null),e.state=null,Xx},inflateGetHeader:LM,inflateSetDictionary:(e,t)=>{const r=t.length;let i,n,s;return gM(e)?eM:(i=e.state,0!==i.wrap&&i.mode!==aM?eM:i.mode===aM&&(n=1,n=yO(n,t,r,0),n!==i.check)?tM:(s=wM(e,t,r,r),s?(i.mode=16210,rM):(i.havedict=1,Xx)))},inflateInfo:"pako inflate (from Nodeca project)"};var IM=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const kM=Object.prototype.toString,{Z_NO_FLUSH:DM,Z_FINISH:PM,Z_OK:OM,Z_STREAM_END:xM,Z_NEED_DICT:MM,Z_STREAM_ERROR:NM,Z_DATA_ERROR:FM,Z_MEM_ERROR:UM}=SO;function BM(e){this.options=Tx.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ax,this.strm.avail_out=0;let r=CM.inflateInit2(this.strm,t.windowBits);if(r!==OM)throw new Error(EO[r]);if(this.header=new IM,CM.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=wx.string2buf(t.dictionary):"[object ArrayBuffer]"===kM.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=CM.inflateSetDictionary(this.strm,t.dictionary),r!==OM)))throw new Error(EO[r])}function HM(e,t){const r=new BM(t);if(r.push(e),r.err)throw r.msg||EO[r.err];return r.result}BM.prototype.push=function(e,t){const r=this.strm,i=this.options.chunkSize,n=this.options.dictionary;let s,a,o;if(this.ended)return!1;for(a=t===~~t?t:!0===t?PM:DM,"[object ArrayBuffer]"===kM.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),s=CM.inflate(r,a),s===MM&&n&&(s=CM.inflateSetDictionary(r,n),s===OM?s=CM.inflate(r,a):s===FM&&(s=MM));r.avail_in>0&&s===xM&&r.state.wrap>0&&0!==e[r.next_in];)CM.inflateReset(r),s=CM.inflate(r,a);switch(s){case NM:case FM:case MM:case UM:return this.onEnd(s),this.ended=!0,!1}if(o=r.avail_out,r.next_out&&(0===r.avail_out||s===xM))if("string"===this.options.to){let e=wx.utf8border(r.output,r.next_out),t=r.next_out-e,n=wx.buf2string(r.output,e);r.next_out=t,r.avail_out=i-t,t&&r.output.set(r.output.subarray(e,e+t),0),this.onData(n)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(s!==OM||0!==o){if(s===xM)return s=CM.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},BM.prototype.onData=function(e){this.chunks.push(e)},BM.prototype.onEnd=function(e){e===OM&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Tx.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var jM={Inflate:BM,inflate:HM,inflateRaw:function(e,t){return(t=t||{}).raw=!0,HM(e,t)},ungzip:HM,constants:SO};const{Deflate:VM,deflate:GM,deflateRaw:zM,gzip:KM}=Bx,{Inflate:WM,inflate:$M,inflateRaw:YM,ungzip:qM}=jM;var ZM,XM,JM,QM,eN,tN,rN,iN,nN,sN,aN,oN,lN,cN,dN,uN,hN,fN,pN={Deflate:VM,deflate:GM,deflateRaw:zM,gzip:KM,Inflate:WM,inflate:$M,inflateRaw:YM,ungzip:qM,constants:SO};class mN{constructor(e){$l(this,"module_","FlvPlayer"),this.loadingUtils=new EP(e.parentDiv),this.event=e.eventEmitter,this.playerEventHandler={errorHandler:(e,t)=>{if(Qv.error(this.module_,"event ERROR: ".concat(JSON.stringify(e))),this.loadingMask(!1),e===sS.ErrorTypes.NETWORK_ERROR)switch(t){case sS.ErrorDetails.NETWORK_EXCEPTION:this.event.emit("Error",{errCode:Ph.HWLLS_ERROR_SERVER_CONNECT_FAIL,errDesc:Oh[Ph.HWLLS_ERROR_SERVER_CONNECT_FAIL]});break;case sS.ErrorDetails.NETWORK_STATUS_CODE_INVALID:this.event.emit("Error",{errCode:Ph.HWLLS_ERROR_STREAM_NOT_EXIST,errDesc:Oh[Ph.HWLLS_ERROR_STREAM_NOT_EXIST]});break;case sS.ErrorDetails.NETWORK_TIMEOUT:this.event.emit("Error",{errCode:Ph.HWLLS_ERROR_SERVER_NO_RESPONSE,errDesc:Oh[Ph.HWLLS_ERROR_SERVER_NO_RESPONSE]});break;case sS.ErrorDetails.NETWORK_UNRECOVERABLE_EARLY_EOF:this.event.emit("Error",{errCode:Ph.HWLLS_ERROR_UNEXPECTED_EOF,errDesc:Oh[Ph.HWLLS_ERROR_UNEXPECTED_EOF]});break;default:this.event.emit("Error",{errCode:Ph.HWLLS_INTERNAL_ERROR,errDesc:t})}else if(e===sS.ErrorTypes.MEDIA_ERROR){const e=this.getMediaInfo();this.event.emit("Error",{errCode:Ph.HWLLS_ERROR_MEDIA_ERROR,errDesc:"".concat(t,", videoCodec: ").concat(e.videoCodec," and audioCodec: ").concat(e.audioCodec)})}else this.event.emit("Error",{errCode:Ph.HWLLS_INTERNAL_ERROR,errDesc:t||Oh[Ph.HWLLS_INTERNAL_ERROR]})},loadCompleteHandler:()=>{Qv.info(this.module_,"event LOADING_COMPLETE")},unexpectedEOFHandler:e=>{Qv.error(this.module_,"event RECOVERED_EARLY_EOF: ".concat(JSON.stringify(e)))},mediaDataArrived:e=>{Qv.info(this.module_,"event METADATA_ARRIVED: ".concat(JSON.stringify(e))),this.event.emit(Hk.VIDEO_START),this.event.emit(Hk.AUDIO_START),this.loadingMask(!1),this.videoBufferedReday=!0},logHandler:(e,t)=>{const r=e in Qv?Qv[e]:null;"function"==typeof r&&r(this.module_,t)}},this.parentDiv=e.parentDiv,this.objectFit=e.objectFit||Gk.CONTAIN,this.muted=Boolean(e.muted),this.poster_=e.poster,this.createFlvPlayer(e.url),this.initPlayerListener()}async play(e,t){this.autoPlay=!1!==e,this.poster_&&(SP.attachPoster(this.parentDiv,this.poster_.url,this.poster_.mode||Ok.FILL),!this.autoPlay&&this.poster_.startEnable&&SP.disPlayPoster(!0,this.poster_.url)),this.showLoading=t;let r=this.parentDiv.querySelector("#video_player");r||(r=document.createElement("video"),r.setAttribute("id","video_player"),r.style.width="100%",r.style.height="100%",r.style.position="absolute",r.style["object-fit"]=this.objectFit,this.autoPlay&&r.setAttribute("autoplay",""),r.setAttribute("playsinline",""),r.setAttribute("webkit-playsinline",""),Zv.isTencentX5BrowserKernel()&&r.setAttribute("x5-playsinline",""),this.parentDiv.appendChild(r));try{this.player.attachMediaElement(r),this.muted?this.player.muted=!0:this.player.volume=.5,this.player.load(),this.autoPlay&&(t&&this.loadingMask(!0),await this.player.play())}catch(IU){var i;throw Qv.error(this.module_,"play failed, errmsg=".concat(IU,",parentDiv id:").concat(null===(i=this.parentDiv)||void 0===i?void 0:i.id)),"NotAllowedError"===IU.name?new xh(Ph.HWLLS_PLAY_NOT_ALLOW):new xh(Ph.HWLLS_INTERNAL_ERROR,IU.message)}}pause(){var e;this.player&&(this.player.pause(),null!==(e=this.poster_)&&void 0!==e&&e.pauseEnable&&SP.disPlayPoster(!0,this.poster_.url))}async resume(){if(this.poster_&&SP.disPlayPoster(!1,this.poster_.url),this.player)return!this.videoBufferedReday&&this.showLoading&&this.loadingMask(!0),await this.player.play()}mute(e){this.player&&(this.player.muted=e,this.muted=e)}async switchPlay(e){var t;if(this.videoBufferedReday=!1,this.offPlayerListener(),this.player.detachMediaElement(),this.player.unload(),this.player.destroy(),this.poster_=e.poster,this.createFlvPlayer(e.url),this.parentDiv&&this.parentDiv.id!==(null===(t=e.parentDiv)||void 0===t?void 0:t.id)){var r;const t=document.querySelector("#".concat(this.parentDiv.id," #video_player"));t&&this.parentDiv.appendChild(t),null===(r=document.querySelector("#".concat(this.parentDiv.id," #video_player")))||void 0===r||r.remove(),this.parentDiv=e.parentDiv}this.initPlayerListener(),await this.play(e.autoPlay,e.showLoading)}stopPlay(){var e;this.videoBufferedReday=!1,this.loadingUtils.stopLoadingMask(),null===(e=document.querySelector("#".concat(this.parentDiv.id," #video_player")))||void 0===e||e.remove(),this.poster_&&SP.detachPoster(this.parentDiv,this.poster_.url),this.offPlayerListener(),this.player.detachMediaElement(),this.player.unload(),this.player.destroy()}destory(){this.stopPlay(),this.player=null}getPlayoutVolume(){var e,t;return null!==(e=this.player)&&void 0!==e&&e.muted?0:100*((null===(t=this.player)||void 0===t?void 0:t.volume)||0)}setPlayoutVolume(e){return!!this.player&&(this.player.volume=Number((e/100).toFixed(2)),!0)}getMediaInfo(){var e;return null===(e=this.player)||void 0===e?void 0:e.mediaInfo}getStatisticInfo(){var e;return null===(e=this.player)||void 0===e?void 0:e.statisticsInfo}loadingMask(e){e?this.autoPlay&&this.loadingUtils.loadingMask(!0):this.loadingUtils.loadingMask(!1)}exitFullScreen(){TP.exitFullScreen()}enterFullScreen(){TP.enterFullScreen(this.parentDiv,this.parentDiv.querySelector("#video_player"),this.event)}createFlvPlayer(e){this.player=sS.createPlayer({type:"flv",isLive:!0,cors:!0,url:e},{enableWorker:!1,enableStashBuffer:!0,lazyLoad:!1}),sS.LoggingControl.applyConfig({enableAll:!1}),sS.LoggingControl.addLogListener(this.playerEventHandler.logHandler)}initPlayerListener(){this.player.on(sS.Events.ERROR,this.playerEventHandler.errorHandler),this.player.on(sS.Events.LOADING_COMPLETE,this.playerEventHandler.loadCompleteHandler),this.player.on(sS.Events.RECOVERED_EARLY_EOF,this.playerEventHandler.unexpectedEOFHandler),this.player.on(sS.Events.METADATA_ARRIVED,this.playerEventHandler.mediaDataArrived)}offPlayerListener(){var e,t,r,i;null===(e=this.player)||void 0===e||e.off(sS.Events.ERROR,this.playerEventHandler.errorHandler),null===(t=this.player)||void 0===t||t.off(sS.Events.LOADING_COMPLETE,this.playerEventHandler.loadCompleteHandler),null===(r=this.player)||void 0===r||r.off(sS.Events.RECOVERED_EARLY_EOF,this.playerEventHandler.unexpectedEOFHandler),null===(i=this.player)||void 0===i||i.off(sS.Events.METADATA_ARRIVED,this.playerEventHandler.mediaDataArrived),sS.LoggingControl.removeLogListener(this.playerEventHandler.logHandler)}}const gN="HWFlvClient";let yN=(ZM=ck("HWFlvClient$startPlay#Promise<void>#string#StartPlayOptions"),XM=ck("HWFlvClient$switchPlay#Promise<boolean>#string#StartPlayOptions"),JM=dk("HWFlvClient$stopPlay#boolean#void"),QM=ck("HWFlvClient$replay#Promise<boolean>#void"),eN=ck("HWFlvClient$resume#Promise<boolean>#void"),tN=dk("HWFlvClient$pause#boolean#void"),rN=dk("HWFlvClient$pauseVideo#boolean#void"),iN=ck("HWFlvClient$resumeVideo#Promsise<boolean>#void"),nN=dk("HWFlvClient$pauseAudio#boolean#void"),sN=ck("HWFlvClient$resumeAudio#Promsise<boolean>#void"),aN=dk("HWFlvClient$setPlayoutVolume#boolean#number"),oN=dk("HWFlvClient$getPlayoutVolume#number#void"),lN=dk("HWFlvClient$muteAudio#void#boolean"),cN=dk("HWFlvClient$destoryClient#void#void"),dN=dk("HWFlvClient$fullScreenToggle#void#boolean"),uN=dk("HWFlvClient$streamStatistic#void#boolean#number#ExecutableFunction"),hN=dk("HWFlvClient$enableStreamStateDetection#boolean#boolean#number"),fN=class extends kD{constructor(e,t){super(gN,e,t),$l(this,"debugStatisticTimer",{timer:null,interval:1}),$l(this,"detectTimer",{timer:null,interval:3,interruptRetry:null}),$l(this,"recoveryInfo",{recoveryTimer:null,retryTimes:0,recoveryUrl:null})}async startPlay(e,t){Qv.info(gN,"[KPI] startPlay url: ".concat(Qv.shieldUrlParameters(e))),this.startPlayOptions=t,e=e.replace(/\.m3u8/gi,".flv"),this.recoveryInfo.recoveryUrl=e;if(!PP.checkUrlFormat(e,zk.FLV))throw Qv.error(gN,"startPlay failed, invalid Parameter: ".concat(e)),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER);const r=document.getElementById(t.elementId);if(!r)throw Qv.error(gN,"switchPlay failed, invalid Parameter: ".concat(e)),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER,"player Element is not exist.");this.flvPlayer=new mN({eventEmitter:this.eventEmitter,url:e,parentDiv:r,objectFit:t.objectFit,muted:t.muted,poster:this.startPlayOptions.poster}),this.startPlayOptions.poster&&this.startPlayOptions.poster.url&&SP.preLoadPoster(this.startPlayOptions.poster.url),await this.flvPlayer.play(this.startPlayOptions.autoPlay,t.showLoading).catch((e=>{e instanceof xh&&e.getCode()===Ph.HWLLS_PLAY_NOT_ALLOW?this.eventEmitter.emit("Error",{errCode:e.getCode(),errDesc:e.getMsg()}):this.eventEmitter.emit("Error",{errCode:Ph.HWLLS_INTERNAL_ERROR,errDesc:Oh[Ph.HWLLS_INTERNAL_ERROR]})}))}async switchPlay(e,t){clearTimeout(this.debugStatisticTimer.timer),clearTimeout(this.detectTimer.timer),clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.retryTimes=0,Qv.info(gN,"[KPI] switchPlay url: ".concat(Qv.shieldUrlParameters(e))),this.startPlayOptions=t||this.startPlayOptions,e=e.replace(/\.m3u8/gi,".flv"),this.recoveryInfo.recoveryUrl=e;const r=document.getElementById(this.startPlayOptions.elementId);if(!r)throw Qv.error(gN,"switchPlay failed, invalid Parameter: ".concat(e)),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER,"player Element is not exist.");this.startPlayOptions.poster&&this.startPlayOptions.poster.url&&SP.preLoadPoster(this.startPlayOptions.poster.url),await this.flvPlayer.switchPlay({url:e,parentDiv:r,objectFit:this.startPlayOptions.objectFit,muted:this.startPlayOptions.muted,autoPlay:this.startPlayOptions.autoPlay,showLoading:t.showLoading,poster:this.startPlayOptions.poster}).catch((e=>{e instanceof xh&&e.getCode()===Ph.HWLLS_PLAY_NOT_ALLOW?this.eventEmitter.emit("Error",{errCode:e.getCode(),errDesc:e.getMsg()}):this.eventEmitter.emit("Error",{errCode:Ph.HWLLS_INTERNAL_ERROR,errDesc:Oh[Ph.HWLLS_INTERNAL_ERROR]})})),this.debugStatisticTimer.timer&&this.streamStatistic(!0,this.debugStatisticTimer.interval),this.detectTimer.timer&&this.enableStreamStateDetection(!0,this.detectTimer.interval,this.detectTimer.interruptRetry)}stopPlay(){return this.resetPlayer()}async replay(){if(this.flvPlayer)try{return await this.flvPlayer.resume(),!0}catch(IU){return Qv.error(gN,"resume failed: ".concat(IU)),!1}return!1}async resume(){if(this.flvPlayer)try{return await this.flvPlayer.resume(),!0}catch(IU){return Qv.error(gN,"resume failed: ".concat(IU)),!1}return!1}pause(){return!!this.flvPlayer&&(this.flvPlayer.pause(),!0)}pauseVideo(){return Qv.error(gN,"flv player is not support pause video only."),!1}async resumeVideo(){return Qv.error(gN,"flv player is not support resume video only."),!1}pauseAudio(){return!!this.flvPlayer&&(this.flvPlayer.mute(!0),!0)}async resumeAudio(){return!!this.flvPlayer&&(this.flvPlayer.mute(!1),!0)}setPlayoutVolume(e){return!!this.flvPlayer&&(this.flvPlayer.mute(!1),this.flvPlayer.setPlayoutVolume(e),!0)}getPlayoutVolume(){var e;return null===(e=this.flvPlayer)||void 0===e?void 0:e.getPlayoutVolume()}muteAudio(e){var t;null===(t=this.flvPlayer)||void 0===t||t.mute(e)}destoryClient(){var e;null===(e=this.flvPlayer)||void 0===e||e.destory(),this.offAllEvents()}fullScreenToggle(){var e,t;arguments.length>0&&void 0!==arguments[0]&&arguments[0]?null===(e=this.flvPlayer)||void 0===e||e.exitFullScreen():null===(t=this.flvPlayer)||void 0===t||t.enterFullScreen()}on(e,t){[Hk.MEDIA_STATISTIC,Hk.NET_QUALITY].includes(e)?super.on(e,t):super.on(e,t,!0)}off(e,t){[Hk.MEDIA_STATISTIC,Hk.NET_QUALITY].includes(e)?super.off(e,t):super.off(e,t,!0)}streamStatistic(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e){if(!Number.isInteger(t)||t<1||t>60)throw Qv.error(gN,"streamStatistic, invalid parameter of interval."),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER);const e=0;this.getStreamStatisticInfo(e,t)}else clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer={timer:null,interval:1}}enableStreamStateDetection(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2?arguments[2]:void 0;if(!e)return clearTimeout(this.detectTimer.timer),this.detectTimer={timer:null,interval:3,interruptRetry:null},!0;if(!Number.isInteger(t)||t<1||t>60)throw Qv.error(gN,"enableStreamStateDetection, invalid parameter of interval."),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER);clearTimeout(this.detectTimer.timer);const i={preFramesDecoded:0,isInterrupted:!1};var n;this.flvPlayer&&(i.preFramesDecoded=Zv.getValue(null===(n=this.flvPlayer.getStatisticInfo())||void 0===n?void 0:n.decodedFrames,0));return this.detectTimer.interval=t,this.detectTimer.interruptRetry=r,this.judgeStreamInterrupted(i,t,r),!0}judgeStreamInterrupted(e,t,r){this.detectTimer.timer=setTimeout((()=>{clearTimeout(this.detectTimer.timer);let i=null,n=!1;var s,a;this.flvPlayer&&(i=this.flvPlayer.getStatisticInfo(),n=Zv.getValue(null===(s=i)||void 0===s?void 0:s.decodedFrames,0)-Zv.getValue(e.preFramesDecoded,0)<=0,n||(clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.retryTimes=0),i&&(e.preFramesDecoded=Zv.getValue(i.decodedFrames,0)));if(e.isInterrupted&&!n)null===(a=this.flvPlayer)||void 0===a||a.loadingMask(!1),this.eventEmitter.emit(Hk.VIDEO_RECOVERY),this.eventEmitter.emit(Hk.AUDIO_RECOVERY),e.isInterrupted=!1;else if(!e.isInterrupted&&n){var o;this.startPlayOptions.showLoading&&(null===(o=this.flvPlayer)||void 0===o||o.loadingMask(!0)),this.eventEmitter.emit(Hk.VIDEO_INTERRUPTED),this.eventEmitter.emit(Hk.AUDIO_INTERRUPTED),e.isInterrupted=!0,null!=r&&r.enable&&(Qv.info(this.moudle_,"autoRecoverPlay timer start"),clearTimeout(this.recoveryInfo.recoveryTimer),this.autoRecoverPlay(this.recoveryInfo.recoveryUrl,Math.max(10,(null==r?void 0:r.retryInterval)||30),(null==r?void 0:r.retryTimes)||30))}this.judgeStreamInterrupted(e,t,r)}),1e3*t)}autoRecoverPlay(e,t,r){let i=0;this.recoveryInfo.recoveryTimer=setTimeout((async()=>{if(Qv.info(this.moudle_,"autoRecoverPlay every ".concat(t," sencond")),clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.recoveryTimer=null,e===this.recoveryInfo.recoveryUrl)try{this.recoveryInfo.retryTimes++,i=this.recoveryInfo.retryTimes,await this.switchPlay(e)}finally{this.recoveryInfo.retryTimes=i,i<r?this.autoRecoverPlay(e,t,r):this.eventEmitter.emit("Error",{errCode:Ph.HWLLS_PLAY_FLV_RETRY_FAILED,errDesc:Oh[Ph.HWLLS_PLAY_FLV_RETRY_FAILED]})}else this.recoveryInfo.retryTimes=0}),1e3*t)}resetPlayer(){var e;return this.startPlayOptions=null,clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer={timer:null,interval:1},clearTimeout(this.detectTimer.timer),this.detectTimer={timer:null,interval:3,interruptRetry:null},clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo={recoveryTimer:null,retryTimes:0,recoveryUrl:null},null===(e=this.flvPlayer)||void 0===e||e.stopPlay(),!0}getStreamStatisticInfo(e,t){this.debugStatisticTimer.interval=t,this.debugStatisticTimer.timer=setTimeout((()=>{clearTimeout(this.debugStatisticTimer.timer);const r={},i=this.flvPlayer.getMediaInfo();if(i.audioCodec&&(r.audio={mediaType:Pk.TRACK_TYPE_AUDIO,bitRate:Math.round(i.audioDataRate),codec:i.audioCodec}),i.videoCodec){const n=this.flvPlayer.getStatisticInfo();r.video={mediaType:Pk.TRACK_TYPE_VIDEO,codec:i.videoCodec,bitRate:Math.round(i.videoDataRate),frameRate:e>0?Number(((n.decodedFrames-e)/t).toFixed(1)):0,width:Zv.getValue(i.width,0),height:Zv.getValue(i.height,0)},e=n.decodedFrames}this.eventEmitter.emit(Hk.MEDIA_STATISTIC,r),this.getStreamStatisticInfo(e,t)}),1e3*t)}},t(fN.prototype,"startPlay",[ZM],Object.getOwnPropertyDescriptor(fN.prototype,"startPlay"),fN.prototype),t(fN.prototype,"switchPlay",[XM],Object.getOwnPropertyDescriptor(fN.prototype,"switchPlay"),fN.prototype),t(fN.prototype,"stopPlay",[JM],Object.getOwnPropertyDescriptor(fN.prototype,"stopPlay"),fN.prototype),t(fN.prototype,"replay",[QM],Object.getOwnPropertyDescriptor(fN.prototype,"replay"),fN.prototype),t(fN.prototype,"resume",[eN],Object.getOwnPropertyDescriptor(fN.prototype,"resume"),fN.prototype),t(fN.prototype,"pause",[tN],Object.getOwnPropertyDescriptor(fN.prototype,"pause"),fN.prototype),t(fN.prototype,"pauseVideo",[rN],Object.getOwnPropertyDescriptor(fN.prototype,"pauseVideo"),fN.prototype),t(fN.prototype,"resumeVideo",[iN],Object.getOwnPropertyDescriptor(fN.prototype,"resumeVideo"),fN.prototype),t(fN.prototype,"pauseAudio",[nN],Object.getOwnPropertyDescriptor(fN.prototype,"pauseAudio"),fN.prototype),t(fN.prototype,"resumeAudio",[sN],Object.getOwnPropertyDescriptor(fN.prototype,"resumeAudio"),fN.prototype),t(fN.prototype,"setPlayoutVolume",[aN],Object.getOwnPropertyDescriptor(fN.prototype,"setPlayoutVolume"),fN.prototype),t(fN.prototype,"getPlayoutVolume",[oN],Object.getOwnPropertyDescriptor(fN.prototype,"getPlayoutVolume"),fN.prototype),t(fN.prototype,"muteAudio",[lN],Object.getOwnPropertyDescriptor(fN.prototype,"muteAudio"),fN.prototype),t(fN.prototype,"destoryClient",[cN],Object.getOwnPropertyDescriptor(fN.prototype,"destoryClient"),fN.prototype),t(fN.prototype,"fullScreenToggle",[dN],Object.getOwnPropertyDescriptor(fN.prototype,"fullScreenToggle"),fN.prototype),t(fN.prototype,"streamStatistic",[uN],Object.getOwnPropertyDescriptor(fN.prototype,"streamStatistic"),fN.prototype),t(fN.prototype,"enableStreamStateDetection",[hN],Object.getOwnPropertyDescriptor(fN.prototype,"enableStreamStateDetection"),fN.prototype),fN);class _N{constructor(e){$l(this,"module_","HlsPlayer"),this.loadingUtils=new EP(e.parentDiv),this.event=e.eventEmitter,this.parentDiv=e.parentDiv,this.objectFit=e.objectFit||Gk.CONTAIN,this.muted=Boolean(e.muted),this.playUrl=e.url,this.pauseCount=0,this.poster_=e.poster,this.createHlsPlayer(),this.mobilePlayTimer=null,this.playerEventHandler={errorHandler:e=>{Qv.error(this.module_,"video element error encountered: ".concat(JSON.stringify(e)))},playingHandler:e=>{Qv.debug(this.module_,"video element playing encountered: ".concat(JSON.stringify(e))),clearTimeout(this.mobilePlayTimer)},loadedMetaHandler:e=>{Qv.debug(this.module_,"video element loadedMeta encountered: ".concat(JSON.stringify(e)))},loadedDataHandler:e=>{Qv.debug(this.module_,"video element loadedData encountered: ".concat(JSON.stringify(e))),this.loadingMask(!1)},canPlayHandler:e=>{Qv.info(this.module_,"video element canPlay encountered: ".concat(JSON.stringify(e))),this.event.emit("hlsCanPlay"),this.loadingMask(!1),this.videoBufferedReday=!0},mediaRecoverHandler:()=>{var e,t;null===(e=this.hlsPlayer)||void 0===e||e.swapAudioCodec(),null===(t=this.hlsPlayer)||void 0===t||t.recoverMediaError()},mediaAttachedHandler:()=>{Qv.info(this.module_,"HlsPlayer MEDIA_ATTACHED")},manifestParsedHandler:(e,t)=>{Qv.info(this.module_,"HlsPlayer MANIFEST_PARSED, quality level ")},levelSwitchedHandler:(e,t)=>{Qv.info(this.module_,"HlsPlayer LEVEL_SWITCHED, ".concat(JSON.stringify(t)))},frameDropHandler:(e,t)=>{if(Qv.info(this.module_,"HlsPlayer FPS_DROP, ".concat(JSON.stringify(t))),!this.isNativePlayer){var r;const e=this.hlsPlayer.levels[this.hlsPlayer.currentLevel],i=(null===(r=this.statisticInfo)||void 0===r?void 0:r.totalFrameDecoded)||0;this.statisticInfo={width:e.width||0,height:e.height||0,audioCodec:e.audioCodec,videoCodec:e.videoCodec,bitRate:e.realBitrate||e.bitrate||0,frameRate:t.currentDecoded||0,totalFrameDecoded:t.currentDecoded+i,frameDropped:t.currentDropped||0,totalFrameDropped:t.totalDroppedFrames||0}}},frameDropLevelCappingHandler:(e,t)=>{Qv.info(this.module_,"HlsPlayer FPS_DROP_LEVEL_CAPPING, ".concat(JSON.stringify(t)))},mediaErrHandler:(e,t)=>{if(t.fatal)switch(t.type){case FC.ErrorTypes.NETWORK_ERROR:Qv.error(this.module_,"HlsPlayer NETWORK_ERROR ".concat(JSON.stringify(t.details)," encountered, try to recover")),this.hlsPlayer.startLoad();break;case FC.ErrorTypes.MEDIA_ERROR:Qv.error(this.module_,"HlsPlayer NETWORK_ERROR ".concat(JSON.stringify(t)," encountered, try to recover")),this.event.emit(FC.ErrorTypes.MEDIA_ERROR),this.hlsPlayer.recoverMediaError(),this.event.once(FC.ErrorTypes.MEDIA_ERROR,this.playerEventHandler.mediaRecoverHandler);break;default:Qv.error(this.module_,"HlsPlayer other fatal ERROR ".concat(JSON.stringify(t)," encountered, try to recover")),this.hlsPlayer.destroy()}}}}async play(e,t){return this.autoPlay=!1!==e,this.poster_&&(SP.attachPoster(this.parentDiv,this.poster_.url,this.poster_.mode||Ok.FILL),!this.autoPlay&&this.poster_.startEnable&&SP.disPlayPoster(!0,this.poster_.url)),this.showLoading=t,new Promise(((e,t)=>{let r=this.parentDiv.querySelector("#video_player"),i=!1;if(r||(i=!0,r=document.createElement("video"),r.setAttribute("id","video_player"),r.style.width="100%",r.style.height="100%",r.style.position="absolute",r.style["object-fit"]=this.objectFit,r.setAttribute("autoplay",""),r.setAttribute("playsinline",""),r.setAttribute("webkit-playsinline",""),Zv.isTencentX5BrowserKernel()&&r.setAttribute("x5-playsinline",""),this.parentDiv.appendChild(r),this.player=r),this.offPlayerAndListener(),this.initPlayerAndListener(),this.muted?this.player.muted=!0:this.player.volume=.5,this.autoPlay)return this.mobilePlayTimer=setTimeout((()=>{Qv.error(this.module_,"mobile device not autoPlay, please manually play the video"),this.event.emit("mobileDeviceManualPlay")}),5e3),void e();clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{Qv.info(this.module_,"trigger videoCanPlay event by Timer"),this.event.emit("hlsCanPlay"),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=setTimeout((()=>{Qv.info(this.module_,"video playing timeout"),clearTimeout(this.playTimeOutTimer),this.playTimeOutTimer=null,e()}),2e3)}),i?0:1e3),this.playerEventHandler.playHandler&&this.event.removeListener("hlsCanPlay",this.playerEventHandler.playHandler),this.playerEventHandler.playHandler=async()=>{var r;await vP.multiPlatformAdapter(),null===(r=this.player)||void 0===r||r.play().then((()=>{var t;Qv.info(this.module_,"play success, parentDiv id:".concat(null===(t=this.parentDiv)||void 0===t?void 0:t.id)),this.afterPlayStrategy(),e()})).catch((e=>{var r;Qv.error(this.module_,"play failed, errmsg=".concat(e,", parentDiv id:").concat(null===(r=this.parentDiv)||void 0===r?void 0:r.id)),"NotAllowedError"===e.name?t(new xh(Ph.HWLLS_PLAY_NOT_ALLOW)):t(new xh(Ph.HWLLS_INTERNAL_ERROR,e.message))})).finally((()=>{clearTimeout(this.playTimeOutTimer)}))},this.event.on("hlsCanPlay",this.playerEventHandler.playHandler)}))}pause(){var e,t;null===(e=this.player)||void 0===e||e.pause(),null!==(t=this.poster_)&&void 0!==t&&t.pauseEnable&&SP.disPlayPoster(!0,this.poster_.url)}async resume(){var e;this.poster_&&SP.disPlayPoster(!1,this.poster_.url),this.manualStartedPlay()||(this.playerEventHandler.playHandler&&this.event.removeListener("hlsCanPlay",this.playerEventHandler.playHandler),this.playerEventHandler.playHandler=()=>{var e;null===(e=this.player)||void 0===e||e.play()},this.event.on("hlsCanPlay",this.playerEventHandler.playHandler),!this.videoBufferedReday&&this.showLoading&&this.loadingMask(!0)),await(null===(e=this.player)||void 0===e?void 0:e.play())}mute(e){this.player&&(this.player.muted=e,this.muted=e)}async switchPlay(e){var t;if(this.statisticInfo=null,this.videoBufferedReday=!1,this.offPlayerAndListener(),this.parentDiv&&this.parentDiv.id!==(null===(t=e.parentDiv)||void 0===t?void 0:t.id)){var r;const t=document.querySelector("#".concat(this.parentDiv.id," #video_player"));t&&this.parentDiv.appendChild(t),null===(r=document.querySelector("#".concat(this.parentDiv.id," #video_player")))||void 0===r||r.remove(),this.parentDiv=e.parentDiv}this.playUrl=e.url,this.poster_=e.poster,await this.play(e.autoPlay,e.showLoading)}stopPlay(){var e,t;this.loadingUtils.stopLoadingMask(),null===(e=document.querySelector("#".concat(this.parentDiv.id," #video_player")))||void 0===e||e.remove(),this.poster_&&SP.detachPoster(this.parentDiv,this.poster_.url),this.offPlayerAndListener(),this.playUrl=null,this.videoBufferedReday=!1,clearTimeout(this.playTimeOutTimer),null===(t=this.hlsPlayer)||void 0===t||t.destroy()}destory(){this.stopPlay(),this.player=null,this.hlsPlayer=null}getPlayoutVolume(){var e,t;return null!==(e=this.player)&&void 0!==e&&e.muted?0:100*((null===(t=this.player)||void 0===t?void 0:t.volume)||0)}setPlayoutVolume(e){return!!this.player&&(this.player.volume=Number((e/100).toFixed(2)),!0)}getStatisticInfo(){return this.statisticInfo}loadingMask(e){e?(this.autoPlay||this.manualStartedPlay())&&this.loadingUtils.loadingMask(!0):this.loadingUtils.loadingMask(!1)}manualStartedPlay(){return this.event.eventNames().includes("hlsCanPlay")}createHlsPlayer(){document.createElement("video").canPlayType("application/vnd.apple.mpegurl")?this.isNativePlayer=!0:(this.hlsPlayer=new FC({debug:{trace:Qv.trace,debug:Qv.debug,log:Qv.log,warn:Qv.warn,info:Qv.info,error:Qv.error},initialLiveManifestSize:1,liveSyncDurationCount:3,enableWorker:!1,lowLatencyMode:!0,progressive:!0,capLevelOnFPSDrop:!0,fpsDroppedMonitoringPeriod:1e3,fpsDroppedMonitoringThreshold:.2,startFragPrefetch:!0}),this.hlsPlayer.loadSource(this.playUrl),this.isNativePlayer=!1)}initPlayerAndListener(){this.player&&(this.player.addEventListener("error",this.playerEventHandler.errorHandler),this.player.addEventListener("playing",this.playerEventHandler.playingHandler),this.player.addEventListener("loadedmetadata",this.playerEventHandler.loadedMetaHandler),this.player.addEventListener("loadeddata",this.playerEventHandler.loadedDataHandler),this.player.addEventListener("canplay",this.playerEventHandler.canPlayHandler)),!this.hlsPlayer&&this.player?(this.player.src=this.playUrl,this.player.load()):this.hlsPlayer&&this.player&&(this.hlsPlayer.attachMedia(this.player),this.hlsPlayer.on(FC.Events.MEDIA_ATTACHED,this.playerEventHandler.mediaAttachedHandler),this.hlsPlayer.on(FC.Events.MANIFEST_PARSED,this.playerEventHandler.manifestParsedHandler),this.hlsPlayer.on(FC.Events.LEVEL_SWITCHED,this.playerEventHandler.levelSwitchedHandler),this.hlsPlayer.on(FC.Events.FPS_DROP,this.playerEventHandler.frameDropHandler),this.hlsPlayer.on(FC.Events.FPS_DROP_LEVEL_CAPPING,this.playerEventHandler.frameDropLevelCappingHandler),this.hlsPlayer.on(FC.Events.ERROR,this.playerEventHandler.mediaErrHandler))}offPlayerAndListener(){!this.hlsPlayer&&this.player?this.player.src=null:this.hlsPlayer&&this.player&&(this.hlsPlayer.detachMedia(),this.hlsPlayer.off(FC.Events.MEDIA_ATTACHED,this.playerEventHandler.mediaAttachedHandler),this.hlsPlayer.off(FC.Events.MANIFEST_PARSED,this.playerEventHandler.manifestParsedHandler),this.hlsPlayer.off(FC.Events.LEVEL_SWITCHED,this.playerEventHandler.levelSwitchedHandler),this.hlsPlayer.off(FC.Events.FPS_DROP,this.playerEventHandler.frameDropHandler),this.hlsPlayer.off(FC.Events.FPS_DROP_LEVEL_CAPPING,this.playerEventHandler.frameDropLevelCappingHandler),this.hlsPlayer.off(FC.Events.ERROR,this.playerEventHandler.mediaErrHandler)),this.player&&(this.player.removeEventListener("error",this.playerEventHandler.errorHandler),this.player.removeEventListener("playing",this.playerEventHandler.playingHandler),this.player.removeEventListener("loadedmetadata",this.playerEventHandler.loadedMetaHandler),this.player.removeEventListener("loadeddata",this.playerEventHandler.loadedDataHandler),this.player.removeEventListener("canplay",this.playerEventHandler.canPlayHandler)),this.event.removeListener(FC.ErrorTypes.MEDIA_ERROR,this.playerEventHandler.mediaRecoverHandler)}afterPlayStrategy(){if(!this.pauseCount&&Zv.getPlatform().indexOf("Ios 15")>=0){Qv.error(this.module_,Zv.getPlatform());const e=setTimeout((()=>{var t;clearTimeout(e),null===(t=this.player)||void 0===t||t.pause(),this.pauseCount++}),100)}}}var vN,EN,SN,TN,bN,RN,wN,AN,LN,CN,IN,kN,DN,PN,ON,xN,MN,NN;const FN="HWHlsClient";let UN=(vN=ck("HWHlsClient$startPlay#Promise<void>#string#StartPlayOptions"),EN=ck("HWHlsClient$switchPlay#Promise<void>#string#StartPlayOptions"),SN=dk("HWHlsClient$stopPlay#boolean#void"),TN=ck("HWHlsClient$replay#Promise<void>#void"),bN=ck("HWHlsClient$resume#Promise<boolean>#void"),RN=dk("HWHlsClient$pause#boolean#void"),wN=dk("HWHlsClient$pauseVideo#boolean#void"),AN=ck("HWHlsClient$resumeVideo#Promise<boolean>#void"),LN=dk("HWHlsClient$pauseVideo#boolean#void"),CN=ck("HWHlsClient$resumeAudio#Promise<boolean>#void"),IN=dk("HWHlsClient$setPlayoutVolume#boolean#number"),kN=dk("HWHlsClient$getPlayoutVolume#number#void"),DN=dk("HWHlsClient$muteAudio#void#boolean"),PN=dk("HWHlsClient$destoryClient#void#void"),ON=dk("HWHlsClient$streamStatistic#void#boolean#number"),xN=dk("HWHlsClient$enableStreamStateDetection#boolean#boolean#number#StreamInterruptRetry"),MN=dk("HWHlsClient$fullScreenToggle#void#boolean"),NN=class extends kD{constructor(e,t){super(FN,e,t),$l(this,"debugStatisticTimer",{timer:null,interval:1}),$l(this,"detectTimer",{timer:null,interval:3,interruptRetry:null}),$l(this,"recoveryInfo",{recoveryTimer:null,retryTimes:0,recoveryUrl:null}),this.initListeners()}async startPlay(e,t){Qv.info(FN,"[KPI] startPlay url: ".concat(Qv.shieldUrlParameters(e))),this.startPlayOptions=t,e=e.replace(/\.flv/gi,".m3u8");if(!PP.checkUrlFormat(e,zk.HLS))throw Qv.error(FN,"startPlay failed, invalid Parameter: ".concat(e)),this.eventEmitter.emit(Yk),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER);const r=document.getElementById(t.elementId);if(!r)throw Qv.error(FN,"startPlay failed, invalid Parameter: ".concat(e)),this.eventEmitter.emit(Yk),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER,"player Element is not exist.");this.hlsPlayer=new _N({eventEmitter:this.eventEmitter,url:e,parentDiv:r,objectFit:t.objectFit,muted:t.muted,poster:this.startPlayOptions.poster}),this.startPlayOptions.poster&&this.startPlayOptions.poster.url&&SP.preLoadPoster(this.startPlayOptions.poster.url);try{await this.hlsPlayer.play(this.startPlayOptions.autoPlay,t.showLoading)}catch(IU){IU instanceof xh&&IU.getCode()===Ph.HWLLS_PLAY_NOT_ALLOW?this.eventEmitter.emit("Error",{errCode:IU.getCode(),errDesc:IU.getMsg()}):(this.eventEmitter.emit(Yk),this.eventEmitter.emit("Error",{errCode:Ph.HWLLS_INTERNAL_ERROR,errDesc:Oh[Ph.HWLLS_INTERNAL_ERROR]}))}}async switchPlay(e,t){Qv.info(FN,"[KPI] switchPlay url: ".concat(Qv.shieldUrlParameters(e))),this.startPlayOptions=t||this.startPlayOptions,e=e.replace(/\.flv/gi,".m3u8");const r=document.getElementById(this.startPlayOptions.elementId);if(!r)throw Qv.error(FN,"switchPlay failed, invalid Parameter: ".concat(e)),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER,"player Element is not exist.");clearTimeout(this.debugStatisticTimer.timer),clearTimeout(this.detectTimer.timer),this.startPlayOptions.poster&&this.startPlayOptions.poster.url&&SP.preLoadPoster(this.startPlayOptions.poster.url),await this.hlsPlayer.switchPlay({url:e,parentDiv:r,objectFit:this.startPlayOptions.objectFit,muted:this.startPlayOptions.muted,autoPlay:this.startPlayOptions.autoPlay,showLoading:t.showLoading,poster:this.startPlayOptions.poster}).catch((e=>{e instanceof xh&&e.getCode()===Ph.HWLLS_PLAY_NOT_ALLOW?this.eventEmitter.emit("Error",{errCode:e.getCode(),errDesc:e.getMsg()}):this.eventEmitter.emit("Error",{errCode:Ph.HWLLS_INTERNAL_ERROR,errDesc:Oh[Ph.HWLLS_INTERNAL_ERROR]})})),this.debugStatisticTimer.timer&&this.streamStatistic(!0,this.debugStatisticTimer.interval),this.detectTimer.timer&&this.enableStreamStateDetection(!0,this.detectTimer.interval,this.detectTimer.interruptRetry)}stopPlay(){var e;return null===(e=this.hlsPlayer)||void 0===e||e.stopPlay(),this.hlsPlayer=null,clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer={timer:null,interval:1},clearTimeout(this.detectTimer.timer),this.detectTimer={timer:null,interval:3,interruptRetry:null},clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo={recoveryTimer:null,retryTimes:0,recoveryUrl:null},!0}async replay(){if(this.hlsPlayer)try{return await this.hlsPlayer.resume(),!0}catch(IU){return Qv.error(FN,"resume failed: ".concat(IU)),!1}return!1}async resume(){if(this.hlsPlayer)try{return await this.hlsPlayer.resume(),!0}catch(IU){return Qv.error(FN,"resume failed: ".concat(IU)),"NotAllowedError"===IU.name&&this.eventEmitter.emit("Error",{errCode:Ph.HWLLS_PLAY_NOT_ALLOW,errDesc:Oh[Ph.HWLLS_PLAY_NOT_ALLOW]}),!1}return!1}pause(){return!!this.hlsPlayer&&(this.hlsPlayer.pause(),!0)}pauseVideo(){return Qv.error(FN,"hls player is not support pause video only."),!1}async resumeVideo(){return Qv.error(FN,"hls player is not support resume video only."),!0}pauseAudio(){return!!this.hlsPlayer&&(this.hlsPlayer.mute(!0),!0)}async resumeAudio(){return!!this.hlsPlayer&&(this.hlsPlayer.mute(!1),!0)}setPlayoutVolume(e){var t;return this.muteAudio(!1),null===(t=this.hlsPlayer)||void 0===t||t.setPlayoutVolume(e),!0}getPlayoutVolume(){var e;return null===(e=this.hlsPlayer)||void 0===e?void 0:e.getPlayoutVolume()}muteAudio(e){var t;null===(t=this.hlsPlayer)||void 0===t||t.mute(e)}destoryClient(){var e;null===(e=this.hlsPlayer)||void 0===e||e.destory(),this.hlsPlayer=null,clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer={timer:null,interval:1},clearTimeout(this.detectTimer.timer),this.detectTimer={timer:null,interval:3,interruptRetry:null},clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo={recoveryTimer:null,retryTimes:0,recoveryUrl:null}}streamStatistic(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e){if(!Number.isInteger(t)||t<1||t>60)throw Qv.error(FN,"streamStatistic, invalid parameter of interval."),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER);this.getStreamStatisticInfo(t)}else clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer={timer:null,interval:1}}enableStreamStateDetection(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2?arguments[2]:void 0;if(!e)return clearTimeout(this.detectTimer.timer),this.detectTimer={timer:null,interval:3,interruptRetry:null},!0;if(!Number.isInteger(t)||t<1||t>60)throw Qv.error(FN,"enableStreamStateDetection, invalid parameter of interval."),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER);clearTimeout(this.detectTimer.timer);const i={preFramesDecoded:0,isInterrupted:!1};var n,s;this.hlsPlayer&&(i.preFramesDecoded=Zv.getValue(null===(n=this.hlsPlayer)||void 0===n||null===(s=n.getStatisticInfo())||void 0===s?void 0:s.totalFrameDecoded,0));return this.detectTimer.interval=t,this.detectTimer.interruptRetry=r,this.judgeStreamInterrupted(i,t,r),!0}fullScreenToggle(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Qv.error(FN,"hls player is not support fullScreenToggle.".concat(e))}getStreamStatisticInfo(e){clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer.interval=e,this.debugStatisticTimer.timer=setTimeout((()=>{var t;const r=null===(t=this.hlsPlayer)||void 0===t?void 0:t.getStatisticInfo();r&&this.eventEmitter.emit(Hk.MEDIA_STATISTIC,{audio:{mediaType:Pk.TRACK_TYPE_AUDIO,bitRate:0,codec:r.audioCodec},video:{mediaType:Pk.TRACK_TYPE_VIDEO,codec:r.videoCodec,bitRate:Math.round(r.bitRate),frameRate:r.frameRate,width:r.width,height:r.height}}),this.getStreamStatisticInfo(e)}),1e3*e)}judgeStreamInterrupted(e,t,r){this.detectTimer.timer=setTimeout((()=>{var i;clearTimeout(this.detectTimer.timer);let n=!1;const s=null===(i=this.hlsPlayer)||void 0===i?void 0:i.getStatisticInfo();var a;if(s&&(n=Zv.getValue(null==s?void 0:s.totalFrameDecoded,0)-Zv.getValue(e.preFramesDecoded,0)<=0,n||(clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.retryTimes=0),s&&(e.preFramesDecoded=Zv.getValue(s.frameRate,0))),e.isInterrupted&&!n)null===(a=this.hlsPlayer)||void 0===a||a.loadingMask(!1),this.eventEmitter.emit(Hk.VIDEO_RECOVERY),this.eventEmitter.emit(Hk.AUDIO_RECOVERY),e.isInterrupted=!1;else if(!e.isInterrupted&&n){var o;this.startPlayOptions.showLoading&&(null===(o=this.hlsPlayer)||void 0===o||o.loadingMask(!0)),this.eventEmitter.emit(Hk.VIDEO_INTERRUPTED),this.eventEmitter.emit(Hk.AUDIO_INTERRUPTED),e.isInterrupted=!0,null!=r&&r.enable&&(Qv.info(this.moudle_,"autoRecoverPlay timer start"),clearTimeout(this.recoveryInfo.recoveryTimer),this.autoRecoverPlay(this.recoveryInfo.recoveryUrl,Math.max(10,(null==r?void 0:r.retryInterval)||30),(null==r?void 0:r.retryTimes)||30))}this.judgeStreamInterrupted(e,t,r)}),1e3*t)}autoRecoverPlay(e,t,r){let i=0;this.recoveryInfo.recoveryTimer=setTimeout((async()=>{if(Qv.info(this.moudle_,"autoRecoverPlay every ".concat(t," sencond")),clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.recoveryTimer=null,e===this.recoveryInfo.recoveryUrl)try{this.recoveryInfo.retryTimes++,i=this.recoveryInfo.retryTimes,await this.switchPlay(e)}finally{this.recoveryInfo.retryTimes=i,i<r?this.autoRecoverPlay(e,t,r):this.eventEmitter.emit("Error",{errCode:Ph.HWLLS_PLAY_HLS_RETRY_FAILED,errDesc:Oh[Ph.HWLLS_PLAY_HLS_RETRY_FAILED]})}else this.recoveryInfo.retryTimes=0}),1e3*t)}initListeners(){this.eventEmitter.on("mobileDeviceManualPlay",(()=>{Zv.isMobileDevice()&&(Qv.error(FN,"some mobile devices do not support autoPlay, now manually try to play"),this.resume())}))}},t(NN.prototype,"startPlay",[vN],Object.getOwnPropertyDescriptor(NN.prototype,"startPlay"),NN.prototype),t(NN.prototype,"switchPlay",[EN],Object.getOwnPropertyDescriptor(NN.prototype,"switchPlay"),NN.prototype),t(NN.prototype,"stopPlay",[SN],Object.getOwnPropertyDescriptor(NN.prototype,"stopPlay"),NN.prototype),t(NN.prototype,"replay",[TN],Object.getOwnPropertyDescriptor(NN.prototype,"replay"),NN.prototype),t(NN.prototype,"resume",[bN],Object.getOwnPropertyDescriptor(NN.prototype,"resume"),NN.prototype),t(NN.prototype,"pause",[RN],Object.getOwnPropertyDescriptor(NN.prototype,"pause"),NN.prototype),t(NN.prototype,"pauseVideo",[wN],Object.getOwnPropertyDescriptor(NN.prototype,"pauseVideo"),NN.prototype),t(NN.prototype,"resumeVideo",[AN],Object.getOwnPropertyDescriptor(NN.prototype,"resumeVideo"),NN.prototype),t(NN.prototype,"pauseAudio",[LN],Object.getOwnPropertyDescriptor(NN.prototype,"pauseAudio"),NN.prototype),t(NN.prototype,"resumeAudio",[CN],Object.getOwnPropertyDescriptor(NN.prototype,"resumeAudio"),NN.prototype),t(NN.prototype,"setPlayoutVolume",[IN],Object.getOwnPropertyDescriptor(NN.prototype,"setPlayoutVolume"),NN.prototype),t(NN.prototype,"getPlayoutVolume",[kN],Object.getOwnPropertyDescriptor(NN.prototype,"getPlayoutVolume"),NN.prototype),t(NN.prototype,"muteAudio",[DN],Object.getOwnPropertyDescriptor(NN.prototype,"muteAudio"),NN.prototype),t(NN.prototype,"destoryClient",[PN],Object.getOwnPropertyDescriptor(NN.prototype,"destoryClient"),NN.prototype),t(NN.prototype,"streamStatistic",[ON],Object.getOwnPropertyDescriptor(NN.prototype,"streamStatistic"),NN.prototype),t(NN.prototype,"enableStreamStateDetection",[xN],Object.getOwnPropertyDescriptor(NN.prototype,"enableStreamStateDetection"),NN.prototype),t(NN.prototype,"fullScreenToggle",[MN],Object.getOwnPropertyDescriptor(NN.prototype,"fullScreenToggle"),NN.prototype),NN);const BN="DowngradeManager";class HN{constructor(e,t){this.eventEmitter=t,this.playOptions=e,this.initListener()}initListener(){this.eventEmitter.on(Yk,(e=>{var t,r;void 0===this.downgradeForm&&null!==(t=this.playOptions.downgradeUrl)&&void 0!==t&&t.hlsUrl&&BC.hlsCapabilityCheck()?(this.downgradeForm=zk.HLS,this.downgradeClient=new UN(void 0,this.eventEmitter),this.trackDowngrade(),this.startPlay(this.playOptions.downgradeUrl.hlsUrl,this.playOptions)):null!==(r=this.playOptions.downgradeUrl)&&void 0!==r&&r.flvUrl&&BC.flvCapabilityCheck()?(this.destoryClient(),this.downgradeForm=zk.FLV,this.downgradeClient=new yN(void 0,this.eventEmitter),this.trackDowngrade(),this.startPlay(this.playOptions.downgradeUrl.flvUrl,this.playOptions)):(Qv.error(BN,"can't downgrade"),e&&e instanceof xh&&this.eventEmitter.emit("Error",{errCode:e.getCode(),errDesc:e.getMsg()}))}))}trackDowngrade(){Qv.warn(BN,"The autoDowngrade form has been set to ".concat(this.downgradeForm)),this.eventEmitter.emit(Hk.PLAYER_CHANGE,this.downgradeForm)}async startPlay(e,t){var r;return null===(r=this.downgradeClient)||void 0===r?void 0:r.startPlay(e,t)}async switchPlay(e,t){var r;return null===(r=this.downgradeClient)||void 0===r?void 0:r.switchPlay(e,t||this.playOptions)}replay(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.replay()}pause(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.pause()}resume(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.resume()}stopPlay(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.stopPlay()}pauseVideo(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.pauseVideo()}resumeVideo(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.resumeVideo()}pauseAudio(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.pauseAudio()}resumeAudio(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.resumeAudio()}setPlayoutVolume(e){var t;return null===(t=this.downgradeClient)||void 0===t?void 0:t.setPlayoutVolume(e)}getPlayoutVolume(){var e;return null===(e=this.downgradeClient)||void 0===e?void 0:e.getPlayoutVolume()}muteAudio(e){var t;null===(t=this.downgradeClient)||void 0===t||t.muteAudio(e)}destoryClient(){var e;null===(e=this.downgradeClient)||void 0===e||e.destoryClient()}streamStatistic(e,t){var r;null===(r=this.downgradeClient)||void 0===r||r.streamStatistic(e,t)}enableStreamStateDetection(e,t,r){var i;return null===(i=this.downgradeClient)||void 0===i?void 0:i.enableStreamStateDetection(e,t,r)}fullScreenToggle(e){var t;return null===(t=this.downgradeClient)||void 0===t?void 0:t.fullScreenToggle(e)}}var jN=z,VN=D,GN=Qe("match"),zN=p,KN=Fe,WN=Y,$N=Jl,YN=RegExp.prototype,qN=At.f,ZN=d,XN=o,JN=L,QN=zi,eF=_y,tF=Kt,rF=Zr.f,iF=Y,nF=function(e){var t;return jN(e)&&(void 0!==(t=e[GN])?!!t:"RegExp"==VN(e))},sF=Zl,aF=function(e){var t=e.flags;return void 0!==t||"flags"in YN||KN(e,"flags")||!WN(YN,e)?t:zN($N,e)},oF=ic,lF=function(e,t,r){r in e||qN(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})},cF=qr,dF=c,uF=Fe,hF=Pr.enforce,fF=gn,pF=Dc,mF=xc,gF=Qe("match"),yF=XN.RegExp,_F=yF.prototype,vF=XN.SyntaxError,EF=JN(_F.exec),SF=JN("".charAt),TF=JN("".replace),bF=JN("".indexOf),RF=JN("".slice),wF=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,AF=/a/g,LF=/a/g,CF=new yF(AF)!==AF,IF=oF.MISSED_STICKY,kF=oF.UNSUPPORTED_Y,DF=ZN&&(!CF||IF||pF||mF||dF((function(){return LF[gF]=!1,yF(AF)!=AF||yF(LF)==LF||"/a/i"!=yF(AF,"i")})));if(QN("RegExp",DF)){for(var PF=function(e,t){var r,i,n,s,a,o,l=iF(_F,this),c=nF(e),d=void 0===t,u=[],h=e;if(!l&&c&&d&&e.constructor===PF)return e;if((c||iF(_F,e))&&(e=e.source,d&&(t=aF(h))),e=void 0===e?"":sF(e),t=void 0===t?"":sF(t),h=e,pF&&"dotAll"in AF&&(i=!!t&&bF(t,"s")>-1)&&(t=TF(t,/s/g,"")),r=t,IF&&"sticky"in AF&&(n=!!t&&bF(t,"y")>-1)&&kF&&(t=TF(t,/y/g,"")),mF&&(s=function(e){for(var t,r=e.length,i=0,n="",s=[],a={},o=!1,l=!1,c=0,d="";i<=r;i++){if("\\"===(t=SF(e,i)))t+=SF(e,++i);else if("]"===t)o=!1;else if(!o)switch(!0){case"["===t:o=!0;break;case"("===t:EF(wF,RF(e,i+1))&&(i+=2,l=!0),n+=t,c++;continue;case">"===t&&l:if(""===d||uF(a,d))throw new vF("Invalid capture group name");a[d]=!0,s[s.length]=[d,c],l=!1,d="";continue}l?d+=t:n+=t}return[n,s]}(e),e=s[0],u=s[1]),a=eF(yF(e,t),l?this:_F,PF),(i||n||u.length)&&(o=hF(a),i&&(o.dotAll=!0,o.raw=PF(function(e){for(var t,r=e.length,i=0,n="",s=!1;i<=r;i++)"\\"!==(t=SF(e,i))?s||"."!==t?("["===t?s=!0:"]"===t&&(s=!1),n+=t):n+="[\\s\\S]":n+=t+SF(e,++i);return n}(e),r)),n&&(o.sticky=!0),u.length&&(o.groups=u)),e!==h)try{tF(a,"source",""===h?"(?:)":h)}catch(IU){}return a},OF=rF(yF),xF=0;OF.length>xF;)lF(PF,yF,OF[xF++]);_F.constructor=PF,PF.prototype=_F,cF(XN,"RegExp",PF,{constructor:!0})}fF("RegExp");var MF={},NF=n(ih),FF={toString:function(e){switch(e){case 1:return"A";case 10:return"NULL";case 28:return"AAAA";case 18:return"AFSDB";case 42:return"APL";case 257:return"CAA";case 60:return"CDNSKEY";case 59:return"CDS";case 37:return"CERT";case 5:return"CNAME";case 49:return"DHCID";case 32769:return"DLV";case 39:return"DNAME";case 48:return"DNSKEY";case 43:return"DS";case 55:return"HIP";case 13:return"HINFO";case 45:return"IPSECKEY";case 25:return"KEY";case 36:return"KX";case 29:return"LOC";case 15:return"MX";case 35:return"NAPTR";case 2:return"NS";case 47:return"NSEC";case 50:return"NSEC3";case 51:return"NSEC3PARAM";case 12:return"PTR";case 46:return"RRSIG";case 17:return"RP";case 24:return"SIG";case 6:return"SOA";case 99:return"SPF";case 33:return"SRV";case 44:return"SSHFP";case 32768:return"TA";case 249:return"TKEY";case 52:return"TLSA";case 250:return"TSIG";case 16:return"TXT";case 252:return"AXFR";case 251:return"IXFR";case 41:return"OPT";case 255:return"ANY"}return"UNKNOWN_"+e},toType:function(e){switch(e.toUpperCase()){case"A":return 1;case"NULL":return 10;case"AAAA":return 28;case"AFSDB":return 18;case"APL":return 42;case"CAA":return 257;case"CDNSKEY":return 60;case"CDS":return 59;case"CERT":return 37;case"CNAME":return 5;case"DHCID":return 49;case"DLV":return 32769;case"DNAME":return 39;case"DNSKEY":return 48;case"DS":return 43;case"HIP":return 55;case"HINFO":return 13;case"IPSECKEY":return 45;case"KEY":return 25;case"KX":return 36;case"LOC":return 29;case"MX":return 15;case"NAPTR":return 35;case"NS":return 2;case"NSEC":return 47;case"NSEC3":return 50;case"NSEC3PARAM":return 51;case"PTR":return 12;case"RRSIG":return 46;case"RP":return 17;case"SIG":return 24;case"SOA":return 6;case"SPF":return 99;case"SRV":return 33;case"SSHFP":return 44;case"TA":return 32768;case"TKEY":return 249;case"TLSA":return 52;case"TSIG":return 250;case"TXT":return 16;case"AXFR":return 252;case"IXFR":return 251;case"OPT":return 41;case"ANY":case"*":return 255}return e.toUpperCase().startsWith("UNKNOWN_")?parseInt(e.slice(8)):0}},UF={toString:function(e){switch(e){case 0:return"NOERROR";case 1:return"FORMERR";case 2:return"SERVFAIL";case 3:return"NXDOMAIN";case 4:return"NOTIMP";case 5:return"REFUSED";case 6:return"YXDOMAIN";case 7:return"YXRRSET";case 8:return"NXRRSET";case 9:return"NOTAUTH";case 10:return"NOTZONE";case 11:return"RCODE_11";case 12:return"RCODE_12";case 13:return"RCODE_13";case 14:return"RCODE_14";case 15:return"RCODE_15"}return"RCODE_"+e},toRcode:function(e){switch(e.toUpperCase()){case"NOERROR":return 0;case"FORMERR":return 1;case"SERVFAIL":return 2;case"NXDOMAIN":return 3;case"NOTIMP":return 4;case"REFUSED":return 5;case"YXDOMAIN":return 6;case"YXRRSET":return 7;case"NXRRSET":return 8;case"NOTAUTH":return 9;case"NOTZONE":return 10;case"RCODE_11":return 11;case"RCODE_12":return 12;case"RCODE_13":return 13;case"RCODE_14":return 14;case"RCODE_15":return 15}return 0}},BF={toString:function(e){switch(e){case 0:return"QUERY";case 1:return"IQUERY";case 2:return"STATUS";case 3:return"OPCODE_3";case 4:return"NOTIFY";case 5:return"UPDATE";case 6:return"OPCODE_6";case 7:return"OPCODE_7";case 8:return"OPCODE_8";case 9:return"OPCODE_9";case 10:return"OPCODE_10";case 11:return"OPCODE_11";case 12:return"OPCODE_12";case 13:return"OPCODE_13";case 14:return"OPCODE_14";case 15:return"OPCODE_15"}return"OPCODE_"+e},toOpcode:function(e){switch(e.toUpperCase()){case"QUERY":return 0;case"IQUERY":return 1;case"STATUS":return 2;case"OPCODE_3":return 3;case"NOTIFY":return 4;case"UPDATE":return 5;case"OPCODE_6":return 6;case"OPCODE_7":return 7;case"OPCODE_8":return 8;case"OPCODE_9":return 9;case"OPCODE_10":return 10;case"OPCODE_11":return 11;case"OPCODE_12":return 12;case"OPCODE_13":return 13;case"OPCODE_14":return 14;case"OPCODE_15":return 15}return 0}},HF={toString:function(e){switch(e){case 1:return"IN";case 2:return"CS";case 3:return"CH";case 4:return"HS";case 255:return"ANY"}return"UNKNOWN_"+e},toClass:function(e){switch(e.toUpperCase()){case"IN":return 1;case"CS":return 2;case"CH":return 3;case"HS":return 4;case"ANY":return 255}return 0}},jF={toString:function(e){switch(e){case 1:return"LLQ";case 2:return"UL";case 3:return"NSID";case 5:return"DAU";case 6:return"DHU";case 7:return"N3U";case 8:return"CLIENT_SUBNET";case 9:return"EXPIRE";case 10:return"COOKIE";case 11:return"TCP_KEEPALIVE";case 12:return"PADDING";case 13:return"CHAIN";case 14:return"KEY_TAG";case 26946:return"DEVICEID"}return e<0?null:`OPTION_${e}`},toCode:function(e){if("number"==typeof e)return e;if(!e)return-1;switch(e.toUpperCase()){case"OPTION_0":return 0;case"LLQ":return 1;case"UL":return 2;case"NSID":return 3;case"OPTION_4":return 4;case"DAU":return 5;case"DHU":return 6;case"N3U":return 7;case"CLIENT_SUBNET":return 8;case"EXPIRE":return 9;case"COOKIE":return 10;case"TCP_KEEPALIVE":return 11;case"PADDING":return 12;case"CHAIN":return 13;case"KEY_TAG":return 14;case"DEVICEID":return 26946;case"OPTION_65535":return 65535}const t=e.match(/_(\d+)$/);return t?parseInt(t[1],10):-1}};const VF=/^(\d{1,3}\.){3,3}\d{1,3}$/,GF=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i,zF={name:"v4",size:4,isFormat:e=>VF.test(e),encode(e,t,r){r=~~r;const i=t||new Uint8Array(r+4);return e.split(/\./g).forEach(((e,t)=>{i[r+t]=255&parseInt(e,10)})),i},decode:(e,t)=>[e[t=~~t],e[t+1],e[t+2],e[t+3]].join(".")};function KF(e){return 1===(e=e.toString(16)).length?"0"+e:e}const WF={name:"v6",size:16,isFormat:e=>e.length>0&&GF.test(e),encode(e,t,r){r=~~r;const i=e.split(":",8);for(let s=0;s<i.length;s++)if(zF.isFormat(i[s])){const e=zF.encode(i[s]);i[s]=KF(e[0])+KF(e[1]),++s<8&&i.splice(s,0,KF(e[2])+KF(e[3]))}if(""===i[0])for(;i.length<8;)i.unshift("0");else if(""===i[i.length-1])for(;i.length<8;)i.push("0");else if(i.length<8){let e=0;for(;e<i.length&&""!==i[e];)e++;const t=[e,1];for(e=9-i.length;e>0;e--)t.push("0");i.splice.apply(i,t)}const n=t||new Uint8Array(r+16);for(const s of i){const e=parseInt(s,16);n[r++]=e>>8&255,n[r++]=255&e}return n},decode(e,t){const r=[];for(let i=0;i<16;i+=2)r.push((e[t+i]<<8|e[t+i+1]).toString(16));return r.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}};function $F(e){if(zF.isFormat(e))return zF.size;if(WF.isFormat(e))return WF.size;throw Error(`Invalid ip address: ${e}`)}var YF=Object.freeze({name:"ip",sizeOf:$F,familyOf:e=>$F(e)===zF.size?1:2,v4:zF,v6:WF,encode(e,t,r){r=~~r;const i=$F(e);return"function"==typeof t&&(t=t(r+i)),i===zF.size?zF.encode(e,t,r):WF.encode(e,t,r)},decode(e,t,r){if(t=~~t,(r=r||e.length-t)===zF.size)return zF.decode(e,t,r);if(r===WF.size)return WF.decode(e,t,r);throw Error(`Invalid buffer size needs to be ${zF.size} for v4 or ${WF.size} for v6.`)}});!function(e){const t=NF.Buffer,r=FF,i=UF,n=BF,s=HF,a=jF,o=YF,l=32768,c=e.name={};c.encode=function(e,r,i){r||(r=t.alloc(c.encodingLength(e))),i||(i=0);const n=i,s=e.replace(/^\.|\.$/gm,"");if(s.length){const e=s.split(".");for(let t=0;t<e.length;t++){const n=r.write(e[t],i+1);r[i]=n,i+=n+1}}return r[i++]=0,c.encode.bytes=i-n,r},c.encode.bytes=0,c.decode=function(e,t){t||(t=0);const r=[];let i=t,n=0,s=0,a=!1;for(;;){if(t>=e.length)throw new Error("Cannot decode name (buffer overflow)");const o=e[t++];if(s+=a?0:1,0===o)break;if(192&o){if(192&~o)throw new Error("Cannot decode name (bad label)");{if(t+1>e.length)throw new Error("Cannot decode name (buffer overflow)");const r=e.readUInt16BE(t-1)-49152;if(r>=i)throw new Error("Cannot decode name (bad pointer)");t=r,i=r,s+=a?0:1,a=!0}}else{if(t+o>e.length)throw new Error("Cannot decode name (buffer overflow)");if(n+=o+1,n>254)throw new Error("Cannot decode name (name too long)");r.push(e.toString("utf-8",t,t+o)),t+=o,s+=a?0:o}}return c.decode.bytes=s,0===r.length?".":r.join(".")},c.decode.bytes=0,c.encodingLength=function(e){return"."===e||".."===e?1:t.byteLength(e.replace(/^\.|\.$/gm,""))+2};const d={encode:function(e,r,i){r||(r=t.alloc(d.encodingLength(e))),i||(i=0);const n=r.write(e,i+1);return r[i]=n,d.encode.bytes=n+1,r}};d.encode.bytes=0,d.decode=function(e,t){t||(t=0);const r=e[t],i=e.toString("utf-8",t+1,t+1+r);return d.decode.bytes=r+1,i},d.decode.bytes=0,d.encodingLength=function(e){return t.byteLength(e)+1};const u={encode:function(e,t,r){t||(t=u.encodingLength(e)),r||(r=0);const i=32767&(e.flags||0),n="response"===e.type?32768:0;return t.writeUInt16BE(e.id||0,r),t.writeUInt16BE(i|n,r+2),t.writeUInt16BE(e.questions.length,r+4),t.writeUInt16BE(e.answers.length,r+6),t.writeUInt16BE(e.authorities.length,r+8),t.writeUInt16BE(e.additionals.length,r+10),t}};u.encode.bytes=12,u.decode=function(e,t){if(t||(t=0),e.length<12)throw new Error("Header must be 12 bytes");const r=e.readUInt16BE(t+2);return{id:e.readUInt16BE(t),type:32768&r?"response":"query",flags:32767&r,flag_qr:1==(r>>15&1),opcode:n.toString(r>>11&15),flag_aa:1==(r>>10&1),flag_tc:1==(r>>9&1),flag_rd:1==(r>>8&1),flag_ra:1==(r>>7&1),flag_z:1==(r>>6&1),flag_ad:1==(r>>5&1),flag_cd:1==(r>>4&1),rcode:i.toString(15&r),questions:new Array(e.readUInt16BE(t+4)),answers:new Array(e.readUInt16BE(t+6)),authorities:new Array(e.readUInt16BE(t+8)),additionals:new Array(e.readUInt16BE(t+10))}},u.decode.bytes=12,u.encodingLength=function(){return 12};const h=e.unknown={};h.encode=function(e,r,i){return r||(r=t.alloc(h.encodingLength(e))),i||(i=0),r.writeUInt16BE(e.length,i),e.copy(r,i+2),h.encode.bytes=e.length+2,r},h.encode.bytes=0,h.decode=function(e,t){t||(t=0);const r=e.readUInt16BE(t),i=e.slice(t+2,t+2+r);return h.decode.bytes=r+2,i},h.decode.bytes=0,h.encodingLength=function(e){return e.length+2};const f=e.ns={};f.encode=function(e,r,i){return r||(r=t.alloc(f.encodingLength(e))),i||(i=0),c.encode(e,r,i+2),r.writeUInt16BE(c.encode.bytes,i),f.encode.bytes=c.encode.bytes+2,r},f.encode.bytes=0,f.decode=function(e,t){t||(t=0);const r=e.readUInt16BE(t),i=c.decode(e,t+2);return f.decode.bytes=r+2,i},f.decode.bytes=0,f.encodingLength=function(e){return c.encodingLength(e)+2};const p=e.soa={};p.encode=function(e,r,i){r||(r=t.alloc(p.encodingLength(e))),i||(i=0);const n=i;return i+=2,c.encode(e.mname,r,i),i+=c.encode.bytes,c.encode(e.rname,r,i),i+=c.encode.bytes,r.writeUInt32BE(e.serial||0,i),i+=4,r.writeUInt32BE(e.refresh||0,i),i+=4,r.writeUInt32BE(e.retry||0,i),i+=4,r.writeUInt32BE(e.expire||0,i),i+=4,r.writeUInt32BE(e.minimum||0,i),i+=4,r.writeUInt16BE(i-n-2,n),p.encode.bytes=i-n,r},p.encode.bytes=0,p.decode=function(e,t){t||(t=0);const r=t,i={};return t+=2,i.mname=c.decode(e,t),t+=c.decode.bytes,i.rname=c.decode(e,t),t+=c.decode.bytes,i.serial=e.readUInt32BE(t),t+=4,i.refresh=e.readUInt32BE(t),t+=4,i.retry=e.readUInt32BE(t),t+=4,i.expire=e.readUInt32BE(t),t+=4,i.minimum=e.readUInt32BE(t),t+=4,p.decode.bytes=t-r,i},p.decode.bytes=0,p.encodingLength=function(e){return 22+c.encodingLength(e.mname)+c.encodingLength(e.rname)};const m=e.txt={};m.encode=function(e,r,i){Array.isArray(e)||(e=[e]);for(let s=0;s<e.length;s++)if("string"==typeof e[s]&&(e[s]=t.from(e[s])),!t.isBuffer(e[s]))throw new Error("Must be a Buffer");r||(r=t.alloc(m.encodingLength(e))),i||(i=0);const n=i;return i+=2,e.forEach((function(e){r[i++]=e.length,e.copy(r,i,0,e.length),i+=e.length})),r.writeUInt16BE(i-n-2,n),m.encode.bytes=i-n,r},m.encode.bytes=0,m.decode=function(e,t){t||(t=0);const r=t;let i=e.readUInt16BE(t);t+=2;let n=[];for(;i>0;){const r=e[t++];if(--i,i<r)throw new Error("Buffer overflow");n.push(e.slice(t,t+r)),t+=r,i-=r}return m.decode.bytes=t-r,n},m.decode.bytes=0,m.encodingLength=function(e){Array.isArray(e)||(e=[e]);let r=2;return e.forEach((function(e){r+="string"==typeof e?t.byteLength(e)+1:e.length+1})),r};const g=e.null={};g.encode=function(e,r,i){r||(r=t.alloc(g.encodingLength(e))),i||(i=0),"string"==typeof e&&(e=t.from(e)),e||(e=t.alloc(0));const n=i;i+=2;const s=e.length;return e.copy(r,i,0,s),i+=s,r.writeUInt16BE(i-n-2,n),g.encode.bytes=i-n,r},g.encode.bytes=0,g.decode=function(e,t){t||(t=0);const r=t,i=e.readUInt16BE(t);t+=2;const n=e.slice(t,t+i);return t+=i,g.decode.bytes=t-r,n},g.decode.bytes=0,g.encodingLength=function(e){return e?(t.isBuffer(e)?e.length:t.byteLength(e))+2:2};const y=e.hinfo={};y.encode=function(e,r,i){r||(r=t.alloc(y.encodingLength(e))),i||(i=0);const n=i;return i+=2,d.encode(e.cpu,r,i),i+=d.encode.bytes,d.encode(e.os,r,i),i+=d.encode.bytes,r.writeUInt16BE(i-n-2,n),y.encode.bytes=i-n,r},y.encode.bytes=0,y.decode=function(e,t){t||(t=0);const r=t,i={};return t+=2,i.cpu=d.decode(e,t),t+=d.decode.bytes,i.os=d.decode(e,t),t+=d.decode.bytes,y.decode.bytes=t-r,i},y.decode.bytes=0,y.encodingLength=function(e){return d.encodingLength(e.cpu)+d.encodingLength(e.os)+2};const _=e.ptr={},v=e.cname=_,E=e.dname=_;_.encode=function(e,r,i){return r||(r=t.alloc(_.encodingLength(e))),i||(i=0),c.encode(e,r,i+2),r.writeUInt16BE(c.encode.bytes,i),_.encode.bytes=c.encode.bytes+2,r},_.encode.bytes=0,_.decode=function(e,t){t||(t=0);const r=c.decode(e,t+2);return _.decode.bytes=c.decode.bytes+2,r},_.decode.bytes=0,_.encodingLength=function(e){return c.encodingLength(e)+2};const S=e.srv={};S.encode=function(e,r,i){r||(r=t.alloc(S.encodingLength(e))),i||(i=0),r.writeUInt16BE(e.priority||0,i+2),r.writeUInt16BE(e.weight||0,i+4),r.writeUInt16BE(e.port||0,i+6),c.encode(e.target,r,i+8);const n=c.encode.bytes+6;return r.writeUInt16BE(n,i),S.encode.bytes=n+2,r},S.encode.bytes=0,S.decode=function(e,t){t||(t=0);const r=e.readUInt16BE(t),i={};return i.priority=e.readUInt16BE(t+2),i.weight=e.readUInt16BE(t+4),i.port=e.readUInt16BE(t+6),i.target=c.decode(e,t+8),S.decode.bytes=r+2,i},S.decode.bytes=0,S.encodingLength=function(e){return 8+c.encodingLength(e.target)};const T=e.caa={};T.ISSUER_CRITICAL=128,T.encode=function(e,r,i){const n=T.encodingLength(e);return r||(r=t.alloc(T.encodingLength(e))),i||(i=0),e.issuerCritical&&(e.flags=T.ISSUER_CRITICAL),r.writeUInt16BE(n-2,i),i+=2,r.writeUInt8(e.flags||0,i),i+=1,d.encode(e.tag,r,i),i+=d.encode.bytes,r.write(e.value,i),i+=t.byteLength(e.value),T.encode.bytes=n,r},T.encode.bytes=0,T.decode=function(e,t){t||(t=0);const r=e.readUInt16BE(t),i=t+=2,n={};return n.flags=e.readUInt8(t),t+=1,n.tag=d.decode(e,t),t+=d.decode.bytes,n.value=e.toString("utf-8",t,i+r),n.issuerCritical=!!(n.flags&T.ISSUER_CRITICAL),T.decode.bytes=r+2,n},T.decode.bytes=0,T.encodingLength=function(e){return d.encodingLength(e.tag)+d.encodingLength(e.value)+2};const b=e.mx={};b.encode=function(e,r,i){r||(r=t.alloc(b.encodingLength(e))),i||(i=0);const n=i;return i+=2,r.writeUInt16BE(e.preference||0,i),i+=2,c.encode(e.exchange,r,i),i+=c.encode.bytes,r.writeUInt16BE(i-n-2,n),b.encode.bytes=i-n,r},b.encode.bytes=0,b.decode=function(e,t){t||(t=0);const r=t,i={};return t+=2,i.preference=e.readUInt16BE(t),t+=2,i.exchange=c.decode(e,t),t+=c.decode.bytes,b.decode.bytes=t-r,i},b.encodingLength=function(e){return 4+c.encodingLength(e.exchange)};const R=e.a={};R.encode=function(e,r,i){return r||(r=t.alloc(R.encodingLength(e))),i||(i=0),r.writeUInt16BE(4,i),i+=2,o.v4.encode(e,r,i),R.encode.bytes=6,r},R.encode.bytes=0,R.decode=function(e,t){t||(t=0),t+=2;const r=o.v4.decode(e,t);return R.decode.bytes=6,r},R.decode.bytes=0,R.encodingLength=function(){return 6};const w=e.aaaa={};w.encode=function(e,r,i){return r||(r=t.alloc(w.encodingLength(e))),i||(i=0),r.writeUInt16BE(16,i),i+=2,o.v6.encode(e,r,i),w.encode.bytes=18,r},w.encode.bytes=0,w.decode=function(e,t){t||(t=0),t+=2;const r=o.v6.decode(e,t);return w.decode.bytes=18,r},w.decode.bytes=0,w.encodingLength=function(){return 18};const A=e.option={};A.encode=function(e,r,i){r||(r=t.alloc(A.encodingLength(e))),i||(i=0);const n=i,s=a.toCode(e.code);if(r.writeUInt16BE(s,i),i+=2,e.data)r.writeUInt16BE(e.data.length,i),i+=2,e.data.copy(r,i),i+=e.data.length;else switch(s){case 8:const n=e.sourcePrefixLength||0,s=e.family||o.familyOf(e.ip),a=o.encode(e.ip,t.alloc),l=Math.ceil(n/8);r.writeUInt16BE(l+4,i),i+=2,r.writeUInt16BE(s,i),i+=2,r.writeUInt8(n,i++),r.writeUInt8(e.scopePrefixLength||0,i++),a.copy(r,i,0,l),i+=l;break;case 11:e.timeout?(r.writeUInt16BE(2,i),i+=2,r.writeUInt16BE(e.timeout,i),i+=2):(r.writeUInt16BE(0,i),i+=2);break;case 12:const c=e.length||0;r.writeUInt16BE(c,i),i+=2,r.fill(0,i,i+c),i+=c;break;case 14:const d=2*e.tags.length;r.writeUInt16BE(d,i),i+=2;for(const t of e.tags)r.writeUInt16BE(t,i),i+=2;break;default:throw new Error(`Unknown roption code: ${e.code}`)}return A.encode.bytes=i-n,r},A.encode.bytes=0,A.decode=function(e,r){r||(r=0);const i={};i.code=e.readUInt16BE(r),i.type=a.toString(i.code),r+=2;const n=e.readUInt16BE(r);switch(r+=2,i.data=e.slice(r,r+n),i.code){case 8:i.family=e.readUInt16BE(r),r+=2,i.sourcePrefixLength=e.readUInt8(r++),i.scopePrefixLength=e.readUInt8(r++);const s=t.alloc(1===i.family?4:16);e.copy(s,0,r,r+n-4),i.ip=o.decode(s);break;case 11:n>0&&(i.timeout=e.readUInt16BE(r),r+=2);break;case 14:i.tags=[];for(let t=0;t<n;t+=2)i.tags.push(e.readUInt16BE(r)),r+=2}return A.decode.bytes=n+4,i},A.decode.bytes=0,A.encodingLength=function(e){if(e.data)return e.data.length+4;switch(a.toCode(e.code)){case 8:const t=e.sourcePrefixLength||0;return Math.ceil(t/8)+8;case 11:return"number"==typeof e.timeout?6:4;case 12:return e.length+4;case 14:return 4+2*e.tags.length}throw new Error(`Unknown roption code: ${e.code}`)};const L=e.opt={};L.encode=function(e,r,i){r||(r=t.alloc(L.encodingLength(e))),i||(i=0);const n=i,s=U(e,A);return r.writeUInt16BE(s,i),i=B(e,A,r,i+2),L.encode.bytes=i-n,r},L.encode.bytes=0,L.decode=function(e,t){t||(t=0);const r=t,i=[];let n=e.readUInt16BE(t);t+=2;let s=0;for(;n>0;)i[s++]=A.decode(e,t),t+=A.decode.bytes,n-=A.decode.bytes;return L.decode.bytes=t-r,i},L.decode.bytes=0,L.encodingLength=function(e){return 2+U(e||[],A)};const C=e.dnskey={};C.PROTOCOL_DNSSEC=3,C.ZONE_KEY=128,C.SECURE_ENTRYPOINT=32768,C.encode=function(e,r,i){r||(r=t.alloc(C.encodingLength(e))),i||(i=0);const n=i,s=e.key;if(!t.isBuffer(s))throw new Error("Key must be a Buffer");return i+=2,r.writeUInt16BE(e.flags,i),i+=2,r.writeUInt8(C.PROTOCOL_DNSSEC,i),i+=1,r.writeUInt8(e.algorithm,i),i+=1,s.copy(r,i,0,s.length),i+=s.length,C.encode.bytes=i-n,r.writeUInt16BE(C.encode.bytes-2,n),r},C.encode.bytes=0,C.decode=function(e,t){t||(t=0);const r=t;var i={},n=e.readUInt16BE(t);if(t+=2,i.flags=e.readUInt16BE(t),t+=2,e.readUInt8(t)!==C.PROTOCOL_DNSSEC)throw new Error("Protocol must be 3");return t+=1,i.algorithm=e.readUInt8(t),t+=1,i.key=e.slice(t,r+n+2),t+=i.key.length,C.decode.bytes=t-r,i},C.decode.bytes=0,C.encodingLength=function(e){return 6+t.byteLength(e.key)};const I=e.rrsig={};I.encode=function(e,i,n){i||(i=t.alloc(I.encodingLength(e))),n||(n=0);const s=n,a=e.signature;if(!t.isBuffer(a))throw new Error("Signature must be a Buffer");return n+=2,i.writeUInt16BE(r.toType(e.typeCovered),n),n+=2,i.writeUInt8(e.algorithm,n),n+=1,i.writeUInt8(e.labels,n),n+=1,i.writeUInt32BE(e.originalTTL,n),n+=4,i.writeUInt32BE(e.expiration,n),n+=4,i.writeUInt32BE(e.inception,n),n+=4,i.writeUInt16BE(e.keyTag,n),n+=2,c.encode(e.signersName,i,n),n+=c.encode.bytes,a.copy(i,n,0,a.length),n+=a.length,I.encode.bytes=n-s,i.writeUInt16BE(I.encode.bytes-2,s),i},I.encode.bytes=0,I.decode=function(e,t){t||(t=0);const i=t;var n={},s=e.readUInt16BE(t);return t+=2,n.typeCovered=r.toString(e.readUInt16BE(t)),t+=2,n.algorithm=e.readUInt8(t),t+=1,n.labels=e.readUInt8(t),t+=1,n.originalTTL=e.readUInt32BE(t),t+=4,n.expiration=e.readUInt32BE(t),t+=4,n.inception=e.readUInt32BE(t),t+=4,n.keyTag=e.readUInt16BE(t),t+=2,n.signersName=c.decode(e,t),t+=c.decode.bytes,n.signature=e.slice(t,i+s+2),t+=n.signature.length,I.decode.bytes=t-i,n},I.decode.bytes=0,I.encodingLength=function(e){return 20+c.encodingLength(e.signersName)+t.byteLength(e.signature)};const k=e.rp={};k.encode=function(e,r,i){r||(r=t.alloc(k.encodingLength(e))),i||(i=0);const n=i;return i+=2,c.encode(e.mbox||".",r,i),i+=c.encode.bytes,c.encode(e.txt||".",r,i),i+=c.encode.bytes,k.encode.bytes=i-n,r.writeUInt16BE(k.encode.bytes-2,n),r},k.encode.bytes=0,k.decode=function(e,t){t||(t=0);const r=t,i={};return t+=2,i.mbox=c.decode(e,t)||".",t+=c.decode.bytes,i.txt=c.decode(e,t)||".",t+=c.decode.bytes,k.decode.bytes=t-r,i},k.decode.bytes=0,k.encodingLength=function(e){return 2+c.encodingLength(e.mbox||".")+c.encodingLength(e.txt||".")};const D={encode:function(e,i,n){i||(i=t.alloc(D.encodingLength(e))),n||(n=0);const s=n;for(var a=[],o=0;o<e.length;o++){var l=r.toType(e[o]);void 0===a[l>>8]&&(a[l>>8]=[]),a[l>>8][l>>3&31]|=1<<7-(7&l)}for(o=0;o<a.length;o++)if(void 0!==a[o]){var c=t.from(a[o]);i.writeUInt8(o,n),n+=1,i.writeUInt8(c.length,n),n+=1,c.copy(i,n),n+=c.length}return D.encode.bytes=n-s,i}};D.encode.bytes=0,D.decode=function(e,t,i){t||(t=0);const n=t;for(var s=[];t-n<i;){var a=e.readUInt8(t);t+=1;var o=e.readUInt8(t);t+=1;for(var l=0;l<o;l++)for(var c=e.readUInt8(t+l),d=0;d<8;d++)if(c&1<<7-d){var u=r.toString(a<<8|l<<3|d);s.push(u)}t+=o}return D.decode.bytes=t-n,s},D.decode.bytes=0,D.encodingLength=function(e){for(var t=[],i=0;i<e.length;i++){var n=r.toType(e[i]);t[n>>8]=Math.max(t[n>>8]||0,255&n)}var s=0;for(i=0;i<t.length;i++)void 0!==t[i]&&(s+=2+Math.ceil((t[i]+1)/8));return s};const P=e.nsec={};P.encode=function(e,r,i){r||(r=t.alloc(P.encodingLength(e))),i||(i=0);const n=i;return i+=2,c.encode(e.nextDomain,r,i),i+=c.encode.bytes,D.encode(e.rrtypes,r,i),i+=D.encode.bytes,P.encode.bytes=i-n,r.writeUInt16BE(P.encode.bytes-2,n),r},P.encode.bytes=0,P.decode=function(e,t){t||(t=0);const r=t;var i={},n=e.readUInt16BE(t);return t+=2,i.nextDomain=c.decode(e,t),t+=c.decode.bytes,i.rrtypes=D.decode(e,t,n-(t-r)),t+=D.decode.bytes,P.decode.bytes=t-r,i},P.decode.bytes=0,P.encodingLength=function(e){return 2+c.encodingLength(e.nextDomain)+D.encodingLength(e.rrtypes)};const O=e.nsec3={};O.encode=function(e,r,i){r||(r=t.alloc(O.encodingLength(e))),i||(i=0);const n=i,s=e.salt;if(!t.isBuffer(s))throw new Error("salt must be a Buffer");const a=e.nextDomain;if(!t.isBuffer(a))throw new Error("nextDomain must be a Buffer");return i+=2,r.writeUInt8(e.algorithm,i),i+=1,r.writeUInt8(e.flags,i),i+=1,r.writeUInt16BE(e.iterations,i),i+=2,r.writeUInt8(s.length,i),i+=1,s.copy(r,i,0,s.length),i+=s.length,r.writeUInt8(a.length,i),i+=1,a.copy(r,i,0,a.length),i+=a.length,D.encode(e.rrtypes,r,i),i+=D.encode.bytes,O.encode.bytes=i-n,r.writeUInt16BE(O.encode.bytes-2,n),r},O.encode.bytes=0,O.decode=function(e,t){t||(t=0);const r=t;var i={},n=e.readUInt16BE(t);t+=2,i.algorithm=e.readUInt8(t),t+=1,i.flags=e.readUInt8(t),t+=1,i.iterations=e.readUInt16BE(t),t+=2;const s=e.readUInt8(t);t+=1,i.salt=e.slice(t,t+s),t+=s;const a=e.readUInt8(t);return t+=1,i.nextDomain=e.slice(t,t+a),t+=a,i.rrtypes=D.decode(e,t,n-(t-r)),t+=D.decode.bytes,O.decode.bytes=t-r,i},O.decode.bytes=0,O.encodingLength=function(e){return 8+e.salt.length+e.nextDomain.length+D.encodingLength(e.rrtypes)};const x=e.ds={};x.encode=function(e,r,i){r||(r=t.alloc(x.encodingLength(e))),i||(i=0);const n=i,s=e.digest;if(!t.isBuffer(s))throw new Error("Digest must be a Buffer");return i+=2,r.writeUInt16BE(e.keyTag,i),i+=2,r.writeUInt8(e.algorithm,i),i+=1,r.writeUInt8(e.digestType,i),i+=1,s.copy(r,i,0,s.length),i+=s.length,x.encode.bytes=i-n,r.writeUInt16BE(x.encode.bytes-2,n),r},x.encode.bytes=0,x.decode=function(e,t){t||(t=0);const r=t;var i={},n=e.readUInt16BE(t);return t+=2,i.keyTag=e.readUInt16BE(t),t+=2,i.algorithm=e.readUInt8(t),t+=1,i.digestType=e.readUInt8(t),t+=1,i.digest=e.slice(t,r+n+2),t+=i.digest.length,x.decode.bytes=t-r,i},x.decode.bytes=0,x.encodingLength=function(e){return 6+t.byteLength(e.digest)};const M=e.record=function(e){switch(e.toUpperCase()){case"A":return R;case"PTR":return _;case"CNAME":return v;case"DNAME":return E;case"TXT":return m;case"NULL":return g;case"AAAA":return w;case"SRV":return S;case"HINFO":return y;case"CAA":return T;case"NS":return f;case"SOA":return p;case"MX":return b;case"OPT":return L;case"DNSKEY":return C;case"RRSIG":return I;case"RP":return k;case"NSEC":return P;case"NSEC3":return O;case"DS":return x}return h},N=e.answer={};N.encode=function(e,i,n){i||(i=t.alloc(N.encodingLength(e))),n||(n=0);const a=n;if(c.encode(e.name,i,n),n+=c.encode.bytes,i.writeUInt16BE(r.toType(e.type),n),"OPT"===e.type.toUpperCase()){if("."!==e.name)throw new Error("OPT name must be root.");i.writeUInt16BE(e.udpPayloadSize||4096,n+2),i.writeUInt8(e.extendedRcode||0,n+4),i.writeUInt8(e.ednsVersion||0,n+5),i.writeUInt16BE(e.flags||0,n+6),n+=8,L.encode(e.options||[],i,n),n+=L.encode.bytes}else{let t=s.toClass(void 0===e.class?"IN":e.class);e.flush&&(t|=l),i.writeUInt16BE(t,n+2),i.writeUInt32BE(e.ttl||0,n+4),n+=8;const r=M(e.type);r.encode(e.data,i,n),n+=r.encode.bytes}return N.encode.bytes=n-a,i},N.encode.bytes=0,N.decode=function(e,t){t||(t=0);const i={},n=t;if(i.name=c.decode(e,t),t+=c.decode.bytes,i.type=r.toString(e.readUInt16BE(t)),"OPT"===i.type)i.udpPayloadSize=e.readUInt16BE(t+2),i.extendedRcode=e.readUInt8(t+4),i.ednsVersion=e.readUInt8(t+5),i.flags=e.readUInt16BE(t+6),i.flag_do=1==(i.flags>>15&1),i.options=L.decode(e,t+8),t+=8+L.decode.bytes;else{const r=e.readUInt16BE(t+2);i.ttl=e.readUInt32BE(t+4),i.class=s.toString(-32769&r),i.flush=!!(r&l);const n=M(i.type);i.data=n.decode(e,t+8),t+=8+n.decode.bytes}return N.decode.bytes=t-n,i},N.decode.bytes=0,N.encodingLength=function(e){const t=null!==e.data&&void 0!==e.data?e.data:e.options;return c.encodingLength(e.name)+8+M(e.type).encodingLength(t)};const F=e.question={};function U(e,t){let r=0;for(let i=0;i<e.length;i++)r+=t.encodingLength(e[i]);return r}function B(e,t,r,i){for(let n=0;n<e.length;n++)t.encode(e[n],r,i),i+=t.encode.bytes;return i}function H(e,t,r,i){for(let n=0;n<e.length;n++)e[n]=t.decode(r,i),i+=t.decode.bytes;return i}F.encode=function(e,i,n){i||(i=t.alloc(F.encodingLength(e))),n||(n=0);const a=n;return c.encode(e.name,i,n),n+=c.encode.bytes,i.writeUInt16BE(r.toType(e.type),n),n+=2,i.writeUInt16BE(s.toClass(void 0===e.class?"IN":e.class),n),n+=2,F.encode.bytes=n-a,e},F.encode.bytes=0,F.decode=function(e,t){t||(t=0);const i=t,n={};n.name=c.decode(e,t),t+=c.decode.bytes,n.type=r.toString(e.readUInt16BE(t)),t+=2,n.class=s.toString(e.readUInt16BE(t)),t+=2;return!!(32768&n.class)&&(n.class&=-32769),F.decode.bytes=t-i,n},F.decode.bytes=0,F.encodingLength=function(e){return c.encodingLength(e.name)+4},e.AUTHORITATIVE_ANSWER=1024,e.TRUNCATED_RESPONSE=512,e.RECURSION_DESIRED=256,e.RECURSION_AVAILABLE=128,e.AUTHENTIC_DATA=32,e.CHECKING_DISABLED=16,e.DNSSEC_OK=32768,e.encode=function(r,i,n){const s=!i;s&&(i=t.alloc(e.encodingLength(r))),n||(n=0);const a=n;return r.questions||(r.questions=[]),r.answers||(r.answers=[]),r.authorities||(r.authorities=[]),r.additionals||(r.additionals=[]),u.encode(r,i,n),n+=u.encode.bytes,n=B(r.questions,F,i,n),n=B(r.answers,N,i,n),n=B(r.authorities,N,i,n),n=B(r.additionals,N,i,n),e.encode.bytes=n-a,s&&e.encode.bytes!==i.length?i.slice(0,e.encode.bytes):i},e.encode.bytes=0,e.decode=function(t,r){r||(r=0);const i=r,n=u.decode(t,r);return r+=u.decode.bytes,r=H(n.questions,F,t,r),r=H(n.answers,N,t,r),r=H(n.authorities,N,t,r),r=H(n.additionals,N,t,r),e.decode.bytes=r-i,n},e.decode.bytes=0,e.encodingLength=function(e){return u.encodingLength(e)+U(e.questions||[],F)+U(e.answers||[],N)+U(e.authorities||[],N)+U(e.additionals||[],N)},e.streamEncode=function(r){const i=e.encode(r),n=t.alloc(2);n.writeUInt16BE(i.byteLength);const s=t.concat([n,i]);return e.streamEncode.bytes=s.byteLength,s},e.streamEncode.bytes=0,e.streamDecode=function(t){const r=t.readUInt16BE(0);if(t.byteLength<r+2)return null;const i=e.decode(t.slice(2));return e.streamDecode.bytes=e.decode.bytes,i},e.streamDecode.bytes=0}(MF);const qF="DomainUtil";const ZF=new class{async dnsQuery(e){if(!1===ik.getParameter(ek)||!e||e.length<1)return"";let t="";for(const r of e){if(!this.checkDomain(r)){Qv.info(qF,"check domain not need dns parse,".concat(r));const e=this.getIpFromUrl(r);return Qv.info(qF,"check domain get ip:".concat(e[0])),e[0]}const e={type:"query",id:0,flags:256,questions:[{type:"A",name:r.includes("/")?this.getDomainFromUrl(r.replace(/^\.|\.$/gm,"")):r}]};for(const i of Dh.PUBLIC_DNS_SERVER)try{const n=await jv.fetch(["https://".concat(i,"/dns-query?dns=").concat(Zv.dnsRequestEncode(e))],{method:"GET",mode:"cors"},{},Dh.DNS_REQUEST_TIMEOUT);if(200!==n.httpCode){Qv.error(qF,"dns parse failed:".concat(r));continue}const s=MF.decode(_u.from(n.data));for(const e of(null==s?void 0:s.answers)||[])if("A"===e.type){t=e.data;break}if(t)break;Qv.error(qF,"dns parse failed, ip4ARecord is null!");continue}catch(IU){Qv.error(qF,"dnsQuery failed for ".concat(r,":  ").concat(IU))}if(t)break}return Qv.info(qF,"dns query domain get ip:".concat(t)),t}checkDomain(e){return/^((https?):\/\/)?[\da-z\.-]{1,64}\.[a-z\.]{2,6}($|\/[\w\.-\/]*$)/g.test(e)}getIpFromUrl(e){const t=new RegExp(/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/);return e.match(t)}getDomainFromUrl(e){const t=e.split("/");return e[2]?t[2]:""}};var XF,JF,QF,eU,tU,rU,iU,nU,sU,aU,oU,lU,cU,dU,uU,hU,fU,pU,mU,gU;function yU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function _U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yU(Object(r),!0).forEach((function(t){$l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yU(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const vU="HWLLSClient";let EU=(XF=ck("HWLLSClient$startPlay#Promise<void>#string#StartPlayOptions"),JF=ck("HWLLSClient$startPlayCustomize#Promise<void>#string#StartPlayOptions"),QF=ck("HWLLSClient$switchPlay#Promise<boolean>#string#StartPlayOptions"),eU=dk("HWLLSClient$stopPlay#boolean#void"),tU=ck("HWLLSClient$replay#Promise<boolean>#void"),rU=ck("HWLLSClient$resume#Promise<boolean>#void"),iU=dk("HWLLSClient$pause#boolean#void"),nU=dk("HWLLSClient$pauseVideo#boolean#void"),sU=ck("HWLLSClient$resumeVideo#Promise<boolean>#void"),aU=dk("HWLLSClient$pauseAudio#boolean#void"),oU=ck("HWLLSClient$Promise<boolean>#boolean#void"),lU=dk("HWLLSClient$setPlayoutVolume#boolean#number"),cU=dk("HWLLSClient$getPlayoutVolume#number#void"),dU=dk("HWLLSClient$muteAudio#void#boolean"),uU=dk("HWLLSClient$streamStatistic#void#boolean#number#ExecutableFunction"),hU=dk("HWLLSClient$destoryClient#void#void"),fU=dk("HWLLSClient$fullScreenToggle#void#boolean"),pU=dk("HWLLSClient$enableStreamStateDetection#boolean#boolean#number#StreamInterruptRetry"),mU=dk("HWLLSClient$sendMessage#boolean#string|ArrayBuffer"),gU=class extends kD{constructor(){super(vU),$l(this,"debugStatisticTimer",{timer:null,interval:1}),$l(this,"detectTimer",{timer:null,interval:3,interruptRetry:null}),$l(this,"recoveryInfo",{recoveryTimer:null,retryTimes:0,recoveryUrl:null}),$l(this,"videoRecoveryInfo",{interval:3,retryTimes:30}),$l(this,"firstFrameHandler",{videoHandler:()=>{var e,t;null===(e=wD.getInstance(this.identifiedId))||void 0===e||e.updatePlayTrackKpi("videoPlaySucc"),this.receivedFirstFrame=!0;let r=xk.SUCC;(null===(t=wD.getInstance(this.identifiedId))||void 0===t?void 0:t.getPlayTrackKpi().videoTimeOut)>0&&(r=xk.SUCC_AFTER_TIMEOUT),this.stats.reportPullMediaStreamResult(Pk.TRACK_TYPE_VIDEO,r)},audioHandler:()=>{var e,t;null===(e=wD.getInstance(this.identifiedId))||void 0===e||e.updatePlayTrackKpi("audioPlaySucc");let r=xk.SUCC;(null===(t=wD.getInstance(this.identifiedId))||void 0===t?void 0:t.getPlayTrackKpi().audioTimeOut)>0&&(r=xk.SUCC_AFTER_TIMEOUT),this.stats.reportPullMediaStreamResult(Pk.TRACK_TYPE_AUDIO,r)}}),this.preNetQuality=jk.NETWORK_QUALITY_INIT,this.preRemoteStreamStatistic={packetsReceived:[0,0],packetsLost:[0,0],nackCnt:[0,0],preLostRate:[]},this.connectionsManager=new gP(this.stats,this.eventEmitter,this.identifiedId),this.initErrorMap(),window.onbeforeunload=()=>{Qv.info(vU,"app is closing, emergency stop"),this.liveStream&&this.stopSignal()},this.downgraded=!1,this.receivedFirstFrame=!1,this.domains=[]}async startPlay(e,t){if(await this.checkDowngrade(t))return;Qv.info(vU,"[KPI] startPlay url: ".concat(Qv.shieldUrlParameters(e))),wD.addInstance(this.identifiedId),wD.getInstance(this.identifiedId).updatePlayTrackKpi("startPlayTime");let r=PP.checkUrlFormat(e,zk.WEBRTC);if(!r)throw Qv.error(vU,"startPlay failed, invalid url protocol or format: ".concat(e)),new xh(Ph.HWLLS_ERROR_INVALID_URL);if(r=PP.checkPlayOpt(t),!r)throw Qv.error(vU,"startPlay failed, invalid Parameter: ".concat(JSON.stringify(t))),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER);await this.initPeerConnection(e,Dk.COMMON_STANDARD,t),this.netQualityRegularReport(),this.debugStatisticTimer.timer&&this.streamStatistic(!0,this.debugStatisticTimer.interval),this.detectTimer.timer&&(Qv.info(vU,"video stream start play , this.detectTimer.timer : ".concat(this.detectTimer.timer)),this.enableStreamStateDetection(!0,this.detectTimer.interval,this.detectTimer.interruptRetry))}async startPlayCustomize(e,t){if(await this.checkDowngrade(t))return;Qv.info(vU,"[KPI] startPlay url: ".concat(Qv.shieldUrlParameters(e))),wD.addInstance(this.identifiedId),wD.getInstance(this.identifiedId).updatePlayTrackKpi("startPlayTime");if(!PP.checkPlayOpt(t))throw Qv.error(vU,"startPlayCustomize failed, invalid Parameter: ".concat(JSON.stringify(t))),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER);await this.initPeerConnection(e,Dk.CUSTOMIZE_STANDARD,t),this.netQualityRegularReport(),this.debugStatisticTimer.timer&&this.streamStatistic(!0,this.debugStatisticTimer.interval),this.detectTimer.timer&&this.enableStreamStateDetection(!0,this.detectTimer.interval,this.detectTimer.interruptRetry)}async switchPlay(e,t){var r;if(this.downgraded)return void(null===(r=this.autoDowngradeManager)||void 0===r||r.switchPlay(e,t));if(this.liveStream){const e=Zv.getCurrentLocalTimestamp();try{this.liveStream.stop(),this.stopSignal(),wD.getInstance(this.identifiedId).updatePlayTrackKpi("endPlayTime")}catch(IU){Qv.error(vU,"stopPlay occur error: ".concat(IU))}finally{this.stats.reportStopPullStreamReqEvent(e),this.resetClient4Switch()}}Qv.info(vU,"[KPI] switchPlay url: ".concat(Qv.shieldUrlParameters(e))),wD.addInstance(this.identifiedId),wD.getInstance(this.identifiedId).updatePlayTrackKpi("startPlayTime");let i=!1,n=Dk.COMMON_STANDARD;if(/webrtc:\/\/.*/gi.test(e)){if(i=PP.checkUrlFormat(e,zk.WEBRTC),!i)throw Qv.error(vU,"switchPlay failed, invalid Parameter: ".concat(e)),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER)}else n=Dk.CUSTOMIZE_STANDARD;if(!t&&!this.startPlayOptions)throw Qv.error(vU,"switchPlay failed, options is null"),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER);if(t&&(i=PP.checkPlayOpt(t),!i))throw Qv.error(vU,"switchPlay failed, invalid Parameter: ".concat(JSON.stringify(t))),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER);await this.initPeerConnection(e,n,t||this.startPlayOptions,!0),this.debugStatisticTimer.timer&&this.streamStatistic(!0,this.debugStatisticTimer.interval),this.detectTimer.timer&&this.enableStreamStateDetection(!0,this.detectTimer.interval,this.detectTimer.interruptRetry)}stopPlay(){var e;if(this.receivedFirstFrame=!1,this.downgraded)return null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.stopPlay();if(this.liveStream){const e=Zv.getCurrentLocalTimestamp();try{return this.liveStream.stop(),this.stopSignal(),wD.getInstance(this.identifiedId).updatePlayTrackKpi("endPlayTime"),!0}finally{this.stats.reportStopPullStreamReqEvent(e),this.resetClient4Stop()}}return!1}async replay(){var e;if(this.downgraded)return null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.replay();if(this.liveStream)try{return await this.liveStream.resume(),!0}catch(IU){return Qv.error(vU,"resume failed: ".concat(IU)),!1}return!1}async resume(){var e;if(this.downgraded)return null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.resume();if(this.liveStream)try{return await this.liveStream.resume(),!0}catch(IU){return Qv.error(vU,"resume failed: ".concat(IU)),!1}return!1}pause(){var e;return this.downgraded?null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.pause():!!this.liveStream&&(this.liveStream.pause(),!0)}pauseVideo(){var e;return this.downgraded?null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.pauseVideo():!!this.liveStream&&(this.liveStream.pauseVideo(),!0)}async resumeVideo(){var e;if(this.downgraded)return null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.resumeVideo();if(this.liveStream)try{return await this.liveStream.resumeVideo(),!0}catch(IU){return Qv.error(vU,"resumeVideo failed: ".concat(IU)),!1}return!1}pauseAudio(){var e;return this.downgraded?null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.pauseAudio():!!this.liveStream&&(this.liveStream.pauseAudio(),!0)}async resumeAudio(){var e;if(this.downgraded)return null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.resumeAudio();if(this.liveStream)try{return await this.liveStream.resumeAudio(),!0}catch(IU){return Qv.error(vU,"resumeAudio failed: ".concat(IU)),!1}return!1}setPlayoutVolume(e){var t;if(this.downgraded)return null===(t=this.autoDowngradeManager)||void 0===t?void 0:t.setPlayoutVolume(e);if(this.liveStream){const t=this.liveStream.getAudioHRTCTrack();if(t)return t.setAudioVolume(e),!0}return!1}on(e,t){[Hk.MEDIA_STATISTIC,Hk.NET_QUALITY].includes(e)?super.on(e,t):super.on(e,t,!0)}off(e,t){[Hk.MEDIA_STATISTIC,Hk.NET_QUALITY].includes(e)?super.off(e,t):super.off(e,t,!0)}getPlayoutVolume(){var e;if(this.downgraded)return null===(e=this.autoDowngradeManager)||void 0===e?void 0:e.getPlayoutVolume();if(this.liveStream)try{const e=this.liveStream.getAudioHRTCTrack();if(e)return 100*e.getAudioLevel()}catch(IU){Qv.error(vU,"getPlayoutVolume occur error: ".concat(IU))}return 0}muteAudio(e){var t;if(this.downgraded)null===(t=this.autoDowngradeManager)||void 0===t||t.muteAudio(e);else if(this.liveStream)try{const t=this.liveStream.getAudioHRTCTrack();t&&t.muteAudio(e)}catch(IU){Qv.error(vU,"muteAudio occur error: ".concat(IU))}}streamStatistic(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var r;if(this.downgraded)null===(r=this.autoDowngradeManager)||void 0===r||r.streamStatistic(e,t);else if(e){if(!Number.isInteger(t)||t<1||t>60)throw Qv.error(vU,"streamStatistic, invalid parameter of interval."),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER);const e={audioReceiveBytes:0,videoReceiveBytes:0,videoFrames:0};this.getStreamStatisticInfo(e,t)}else clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer={timer:null,interval:1}}destoryClient(){var e;window.onbeforeunload=null,this.resetClient(),this.offAllEvents(),null===(e=this.autoDowngradeManager)||void 0===e||e.destoryClient()}fullScreenToggle(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t,r,i;this.downgraded?null===(t=this.autoDowngradeManager)||void 0===t||t.fullScreenToggle(e):e?null===(r=this.liveStream)||void 0===r||r.exitFullScreen():null===(i=this.liveStream)||void 0===i||i.enterFullScreen()}enableStreamStateDetection(e){var t,r,i;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,s=arguments.length>2?arguments[2]:void 0;var a;if(this.downgraded)return null===(a=this.autoDowngradeManager)||void 0===a?void 0:a.enableStreamStateDetection(e,n,s);if(!e)return clearTimeout(this.detectTimer.timer),this.detectTimer={timer:null,interval:n,interruptRetry:null},!0;if(!Number.isInteger(n)||n<1||n>60)throw Qv.error(vU,"enableStreamStateDetection, invalid parameter of interval."),new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER);clearTimeout(this.detectTimer.timer);const o={preVideoStat:{preFramesDecoded:0,isInterrupted:!1},preAudioStat:{prePacketReceived:0,isInterrupted:!1}},l=null===(t=wD.getInstance(this.identifiedId))||void 0===t?void 0:t.getSfuInfo();var c,d;null!==(r=this.liveStream)&&void 0!==r&&r.getVideoHRTCTrack()&&(o.preVideoStat.preFramesDecoded=Zv.getValue(null===(c=SD.getLeastestVideoInfo(this.connectionsManager.getConnectionId(),l.vSsrc))||void 0===c?void 0:c.framesDecoded,0));null!==(i=this.liveStream)&&void 0!==i&&i.getAudioHRTCTrack()&&(o.preAudioStat.prePacketReceived=Zv.getValue(null===(d=SD.getLeastestVideoInfo(this.connectionsManager.getConnectionId(),l.aSsrc))||void 0===d?void 0:d.packetsReceived,0));return this.detectTimer.interval=n,this.detectTimer.interruptRetry=s,Qv.info(vU,"video stream , enableStreamStateDetection ,\n      detect interval : ".concat(n,",\n      recoverenable:").concat(s.enable," ,\n      recover interval:").concat(s.retryInterval,",\n      recovertimes:").concat(s.retryTimes)),this.judgeStreamInterrupted(o,n,s),!0}sendMessage(e){return e.msg?this.connectionsManager.sendMessage(e.userUid||0,e.msg):(Qv.error(vU,"send msg is null"),!1)}judgeStreamInterrupted(e,t,r){this.detectTimer.timer=setTimeout((()=>{var i,n,s,a,o,l,c;clearTimeout(this.detectTimer.timer);let d=null,u=null,h=!1,f=!1;const p=null===(i=wD.getInstance(this.identifiedId))||void 0===i?void 0:i.getSfuInfo();var m,g;null!==(n=this.liveStream)&&void 0!==n&&n.getVideoHRTCTrack()&&(d=SD.getLeastestVideoInfo(this.connectionsManager.getConnectionId(),p.vSsrc),h=Zv.getValue(null===(m=d)||void 0===m?void 0:m.framesDecoded,0)-Zv.getValue(e.preVideoStat.preFramesDecoded,0)<=0,h||(clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.retryTimes=0),d&&(e.preVideoStat.preFramesDecoded=Zv.getValue(d.framesDecoded,0)));null!==(s=this.liveStream)&&void 0!==s&&s.getAudioHRTCTrack()&&(u=SD.getLeastestAudioInfo(this.connectionsManager.getConnectionId(),p.aSsrc),f=Zv.getValue(null===(g=u)||void 0===g?void 0:g.packetsReceived,0)-Zv.getValue(e.preAudioStat.prePacketReceived,0)<=0,u&&(e.preAudioStat.prePacketReceived=Zv.getValue(u.packetsReceived,0)));if(!1!==(null===(a=this.startPlayOptions)||void 0===a||null===(o=a.webrtcConfig)||void 0===o?void 0:o.receiveVideo))if(e.preVideoStat.isInterrupted&&!h)this.eventEmitter.emit(Hk.VIDEO_RECOVERY),e.preVideoStat.isInterrupted=!1,Qv.info(vU,"video stream recovery ...");else if(!e.preVideoStat.isInterrupted&&h&&(this.eventEmitter.emit(Hk.VIDEO_INTERRUPTED),e.preVideoStat.isInterrupted=!0,Qv.info(vU,"video stream interrupt, retry enable : ".concat(null==r?void 0:r.enable)),null!=r&&r.enable)){var y,_;clearTimeout(this.recoveryInfo.recoveryTimer);const e=null!==(y=r.retryInterval)&&void 0!==y?y:3,t=null!==(_=null==r?void 0:r.retryTimes)&&void 0!==_?_:30;this.autoRecoverPlay(this.recoveryInfo.recoveryUrl,e,t)}!1!==(null===(l=this.startPlayOptions)||void 0===l||null===(c=l.webrtcConfig)||void 0===c?void 0:c.receiveAudio)&&(e.preAudioStat.isInterrupted&&!f?(this.eventEmitter.emit(Hk.AUDIO_RECOVERY),e.preAudioStat.isInterrupted=!1):!e.preAudioStat.isInterrupted&&f&&(this.eventEmitter.emit(Hk.AUDIO_INTERRUPTED),e.preAudioStat.isInterrupted=!0)),this.judgeStreamInterrupted(e,t,r)}),1e3*t)}autoRecoverPlay(e,t,r){let i=0;const n=0==this.recoveryInfo.retryTimes?0:t;this.recoveryInfo.recoveryTimer=setTimeout((async()=>{if(Qv.info(vU,"video stream , autoRecoverPlay every ".concat(t," sencond, currentRetryTimes : ").concat(this.recoveryInfo.retryTimes)),clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.recoveryTimer=null,e===this.recoveryInfo.recoveryUrl)try{this.recoveryInfo.retryTimes++,i=this.recoveryInfo.retryTimes,await this.switchPlay(e,_U(_U({},this.startPlayOptions),{recover:!0})).then((()=>{this.recoveryInfo.retryTimes=0}))}catch(ZO){Qv.error(vU,"video stream , recovery failed, err : ".concat(ZO)),this.recoveryInfo.retryTimes=i,i<r?this.autoRecoverPlay(e,t,r):(this.recoveryInfo.retryTimes=0,this.eventEmitter.emit("Error",{errCode:Ph.HWLLS_PLAY_WEBRTC_RETRY_FAILED,errDesc:Oh[Ph.HWLLS_PLAY_WEBRTC_RETRY_FAILED]}))}else this.recoveryInfo.retryTimes=0}),1e3*n)}initErrorMap(){this.errMap=new Map,this.errMap.set(100,Ph.HWLLS_ERROR_INVALID_URL),this.errMap.set(101,Ph.HWLLS_ERROR_INVALID_PARAMETER),this.errMap.set(102,Ph.HWLLS_ERROR_ENCODING_NOT_ACCEPTED),this.errMap.set(400,Ph.HWLLS_ERROR_BAD_REQUEST),this.errMap.set(401,Ph.HWLLS_ERROR_STREAM_INVALID_PARAMETER),this.errMap.set(403,Ph.HWLLS_ERROR_AUTH_FAIL),this.errMap.set(404,Ph.HWLLS_ERROR_STREAM_NOT_EXIST),this.errMap.set(500,Ph.HWLLS_ERROR_SERVER_CONNECT_FAIL),this.errMap.set(503,Ph.HWLLS_ERROR_SERVER_CONNECT_FAIL),this.errMap.set(601,Ph.HWLLS_BUSSINESS_DOWNGRADE)}async calcNetworkQuality(){const e=this.connectionsManager.getConnection();if(!e)return jk.NETWORK_QUALITY_UNKNOW;if(e&&["disconnected","failed","closed"].includes(e.connectionState))return jk.NETWORK_QUALITY_DISCONNECT;let t=await this.getDownloadStatistic(Pk.TRACK_TYPE_VIDEO);return t<0&&(t=await this.getDownloadStatistic(Pk.TRACK_TYPE_AUDIO)),-1===t?jk.NETWORK_QUALITY_UNKNOW:t<1?jk.NETWORK_QUALITY_GREAT:t<5?jk.NETWORK_QUALITY_GOOD:t<12?jk.NETWORK_QUALITY_DEFECTS:t<20?jk.NETWORK_QUALITY_WEAK:t<30?jk.NETWORK_QUALITY_BAD:jk.NETWORK_QUALITY_DISCONNECT}async getDownloadStatistic(e){const t=wD.getInstance(this.identifiedId).getSfuInfo(),r=e===Pk.TRACK_TYPE_VIDEO?SD.getLeastestVideoInfo(this.connectionsManager.getConnectionId(),null==t?void 0:t.vSsrc):SD.getLeastestAudioInfo(this.connectionsManager.getConnectionId(),null==t?void 0:t.aSsrc);if(!r)return-1;const i=e===Pk.TRACK_TYPE_VIDEO?0:1,n={packetsReceived:0,packetsLost:0,nackCnt:0};if(n.packetsReceived=Zv.getValue(r.packetsReceived,0),n.packetsLost=Zv.getValue(r.packetsLost,0),n.nackCnt=Zv.getValue(r.nackCount,0),0===n.packetsReceived)return-1;const s=Math.max(n.packetsReceived-this.preRemoteStreamStatistic.packetsReceived[i],1),a=Math.max(n.packetsLost-this.preRemoteStreamStatistic.packetsLost[i],0),o=Math.max(n.nackCnt-this.preRemoteStreamStatistic.nackCnt[i],0);let l=0;const c=100*o/(o+s);l=c<=20?.9*o*100/(.9*o+s):c<=30?.86*o*100/(.86*o+s):c<=40?.82*o*100/(.82*o+s):c<=50?.78*o*100/(.78*o+s):.7*o*100/(.7*o+s),this.preRemoteStreamStatistic.preLostRate.push(Math.min(Math.max(100*a/(a+s),l),100)),this.preRemoteStreamStatistic.preLostRate.length>3&&this.preRemoteStreamStatistic.preLostRate.shift(),this.preRemoteStreamStatistic.packetsReceived[i]=n.packetsReceived,this.preRemoteStreamStatistic.packetsLost[i]=n.packetsLost,this.preRemoteStreamStatistic.nackCnt[i]=n.nackCnt;const d=this.smoothData(this.preRemoteStreamStatistic.preLostRate,.9);return d[d.length-1]}smoothData(e,t){const r=e=>e.reduce((function(e,t){return e+t}),0)/e.length,i=r(e)*t,n=[];for(let s=0;s<e.length;s++){const t=e[s],a=s>0?n[s-1]:e[e.length-1],o=s<e.length-1?e[s+1]:e[0],l=Number(r([i,a,t,o]).toFixed(2));n.push(l)}return n}netQualityRegularReport(){clearTimeout(this.netQualityTimer),this.netQualityTimer=setTimeout((()=>{clearTimeout(this.netQualityTimer),this.calcNetworkQuality().then((e=>{this.preNetQuality!==jk.NETWORK_QUALITY_INIT&&this.preNetQuality===e||(Qv.info(vU,"emit: ".concat(Hk.NET_QUALITY,", quality: ").concat(e," ")),this.eventEmitter.emit(Hk.NET_QUALITY,e),this.loadingconfig.netQualityLoading&&this.eventEmitter.emit(Hk.VIDEO_STUCK,e<=jk.NETWORK_QUALITY_UNKNOW||e>=this.loadingconfig.netQualityLoadingThreshold)),this.preNetQuality=e})).finally(this.netQualityRegularReport.bind(this))}),1e3)}checkRecover(e){e?(delete this.startPlayOptions.recover,this.playOption=_U(_U({},this.startPlayOptions),{autoPlay:!0})):this.playOption=this.startPlayOptions}async initPeerConnection(e){var t,r,i,n;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Dk.COMMON_STANDARD,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;this.recoveryInfo.recoveryUrl=e,a.sessionId&&!o||(a.sessionId=Zv.generateStandardUuid()),a.domainPolicy=a.domainPolicy||Kk.USER_DOMIAN,a.schedulePolicy=a.schedulePolicy||Wk.DNS,this.startPlayOptions=a;const l=a.recover;this.checkRecover(l),this.startPlayOptions.poster&&this.startPlayOptions.poster.url&&SP.preLoadPoster(this.startPlayOptions.poster.url),this.loadingconfig=_U(_U({},{netQualityLoading:!1,netQualityLoadingThreshold:jk.NETWORK_QUALITY_BAD}),ik.getParameter(JI)||{}),await this.connectionsManager.initConnectionAndSdp({receiveVideo:!1!==(null===(t=this.startPlayOptions.webrtcConfig)||void 0===t?void 0:t.receiveVideo),receiveAudio:!1!==(null===(r=this.startPlayOptions.webrtcConfig)||void 0===r?void 0:r.receiveAudio)},{onTrackHandler:this.onTrackHandler.bind(this)});const c=this.connectionsManager.modifySdpCandidates(),d=[],u=[];if(s===Dk.COMMON_STANDARD){const{policy:t,userIp:r,routeType:i}=await this.getPullStreamDomain(e,a,d);wD.getInstance(this.identifiedId).updateClientAddr(r);for(let e of this.domains)/^https?:\/\/.+/g.test(e)||(e="https://".concat(e)),u.push(/\/pullstream\??/.test(e)?e:"".concat(e).concat(Dh.NEGOTIATE_SDP_URL_PATH));t&&(e="".concat(e).concat(e.indexOf("?")>0?"&":"?","policy=").concat(t)),this.setInputParams(e,i)}else u.push(e),this.setInputParams(e);const h=await this.negotiateSDP(u,e,{offerSdp:c,sdpNegotiateMode:s,sessionId:a.sessionId,joinQos:d,autoRetry:l});if(null===h)return void Qv.error(vU,"answerSdp is null");const f=wD.getInstance(this.identifiedId).getSfuInfo();f.aSsrc&&f.vSsrc||!1===(null===(i=this.startPlayOptions.webrtcConfig)||void 0===i?void 0:i.receiveVideo)||!1===(null===(n=this.startPlayOptions.webrtcConfig)||void 0===n?void 0:n.receiveAudio)||(this.connectionsManager.destroyPeerConnection(),await this.connectionsManager.initConnectionAndSdp({receiveVideo:!!f.vSsrc,receiveAudio:!!f.aSsrc},{onTrackHandler:this.onTrackHandler.bind(this)})),this.addStartPlayEvent(!!f.aSsrc,!!f.vSsrc),await this.connectionsManager.handleAnswerSdpFromServer(h)}addStartPlayEvent(e,t){e&&(super.off(Hk.AUDIO_START,this.firstFrameHandler.audioHandler),super.once(Hk.AUDIO_START,this.firstFrameHandler.audioHandler),vD.off("audio_start_".concat(this.connectionsManager.getConnectionId())),vD.on("audio_start_".concat(this.connectionsManager.getConnectionId()),(()=>{this.eventEmitter.listeners(Hk.AUDIO_START).find((e=>e===this.firstFrameHandler.audioHandler))&&this.eventEmitter.emit(Hk.AUDIO_START)}))),t&&(super.off(Hk.VIDEO_START,this.firstFrameHandler.videoHandler),super.once(Hk.VIDEO_START,this.firstFrameHandler.videoHandler),vD.off("video_start_".concat(this.connectionsManager.getConnectionId())),vD.on("video_start_".concat(this.connectionsManager.getConnectionId()),(()=>{this.eventEmitter.listeners(Hk.VIDEO_START).find((e=>e===this.firstFrameHandler.videoHandler))&&this.eventEmitter.emit(Hk.VIDEO_START)})),vD.off("video_broken_".concat(this.connectionsManager.getConnectionId())),vD.on("video_broken_".concat(this.connectionsManager.getConnectionId()),(()=>{this.recoveryInfo.recoveryTimer||0!=this.recoveryInfo.retryTimes?Qv.info(vU,"the recovery timer is running..."):this.autoRecoverPlay(this.recoveryInfo.recoveryUrl,this.videoRecoveryInfo.interval,this.videoRecoveryInfo.retryTimes)})))}async getPullStreamDomain(e,t,r){const i=ik.getParameter(QI);if(i)this.domains=[i];else if(t.domainPolicy===Kk.SHARE_DOMAIN)this.domains=Dh.SHARE_PULL_DOMAIN;else{const t=/(?:webrtc):\/\/([^\/]+)\/.*/gi.exec(e);t&&2===t.length&&(this.domains=[t[1]])}const n={policy:null,userIp:null,routeType:Vk.DNS};try{if(wD.getInstance(this.identifiedId).updatePlayTrackKpi("glsbRequest"),t.schedulePolicy===Wk.HTTPDNS){let e=ik.getParameter(tk)||Dh.GSLB_DOMAIN;/^https?:\/\/.+/g.test(e)||(e="https://".concat(e));const t="".concat(e,"/v1/live/dns?dns=").concat(this.domains[0],"&withdomain=1&dualstack=1");if(t===Zv.responeInfo.gslbRequestUrl)this.gslbResponeProcess(Zv.responeInfo.respone,n);else{const e=await jv.fetch([t],{method:"GET",mode:"cors"},{"Content-Type":"application/json"},Dh.GSLB_REQUEST_TIMEOUT,1,r);this.gslbResponeProcess(e,n),Zv.gslbResponeConfigurationEnvironment(e)}}}catch(IU){Qv.error(vU,"gslb request failed: ".concat(IU))}finally{wD.getInstance(this.identifiedId).updatePlayTrackKpi("glsbRespone"),n.routeType!==Vk.GSLB&&this.domains&&this.domains.length>0&&ZF.dnsQuery(this.domains).then((e=>{Qv.info(vU,"dnsQuery get ip:".concat(e)),wD.getInstance(this.identifiedId).updateAccessAddr(e)}))}return n}gslbResponeProcess(e,t){var r;if(200===e.httpCode&&0===(null===(r=e.data)||void 0===r?void 0:r.errno)){const r=e.data.data[this.domains[0]],i=[];if(i.push(...(null==r?void 0:r.ips)||[],...(null==r?void 0:r.ipv6s)||[]),i.length>0){Qv.debug(vU,"gslb respone handle");const{ip:n,domain:s}=i[0];wD.getInstance(this.identifiedId).updateAccessAddr(n),this.domains=[s],t.policy=r.policy,t.userIp=e.data.user_ip,t.routeType=Vk.GSLB}}else Qv.error(vU,"gslb respone data error")}setInputParams(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vk.DNS;const r={sessionId:this.startPlayOptions.sessionId,routeType:t},i=/(?:webrtc|http(?:s?)):\/\/([^\/]+)\/([^\/]+)\/([^?]+).*/gi.exec(e);i&&4===i.length?(r.streamDomain=i[1],r.appName=i[2],r.streamName=i[3].replace(/\..*/,""),Qv.setExtraInfos({domain:r.streamDomain,appName:r.appName,streamName:r.streamName,svrsid:r.sessionId})):Qv.info(vU,"get domain / appName / streamName failed"),wD.getInstance(this.identifiedId).setStreamParams(r)}async negotiateSDP(e,t,r){Qv.info(vU,"[KPI] negotiateSDP begin"),wD.getInstance(this.identifiedId).updatePlayTrackKpi("negotiateSDPRequest");const i={httpCode:-1,retCode:-1,retMsg:""},n=this.setSdpInfo(t,r);r.joinQos.push({offersdp:r.offerSdp});try{return await this.getAnswerSdp(e,t,r,n,i)}catch(IU){Qv.error(vU,"[KPI] negotiateSDP occur error: ".concat(IU));const t=IU.getCode?IU.getCode():IU.name;if(-1===i.httpCode&&(i.httpCode=t),-1===i.retCode&&(i.retCode=t,i.retMsg=IU.getMsg?IU.getMsg():IU.message),this.canDowngrade(this.startPlayOptions)&&i.retCode>=400)return this.eventEmitter.emit(Yk),null;throw IU}finally{var s;null===(s=wD.getInstance(this.identifiedId))||void 0===s||s.updatePlayTrackKpi("negotiateSDPRespone"),setTimeout((()=>{this.stats.reportStartPullStreamReqEvent({httpCode:i.httpCode,retCode:i.retCode,retMsg:i.retMsg,joinQos:r.joinQos,autoRetry:r.autoRetry?1:0})}),1e3)}}async getAnswerSdp(e,t,r,i,n){var s;let a=await this.tryNegotiateFetch(e,r,i,!0);if(this.errMap.get(a.data.errcode||a.data.code)===Ph.HWLLS_ERROR_ENCODING_NOT_ACCEPTED&&(Qv.error(vU,"".concat(Oh[Ph.HWLLS_ERROR_ENCODING_NOT_ACCEPTED])),a=await this.tryNegotiateFetch(e,r,i,!1)),n.httpCode=a.httpCode,Qv.setExtraInfos({svrsid:a.data.svrsid}),wD.getInstance(this.identifiedId).setPullMediaParams({svrSid:a.data.svrsid,svrsig:a.data.svrsig,streamUrl:t,clientAddr:a.data.clientaddr}),n.retCode=isNaN(a.data.errcode)?a.data.code:a.data.errcode,n.retMsg=a.data.message||a.data.errmsg,0!==n.retCode&&200!==n.retCode)throw this.errMap.get(n.retCode)?new xh(this.errMap.get(n.retCode)):new xh(Ph.HWLLS_INTERNAL_ERROR,"".concat(n.retCode," _ ").concat(n.retMsg));const o=(a.data.remotesdp||a.data.remoteSdp).sdp;return null===(s=wD.getInstance(this.identifiedId))||void 0===s||s.setSfuInfo(this.connectionsManager.getSfuInfoFromSdp(o)),o}setSdpInfo(e,t){let r;return r=t.sdpNegotiateMode===Dk.COMMON_STANDARD?{sessionid:t.sessionId,streamurl:e,localsdp:{type:"offer",sdp:t.offerSdp}}:{version:"v1.0",sessionId:t.sessionId,localSdp:{type:"offer",sdp:t.offerSdp}},r}async tryNegotiateFetch(e,t,r,i){const n={request:JSON.stringify(r),header:{"Content-Type":"application/json"}};if(i)try{const e=pN.gzip(n.request,{to:"string"});n.request=e,n.header["Content-Encoding"]="gzip"}catch(IU){Qv.error(vU,"negotiateSDP gzip request failed")}const s=await jv.fetch(e,{method:"POST",body:n.request,mode:"cors"},n.header,Dh.PULLSTREAM_REQUEST_TIMEOUT,this.startPlayOptions.domainPolicy===Kk.SHARE_DOMAIN?$k.SHARE_DOMAIN_RETRY_TIMES:$k.USER_DOMAIN_RETRY_TIMES,t.joinQos);if(200!==s.httpCode)throw new xh(Ph.HWLLS_ERROR_SERVER_CONNECT_FAIL);if(!s.data||"{}"===JSON.stringify(s.data))throw Qv.error(vU,"negotiateSDP, respone is null"),new xh(Ph.HWLLS_INTERNAL_ERROR,"respone is null");return s}async stopSignal(){var e;Qv.info(vU,"stop signal...");const t=null===(e=wD.getInstance(this.identifiedId))||void 0===e?void 0:e.getPullMediaParams();if(null!=t&&t.svrsig)for(let r of this.domains)try{/^https?:\/\/.+/g.test(r)||(r="https://".concat(r));const e=/\/pullstream\??/.test(r)?r.replace(/(https?:\/\/[^\/]*)\/.*/g,"$1".concat(Dh.STOP_PLAY_URL_PATH)):"".concat(r).concat(Dh.STOP_PLAY_URL_PATH);await jv.fetch([e],{method:"POST",body:JSON.stringify({streamurl:t.streamUrl,svrsig:t.svrsig}),mode:"cors"},{"Content-Type":"application/json"});break}catch(IU){Qv.warn(vU,"stop stream signal failed: ".concat(IU))}else Qv.warn(vU,"stop stream signal failed, svrsig is null.")}onTrackHandler(e){Qv.info(vU,"peerconnection ontrack event: ".concat(e.track.kind));const t=e.track.kind;if(t===Pk.TRACK_TYPE_VIDEO||t===Pk.TRACK_TYPE_AUDIO){var r,i,n;this.liveStream||(this.liveStream=new DP(this.stats,this.eventEmitter)),this.liveStream.addRemoteTrack(e.track);const s=t===Pk.TRACK_TYPE_VIDEO;s&&(vD.off("video_stuck_".concat(this.connectionsManager.getConnectionId())),vD.on("video_stuck_".concat(this.connectionsManager.getConnectionId()),(e=>{!e&&this.loadingconfig.netQualityLoading&&this.preNetQuality>=this.loadingconfig.netQualityLoadingThreshold||this.eventEmitter.emit(Hk.VIDEO_STUCK,e)})),vD.off("video_broken_".concat(this.connectionsManager.getConnectionId())),vD.on("video_broken_".concat(this.connectionsManager.getConnectionId()),(()=>{this.recoveryInfo.recoveryTimer||0!=this.recoveryInfo.retryTimes?Qv.info(vU,"video broken, the recovery timer is running..."):this.autoRecoverPlay(this.recoveryInfo.recoveryUrl,this.videoRecoveryInfo.interval,this.videoRecoveryInfo.retryTimes)})));const a=null===(r=wD.getInstance(this.identifiedId))||void 0===r?void 0:r.getSfuInfo(),o=null===(i=wD.getInstance(this.identifiedId))||void 0===i?void 0:i.getStreamParams(),l=null===(n=wD.getInstance(this.identifiedId))||void 0===n?void 0:n.getPullMediaParams();this.liveStream.play(_U(_U({},this.playOption),{},{audio:!s,video:s})).catch((e=>{if(e instanceof xh&&(e.getCode()===Ph.HWLLS_PLAY_NOT_ALLOW||/The operation was aborted/gi.test(e.getMsg())))this.eventEmitter.emit("Error",{errCode:e.getCode(),errDesc:e.getMsg()});else{let r=xk.FAIL;if(e instanceof xh)if(e.getCode()!==Ph.HWLLS_PLAY_TIMEOUT){if(/interrupted by a new load request/gi.test(e.getMsg())&&(r=xk.INTERRUPT),!s&&a.aSsrc){this.eventEmitter.listeners(Hk.AUDIO_START).find((e=>e===this.firstFrameHandler.audioHandler))&&this.stats.reportPullMediaStreamResult(Pk.TRACK_TYPE_AUDIO,r,{playTrackKpi:this.prePlayTrackCache,sfuInfo:a,streamParams:o,mediaParams:l})}this.eventEmitter.emit("Error",{errCode:e.getCode(),errDesc:e.getMsg()})}else{if(this.connectionsManager.isConnectionEstablished()||(r=xk.CONNECTION_UNCOMPLETE),!s&&a.aSsrc){this.eventEmitter.listeners(Hk.AUDIO_START).find((e=>e===this.firstFrameHandler.audioHandler))&&(wD.getInstance(this.identifiedId).updatePlayTrackKpi("audioTimeOut"),this.stats.reportPullMediaStreamResult(Pk.TRACK_TYPE_AUDIO,r,{playTrackKpi:this.prePlayTrackCache,sfuInfo:a,streamParams:o,mediaParams:l}))}wD.getInstance(this.identifiedId).updatePlayTrackKpi("".concat(s?"video":"audio","TimeOut")),!this.receivedFirstFrame&&this.canDowngrade(this.startPlayOptions)?this.eventEmitter.emit(Yk,e):this.eventEmitter.emit("Error",{errCode:e.getCode(),errDesc:e.getMsg()})}else this.eventEmitter.emit("Error",{errCode:Ph.HWLLS_INTERNAL_ERROR,errDesc:Oh[Ph.HWLLS_INTERNAL_ERROR]});this.stats.reportPullMediaStreamResult(t,r,{playTrackKpi:this.prePlayTrackCache,sfuInfo:a,streamParams:o,mediaParams:l})}})),this.stats.startMediaStatistic()}}resetClient4Switch(){var e;this.stats.cancelMediaStatistic(),this.connectionsManager.destroyPeerConnection(),this.prePlayTrackCache=null===(e=wD.getInstance(this.identifiedId))||void 0===e?void 0:e.getPlayTrackKpi(),wD.delInstance(this.identifiedId),clearTimeout(this.debugStatisticTimer.timer),clearTimeout(this.detectTimer.timer),clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.retryTimes=0}resetClient4Stop(){var e,t;this.stats.cancelMediaStatistic(),this.connectionsManager.destroyPeerConnection(),this.prePlayTrackCache=null===(e=wD.getInstance(this.identifiedId))||void 0===e?void 0:e.getPlayTrackKpi(),wD.delInstance(this.identifiedId),clearTimeout(this.debugStatisticTimer.timer),clearTimeout(this.detectTimer.timer),clearTimeout(this.netQualityTimer),this.netQualityTimer=null,this.preNetQuality=jk.NETWORK_QUALITY_INIT,clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.retryTimes=0,this.recoveryInfo.recoveryUrl=null,null===(t=this.liveStream)||void 0===t||t.destory(),this.liveStream=null,this.startPlayOptions=null}resetClient(e){var t,r;this.stats.cancelMediaStatistic(),this.connectionsManager.destroyPeerConnection(),this.prePlayTrackCache=null===(t=wD.getInstance(this.identifiedId))||void 0===t?void 0:t.getPlayTrackKpi(),e||wD.delInstance(this.identifiedId),clearTimeout(this.debugStatisticTimer.timer),this.debugStatisticTimer={timer:null,interval:1},clearTimeout(this.detectTimer.timer),this.detectTimer={timer:null,interval:3,interruptRetry:null},clearTimeout(this.netQualityTimer),this.netQualityTimer=null,clearTimeout(this.recoveryInfo.recoveryTimer),this.recoveryInfo.retryTimes=0,this.recoveryInfo.recoveryUrl=null,null===(r=this.liveStream)||void 0===r||r.destory(),this.liveStream=null,this.startPlayOptions=null,this.preNetQuality=jk.NETWORK_QUALITY_INIT}getStreamStatisticInfo(e,t){this.debugStatisticTimer.interval=t,this.debugStatisticTimer.timer=setTimeout((()=>{clearTimeout(this.debugStatisticTimer.timer);const r=wD.getInstance(this.identifiedId).getSfuInfo(),i={};if(r.aSsrc){const n=SD.getLeastestAudioInfo(this.connectionsManager.getConnectionId(),r.aSsrc),s=wD.getInstance(this.identifiedId).getMediaFreezeStatistic(Pk.TRACK_TYPE_AUDIO);if(n){const r=0!==e.audioReceiveBytes?Math.round(8*(Zv.getValue(n.bytesReceived,0)-e.audioReceiveBytes)/1e3):0;i.audio={mediaType:Pk.TRACK_TYPE_AUDIO,codec:"OPUS",bitRate:Math.round(1e3*r/(1e3*t)),packetsLost:Math.max(Zv.getValue(n.packetsLost,0),0),jitter:Math.floor(1e3*Zv.getValue(n.jitter,0)),bytesReceived:Zv.getValue(n.bytesReceived,0),packetsReceived:Zv.getValue(n.packetsReceived,0),freeze200Count:s.freeze200Count,freeze200Duration:s.freeze200Duration},e.audioReceiveBytes=Zv.getValue(n.bytesReceived,0)}}if(r.vSsrc){const n=SD.getLeastestVideoInfo(this.connectionsManager.getConnectionId(),r.vSsrc);if(n){const r=0!==e.videoReceiveBytes?Math.round(8*(Zv.getValue(n.bytesReceived,0)-e.videoReceiveBytes)/1e3):0,s=0!==e.videoFrames?Zv.getValue(n.framesDecoded,0)-e.videoFrames:0;e.videoFrames=Zv.getValue(n.framesDecoded,0);const a=wD.getInstance(this.identifiedId).getMediaFreezeStatistic(Pk.TRACK_TYPE_VIDEO);i.video={mediaType:Pk.TRACK_TYPE_VIDEO,codec:"H264",jitter:Math.floor(1e3*Zv.getValue(n.jitter,0)),bitRate:Math.round(1e3*r/(1e3*t)),bytesReceived:Zv.getValue(n.bytesReceived,0),packetsReceived:Zv.getValue(n.packetsReceived,0),packetsLost:Math.max(Zv.getValue(n.packetsLost,0),0),frameRate:Math.ceil(1e3*s/(1e3*t)),width:Zv.getValue(n.frameWidth,0),height:Zv.getValue(n.frameHeight,0),freeze200Count:a.freeze200Count,freeze200Duration:a.freeze200Duration,freeze600Count:a.freeze600Count,freeze600Duration:a.freeze600Duration},e.videoReceiveBytes=Zv.getValue(n.bytesReceived,0)}}this.eventEmitter.emit(Hk.MEDIA_STATISTIC,i),this.getStreamStatisticInfo(e,t)}),1e3*t)}canDowngrade(e){return!(!e.downgradeUrl||!e.downgradeUrl.hlsUrl&&!e.downgradeUrl.flvUrl)}async checkDowngrade(e){this.eventEmitter.once(Yk,(()=>{this.downgraded=!0,window.onbeforeunload=null,this.resetClient(!0)})),this.autoDowngradeManager=new HN(e,this.eventEmitter);let t=!1;if(!this.canDowngrade(e))return Qv.error(vU,"user has not set downgrade url"),t;try{await BC.checkSystemRequirements()}catch(ZO){Qv.error(vU,"checkSystemRequirements failed, ".concat(ZO.toString())),this.eventEmitter.emit(Yk,ZO),t=!0}return t}},t(gU.prototype,"startPlay",[XF],Object.getOwnPropertyDescriptor(gU.prototype,"startPlay"),gU.prototype),t(gU.prototype,"startPlayCustomize",[JF],Object.getOwnPropertyDescriptor(gU.prototype,"startPlayCustomize"),gU.prototype),t(gU.prototype,"switchPlay",[QF],Object.getOwnPropertyDescriptor(gU.prototype,"switchPlay"),gU.prototype),t(gU.prototype,"stopPlay",[eU],Object.getOwnPropertyDescriptor(gU.prototype,"stopPlay"),gU.prototype),t(gU.prototype,"replay",[tU],Object.getOwnPropertyDescriptor(gU.prototype,"replay"),gU.prototype),t(gU.prototype,"resume",[rU],Object.getOwnPropertyDescriptor(gU.prototype,"resume"),gU.prototype),t(gU.prototype,"pause",[iU],Object.getOwnPropertyDescriptor(gU.prototype,"pause"),gU.prototype),t(gU.prototype,"pauseVideo",[nU],Object.getOwnPropertyDescriptor(gU.prototype,"pauseVideo"),gU.prototype),t(gU.prototype,"resumeVideo",[sU],Object.getOwnPropertyDescriptor(gU.prototype,"resumeVideo"),gU.prototype),t(gU.prototype,"pauseAudio",[aU],Object.getOwnPropertyDescriptor(gU.prototype,"pauseAudio"),gU.prototype),t(gU.prototype,"resumeAudio",[oU],Object.getOwnPropertyDescriptor(gU.prototype,"resumeAudio"),gU.prototype),t(gU.prototype,"setPlayoutVolume",[lU],Object.getOwnPropertyDescriptor(gU.prototype,"setPlayoutVolume"),gU.prototype),t(gU.prototype,"getPlayoutVolume",[cU],Object.getOwnPropertyDescriptor(gU.prototype,"getPlayoutVolume"),gU.prototype),t(gU.prototype,"muteAudio",[dU],Object.getOwnPropertyDescriptor(gU.prototype,"muteAudio"),gU.prototype),t(gU.prototype,"streamStatistic",[uU],Object.getOwnPropertyDescriptor(gU.prototype,"streamStatistic"),gU.prototype),t(gU.prototype,"destoryClient",[hU],Object.getOwnPropertyDescriptor(gU.prototype,"destoryClient"),gU.prototype),t(gU.prototype,"fullScreenToggle",[fU],Object.getOwnPropertyDescriptor(gU.prototype,"fullScreenToggle"),gU.prototype),t(gU.prototype,"enableStreamStateDetection",[pU],Object.getOwnPropertyDescriptor(gU.prototype,"enableStreamStateDetection"),gU.prototype),t(gU.prototype,"sendMessage",[mU],Object.getOwnPropertyDescriptor(gU.prototype,"sendMessage"),gU.prototype),gU);var SU,TU,bU,RU,wU,AU,LU;const CU=new(SU=dk("HWLLSEnter$getVersion#string#void"),TU=ck("HWLLSEnter$checkSystemRequirements#Promise<boolean>#void"),bU=dk("HWLLSEnter$setParameter#boolean#string#string"),RU=dk("HWLLSEnter$createClient#HWLLSClient|HWFlvClient#void"),wU=dk("HWLLSEnter$uploadLog#Promise<void>#void"),AU=dk("HWLLSEnter$setLogLevel#boolean#string"),t((LU=class extends kD{constructor(){super("HWLLSEnter"),Zv.configurationEnvironment()}getVersion(){return Dh.SDK_VERSION}async checkSystemRequirements(){return await BC.checkSystemRequirements()}setParameter(e,t){return ik.setParameter(e,t)}createClient(e){if(!e||e===zk.WEBRTC)return new EU;if(e===zk.HLS&&BC.hlsCapabilityCheck())return new UN;if(e===zk.FLV&&BC.flvCapabilityCheck())return new yN;throw new xh(Ph.HWLLS_ERROR_INVALID_PARAMETER)}uploadLog(){return Qv.uploadLog()}async saveLog(){return(await Qv.getLogFileInfo()).content}setLogLevel(e){return Qv.setLogLevel(e)}}).prototype,"getVersion",[SU],Object.getOwnPropertyDescriptor(LU.prototype,"getVersion"),LU.prototype),t(LU.prototype,"checkSystemRequirements",[TU],Object.getOwnPropertyDescriptor(LU.prototype,"checkSystemRequirements"),LU.prototype),t(LU.prototype,"setParameter",[bU],Object.getOwnPropertyDescriptor(LU.prototype,"setParameter"),LU.prototype),t(LU.prototype,"createClient",[RU],Object.getOwnPropertyDescriptor(LU.prototype,"createClient"),LU.prototype),t(LU.prototype,"uploadLog",[wU],Object.getOwnPropertyDescriptor(LU.prototype,"uploadLog"),LU.prototype),t(LU.prototype,"setLogLevel",[AU],Object.getOwnPropertyDescriptor(LU.prototype,"setLogLevel"),LU.prototype),LU);return{getVersion:CU.getVersion.bind(CU),checkSystemRequirements:CU.checkSystemRequirements.bind(CU),setParameter:CU.setParameter.bind(CU),createClient:CU.createClient.bind(CU),saveLog:CU.saveLog.bind(CU),setLogLevel:CU.setLogLevel.bind(CU),uploadLog:CU.uploadLog.bind(CU)}}));
